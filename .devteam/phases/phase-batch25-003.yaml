phase_id: 3
description: "Agenda tab integration + Home tab + Tab layout + Presentation mode + Permissions + Regression + Tests"
status: completed
features:
  - id: F157
    name: "Managed Prayers - Phase 3"
    cr: CR-221
    status: completed
artifacts_produced:
  - docs/plans/PLAN_P046.yaml
  - docs/qa/QA_PLAN_042.yaml
commits:
  - {hash: "3ca6a1d", message: "feat(agenda-form): change prayer data source to speeches and add conditional editing (CR-221, STEP-11)"}
  - {hash: "c471b27", message: "feat(agenda): change collapsed card prayer count to read from speeches positions 0/4 (CR-221, STEP-12)"}
  - {hash: "fd885ad", message: "feat(home): dynamic section title and prayer count from speeches (CR-221, STEP-13)"}
  - {hash: "7369378", message: "feat(layout): dynamic Speeches tab label based on manage_prayers toggle (CR-221, STEP-15)"}
  - {hash: "1fd2899", message: "feat(presentation): read prayer data from speeches positions 0/4 (CR-221, STEP-19)"}
  - {hash: "4efc613", message: "test(batch25): add 156 tests for F157 CR-221 Phase 3 (Steps 11-22)"}
  - {hash: "1498c4f", message: "fix(tests): update superseded assertions for Phase 3 code changes (R-3)"}
  - {hash: "76e1e9a", message: "docs(code-ledger): add Phase 3 commits for CR-221 (Steps 11-22)"}
  - {hash: "0db48f7", message: "docs(tests): update TEST_CONSOLIDATED for Phase 3"}
  - {hash: "b95b7cd", message: "fix(home): use sectionTitleText in NextAssignmentsSection normal render path (CR-221, R-1)"}
  - {hash: "d88cb88", message: "docs(code-ledger): add R-1 fix commit entry (CR-221)"}
decisions:
  - "ARCH_M044 covers all 3 phases, no new ARCH needed for Phase 3"
  - "PLAN_P046 created as Phase 3 subset of PLAN_P044 (Steps 11, 12, 13, 15, 19, 20, 21, 22)"
  - "STEP-18 (Sunday type change) was already implemented in Phase 2 STEP-10"
  - "STEP-14 (InviteManagement) was already implemented in Phase 2"
  - "STEP-20 (Permissions) and STEP-21 (Regression) verified implicitly via tests"
  - "SundayAgenda type cleanup (4 prayer fields in database.ts) deferred - not blocking"
  - "R-1 fix: NextAssignmentsSection line 152 hardcoded title replaced with sectionTitleText"
handoff_notes: "CR-221 Managed Prayers feature is COMPLETE across all 3 phases. Deferred item: SundayAgenda interface in database.ts still has 4 legacy prayer fields (opening_prayer_member_id, opening_prayer_name, closing_prayer_member_id, closing_prayer_name) that are no longer used by production code. Consider cleanup in a future batch."
