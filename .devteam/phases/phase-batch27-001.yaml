phase_id: 1
description: "Split speech WhatsApp template into 3 individual templates, remove {posicao}"
status: completed
features: [{id: F159, name: "Individual WhatsApp templates per speech position", status: completed}]
change_requests: [CR-231]
artifacts_produced:
  - "docs/specs/SPEC_F159.yaml"
  - "docs/arch/ARCH_M159.yaml"
  - "docs/plans/PLAN_P048.yaml"
  - "docs/qa/QA_PLAN_008.yaml"
  - "src/__tests__/batch27-f159.test.ts"
  - "supabase/migrations/020_split_speech_template.sql"
commits:
  - {hash: "e48ee14", message: "feat(migration): add 3 speech template columns and drop old column (CR-231)"}
  - {hash: "86e6a33", message: "feat(types): update Ward interface with 3 speech template columns (CR-231)"}
  - {hash: "021debe", message: "feat(whatsapp): 9 default speech templates, remove {posicao} placeholder (CR-231)"}
  - {hash: "824f757", message: "refactor(whatsapp): update re-exports for speech template split (CR-231)"}
  - {hash: "cbd60b2", message: "feat(invite): select speech template by position, remove position variable (CR-231)"}
  - {hash: "821ad8c", message: "feat(settings): 5-tab segmented control for speech template editing (CR-231)"}
  - {hash: "3d559ed", message: "feat(settings): reset all 5 template columns on language change (CR-231)"}
  - {hash: "0fed6a2", message: "feat(edge): create ward with 3 per-position speech template columns (CR-231)"}
  - {hash: "97cde32", message: "feat(i18n): remove placeholderPosition, add 3 speech tab labels (CR-231)"}
  - {hash: "de736d0", message: "test(f159): add 70 tests for CR-231 speech template split"}
  - {hash: "039d575", message: "fix(test): update existing tests for speech template split API changes (CR-231)"}
  - {hash: "3ebd62b", message: "docs(code-ledger): add Batch 27 F159 commit entries for CR-231"}
  - {hash: "a056295", message: "fix(cr-231): remove stale position field references (R-1, R-2, R-3)"}
  - {hash: "c21ff34", message: "docs(code-ledger): add R-1/R-2/R-3 fix commit entry (CR-231)"}
decisions:
  - "ADR-112: 3 separate DB columns per speech position"
  - "ADR-113: Segmented control always visible (3-5 tabs)"
  - "DD-159-01: Migration copies existing template to all 3 columns"
  - "DD-159-02: Tab labels abbreviated"
  - "DD-159-03: Ordinals embedded in default text"
  - "DD-159-04: {posicao} left as literal in migrated custom templates"
handoff_notes: "Project complete. Pending deploys: run migration 020 + redeploy register-first-user edge function."
