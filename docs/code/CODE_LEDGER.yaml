# =============================================================================
# CODE_LEDGER.yaml
# Tracks commits made for CR-82, CR-80, CR-83, CR-84, CR-85, CR-86, CR-90,
# CR-87, CR-88, CR-89, CR-91, CR-92, CR-93, CR-95, CR-98,
# CR-94, CR-96, CR-97, CR-99, CR-100,
# CR-101, CR-102, CR-103, CR-104, CR-108, CR-109,
# CR-105, CR-106, CR-107, CR-110, CR-111,
# CR-112, CR-113, CR-117, CR-122, CR-125,
# CR-114, CR-115, CR-116, CR-119, CR-121
# Generated: 2026-02-19
# =============================================================================

metadata:
  project: Sacrament Meeting Planner
  change_requests: [CR-82, CR-80, CR-83, CR-84, CR-85, CR-86, CR-90, CR-87, CR-88, CR-89, CR-91, CR-92, CR-93, CR-95, CR-98, CR-94, CR-96, CR-97, CR-99, CR-100, CR-101, CR-102, CR-103, CR-104, CR-108, CR-109, CR-105, CR-106, CR-107, CR-110, CR-111, CR-112, CR-113, CR-117, CR-122, CR-125, CR-114, CR-115, CR-116, CR-119, CR-121]
  plan_ref: plans/PLAN_P018.yaml
  arch_ref: arch/ARCH_M018.yaml
  spec_ref: specs/SPEC_F060_F064.yaml

commits:

  # --- CR-82 commits ---

  - step: 1
    cr: CR-82
    hash: ee9d84d
    message: "fix(layout): add GestureHandlerRootView wrapper to root layout (CR-82)"
    files_changed:
      - src/app/_layout.tsx
    changes:
      - id: CHG-01
        description: "Added import { GestureHandlerRootView } from 'react-native-gesture-handler'"
      - id: CHG-02
        description: "Wrapped provider tree with <GestureHandlerRootView style={{ flex: 1 }}> inside ErrorBoundary"
    acs_covered: [AC-001, AC-002, AC-003, AC-004, AC-005, AC-006]
    ecs_covered: [EC-001]

  - step: 2
    cr: CR-82
    hash: 37e880b
    message: "test(layout): add tests for GestureHandlerRootView wrapper (CR-82)"
    files_changed:
      - src/__tests__/cr082-gesture-handler-root.test.ts
    tests_added: 9
    test_ids: [T-001, T-002, T-003, T-004, T-005, T-006, T-007, T-008, T-009]
    acs_covered: [AC-001, AC-002, AC-003, AC-004, AC-005, AC-006]
    ecs_covered: [EC-001, EC-002]

  # --- CR-80 commits ---

  - step: 1
    cr: CR-80
    plan_ref: plans/PLAN_P010.yaml
    plan_step: STEP-01
    hash: 9359348
    message: "feat(i18n): add members.description and members.csvHelp keys in pt-BR/en/es (CR-80)"
    files_changed:
      - src/i18n/locales/en.json
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-03
        description: "Added members.description key with English text to en.json"
      - id: CHG-04
        description: "Added members.csvHelp key with English text to en.json"
      - id: CHG-05
        description: "Added members.description key with Portuguese text to pt-BR.json"
      - id: CHG-06
        description: "Added members.csvHelp key with Portuguese text to pt-BR.json"
      - id: CHG-07
        description: "Added members.description key with Spanish text to es.json"
      - id: CHG-08
        description: "Added members.csvHelp key with Spanish text to es.json"
    acs_covered: [AC-4, AC-5, AC-6]
    ecs_covered: [EC-2]

  - step: 2
    cr: CR-80
    plan_ref: plans/PLAN_P010.yaml
    plan_step: STEP-02
    hash: 84bea70
    message: "feat(members): add description and csvHelp explanatory texts (CR-80)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-09
        description: "Added <Text> with t('members.description') between header and searchContainer"
      - id: CHG-10
        description: "Added <Text> with t('members.csvHelp') inside canImport block after csvActions"
      - id: CHG-11
        description: "Added description style (fontSize 13, textAlign center, paddingHorizontal 16, marginBottom 8)"
      - id: CHG-12
        description: "Added csvHelp style (fontSize 12, paddingHorizontal 16, marginBottom 8)"
      - id: CHG-13
        description: "Wrapped canImport block content with React Fragment to include csvHelp text"
    acs_covered: [AC-1, AC-2, AC-3]
    ecs_covered: [EC-1, EC-3]

  - step: 3
    cr: CR-80
    plan_ref: plans/PLAN_P010.yaml
    plan_step: STEP-03
    hash: null
    message: "Regression verification (no code changes)"
    files_changed: []
    changes: []
    acs_covered: [AC-7]
    ecs_covered: [EC-2]

  # --- Batch 6, Phase 1: CR-83, CR-84, CR-85, CR-86, CR-90 ---

  - step: STEP-01
    cr: CR-90
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-01
    hash: 298258c
    message: "fix(swipeable): add pointerEvents box-none to fix Delete button touch (CR-90)"
    files_changed:
      - src/components/SwipeableCard.tsx
    changes:
      - id: CHG-14
        description: "Added pointerEvents='box-none' to Animated.View wrapping card content"
      - id: CHG-15
        description: "Moved backgroundColor from Animated.View style to inner <View> wrapper"
    acs_covered: [AC-F031-01, AC-F031-02, AC-F031-03, AC-F031-04]

  - step: STEP-02
    cr: CR-83
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-02
    hash: 89b5dc9
    message: "feat(members): replace onBlur auto-save with Save/Cancel buttons (CR-83)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-16
        description: "Removed onBlur={handleSave} from name and phone TextInputs"
      - id: CHG-17
        description: "Made onCancel required in MemberEditorProps"
      - id: CHG-18
        description: "Added Save/Cancel Pressable buttons below phone row"
      - id: CHG-19
        description: "Added editorButtons, cancelButton, saveButton styles"
      - id: CHG-20
        description: "Updated MemberRow to pass onCancel to MemberEditor"
    acs_covered: [AC-F027-01, AC-F027-02, AC-F027-03, AC-F027-04, AC-F027-08]

  - step: STEP-03
    cr: CR-83
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-03
    hash: 1970e71
    message: "feat(topics): replace onBlur auto-save with Save/Cancel buttons (CR-83)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-21
        description: "Removed onBlur={handleSave} from title and link TextInputs"
      - id: CHG-22
        description: "Added onCancel prop to TopicEditorProps (required)"
      - id: CHG-23
        description: "Added Save/Cancel buttons below link input"
      - id: CHG-24
        description: "Updated TopicRow to pass onCancel to TopicEditor"
    acs_covered: [AC-F027-05, AC-F027-06, AC-F027-07, AC-F027-08]

  - step: STEP-04
    cr: CR-85
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-04
    hash: 8d0f6c4
    message: "feat(lib): create countryCodes.ts with ~200 country codes and splitPhoneNumber (CR-85)"
    files_changed:
      - src/lib/countryCodes.ts
    changes:
      - id: CHG-25
        description: "Created countryCodes.ts with CountryCode interface, 172 entries, getFlagForCode, splitPhoneNumber"
    acs_covered: [AC-F029-01, AC-F029-02, AC-F029-04, AC-F029-05]

  - step: STEP-05
    cr: CR-85
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-05
    hash: 59eaba7
    message: "refactor(members,csv): use shared countryCodes.ts as single source of truth (CR-85)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
      - src/lib/csvUtils.ts
    changes:
      - id: CHG-26
        description: "Removed local CountryCode, COUNTRY_CODES, getFlagForCode from members.tsx"
      - id: CHG-27
        description: "Added import from countryCodes.ts in members.tsx"
      - id: CHG-28
        description: "Removed local splitPhoneNumber from csvUtils.ts, re-exported from countryCodes"
    acs_covered: [AC-F029-03]

  - step: STEP-06
    cr: CR-86
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-06
    hash: 5d65fb1
    message: "feat(i18n): add members.importConfirmTitle and importConfirmMessage keys (CR-86)"
    files_changed:
      - src/i18n/locales/en.json
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-29
        description: "Added importConfirmTitle and importConfirmMessage keys in en, pt-BR, es"
    acs_covered: [AC-F030-05]

  - step: STEP-07
    cr: CR-86
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-07
    hash: 5837628
    message: "feat(members): add confirmation dialog before CSV import (CR-86)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-30
        description: "Renamed handleImport to performImport (file picker logic)"
      - id: CHG-31
        description: "Created new handleImport with Alert.alert confirmation before import"
    acs_covered: [AC-F030-01, AC-F030-02, AC-F030-03, AC-F030-04]

  - step: STEP-08
    cr: CR-84
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-08
    hash: 8f2b42a
    message: "feat(components): create SearchInput component with clear X button (CR-84)"
    files_changed:
      - src/components/SearchInput.tsx
    changes:
      - id: CHG-32
        description: "Created SearchInput with useTheme internally, clear X button, paddingRight 36"
    acs_covered: [AC-F028-01, AC-F028-02, AC-F028-03, AC-F028-04, AC-F028-05]

  - step: STEP-09
    cr: CR-84
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-09
    hash: 27daf39
    message: "feat(settings): migrate search fields to SearchInput in 4 settings screens (CR-84)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
      - src/app/(tabs)/settings/topics.tsx
      - src/app/(tabs)/settings/history.tsx
      - src/app/(tabs)/settings/timezone.tsx
    changes:
      - id: CHG-33
        description: "Replaced search TextInput with SearchInput in members, topics, history, timezone"
      - id: CHG-34
        description: "Removed unused searchInput styles and TextInput imports where applicable"
    acs_covered: [AC-F028-06]

  - step: STEP-10
    cr: CR-84
    plan_ref: plans/PLAN_P011.yaml
    plan_step: STEP-10
    hash: ede8904
    message: "feat(components): migrate search fields to SearchInput in 6 modal/selector components (CR-84)"
    files_changed:
      - src/components/HymnSelector.tsx
      - src/components/MemberSelectorModal.tsx
      - src/components/TopicSelectorModal.tsx
      - src/components/PrayerSelector.tsx
      - src/components/ActorSelector.tsx
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-35
        description: "Replaced search TextInput with SearchInput in 6 modal/selector components"
      - id: CHG-36
        description: "Removed unused TextInput imports where applicable"
    acs_covered: [AC-F028-06]

  # --- Regression fixes from Phase 1 review ---

  - step: R-B6P1-01
    cr: CR-84
    hash: ac4b489
    message: "fix(tests): update CR-39 tests for SearchInput migration in topics.tsx (R-B6P1-01)"
    files_changed:
      - src/__tests__/cr003-qa.test.ts
    changes:
      - id: CHG-37
        description: "Updated AC-39.1 test to check for 'SearchInput' instead of 'searchInput' style"
      - id: CHG-38
        description: "Updated AC-39.5 test to verify SearchInput import and component styles"

  - step: R-B6P1-02
    cr: CR-86
    hash: 27a4383
    message: "fix(tests): update CSV import test to reference performImport after CR-86 refactor (R-B6P1-02)"
    files_changed:
      - src/__tests__/cr004-f005-csv-members.test.ts
    changes:
      - id: CHG-39
        description: "Updated test to extract performImport body instead of handleImport for error handling check"

  - step: R-B6P1-03
    cr: CR-84
    hash: 3b780d4
    message: "fix(tests): update CR-80 regression test for SearchInput migration in members.tsx (R-B6P1-03)"
    files_changed:
      - src/__tests__/cr080-f026-members-explanatory-texts.test.ts
    changes:
      - id: CHG-40
        description: "Updated AC-7 regression test to check for 'SearchInput' instead of 'searchInput'"

  # --- Batch 6, Phase 2: CR-87, CR-88, CR-89 ---

  - step: STEP-01
    cr: CR-87
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-01
    hash: 4e0fbb7
    message: "feat(swipeable): replace Edit/Delete text with Unicode icons pencil/trash (CR-87)"
    files_changed:
      - src/components/SwipeableCard.tsx
    changes:
      - id: CHG-41
        description: "Replaced Edit button Text content from editLabel to pencil Unicode character (U+270F)"
      - id: CHG-42
        description: "Replaced Delete button Text content from deleteLabel to wastebasket Unicode character (U+1F5D1)"
      - id: CHG-43
        description: "Changed both Text styles from styles.actionText to styles.actionIcon"
      - id: CHG-44
        description: "Added actionIcon style with fontSize 20 and textAlign center"
    acs_covered: [AC-F032-01, AC-F032-02, AC-F032-03, AC-F032-04, AC-F032-05]

  - step: STEP-02
    cr: CR-88
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-02
    hash: 98dbee2
    message: "feat(i18n): add topics.description and topics.noTopics keys in 3 locales (CR-88)"
    files_changed:
      - src/i18n/locales/en.json
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-45
        description: "Added topics.description key with explanatory text in en.json"
      - id: CHG-46
        description: "Added topics.noTopics key ('No topics in this collection') in en.json"
      - id: CHG-47
        description: "Added topics.description key with Portuguese text in pt-BR.json"
      - id: CHG-48
        description: "Added topics.noTopics key ('Nenhum tema nesta colecao') in pt-BR.json"
      - id: CHG-49
        description: "Added topics.description key with Spanish text in es.json"
      - id: CHG-50
        description: "Added topics.noTopics key ('No hay temas en esta coleccion') in es.json"
    acs_covered: [AC-F033-03, AC-F033-06]

  - step: STEP-03
    cr: CR-88
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-03
    hash: 8431360
    message: "feat(topics): add explanatory description text below header (CR-88)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-51
        description: "Added <Text> with t('topics.description') between header and Ward Topics section"
      - id: CHG-52
        description: "Added description style (fontSize 13, textAlign center, paddingHorizontal 16, marginBottom 8)"
    acs_covered: [AC-F033-01, AC-F033-02, AC-F033-04, AC-F033-05]

  - step: STEP-04
    cr: CR-89
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-04
    hash: 445f7b7
    message: "feat(hooks): add useCollectionTopics hook for lazy-loading collection topics (CR-89)"
    files_changed:
      - src/hooks/useTopics.ts
    changes:
      - id: CHG-53
        description: "Added collectionTopics key function to topicKeys"
      - id: CHG-54
        description: "Added useCollectionTopics hook that queries general_topics by collection_id, ordered by title"
    acs_covered: [AC-F034-03]

  - step: STEP-05
    cr: CR-89
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-05
    hash: d2c9c0a
    message: "feat(topics): make CollectionRow tappable with chevron indicator (CR-89)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-55
        description: "Added isExpanded and onPress props to CollectionRowProps interface"
      - id: CHG-56
        description: "Wrapped chevron + name in Pressable with onPress handler"
      - id: CHG-57
        description: "Added chevron Text showing U+25B6 (collapsed) or U+25BC (expanded)"
      - id: CHG-58
        description: "Added collectionPressable and chevron styles"
    acs_covered: [AC-F034-06, AC-F034-08]

  - step: STEP-06
    cr: CR-89
    plan_ref: plans/PLAN_P012.yaml
    plan_step: STEP-06
    hash: 9e41fec
    message: "feat(topics): add expand/collapse collection topics view with accordion pattern (CR-89)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-59
        description: "Added ActivityIndicator import and useCollectionTopics import"
      - id: CHG-60
        description: "Added expandedCollectionId state (string | null)"
      - id: CHG-61
        description: "Added handleCollectionPress handler with toggle logic"
      - id: CHG-62
        description: "Created CollectionTopicsList inline component with loading, empty, and topics list states"
      - id: CHG-63
        description: "Updated collections map to use React.Fragment with CollectionRow + conditional CollectionTopicsList"
      - id: CHG-64
        description: "Added 7 new styles: collectionTopicsContainer, collectionTopicItem, collectionTopicTitle, collectionTopicLink, collectionTopicsLoading, collectionTopicsEmpty, collectionTopicsEmptyText"
    acs_covered: [AC-F034-01, AC-F034-02, AC-F034-03, AC-F034-04, AC-F034-05, AC-F034-07, AC-F034-08]

test_results:
  new_tests: 106
  new_tests_passing: 106
  full_suite_tests: 2716
  full_suite_passing: 2716
  full_suite_files: 56
  regressions: 0

  # --- Batch 7, Phase 1: CR-91, CR-92, CR-93, CR-95, CR-98 ---

  - step: STEP-01
    cr: CR-91
    plan_ref: plans/PLAN_P013.yaml
    plan_step: STEP-01
    hash: bdba1aa
    message: "fix(db): add SECURITY DEFINER to enqueue_speech_notification trigger (CR-91)"
    files_changed:
      - supabase/migrations/013_fix_notification_trigger_security_definer.sql
    changes:
      - id: CHG-65
        description: "Created migration 013 with CREATE OR REPLACE FUNCTION enqueue_speech_notification() SECURITY DEFINER"
    acs_covered: [AC-F035-01, AC-F035-02, AC-F035-03, AC-F035-04]
    ecs_covered: [EC-F035-01, EC-F035-02, EC-F035-03, EC-F035-04]

  - step: STEP-02
    cr: CR-92
    plan_ref: plans/PLAN_P013.yaml
    plan_step: STEP-02
    hash: e091833
    message: "fix(members): change keyExtractor to item.label to fix duplicate key warning (CR-92)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-66
        description: "Changed FlatList keyExtractor from item.code to item.label in country code picker"
    acs_covered: [AC-F036-01, AC-F036-02, AC-F036-03, AC-F036-04, AC-F036-05]
    ecs_covered: [EC-F036-01]

  - step: STEP-03
    cr: CR-93
    plan_ref: plans/PLAN_P013.yaml
    plan_step: STEP-03
    hash: 313dc67
    message: "fix(deeplink): change protocol from wardmanager:// to sacrmeetman:// (CR-93)"
    files_changed:
      - app.json
      - supabase/functions/create-invitation/index.ts
    changes:
      - id: CHG-67
        description: "Changed expo.scheme from 'wardmanager' to 'sacrmeetman' in app.json"
      - id: CHG-68
        description: "Changed deep link from wardmanager://invite/ to sacrmeetman://invite/ in create-invitation Edge Function"
    acs_covered: [AC-F037-01, AC-F037-02, AC-F037-03, AC-F037-04]
    ecs_covered: [EC-F037-01, EC-F037-02]

  - step: STEP-04
    cr: CR-95
    plan_ref: plans/PLAN_P013.yaml
    plan_step: STEP-04
    hash: 1420ed2
    message: "fix(speeches): hide speech slots for all non-speeches types (CR-95)"
    files_changed:
      - src/app/(tabs)/speeches.tsx
      - src/__tests__/cr002-qa.test.ts
      - src/__tests__/cr001-qa-extended.test.ts
    changes:
      - id: CHG-69
        description: "Removed import of isExcludedFromAgenda from useAgenda in speeches.tsx"
      - id: CHG-70
        description: "Changed rendering condition from !(exception && isExcludedFromAgenda(exception.reason)) to (!exception || exception.reason === 'speeches')"
      - id: CHG-71
        description: "Updated cr002-qa.test.ts to assert speeches.tsx does NOT contain isExcludedFromAgenda and contains new pattern"
      - id: CHG-72
        description: "Updated cr001-qa-extended.test.ts to verify speeches.tsx uses direct type check instead of isExcludedFromAgenda"
    acs_covered: [AC-F038-01, AC-F038-02, AC-F038-03, AC-F038-04, AC-F038-05, AC-F038-06, AC-F038-07, AC-F038-08, AC-F038-09]
    ecs_covered: [EC-F038-01, EC-F038-02]

  - step: STEP-05
    cr: CR-98
    plan_ref: plans/PLAN_P013.yaml
    plan_step: STEP-05
    hash: 7a60ea8
    message: "fix(prayer): add visible/onClose props to PrayerSelector for immediate modal open (CR-98)"
    files_changed:
      - src/components/PrayerSelector.tsx
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-73
        description: "Added useEffect import to PrayerSelector.tsx"
      - id: CHG-74
        description: "Added visible?: boolean and onClose?: () => void props to PrayerSelectorProps interface"
      - id: CHG-75
        description: "Added useEffect to sync modalVisible with visible prop"
      - id: CHG-76
        description: "Added onClose?.() calls to all modal close handlers (cancel button, onRequestClose, handleSelectMember, handleCustomName)"
      - id: CHG-77
        description: "Added visible={true} and onClose={() => setSelectorModal(null)} to PrayerSelector in AgendaForm.tsx"
    acs_covered: [AC-F039-01, AC-F039-02, AC-F039-03, AC-F039-04, AC-F039-05, AC-F039-06, AC-F039-07]
    ecs_covered: [EC-F039-01, EC-F039-02, EC-F039-03]

batch7_phase1_test_results:
  full_suite_tests: 2716
  full_suite_passing: 2716
  full_suite_files: 56
  regressions: 0

  # --- Batch 7, Phase 2: CR-94, CR-96, CR-97, CR-99, CR-100 ---

  - step: STEP-01
    cr: CR-99
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-01
    hash: 88e7469
    message: "feat(i18n): change speeches.speaker label from Orador/Speaker to Discurso/Speech (CR-99)"
    files_changed:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-78
        description: "Changed speeches.speaker value from 'Orador' to 'Discurso' in pt-BR.json"
      - id: CHG-79
        description: "Changed speeches.speaker value from 'Speaker' to 'Speech' in en.json"
      - id: CHG-80
        description: "Changed speeches.speaker value from 'Orador' to 'Discurso' in es.json"
    acs_covered: [AC-F043-01, AC-F043-02, AC-F043-03]

  - step: STEP-02
    cr: CR-94
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-02
    hash: 390c518
    message: "feat(whatsapp): add i18n default templates EN/ES and language param to buildWhatsAppUrl (CR-94)"
    files_changed:
      - src/lib/whatsappUtils.ts
      - src/lib/whatsapp.ts
    changes:
      - id: CHG-81
        description: "Added DEFAULT_TEMPLATE_EN and DEFAULT_TEMPLATE_ES constants"
      - id: CHG-82
        description: "Added getDefaultTemplate(language) function with fallback to pt-BR"
      - id: CHG-83
        description: "Added language parameter to buildWhatsAppUrl with default 'pt-BR'"
      - id: CHG-84
        description: "Updated whatsapp.ts re-exports to include new symbols"
    acs_covered: [AC-F040-01, AC-F040-02, AC-F040-03, AC-F040-04]

  - step: STEP-03
    cr: CR-94
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-03
    hash: 4ba9413
    message: "feat(invite): pass ward language to buildWhatsAppUrl for i18n template selection (CR-94)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-85
        description: "Passed locale as 5th argument to buildWhatsAppUrl in handleNotInvitedAction"
      - id: CHG-86
        description: "Passed locale as 5th argument to buildWhatsAppUrl in handleInvitedAction"
    acs_covered: [AC-F040-05, AC-F040-06]

  - step: STEP-04
    cr: CR-96
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-04
    hash: 694d188
    message: "fix(members): ensure SearchInput stays fixed above scrollable FlatList (CR-96)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-87
        description: "Added style={styles.flex} to FlatList to fill remaining space below fixed elements"
    acs_covered: [AC-F041-01, AC-F041-02]

  - step: STEP-05
    cr: CR-96
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-05
    hash: 3def318
    message: "fix(topics): move SearchInput outside ScrollView to keep it fixed at top (CR-96)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-88
        description: "Moved header, description, section header with add button, and SearchInput above ScrollView"
      - id: CHG-89
        description: "ScrollView now contains only ward topics list and collections section"
    acs_covered: [AC-F041-03, AC-F041-04]

  - step: STEP-06
    cr: CR-97
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-06
    hash: 4a7b26b
    message: "feat(actor): add multiSelect and selectedNames props to ActorSelector (CR-97)"
    files_changed:
      - src/components/ActorSelector.tsx
    changes:
      - id: CHG-90
        description: "Added multiSelect and selectedNames optional props to ActorSelectorProps"
      - id: CHG-91
        description: "Updated handleSelect to keep modal open when multiSelect=true"
      - id: CHG-92
        description: "Updated handleAdd to keep modal open when multiSelect=true"
      - id: CHG-93
        description: "Added checkmark prefix to selected actor names in renderItem"
    acs_covered: [AC-F042-01, AC-F042-02, AC-F042-03]

  - step: STEP-07
    cr: CR-97
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-07
    hash: ea47454
    message: "feat(agenda): add toggle multi-select for recognized_names field (CR-97)"
    files_changed:
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-94
        description: "Changed recognizing handler to toggle names in/out of recognized_names array"
      - id: CHG-95
        description: "Added multiSelect=true and selectedNames props when field is recognizing"
    acs_covered: [AC-F042-04, AC-F042-05, AC-F042-06]

  - step: STEP-08
    cr: CR-100
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-08
    hash: ba0c775
    message: "feat(db): add speaker_1/2/3_override fields to sunday_agendas for last-minute swap (CR-100)"
    files_changed:
      - supabase/migrations/014_add_speaker_overrides.sql
      - src/types/database.ts
    changes:
      - id: CHG-96
        description: "Created migration 014 adding speaker_1/2/3_override TEXT columns to sunday_agendas"
      - id: CHG-97
        description: "Added speaker_1/2/3_override fields to SundayAgenda TypeScript interface"
    acs_covered: [AC-F044-01, AC-F044-02]

  - step: STEP-09
    cr: CR-100
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-09
    hash: 5038cf4
    message: "feat(agenda): rewrite SpeakerField with read-only display and inline override editing (CR-100)"
    files_changed:
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-98
        description: "Rewrote SpeakerField with read-only name, pencil icon for edit, X icon for revert"
      - id: CHG-99
        description: "Removed MemberSelectorModal, useAssignSpeaker, useLazyCreateSpeeches, useMembers imports"
      - id: CHG-100
        description: "Removed speakerModalPosition state and handleSpeakerAssign callback"
      - id: CHG-101
        description: "Added speakerEditRow, speakerEditInput, speakerReadRow, speakerReadText, speakerIconBtn, speakerIcon styles"
    acs_covered: [AC-F044-03, AC-F044-04, AC-F044-05, AC-F044-06]

  - step: STEP-10
    cr: CR-100
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-10
    hash: 609a36a
    message: "feat(presentation): use speaker override names in presentation mode cards (CR-100)"
    files_changed:
      - src/hooks/usePresentationMode.ts
    changes:
      - id: CHG-102
        description: "Updated buildPresentationCards to use agenda.speaker_N_override ?? speech.speaker_name for all 3 positions"
    acs_covered: [AC-F044-07]

  - step: STEP-11
    cr: CR-100
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-11
    hash: 9307718
    message: "test(agenda): add speaker_override fields to makeAgenda test helper (CR-100)"
    files_changed:
      - src/__tests__/phase04-agenda-presentation.test.ts
    changes:
      - id: CHG-103
        description: "Added speaker_1/2/3_override: null to makeAgenda test helper for type compatibility"
    acs_covered: [AC-F044-08]

  - step: STEP-12
    cr: CR-94
    plan_ref: plans/PLAN_P014.yaml
    plan_step: STEP-12
    hash: aadab00
    message: "test(whatsapp): add tests for getDefaultTemplate and buildWhatsAppUrl language param (CR-94)"
    files_changed:
      - src/__tests__/whatsapp-utils.test.ts
    changes:
      - id: CHG-104
        description: "Added 6 tests for getDefaultTemplate (pt-BR, en, es, fallback, EN content, ES content)"
      - id: CHG-105
        description: "Added 5 tests for buildWhatsAppUrl language parameter (en, es, pt-BR, custom override, default)"
    acs_covered: [AC-F040-07]

  # --- Regression fixes from Phase 2 code review ---

  - step: R-B7P2-01
    cr: [CR-97, CR-100]
    hash: 8d6b6e9
    message: "fix(tests): update agenda-actors tests for multi-select recognizing and SpeakerField override (CR-97, CR-100)"
    files_changed:
      - src/__tests__/cr004-f008-agenda-actors.test.ts
    changes:
      - id: CHG-106
        description: "Updated recognizing test to verify toggle array behavior instead of single-set"
      - id: CHG-107
        description: "Updated speaker modal test to verify SpeakerField with override support instead of MemberSelectorModal"

  - step: R-B7P2-02
    cr: CR-96
    hash: b640e5a
    message: "fix(topics): restore original comment format for test compatibility (CR-96)"
    files_changed:
      - src/app/(tabs)/settings/topics.tsx
    changes:
      - id: CHG-108
        description: "Removed '(fixed)' suffix from JSX comments to match existing test assertions"

batch7_phase2_test_results:
  full_suite_tests: 2800
  full_suite_passing: 2800
  full_suite_files: 57
  regressions: 0

  # --- Batch 8, Phase 1: CR-101, CR-102, CR-103, CR-104, CR-108, CR-109 ---

  - step: STEP-01
    cr: CR-101
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-01
    hash: 63a72ea
    message: "fix(sunday-card): conditionally render LEDs only for speeches type (CR-101)"
    files_changed:
      - src/components/SundayCard.tsx
    changes:
      - id: CHG-109
        description: "Wrapped LED section (StatusLED map) with {isSpeechesType && (...)} conditional"
    acs_covered: [AC-F045-01, AC-F045-02, AC-F045-03, AC-F045-04]
    ecs_covered: [EC-F045-01, EC-F045-02]

  - step: STEP-02
    cr: CR-102
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-02
    hash: 81c4181
    message: "fix(agenda): hide exception label for speeches type sundays (CR-102)"
    files_changed:
      - src/app/(tabs)/agenda.tsx
    changes:
      - id: CHG-110
        description: "Changed exceptionLabel computation to return null when exception.reason === 'speeches'"
    acs_covered: [AC-F046-01, AC-F046-02, AC-F046-03]
    ecs_covered: [EC-F046-01]

  - step: STEP-03
    cr: CR-109
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-03
    hash: 781eb7d
    message: "fix(home): fix SpeechSlots condition to render for speeches type sundays (CR-109)"
    files_changed:
      - src/components/NextSundaysSection.tsx
    changes:
      - id: CHG-111
        description: "Changed condition from !entry.exception to (!entry.exception || entry.exception.reason === 'speeches')"
    acs_covered: [AC-F049-01, AC-F049-02, AC-F049-03]
    ecs_covered: [EC-F049-01, EC-F049-02]

  - step: STEP-04
    cr: CR-104
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-04
    hash: 0ccc825
    message: "fix(whatsapp): add quotes around {titulo} placeholder in default templates (CR-104)"
    files_changed:
      - src/lib/whatsappUtils.ts
    changes:
      - id: CHG-112
        description: "Changed {titulo} to \"{titulo}\" in DEFAULT_TEMPLATE_PT_BR"
      - id: CHG-113
        description: "Changed {titulo} to \"{titulo}\" in DEFAULT_TEMPLATE_EN"
      - id: CHG-114
        description: "Changed {titulo} to \"{titulo}\" in DEFAULT_TEMPLATE_ES"
    acs_covered: [AC-F048-03, AC-F048-08]
    ecs_covered: [EC-F048-03]

  - step: STEP-05
    cr: CR-103
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-05
    hash: 6ac1c9d
    message: "fix(settings): initialize WhatsApp template with language-aware default fallback (CR-103)"
    files_changed:
      - src/app/(tabs)/settings/whatsapp.tsx
    changes:
      - id: CHG-115
        description: "Added import of getDefaultTemplate from whatsappUtils.ts"
      - id: CHG-116
        description: "Changed query .select('whatsapp_template') to .select('whatsapp_template, language')"
      - id: CHG-117
        description: "Updated useEffect to handle 3 cases: null -> getDefaultTemplate(ward.language), '' -> '', value -> value"
    acs_covered: [AC-F047-01, AC-F047-02, AC-F047-03, AC-F047-04, AC-F047-05]
    ecs_covered: [EC-F047-01, EC-F047-02]

  - step: STEP-06
    cr: [CR-104, CR-108]
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-06
    hash: 8e2cc8f
    message: "fix(invite): add collection/link vars and human-readable date to WhatsApp message (CR-104, CR-108)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-118
        description: "Added import of formatDateHumanReadable from dateUtils.ts and SupportedLanguage from i18n"
      - id: CHG-119
        description: "Added collection: speech.topic_collection ?? '' to WhatsAppVariables in handleNotInvitedAction"
      - id: CHG-120
        description: "Added link: speech.topic_link ?? '' to WhatsAppVariables in handleNotInvitedAction"
      - id: CHG-121
        description: "Replaced formatDate with formatDateHumanReadable for date field in handleNotInvitedAction"
      - id: CHG-122
        description: "Added collection: speech.topic_collection ?? '' to WhatsAppVariables in handleInvitedAction"
      - id: CHG-123
        description: "Added link: speech.topic_link ?? '' to WhatsAppVariables in handleInvitedAction"
      - id: CHG-124
        description: "Replaced formatDate with formatDateHumanReadable for date field in handleInvitedAction"
    acs_covered: [AC-F048-01, AC-F048-02, AC-F048-04, AC-F048-05, AC-F048-06, AC-F048-07]
    ecs_covered: [EC-F048-01, EC-F048-02]

  - step: STEP-07
    cr: [CR-101, CR-102, CR-103, CR-104, CR-108, CR-109]
    plan_ref: plans/PLAN_P015.yaml
    plan_step: STEP-07
    hash: 054fe33
    message: "test(batch8-phase1): add tests for F045, F046, F047, F048, F049"
    files_changed:
      - src/__tests__/batch8-phase1.test.ts
    tests_added: 60
    acs_covered: [AC-F045-01, AC-F045-02, AC-F046-01, AC-F046-02, AC-F047-01, AC-F047-02, AC-F048-01, AC-F048-04, AC-F049-01, AC-F049-02]
    ecs_covered: [EC-F045-01, EC-F046-01, EC-F047-01, EC-F048-01, EC-F049-01]

batch8_phase1_test_results:
  new_tests: 60
  new_tests_passing: 60
  full_suite_tests: 2983
  full_suite_passing: 2983
  full_suite_files: 59
  regressions: 0

  # --- Batch 8, Phase 2: CR-105, CR-106, CR-107, CR-110, CR-111 ---

  - step: STEP-01
    cr: CR-110
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-01
    hash: 9ee783e
    message: "feat(permissions): add home:invite_mgmt to bishopric role (CR-110)"
    files_changed:
      - src/lib/permissions.ts
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-125
        description: "Added 'home:invite_mgmt' to bishopric permission set in permissions.ts"
      - id: CHG-126
        description: "Updated docstring and comment to reflect 'Secretary and Bishopric' visibility"
    acs_covered: [AC-F053-01, AC-F053-02, AC-F053-03, AC-F053-04, AC-F053-05]
    ecs_covered: [EC-F053-01]

  - step: STEP-02
    cr: CR-111
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-02
    hash: c5d8288
    message: "feat(speech-slot): increase row gap to 12 and X fontSize to 24 (CR-111)"
    files_changed:
      - src/components/SpeechSlot.tsx
    changes:
      - id: CHG-127
        description: "Changed row style gap from 8 to 12"
      - id: CHG-128
        description: "Changed removeButton style fontSize from 20 to 24"
    acs_covered: [AC-F054-01, AC-F054-02, AC-F054-03, AC-F054-04]
    ecs_covered: [EC-F054-01, EC-F054-02]

  - step: STEP-03
    cr: CR-107
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-03
    hash: 83fadef
    message: "feat(invite): show speech slot label, StatusLED, and status name in second line (CR-107)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-129
        description: "Imported StatusLED component"
      - id: CHG-130
        description: "Replaced simple position text with speechInfoRow View containing slot label, separator, StatusLED, and status name"
      - id: CHG-131
        description: "Added speechInfoRow and statusName styles"
    acs_covered: [AC-F052-01, AC-F052-02, AC-F052-03, AC-F052-04, AC-F052-05]
    ecs_covered: [EC-F052-01, EC-F052-02]

  - step: STEP-04
    cr: CR-105
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-04
    hash: 96944bc
    message: "feat(invite): replace text buttons with WhatsApp SVG icon and Unicode three-dots (CR-105)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-132
        description: "Added Svg and Path imports from react-native-svg"
      - id: CHG-133
        description: "Created WhatsAppIcon inline component with SVG path"
      - id: CHG-134
        description: "Replaced text content with WhatsAppIcon for isNotInvited and Unicode U+22EE for invited"
      - id: CHG-135
        description: "Changed actionButton to fixed 36x36 with centered content, replaced actionText with actionIcon"
      - id: CHG-136
        description: "Added accessibilityLabel to both button variants"
    acs_covered: [AC-F050-01, AC-F050-02, AC-F050-03, AC-F050-04, AC-F050-05]
    ecs_covered: [EC-F050-01, EC-F050-02]

  - step: STEP-05
    cr: CR-106
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-05
    hash: 152b3b4
    message: "feat(speeches): export STATUS_INDICATOR_COLORS and add assigned_invited -> assigned_not_invited transition (CR-106)"
    files_changed:
      - src/components/StatusChangeModal.tsx
      - src/hooks/useSpeeches.ts
      - src/__tests__/useSpeeches-utils.test.ts
      - src/__tests__/phase03-speech-lifecycle.test.ts
    changes:
      - id: CHG-137
        description: "Exported STATUS_INDICATOR_COLORS constant from StatusChangeModal"
      - id: CHG-138
        description: "Added 'assigned_not_invited' to assigned_invited transitions in VALID_TRANSITIONS"
      - id: CHG-139
        description: "Updated test assertions for new transition count (3 -> 4)"
    acs_covered: [AC-F051-04]

  - step: STEP-06
    cr: CR-106
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-06
    hash: 94b1a24
    message: "feat(i18n): add home.viewConversation key in 3 locales (CR-106)"
    files_changed:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-140
        description: "Added home.viewConversation key: 'Ver conversa' in pt-BR.json"
      - id: CHG-141
        description: "Added home.viewConversation key: 'View conversation' in en.json"
      - id: CHG-142
        description: "Added home.viewConversation key: 'Ver conversacion' in es.json"
    acs_covered: [AC-F051-02]

  - step: STEP-07
    cr: CR-106
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-07
    hash: ec883c5
    message: "feat(components): create InviteActionDropdown with 5 options for invite status management (CR-106)"
    files_changed:
      - src/components/InviteActionDropdown.tsx
    changes:
      - id: CHG-143
        description: "Created InviteActionDropdown component with Modal, overlay, and 5 options"
      - id: CHG-144
        description: "Option 1: View conversation with inline WhatsApp icon, disabled when no phone"
      - id: CHG-145
        description: "Option 2: Assigned/Confirmed with green indicator from STATUS_INDICATOR_COLORS"
      - id: CHG-146
        description: "Option 3: Assigned/Not invited (reverse transition) with yellow indicator"
      - id: CHG-147
        description: "Option 4: Gave up with red indicator"
      - id: CHG-148
        description: "Option 5: Cancel that closes dropdown"
    acs_covered: [AC-F051-01, AC-F051-02, AC-F051-03, AC-F051-04, AC-F051-05, AC-F051-06, AC-F051-07, AC-F051-08]
    ecs_covered: [EC-F051-01, EC-F051-02, EC-F051-03]

  - step: STEP-08
    cr: CR-106
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-08
    hash: c28bc63
    message: "feat(invite): integrate InviteActionDropdown replacing Alert.alert for status actions (CR-106)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-149
        description: "Removed Alert import, added InviteActionDropdown import"
      - id: CHG-150
        description: "Added dropdownSpeech state (Speech | null)"
      - id: CHG-151
        description: "Simplified handleInvitedAction to setDropdownSpeech(speech)"
      - id: CHG-152
        description: "Added handleDropdownWhatsApp callback with null-then-open pattern"
      - id: CHG-153
        description: "Added handleDropdownStatusChange callback with null-then-mutate pattern"
      - id: CHG-154
        description: "Rendered InviteActionDropdown at end of section View"
    acs_covered: [AC-F051-01, AC-F051-07]

  - step: STEP-09
    cr: [CR-105, CR-106, CR-107, CR-110, CR-111]
    plan_ref: plans/PLAN_P016.yaml
    plan_step: STEP-09
    hash: ef42ed7
    message: "test(batch8-phase2): add tests for F050, F051, F052, F053, F054"
    files_changed:
      - src/__tests__/batch8-phase2.test.ts
      - src/__tests__/permissions.test.ts
    tests_added: 78
    changes:
      - id: CHG-155
        description: "Created batch8-phase2.test.ts with 78 tests covering all 5 features"
      - id: CHG-156
        description: "Updated permissions.test.ts to reflect bishopric home:invite_mgmt = true and 24 permissions"
    acs_covered: [AC-F050-01, AC-F050-05, AC-F051-01, AC-F051-08, AC-F052-01, AC-F052-05, AC-F053-01, AC-F053-05, AC-F054-01, AC-F054-04]
    ecs_covered: [EC-F050-01, EC-F051-01, EC-F052-01, EC-F053-01, EC-F054-01]

batch8_phase2_test_results:
  new_tests: 78
  new_tests_passing: 78
  full_suite_tests: 3061
  full_suite_passing: 3061
  full_suite_files: 60
  regressions: 0

  # --- Batch 9, Phase 1: CR-113, CR-112, CR-122, CR-117, CR-125 ---

  - step: STEP-01
    cr: CR-113
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-01
    hash: cf1c8cf
    message: "fix(invite): change InviteActionDropdown title to i18n changeStatus label (CR-113)"
    files_changed:
      - src/components/InviteActionDropdown.tsx
    changes:
      - id: CHG-157
        description: "Replaced speech?.speaker_name with t('speeches.changeStatus') in dropdown title"
      - id: CHG-158
        description: "Updated JSX comment from 'speaker name' to 'i18n status change label'"
    acs_covered: [AC-F056-01, AC-F056-02, AC-F056-03]

  - step: STEP-02
    cr: CR-112
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-02
    hash: 3160210
    message: "feat(whatsapp): add buildWhatsAppConversationUrl for opening chat without message (CR-112)"
    files_changed:
      - src/lib/whatsappUtils.ts
      - src/lib/whatsapp.ts
    changes:
      - id: CHG-159
        description: "Added buildWhatsAppConversationUrl(phone) function returning https://wa.me/{cleanPhone} without ?text="
      - id: CHG-160
        description: "Added re-export of buildWhatsAppConversationUrl in whatsapp.ts barrel"
    acs_covered: [AC-F055-01, AC-F055-02]

  - step: STEP-03
    cr: CR-112
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-03
    hash: 6ff6d4c
    message: "fix(invite): use buildWhatsAppConversationUrl for View Conversation action (CR-112)"
    files_changed:
      - src/components/InviteManagementSection.tsx
    changes:
      - id: CHG-161
        description: "Replaced buildWhatsAppUrl call in handleDropdownWhatsApp with buildWhatsAppConversationUrl"
      - id: CHG-162
        description: "Removed unused template/date/position/collection/link variables from handleDropdownWhatsApp"
      - id: CHG-163
        description: "Added buildWhatsAppConversationUrl to import statement"
    acs_covered: [AC-F055-03, AC-F055-04, AC-F055-05]

  - step: STEP-04
    cr: CR-122
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-04
    hash: 0005ea6
    message: "feat(i18n): add speeches.lastSpeech key and update 4 locations for position 3 (CR-122)"
    files_changed:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json
      - src/components/SpeechSlot.tsx
      - src/components/AgendaForm.tsx
      - src/components/InviteManagementSection.tsx
      - src/hooks/usePresentationMode.ts
    changes:
      - id: CHG-164
        description: "Added speeches.lastSpeech key: pt-BR 'Último Discurso', en 'Final Speech', es 'Último Discurso'"
      - id: CHG-165
        description: "Updated getPositionLabel() in SpeechSlot.tsx to return t('speeches.lastSpeech') for position 3"
      - id: CHG-166
        description: "Updated AgendaForm speaker 3 label to use t('speeches.lastSpeech')"
      - id: CHG-167
        description: "Updated InviteManagementSection second line to use t('speeches.lastSpeech') for position 3"
      - id: CHG-168
        description: "Updated usePresentationMode card 4 label to use t('speeches.lastSpeech')"
    acs_covered: [AC-F058-01, AC-F058-02, AC-F058-03, AC-F058-04, AC-F058-05]

  - step: STEP-05
    cr: CR-117
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-05
    hash: 017b7a5
    message: "fix(country): reorder USA before Canada for +1 default and add getCountryByLabel (CR-117)"
    files_changed:
      - src/lib/countryCodes.ts
    changes:
      - id: CHG-169
        description: "Moved United States (+1) entry before Canada (+1) in COUNTRY_CODES array"
      - id: CHG-170
        description: "Added getCountryByLabel(label) function for unique country lookup"
    acs_covered: [AC-F057-01, AC-F057-02, AC-F057-03]

  - step: STEP-06
    cr: CR-117
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-06
    hash: fe1bfba
    message: "fix(members): highlight country by label instead of code to resolve +1 ambiguity (CR-117)"
    files_changed:
      - src/app/(tabs)/settings/members.tsx
    changes:
      - id: CHG-171
        description: "Added countryLabel state initialized from member's country_code"
      - id: CHG-172
        description: "Changed highlight comparison from item.code === countryCode to item.label === countryLabel"
      - id: CHG-173
        description: "Updated onPress to set both countryCode and countryLabel"
    acs_covered: [AC-F057-04, AC-F057-05]

  - step: STEP-07
    cr: CR-125
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-07
    hash: d3ec6a6
    message: "feat(prayer): add modalOnly prop to PrayerSelector to suppress inline button (CR-125)"
    files_changed:
      - src/components/PrayerSelector.tsx
    changes:
      - id: CHG-174
        description: "Added modalOnly?: boolean prop to PrayerSelectorProps interface"
      - id: CHG-175
        description: "Wrapped inline Pressable in {!modalOnly && (...)} conditional"
    acs_covered: [AC-F059-01, AC-F059-02]

  - step: STEP-08
    cr: CR-125
    plan_ref: plans/PLAN_P017.yaml
    plan_step: STEP-08
    hash: abfda79
    message: "fix(agenda): pass modalOnly={true} to PrayerSelector to fix field duplication (CR-125)"
    files_changed:
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-176
        description: "Added modalOnly={true} prop to PrayerSelector in AgendaForm selectorModal rendering"
    acs_covered: [AC-F059-03, AC-F059-04, AC-F059-05]

  - step: STEP-TEST-FIX
    cr: [CR-112, CR-113, CR-117]
    plan_ref: plans/PLAN_P017.yaml
    hash: 8124f5f
    message: "test(batch9): update existing tests to reflect F055, F056, F057 changes"
    files_changed:
      - src/__tests__/batch6-f027-f031.test.ts
      - src/__tests__/batch7-f035-f039.test.ts
      - src/__tests__/batch8-phase1.test.ts
      - src/__tests__/batch8-phase2.test.ts
    changes:
      - id: CHG-177
        description: "Updated batch6 alphabetical order test to skip USA (ADR-043 reordering)"
      - id: CHG-178
        description: "Updated batch7 highlight test from code-based to label-based comparison (ADR-043)"
      - id: CHG-179
        description: "Updated batch8-phase1 test for handleDropdownWhatsApp now using buildWhatsAppConversationUrl"
      - id: CHG-180
        description: "Updated batch8-phase2 test for dropdown title now using t('speeches.changeStatus')"

batch9_phase1_test_results:
  full_suite_tests: 3061
  full_suite_passing: 3061
  full_suite_files: 60
  regressions: 0

  # --- Batch 9, Phase 2: CR-114, CR-115, CR-116, CR-119, CR-121 ---

  - step: STEP-01
    cr: CR-119
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-01
    hash: ec285bd
    message: "feat(speech-slot): reorder layout to [LED][Field][X] and align topic field (CR-119)"
    files_changed:
      - src/components/SpeechSlot.tsx
    changes:
      - id: CHG-181
        description: "Moved StatusLED before speaker Pressable in row"
      - id: CHG-182
        description: "Added marginLeft: 28 to topicField style to align with speaker field"
    acs_covered: [AC-F063-01, AC-F063-02, AC-F063-03]

  - step: STEP-02
    cr: CR-114
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-02
    hash: 5500894
    message: "feat(speech-slot): add onClearTopic prop and X button to topic field (CR-114)"
    files_changed:
      - src/components/SpeechSlot.tsx
    changes:
      - id: CHG-183
        description: "Added onClearTopic optional prop to SpeechSlotProps interface"
      - id: CHG-184
        description: "Added handleClearTopic callback that calls onClearTopic with speech.id"
      - id: CHG-185
        description: "Added X button (Pressable) in topic field when topicDisplay exists and canAssign"
    acs_covered: [AC-F060-01, AC-F060-02, AC-F060-03]

  - step: STEP-03
    cr: CR-114
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-03
    hash: 6d80369
    message: "feat(speeches): wire onClearTopic in speeches.tsx and NextSundaysSection (CR-114)"
    files_changed:
      - src/app/(tabs)/speeches.tsx
      - src/components/NextSundaysSection.tsx
    changes:
      - id: CHG-186
        description: "Added handleClearTopic callback in speeches.tsx calling assignTopic with null values"
      - id: CHG-187
        description: "Passed onClearTopic={handleClearTopic} to SpeechSlot in speeches.tsx"
      - id: CHG-188
        description: "Added handleClearTopic callback in NextSundaysSection.tsx calling assignTopic with null values"
      - id: CHG-189
        description: "Passed onClearTopic={handleClearTopic} to SpeechSlot in NextSundaysSection.tsx"
    acs_covered: [AC-F060-04, AC-F060-05]

  - step: STEP-04
    cr: CR-116
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-04
    hash: 429915d
    message: "feat(status-modal): add optional allowedStatuses prop for filtering transitions (CR-116)"
    files_changed:
      - src/components/StatusChangeModal.tsx
    changes:
      - id: CHG-190
        description: "Added allowedStatuses optional prop to StatusChangeModalProps"
      - id: CHG-191
        description: "Added filtering logic: intersect availableStatuses with allowedStatuses if provided"
      - id: CHG-192
        description: "Changed FlatList data from availableStatuses to filtered"
    acs_covered: [AC-F062-01, AC-F062-02]

  - step: STEP-05
    cr: CR-116
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-05
    hash: 97e8725
    message: "feat(speech-slot): filter LED click to confirmed/gave_up for assigned_invited (CR-116)"
    files_changed:
      - src/components/SpeechSlot.tsx
    changes:
      - id: CHG-193
        description: "Added ledAllowedStatuses variable filtering to confirmed/gave_up when status is assigned_invited"
      - id: CHG-194
        description: "Passed allowedStatuses={ledAllowedStatuses} to StatusChangeModal"
    acs_covered: [AC-F062-03, AC-F062-04]

  - step: STEP-06
    cr: CR-115
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-06
    hash: c95e1d3
    message: "feat(sunday-card): add confirmation dialog when changing type with assignments (CR-115)"
    files_changed:
      - src/components/SundayCard.tsx
    changes:
      - id: CHG-195
        description: "Added Alert import to SundayCard.tsx"
      - id: CHG-196
        description: "Added speeches prop to SundayTypeDropdownProps interface"
      - id: CHG-197
        description: "Added confirmation Alert when changing FROM speeches WITH speaker_name or topic_title assignments"
      - id: CHG-198
        description: "Passed speeches prop to SundayTypeDropdown"
    acs_covered: [AC-F061-01, AC-F061-02, AC-F061-03, AC-F061-04]

  - step: STEP-07
    cr: [CR-115, CR-121]
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-07
    hash: 8ec4f3a
    message: "feat(i18n): add changeConfirmTitle/Message and lastMinuteAssignment keys in 3 locales (CR-115, CR-121)"
    files_changed:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json
    changes:
      - id: CHG-199
        description: "Added sundayExceptions.changeConfirmTitle key in pt-BR, en, es"
      - id: CHG-200
        description: "Added sundayExceptions.changeConfirmMessage key in pt-BR, en, es"
      - id: CHG-201
        description: "Added agenda.lastMinuteAssignment key in pt-BR, en, es"
    acs_covered: [AC-F061-05, AC-F064-01]

  - step: STEP-08
    cr: CR-121
    plan_ref: plans/PLAN_P018.yaml
    plan_step: STEP-08
    hash: 162c74b
    message: "feat(agenda): show last-minute assignment label on speaker override (CR-121)"
    files_changed:
      - src/components/AgendaForm.tsx
    changes:
      - id: CHG-202
        description: "Added useTranslation hook to SpeakerField sub-component"
      - id: CHG-203
        description: "Added italic '(Last-minute assignment)' Text below speakerReadRow when hasOverride"
      - id: CHG-204
        description: "Added lastMinuteLabel style (fontSize 11, fontStyle italic, marginTop 2)"
    acs_covered: [AC-F064-02, AC-F064-03, AC-F064-04]

batch9_phase2_test_results:
  full_suite_tests: 3128
  full_suite_passing: 3128
  full_suite_files: 61
  regressions: 0
