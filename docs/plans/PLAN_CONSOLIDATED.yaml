# =============================================================================
# PLAN_CONSOLIDATED.yaml
# Fonte unica de verdade dos planos de implementacao
# Gerado: 2026-02-18
# =============================================================================

metadata:
  project: Sacrament Meeting Planner
  last_updated: "2026-02-19"
  version: 8
  last_updated_by: "batch-9-phase-3"
  total_phases: 6
  total_cr_plans: 26
  phases_completed: true
  cr_plans_completed: true
  pending_crs_without_plan: []

# =============================================================================
# Fases do projeto original
# =============================================================================

project_phases:
  - id: PHASE-01
    title: "Foundation (DB + Auth + Permissions + i18n + Theme)"
    status: completed
    features_covered: [F001, F002, F020, F021, F023]
    total_steps: 12
    summary: >
      Configuracao inicial do projeto: Expo SDK 54, Supabase com schema completo
      (15 tabelas), RLS ward-scoped, AuthContext com sessao e permissoes,
      auto-registro e convite via deep link, react-i18next com 3 idiomas
      (pt-BR, en, es), tema escuro/claro com persistencia, app shell com
      4 tabs (Home, Agenda, Speeches, Settings), date utils e tipos TypeScript.

  - id: PHASE-02
    title: "Core Data (Ward, Members, Topics, Sunday Types, Actors, Hymns)"
    status: completed
    features_covered: [F003, F005, F006, F007, F013, F014, F015]
    total_steps: 12
    summary: >
      CRUD de membros com busca accent-insensitive e auto-save, gestao de
      temas (ward topics + colecoes gerais com toggle), auto-atribuicao de
      tipos de domingo com regras de testemunho e conferencia geral, atores
      com papeis (presidir, dirigir, reconhecer, musica), seletores de hinos
      com filtro sacramental, seletores de oracoes com nome customizado,
      e scripts CLI de importacao de hinos e colecoes gerais.

  - id: PHASE-03
    title: "Speech Lifecycle (Speech CRUD, Home tab, WhatsApp)"
    status: completed
    features_covered: [F008, F009, F010]
    total_steps: 11
    summary: >
      Gestao completa de discursos: scroll infinito de domingos (12 meses
      passado + 12 futuro), SundayCards expansiveis com LEDs 3D animados
      por status, atribuicao de oradores e temas com snapshots, ciclo de
      vida de status (nao-designado -> designado -> convidado -> confirmado
      / desistiu), aba Home com 3 proximos domingos, secao de proximas
      designacoes (Bispado), gestao de convites (Secretario), e integracao
      WhatsApp com template e URL wa.me.

  - id: PHASE-04
    title: "Agenda & Presentation Mode"
    status: completed
    features_covered: [F012, F016]
    total_steps: 10
    summary: >
      Formulario de agenda da reuniao com 4 secoes (boas-vindas, designacoes,
      discursos, ultimo discurso), formulario especial para reunioes nao-discursos
      (testemunho, conferencia de ala, primaria), designacao de oradores via
      agenda (com status auto-confirmado), modo apresentacao full-screen com
      accordion cards (1 expandido por vez), botao "Iniciar Reuniao" visivel
      apenas aos domingos, e troca de idioma com gestao de colecoes.

  - id: PHASE-05
    title: "Infrastructure (Sync, Offline, Notifications)"
    status: completed
    features_covered: [F011, F017, F022]
    total_steps: 8
    summary: >
      Sincronizacao realtime via Supabase Realtime com polling fallback
      (2.5s quando WebSocket desconecta), push notifications com fila no DB
      (triggers por evento de discurso), lembretes semanais aos domingos 18h,
      processador de notificacoes via Edge Function cron, registro de tokens
      Expo Push, suporte offline com fila de mutacoes (AsyncStorage, max 100),
      UI otimista, e guard para operacoes que requerem conexao.

  - id: PHASE-06
    title: "Admin & Polish (Users, Activity Log, CSV, Template, Hardening)"
    status: completed
    features_covered: [F004, F018, F019, F024]
    total_steps: 9
    summary: >
      Gestao de usuarios via Edge Functions (convite, listagem, troca de
      papel, exclusao), tela de usuarios com card expansivel, log de
      atividades com busca e paginacao infinita, retencao de 2 anos,
      import/export CSV de membros (overwrite total com validacao),
      editor de template WhatsApp com preview em tempo real, tela de
      settings completa com todas as opcoes por papel, error boundaries
      por modulo, e confirmacao de saida.

# =============================================================================
# Planos de Change Requests
# =============================================================================

cr_plans:
  - id: PLAN_CR001
    title: "Change Requests Batch 1"
    status: completed
    crs_covered: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    total_steps: 14
    summary: >
      Correcoes criticas de UI e bugs: fix do enum de sunday types (remocao
      de fast_sunday/special_program/no_meeting, adicao de primary_presentation
      e other com razao customizada), migracao de DB, atualizacao de tipos e
      i18n, titulo na Home, texto traduzido de excecoes, labels de discursos,
      fix de idioma na criacao de ala, ocultar discursos para domingos
      nao-discursos, scroll de temas, fix de flash na navegacao settings,
      telas de tema e sobre, fix de agenda vazia no modo apresentacao.

  - id: PLAN_CR002
    title: "Change Requests Batch 2"
    status: completed
    crs_covered: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
    total_steps: 18
    summary: >
      Fix do idioma padrao ao iniciar app, rename do template WhatsApp,
      fix do template default, placeholders clicaveis, layout do template,
      botoes de voltar em 3 telas, log legivel com datas por extenso,
      fix do dropdown de sunday type (bug critico de revert), scroll
      inicial da aba Agenda, redesign completo de atores (remocao da
      tela Settings, bottom-sheet 2/3, CRUD inline, remocao de "Ator"
      da UI), fix de input com letras perdidas (DebouncedTextInput),
      dialogo de hinos em 2/3, renomeacao de secoes da agenda com
      secoes dinamicas por tipo de reuniao, permissao de Secretario
      para ver Usuarios, label de apresentacao especial.

  - id: PLAN_CR003
    title: "Spec Corrections Batch 3"
    status: completed
    crs_covered: [31, 34, 36, 37]
    total_steps: 5
    type: documentation-only
    summary: >
      Correcoes de inconsistencias na documentacao: fix de ASM-009
      (Secretario pode designar via Agenda), atualizacao de RF-22 e
      secao 7.13.4 para refletir redesign de atores (papel inferido
      do campo, sem checkboxes), adicao de regra de debounce 500ms
      para auto-save em campos de texto, atualizacao de permissoes
      do Secretario para gestao de usuarios em secoes 4.2 e 7.8.

  - id: PLAN_CR4_F001
    title: "Documentation Updates"
    status: completed
    crs_covered: [44, 45, 46, 47, 48, 49, 50]
    total_steps: 7
    type: documentation-only
    summary: >
      Atualizacao de documentos ARCH e SPEC desatualizados: ARCH_M002
      (custom_reason, enum speeches, contracts mobile), ARCH_M006/M007
      (integracao sync/offline), ARCH_M008 (sub-telas settings),
      ARCH_M004 (formatFullDate no PresentationMode), fix de
      inconsistencias em ARCH_CR3_F029 e F027, atualizacao de
      PRODUCT_SPECIFICATION e SPEC.final.md com labels, enum, e
      permissoes corrigidos.

  - id: PLAN_CR4_F002
    title: "Speeches Persistence & Sunday Type Revert Fix"
    status: completed
    crs_covered: [56, 68]
    total_steps: 3
    summary: >
      Fix critico de persistencia de discursos: migracao DB para
      adicionar 'speeches' ao CHECK constraint, remocao do filtro
      que bloqueava insercao de 'speeches' no DB, mudanca de
      useRemoveSundayException para UPSERT ao inves de DELETE,
      fix do bug de revert do tipo de domingo (race condition
      entre optimistic update e refetch).

  - id: PLAN_CR4_F003
    title: "Infrastructure Integration (Sync, Offline, Notifications)"
    status: completed
    crs_covered: [52, 53]
    total_steps: 2
    summary: >
      Conexao de codigo morto de infraestrutura ao app: ativacao
      de useConnection, useRealtimeSync e OfflineBanner no layout
      de tabs, registro de push tokens e handler de notificacoes.

  - id: PLAN_CR4_F004
    title: "Error Handling Overhaul"
    status: completed
    crs_covered: [57, 58, 59, 60, 61]
    total_steps: 7
    summary: >
      Overhaul completo de tratamento de erros: configuracao do
      QueryClient com retry policies (queries 2x, mutations 0x,
      401/403 sem retry), onError com Alert.alert i18n em todas
      as 17+ mutations, internacionalizacao do ErrorBoundary com
      suporte a tema, QueryErrorView reutilizavel com botao retry
      nas 3 tabs principais, error boundaries granulares por tab
      e componentes criticos.

  - id: PLAN_CR4_F005
    title: "CSV & Members Screen Fixes"
    status: completed
    crs_covered: [54, 55, 66]
    total_steps: 5
    summary: >
      Fix de export CSV (cancel do share sheet nao mostra erro),
      import com string i18n ao inves de hardcoded, spacer no
      header quando add button oculto, export habilitado com lista
      vazia (gera CSV apenas com headers), validacao de import
      com numeros de linha e campos especificos.

  - id: PLAN_CR4_F006
    title: "UI/UX Small Fixes"
    status: completed
    crs_covered: [62, 63, 65, 69, 70]
    total_steps: 6
    summary: >
      Tela Sobre com disclaimer e nome do autor corrigido, fix
      do template WhatsApp default, toggle de tema com feedback
      instantaneo (AsyncStorage async), atualizacao de labels
      da agenda (Dirigindo, Apoios e Agradecimentos, etc.),
      aumento de icones de editar/deletar atores.

  - id: PLAN_CR4_F007
    title: "Auth Fixes: Users + Forgot Password"
    status: completed
    crs_covered: [64, 67]
    total_steps: 7
    summary: >
      Fix da tela de usuarios para Secretario (debug de Edge Function
      e erro i18n), implementacao do fluxo "Esqueci minha senha" com
      tela dedicada (email input, supabase.auth.resetPasswordForEmail,
      loading state, validacao, feedback de sucesso/erro, i18n 3 idiomas,
      suporte a dark/light theme).

  - id: PLAN_CR4_F008
    title: "Agenda & Actors Enhancements"
    status: completed
    crs_covered: [71, 72, 73, 74, 75]
    total_steps: 10
    summary: >
      Remocao da regra auto-presidir (can_conduct nao implica mais
      can_preside), auto-criacao de ator para membros do bispado
      convidados, campo Reconhecendo usando ActorSelector ao inves
      de texto, nomes customizados para oracoes via MemberSelectorModal,
      domingos com conferencia geral/estaca aparecem como cards
      nao-expansiveis na aba Agenda.

  - id: PLAN_CR4_F009
    title: "Import Hymns CLI Script"
    status: completed
    crs_covered: [51]
    total_steps: 1
    summary: >
      Script CLI executavel via 'pnpm import-hymns <file.csv>' para
      importar hinario: leitura de CSV (Lingua, Numero, Titulo,
      Sacramental S/N), validacao com erros por linha, upsert por
      (language, number), sumario de importacao.

  - id: PLAN_CR80
    title: "Members Screen Explanatory Texts (i18n)"
    status: pending
    crs_covered: [80]
    total_steps: 3
    summary: >
      Adicao de 2 textos explicativos na tela de Membros: description
      (abaixo do titulo, sempre visivel) e csvHelp (abaixo dos botoes CSV,
      visivel apenas com canImport=true). Traducao em 3 idiomas (pt-BR,
      en, es). 2 keys i18n novas, ~15 linhas em members.tsx, sem
      mudancas de logica.

  - id: project_CR77_CR78_CR82
    title: "Regressions Fix (expo-file-system v19 + GestureHandler)"
    status: completed
    crs_covered: [77, 78, 82]
    total_steps: 3
    summary: >
      Migracao para nova API do expo-file-system v19 (File/Paths API
      ao inves de cacheDirectory/EncodingType), fix de export CSV
      com lista vazia (cacheDirectory null), fix de import CSV
      (EncodingType undefined), remocao de constraint unique no
      phone de membros, adicao de GestureHandlerRootView como wrapper
      no root layout.

  - id: PLAN_CR76
    title: "Fix Users Screen HTTP 401 (Regression CR-64)"
    status: pending
    crs_covered: [76]
    total_steps: 2
    summary: >
      Remocao do header Authorization manual em callEdgeFunction
      (getAccessToken com JWT stale/expirado), delegando auth ao
      SDK do Supabase que gerencia tokens automaticamente via
      autoRefreshToken. Preservacao da logica de extracao de erro
      via error.context.json().

  - id: PLAN_CR79
    title: "Back Button on Users Screen"
    status: pending
    crs_covered: [79]
    total_steps: 3
    summary: >
      Adicao de botao de voltar na tela de Usuarios seguindo o
      padrao das demais sub-telas de Settings (Pressable com
      router.back(), layout 3 elementos: voltar | titulo | invite),
      ajuste de fontSize do titulo para consistencia.

  - id: PLAN_CR81
    title: "User Name Field"
    status: pending
    crs_covered: [81]
    total_steps: 13
    summary: >
      Campo Nome obrigatorio para usuarios: migracao DB (user_name
      em activity_log, RPC list_ward_users com full_name), atualizacao
      das Edge Functions (register-first-user com auto-ator para
      bispado, register-invited-user, novo update-user-name),
      AuthContext expondo userName, inputs de nome nas telas de
      registro, exibicao e edicao na tela de usuarios, pipeline
      de activity log com user_name em 6 hooks.

  - id: PLAN_P011
    title: "Batch 6 Phase 1: Members UX Improvements & Bug Fixes"
    status: pending
    crs_covered: [83, 84, 85, 86, 90]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P011.yaml"
    summary: >
      Fix do botao Delete no SwipeableCard (pointerEvents box-none),
      botoes Save/Cancel no MemberEditor e TopicEditor (remocao de
      auto-save no onBlur), modulo compartilhado countryCodes.ts com
      ~200 codigos de pais (single source of truth), dialogo de
      confirmacao antes de importar CSV (Alert.alert com i18n),
      componente reutilizavel SearchInput com botao X para limpar
      busca em 10 campos do app. 5 features, 28 ACs, 18 arquivos
      impactados (2 novos + 16 modificados).

  - id: PLAN_P012
    title: "Batch 6 Phase 2: Themes & Swipe UX Improvements"
    status: pending
    crs_covered: [87, 88, 89]
    total_steps: 7
    plan_ref: "docs/plans/PLAN_P012.yaml"
    summary: >
      Substituicao de texto Edit/Delete nos botoes de swipe por icones
      Unicode (lapis U+270F e lixeira U+1F5D1) no SwipeableCard, texto
      explicativo na tela de Temas descrevendo temas da ala e toggle de
      colecoes (i18n 3 idiomas), e visao expand/collapse de temas de
      colecao com padrao acordeao (uma expandida por vez), lazy-loading
      via novo hook useCollectionTopics, estados de loading/empty.
      3 features, 19 ACs, 6 arquivos impactados (0 novos + 6 modificados).

  - id: PLAN_P013
    title: "Batch 7 Phase 1: Bug Fixes"
    status: pending
    crs_covered: [91, 92, 93, 95, 98]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P013.yaml"
    summary: >
      5 bug fixes independentes sem overlap de arquivos: SECURITY DEFINER
      na funcao de trigger enqueue_speech_notification para resolver erro
      de RLS na notification_queue (nova migracao 013), fix de duplicate
      key warning no dropdown de paises (keyExtractor item.label), mudanca
      do protocolo de deep link de wardmanager:// para sacrmeetman://
      (app.json + Edge Function), fix de speech slots nao escondendo ao
      mudar tipo de domingo (verificacao direta tipo === 'speeches' ao
      inves de isExcludedFromAgenda), fix de campos de oracao nao
      clicaveis (props visible/onClose no PrayerSelector seguindo padrao
      ActorSelector). 5 features, 30 ACs, 7 arquivos impactados
      (1 novo + 6 modificados + 2 testes atualizados).

  - id: PLAN_P014
    title: "Batch 7 Phase 2: UX & Features"
    status: pending
    crs_covered: [94, 96, 97, 99, 100]
    total_steps: 12
    plan_ref: "docs/plans/PLAN_P014.yaml"
    summary: >
      5 melhorias de UX e features: templates WhatsApp i18n com
      DEFAULT_TEMPLATE_EN e DEFAULT_TEMPLATE_ES + getDefaultTemplate
      por idioma (F040), search fixo no topo em members.tsx e topics.tsx
      (F041), multi-select no campo Reconhecendo a Presenca com toggle
      add/remove e checkmark no ActorSelector (F042), labels de discurso
      Orador->Discurso em i18n (F043), campo read-only de discursante
      com icone lapis para troca de ultima hora e icone X para reverter
      + migracao DB 014 com speaker_*_override (F044). 5 features,
      39 ACs, 12 arquivos impactados (2 novos + 10 modificados).

  - id: PLAN_P015
    title: "Batch 8 Phase 1: Display Fixes & WhatsApp Template"
    status: completed
    crs_covered: [101, 102, 103, 104, 108, 109]
    total_steps: 8
    plan_ref: "docs/plans/PLAN_P015.yaml"
    summary: >
      5 bug fixes de exibicao e dados: LEDs de status condicionados a tipo
      'speeches' no SundayCard (F045), label amarelo de excecao filtrado para
      domingos de discursos na Agenda (F046), inicializacao do template WhatsApp
      na tela Settings com fallback para getDefaultTemplate por idioma (F047),
      correcao de variaveis WhatsApp (colecao, link, aspas no titulo, data
      human-readable por idioma) (F048), e condicao de SpeechSlots no Home
      corrigida para permitir renderizacao em domingos speeches (F049).
      5 features, 26 ACs, 6 arquivos impactados (1 novo + 5 modificados).

  - id: PLAN_P016
    title: "Batch 8 Phase 2: Invite Management UX"
    status: pending
    crs_covered: [105, 106, 107, 110, 111]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P016.yaml"
    summary: >
      5 melhorias de UX na secao de gerenciamento de convites: substituicao de
      botoes texto por icones (WhatsApp SVG + tres pontinhos Unicode U+22EE) (F050),
      substituicao de Alert.alert por dropdown customizado InviteActionDropdown com
      opcoes de status + nova transicao reversa assigned_invited -> assigned_not_invited
      (F051), segunda linha do invite row com label completo + StatusLED inline +
      nome do status traduzido (F052), permissao 'home:invite_mgmt' adicionada ao
      bishopric (F053), e aumento de gap (8->12) e fontSize do X (20->24) no
      SpeechSlot (F054). 5 features, 27 ACs, 8 arquivos impactados (2 novos +
      6 modificados + 3 testes).

  - id: PLAN_P017
    title: "Batch 9 Phase 1: Bug Fixes & Quick UI"
    status: pending
    crs_covered: [112, 113, 117, 122, 125]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P017.yaml"
    summary: >
      3 bug fixes e 2 UI tweaks: abrir conversa WhatsApp sem reenviar convite
      via nova funcao buildWhatsAppConversationUrl (F055), trocar titulo do
      InviteActionDropdown de speaker_name para t('speeches.changeStatus') i18n
      (F056), corrigir bandeira +1 mostrando Canada ao inves de USA com
      reordenacao e highlight por label (F057), trocar label '3o Discurso'
      para 'Ultimo Discurso' i18n em 4 locais com nova key speeches.lastSpeech
      (F058), e corrigir duplicacao visual do campo de oracao com nova prop
      modalOnly no PrayerSelector (F059). 5 features, 23 ACs, 10 arquivos
      impactados (0 novos + 10 modificados + 1 teste).

  - id: PLAN_P018
    title: "Batch 9 Phase 2: Speech Cards & Agenda"
    status: pending
    crs_covered: [114, 115, 116, 119, 121]
    total_steps: 11
    plan_ref: "docs/plans/PLAN_P018.yaml"
    summary: >
      5 melhorias de UX em speech cards e agenda: botao X para remover tema
      atribuido no SpeechSlot com wiring via assignTopic null (F060), dialogo
      de confirmacao Alert.alert ao mudar tipo de domingo quando ha discursantes
      ou temas atribuidos (F061), filtro de opcoes no LED click para assigned_invited
      mostrando apenas confirmado/desistiu via nova prop allowedStatuses no
      StatusChangeModal (F062), reorder do layout SpeechSlot para [LED][Field][X]
      com marginLeft 28px no topicField para alinhamento (F063), e label italico
      "(Designacao de ultima hora)" no AgendaForm SpeakerField quando override
      ativo (F064). 5 features, 30 ACs, 7 arquivos impactados (0 novos +
      7 modificados + 1 teste).

  - id: PLAN_P019
    title: "Batch 9 Phase 3: UX Polish"
    status: pending
    crs_covered: [118, 120, 123, 124]
    total_steps: 9
    plan_ref: "docs/plans/PLAN_P019.yaml"
    summary: >
      3 melhorias de UX polish + 1 CR ja implementado: flex:1 defensivo no
      container do SearchInput + botao "Fechar" nas 4 telas de Settings
      (members, topics, history, timezone) com flexDirection:'row' e gap:12
      (F065), auto-scroll para mostrar card expandido nas abas Discursos e
      Agenda com scrollToIndex viewPosition:0 e setTimeout 300ms (F066),
      campo "Reconhecendo a Presenca" com Pressable customizado exibindo um
      ator por linha ao inves de SelectorField truncado (F067). F068 (nomes
      customizados em oracoes) ja implementado - nenhuma alteracao necessaria.
      3 features ativas, 26 ACs, 8 arquivos impactados (0 novos +
      8 modificados + 1 teste).

# =============================================================================
# CRs pendentes sem plano
# =============================================================================

pending_without_plan: []

# =============================================================================
# CRs pendentes com plano (nao implementados ainda)
# =============================================================================

pending_with_plan:
  - cr_id: 76
    plan_id: PLAN_CR76
    description: "Edge Function erro na tela de Usuarios (regressao CR-64) - HTTP 401"
  - cr_id: 79
    plan_id: PLAN_CR79
    description: "Tela de Usuarios sem botao de voltar"
  - cr_id: 80
    plan_id: PLAN_CR80
    description: "Textos explicativos na tela de Membros (i18n pt/en/es)"
  - cr_id: 81
    plan_id: PLAN_CR81
    description: "Campo Nome para usuario (auto-ator, logs, tela usuarios)"
  - cr_id: 83
    plan_id: PLAN_P011
    description: "Save/Cancel buttons para MemberEditor e TopicEditor"
  - cr_id: 84
    plan_id: PLAN_P011
    description: "Botao X para limpar campos de search (SearchInput reutilizavel)"
  - cr_id: 85
    plan_id: PLAN_P011
    description: "Lista completa de codigos internacionais de telefone"
  - cr_id: 86
    plan_id: PLAN_P011
    description: "Dialogo de confirmacao antes de importar CSV"
  - cr_id: 90
    plan_id: PLAN_P011
    description: "Fix do botao Delete no SwipeableCard"
  - cr_id: 87
    plan_id: PLAN_P012
    description: "Substituir texto Edit/Delete nos botoes de swipe por icones lapis/lixeira"
  - cr_id: 88
    plan_id: PLAN_P012
    description: "Texto explicativo na tela de Temas sobre ativar/desativar colecoes"
  - cr_id: 89
    plan_id: PLAN_P012
    description: "Visao de temas de colecao (expand/collapse read-only list)"
  - cr_id: 91
    plan_id: PLAN_P013
    description: "Fix RLS policy error on notification_queue (SECURITY DEFINER)"
  - cr_id: 92
    plan_id: PLAN_P013
    description: "Fix duplicate key error in country dropdown (keyExtractor item.label)"
  - cr_id: 93
    plan_id: PLAN_P013
    description: "Change deep link protocol de wardmanager:// para sacrmeetman://"
  - cr_id: 95
    plan_id: PLAN_P013
    description: "Fix speech fields not hiding when changing sunday type"
  - cr_id: 98
    plan_id: PLAN_P013
    description: "Fix prayer fields not clickable (PrayerSelector visible/onClose)"
  - cr_id: 94
    plan_id: PLAN_P014
    description: "Templates WhatsApp i18n (padrao por idioma da ala)"
  - cr_id: 96
    plan_id: PLAN_P014
    description: "Search fixo no topo em members.tsx e topics.tsx"
  - cr_id: 97
    plan_id: PLAN_P014
    description: "Multi-select no campo Reconhecendo a Presenca"
  - cr_id: 99
    plan_id: PLAN_P014
    description: "Labels de discurso Orador->Discurso"
  - cr_id: 100
    plan_id: PLAN_P014
    description: "Campo read-only de discursante com troca de ultima hora"
  - cr_id: 105
    plan_id: PLAN_P016
    description: "Substituir botoes texto por icones (WhatsApp + tres pontinhos)"
  - cr_id: 106
    plan_id: PLAN_P016
    description: "Substituir Alert por dropdown customizado para acoes de convite"
  - cr_id: 107
    plan_id: PLAN_P016
    description: "Mostrar posicao + LED + status na segunda linha do invite row"
  - cr_id: 110
    plan_id: PLAN_P016
    description: "Mostrar secao de convites para o bispado"
  - cr_id: 111
    plan_id: PLAN_P016
    description: "Aumentar espaco entre LED e X e tamanho do X no SpeechSlot"
  - cr_id: 112
    plan_id: PLAN_P017
    description: "Ver Conversa no WhatsApp sem reenviar convite"
  - cr_id: 113
    plan_id: PLAN_P017
    description: "Titulo do InviteActionDropdown como 'Alterar status' (i18n)"
  - cr_id: 117
    plan_id: PLAN_P017
    description: "Fix +1 country code mostrando Canada ao inves de USA"
  - cr_id: 122
    plan_id: PLAN_P017
    description: "Trocar label '3o Discurso' para 'Ultimo Discurso' (i18n)"
  - cr_id: 125
    plan_id: PLAN_P017
    description: "Fix duplicacao visual do campo de oracao de encerramento"
  - cr_id: 114
    plan_id: PLAN_P018
    description: "Botao X para remover tema atribuido no SpeechSlot"
  - cr_id: 115
    plan_id: PLAN_P018
    description: "Confirmacao ao mudar tipo de domingo com atribuicoes existentes"
  - cr_id: 116
    plan_id: PLAN_P018
    description: "LED click mostra apenas confirmado/desistiu para assigned_invited"
  - cr_id: 119
    plan_id: PLAN_P018
    description: "Redesign layout SpeechSlot [LED][Field][X] com alinhamento de tema"
  - cr_id: 121
    plan_id: PLAN_P018
    description: "Label (Designacao de ultima hora) na agenda com override ativo"
  - cr_id: 118
    plan_id: PLAN_P019
    description: "SearchInput flex:1 defensivo + botao close nas telas de Settings"
  - cr_id: 120
    plan_id: PLAN_P019
    description: "Auto-scroll para mostrar card expandido nas abas Discursos e Agenda"
  - cr_id: 123
    plan_id: PLAN_P019
    description: "Campo Reconhecendo proporcional com um ator por linha"
  - cr_id: 124
    plan_id: PLAN_P019
    description: "Nomes customizados em campos de oracao (ja implementado)"

# =============================================================================
# Convencoes de implementacao
# =============================================================================

conventions:
  commits: "Conventional Commits (feat:, fix:, chore:, test:, docs:)"
  testing: "Vitest + React Testing Library, testes junto com codigo"
  branching: "master para desenvolvimento, main para releases"
  code_style: "TypeScript strict, ESLint, Prettier"
  plan_structure: "1 commit por step, steps com done_when, covers, risks"
  snapshot_pattern: "ADR-003: dados de oradores e temas copiados como snapshot"
  offline_strategy: "ADR-008: last-write-wins com fila de mutacoes"
  error_handling: "ADR-022: extracao de erro via error.context.json()"
  auth_pattern: "ADR-023: SDK gerencia auth automaticamente, sem header manual"

# =============================================================================
# Changelog
# =============================================================================

changelog:
  - version: 8
    phase: "batch-9-phase-3"
    changes:
      - "Added PLAN_P019 for Batch 9 Phase 3 (F065-F067, CRs 118/120/123/124)"
      - "3 UX polish + 1 already implemented: SearchInput flex:1 + close button, auto-scroll on expand, recognizing field proportional"
      - "9 steps, 26 ACs, 8 arquivos impactados (0 novos + 8 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "3 ADRs: ADR-046 (flex:1 defensivo no SearchInput), ADR-047 (setTimeout 300ms para auto-scroll), ADR-048 (Pressable inline para Reconhecendo)"
      - "F068 (CR-124) marcado como already_implemented - nenhuma alteracao de codigo"
  - version: 7
    phase: "batch-9-phase-2"
    changes:
      - "Added PLAN_P018 for Batch 9 Phase 2 (F060-F064, CRs 114/115/116/119/121)"
      - "5 UX improvements: topic X button, type change confirmation, LED filter, layout reorder, last-minute label"
      - "11 steps, 30 ACs, 7 arquivos impactados (0 novos + 7 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-044 (assignTopic com null para clear), ADR-045 (Alert.alert nativo para confirmacao)"
      - "1 nova prop: onClearTopic, 1 nova prop: allowedStatuses, 1 novo estilo: lastMinuteLabel"
  - version: 6
    phase: "batch-9-phase-1"
    changes:
      - "Added PLAN_P017 for Batch 9 Phase 1 (F055-F059, CRs 112/113/117/122/125)"
      - "3 bug fixes + 2 UI tweaks: WhatsApp conversation URL, dropdown title i18n, +1 flag fix, last speech label, prayer duplication"
      - "10 steps, 23 ACs, 10 arquivos impactados (0 novos + 10 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-042 (buildWhatsAppConversationUrl separada), ADR-043 (country label as selection key)"
      - "1 nova funcao: buildWhatsAppConversationUrl, 1 nova funcao: getCountryByLabel, 1 nova prop: modalOnly"
  - version: 5
    phase: "batch-8-phase-2"
    changes:
      - "Added PLAN_P016 for Batch 8 Phase 2 (F050-F054, CRs 105/106/107/110/111)"
      - "5 UX improvements: icon buttons, custom dropdown, enhanced second line, bishopric permission, SpeechSlot spacing"
      - "10 steps, 27 ACs, 8 arquivos impactados (2 novos + 6 modificados + 3 testes)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "1 nova transicao de status: assigned_invited -> assigned_not_invited (reversa)"
      - "1 novo componente: InviteActionDropdown.tsx"
  - version: 4
    phase: "batch-8-phase-1"
    changes:
      - "Added PLAN_P015 for Batch 8 Phase 1 (F045-F049, CRs 101/102/103/104/108/109)"
      - "5 bug fixes: LEDs condicionais, label amarelo filtrado, template Settings, variaveis WhatsApp, SpeechSlots Home"
      - "8 steps, 26 ACs, 6 arquivos impactados (1 novo + 5 modificados)"
      - "Zero migracoes de banco, zero dependencias novas"
  - version: 3
    phase: "batch-7-phase-2"
    changes:
      - "Added PLAN_P014 for Batch 7 Phase 2 (F040-F044, CRs 94/96/97/99/100)"
      - "5 UX/features: WhatsApp i18n templates, search fixed top, multi-select recognizing, speech labels, speaker override"
      - "12 steps, 39 ACs, 12 arquivos impactados (2 novos + 10 modificados)"
      - "1 migracao DB (014_add_speaker_overrides.sql)"
  - version: 2
    phase: "batch-7-phase-1"
    changes:
      - "Added PLAN_P013 for Batch 7 Phase 1 (F035-F039, CRs 91/92/93/95/98)"
      - "5 bug fixes: RLS trigger, duplicate key, deep link protocol, speech fields, prayer fields"
      - "6 steps, 30 ACs, 7 arquivos impactados (1 novo + 6 modificados + 2 testes)"
  - version: 1
    phase: "batch-6"
    changes:
      - "Initial consolidated plan with all phases and CR plans"
