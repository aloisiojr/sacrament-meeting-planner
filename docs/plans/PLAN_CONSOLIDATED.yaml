# =============================================================================
# PLAN_CONSOLIDATED.yaml
# Fonte unica de verdade dos planos de implementacao
# Gerado: 2026-02-18
# =============================================================================

metadata:
  project: Sacrament Meeting Planner
  last_updated: "2026-02-24"
  version: 37
  last_updated_by: "batch-27-split-speech-whatsapp-template"
  total_phases: 6
  total_cr_plans: 54
  phases_completed: true
  cr_plans_completed: true
  pending_crs_without_plan: []

# =============================================================================
# Fases do projeto original
# =============================================================================

project_phases:
  - id: PHASE-01
    title: "Foundation (DB + Auth + Permissions + i18n + Theme)"
    status: completed
    features_covered: [F001, F002, F020, F021, F023]
    total_steps: 12
    summary: >
      Configuracao inicial do projeto: Expo SDK 54, Supabase com schema completo
      (15 tabelas), RLS ward-scoped, AuthContext com sessao e permissoes,
      auto-registro e convite via deep link, react-i18next com 3 idiomas
      (pt-BR, en, es), tema escuro/claro com persistencia, app shell com
      4 tabs (Home, Agenda, Speeches, Settings), date utils e tipos TypeScript.

  - id: PHASE-02
    title: "Core Data (Ward, Members, Topics, Sunday Types, Actors, Hymns)"
    status: completed
    features_covered: [F003, F005, F006, F007, F013, F014, F015]
    total_steps: 12
    summary: >
      CRUD de membros com busca accent-insensitive e auto-save, gestao de
      temas (ward topics + colecoes gerais com toggle), auto-atribuicao de
      tipos de domingo com regras de testemunho e conferencia geral, atores
      com papeis (presidir, dirigir, reconhecer, musica), seletores de hinos
      com filtro sacramental, seletores de oracoes com nome customizado,
      e scripts CLI de importacao de hinos e colecoes gerais.

  - id: PHASE-03
    title: "Speech Lifecycle (Speech CRUD, Home tab, WhatsApp)"
    status: completed
    features_covered: [F008, F009, F010]
    total_steps: 11
    summary: >
      Gestao completa de discursos: scroll infinito de domingos (12 meses
      passado + 12 futuro), SundayCards expansiveis com LEDs 3D animados
      por status, atribuicao de oradores e temas com snapshots, ciclo de
      vida de status (nao-designado -> designado -> convidado -> confirmado
      / desistiu), aba Home com 3 proximos domingos, secao de proximas
      designacoes (Bispado), gestao de convites (Secretario), e integracao
      WhatsApp com template e URL wa.me.

  - id: PHASE-04
    title: "Agenda & Presentation Mode"
    status: completed
    features_covered: [F012, F016]
    total_steps: 10
    summary: >
      Formulario de agenda da reuniao com 4 secoes (boas-vindas, designacoes,
      discursos, ultimo discurso), formulario especial para reunioes nao-discursos
      (testemunho, conferencia de ala, primaria), designacao de oradores via
      agenda (com status auto-confirmado), modo apresentacao full-screen com
      accordion cards (1 expandido por vez), botao "Iniciar Reuniao" visivel
      apenas aos domingos, e troca de idioma com gestao de colecoes.

  - id: PHASE-05
    title: "Infrastructure (Sync, Offline, Notifications)"
    status: completed
    features_covered: [F011, F017, F022]
    total_steps: 8
    summary: >
      Sincronizacao realtime via Supabase Realtime com polling fallback
      (2.5s quando WebSocket desconecta), push notifications com fila no DB
      (triggers por evento de discurso), lembretes semanais aos domingos 18h,
      processador de notificacoes via Edge Function cron, registro de tokens
      Expo Push, suporte offline com fila de mutacoes (AsyncStorage, max 100),
      UI otimista, e guard para operacoes que requerem conexao.

  - id: PHASE-06
    title: "Admin & Polish (Users, Activity Log, CSV, Template, Hardening)"
    status: completed
    features_covered: [F004, F018, F019, F024]
    total_steps: 9
    summary: >
      Gestao de usuarios via Edge Functions (convite, listagem, troca de
      papel, exclusao), tela de usuarios com card expansivel, log de
      atividades com busca e paginacao infinita, retencao de 2 anos,
      import/export CSV de membros (overwrite total com validacao),
      editor de template WhatsApp com preview em tempo real, tela de
      settings completa com todas as opcoes por papel, error boundaries
      por modulo, e confirmacao de saida.

# =============================================================================
# Planos de Change Requests
# =============================================================================

cr_plans:
  - id: PLAN_CR001
    title: "Change Requests Batch 1"
    status: completed
    crs_covered: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    total_steps: 14
    summary: >
      Correcoes criticas de UI e bugs: fix do enum de sunday types (remocao
      de fast_sunday/special_program/no_meeting, adicao de primary_presentation
      e other com razao customizada), migracao de DB, atualizacao de tipos e
      i18n, titulo na Home, texto traduzido de excecoes, labels de discursos,
      fix de idioma na criacao de ala, ocultar discursos para domingos
      nao-discursos, scroll de temas, fix de flash na navegacao settings,
      telas de tema e sobre, fix de agenda vazia no modo apresentacao.

  - id: PLAN_CR002
    title: "Change Requests Batch 2"
    status: completed
    crs_covered: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
    total_steps: 18
    summary: >
      Fix do idioma padrao ao iniciar app, rename do template WhatsApp,
      fix do template default, placeholders clicaveis, layout do template,
      botoes de voltar em 3 telas, log legivel com datas por extenso,
      fix do dropdown de sunday type (bug critico de revert), scroll
      inicial da aba Agenda, redesign completo de atores (remocao da
      tela Settings, bottom-sheet 2/3, CRUD inline, remocao de "Ator"
      da UI), fix de input com letras perdidas (DebouncedTextInput),
      dialogo de hinos em 2/3, renomeacao de secoes da agenda com
      secoes dinamicas por tipo de reuniao, permissao de Secretario
      para ver Usuarios, label de apresentacao especial.

  - id: PLAN_CR003
    title: "Spec Corrections Batch 3"
    status: completed
    crs_covered: [31, 34, 36, 37]
    total_steps: 5
    type: documentation-only
    summary: >
      Correcoes de inconsistencias na documentacao: fix de ASM-009
      (Secretario pode designar via Agenda), atualizacao de RF-22 e
      secao 7.13.4 para refletir redesign de atores (papel inferido
      do campo, sem checkboxes), adicao de regra de debounce 500ms
      para auto-save em campos de texto, atualizacao de permissoes
      do Secretario para gestao de usuarios em secoes 4.2 e 7.8.

  - id: PLAN_CR4_F001
    title: "Documentation Updates"
    status: completed
    crs_covered: [44, 45, 46, 47, 48, 49, 50]
    total_steps: 7
    type: documentation-only
    summary: >
      Atualizacao de documentos ARCH e SPEC desatualizados: ARCH_M002
      (custom_reason, enum speeches, contracts mobile), ARCH_M006/M007
      (integracao sync/offline), ARCH_M008 (sub-telas settings),
      ARCH_M004 (formatFullDate no PresentationMode), fix de
      inconsistencias em ARCH_CR3_F029 e F027, atualizacao de
      PRODUCT_SPECIFICATION e SPEC.final.md com labels, enum, e
      permissoes corrigidos.

  - id: PLAN_CR4_F002
    title: "Speeches Persistence & Sunday Type Revert Fix"
    status: completed
    crs_covered: [56, 68]
    total_steps: 3
    summary: >
      Fix critico de persistencia de discursos: migracao DB para
      adicionar 'speeches' ao CHECK constraint, remocao do filtro
      que bloqueava insercao de 'speeches' no DB, mudanca de
      useRemoveSundayException para UPSERT ao inves de DELETE,
      fix do bug de revert do tipo de domingo (race condition
      entre optimistic update e refetch).

  - id: PLAN_CR4_F003
    title: "Infrastructure Integration (Sync, Offline, Notifications)"
    status: completed
    crs_covered: [52, 53]
    total_steps: 2
    summary: >
      Conexao de codigo morto de infraestrutura ao app: ativacao
      de useConnection, useRealtimeSync e OfflineBanner no layout
      de tabs, registro de push tokens e handler de notificacoes.

  - id: PLAN_CR4_F004
    title: "Error Handling Overhaul"
    status: completed
    crs_covered: [57, 58, 59, 60, 61]
    total_steps: 7
    summary: >
      Overhaul completo de tratamento de erros: configuracao do
      QueryClient com retry policies (queries 2x, mutations 0x,
      401/403 sem retry), onError com Alert.alert i18n em todas
      as 17+ mutations, internacionalizacao do ErrorBoundary com
      suporte a tema, QueryErrorView reutilizavel com botao retry
      nas 3 tabs principais, error boundaries granulares por tab
      e componentes criticos.

  - id: PLAN_CR4_F005
    title: "CSV & Members Screen Fixes"
    status: completed
    crs_covered: [54, 55, 66]
    total_steps: 5
    summary: >
      Fix de export CSV (cancel do share sheet nao mostra erro),
      import com string i18n ao inves de hardcoded, spacer no
      header quando add button oculto, export habilitado com lista
      vazia (gera CSV apenas com headers), validacao de import
      com numeros de linha e campos especificos.

  - id: PLAN_CR4_F006
    title: "UI/UX Small Fixes"
    status: completed
    crs_covered: [62, 63, 65, 69, 70]
    total_steps: 6
    summary: >
      Tela Sobre com disclaimer e nome do autor corrigido, fix
      do template WhatsApp default, toggle de tema com feedback
      instantaneo (AsyncStorage async), atualizacao de labels
      da agenda (Dirigindo, Apoios e Agradecimentos, etc.),
      aumento de icones de editar/deletar atores.

  - id: PLAN_CR4_F007
    title: "Auth Fixes: Users + Forgot Password"
    status: completed
    crs_covered: [64, 67]
    total_steps: 7
    summary: >
      Fix da tela de usuarios para Secretario (debug de Edge Function
      e erro i18n), implementacao do fluxo "Esqueci minha senha" com
      tela dedicada (email input, supabase.auth.resetPasswordForEmail,
      loading state, validacao, feedback de sucesso/erro, i18n 3 idiomas,
      suporte a dark/light theme).

  - id: PLAN_CR4_F008
    title: "Agenda & Actors Enhancements"
    status: completed
    crs_covered: [71, 72, 73, 74, 75]
    total_steps: 10
    summary: >
      Remocao da regra auto-presidir (can_conduct nao implica mais
      can_preside), auto-criacao de ator para membros do bispado
      convidados, campo Reconhecendo usando ActorSelector ao inves
      de texto, nomes customizados para oracoes via MemberSelectorModal,
      domingos com conferencia geral/estaca aparecem como cards
      nao-expansiveis na aba Agenda.

  - id: PLAN_CR4_F009
    title: "Import Hymns CLI Script"
    status: completed
    crs_covered: [51]
    total_steps: 1
    summary: >
      Script CLI executavel via 'pnpm import-hymns <file.csv>' para
      importar hinario: leitura de CSV (Lingua, Numero, Titulo,
      Sacramental S/N), validacao com erros por linha, upsert por
      (language, number), sumario de importacao.

  - id: PLAN_CR80
    title: "Members Screen Explanatory Texts (i18n)"
    status: pending
    crs_covered: [80]
    total_steps: 3
    summary: >
      Adicao de 2 textos explicativos na tela de Membros: description
      (abaixo do titulo, sempre visivel) e csvHelp (abaixo dos botoes CSV,
      visivel apenas com canImport=true). Traducao em 3 idiomas (pt-BR,
      en, es). 2 keys i18n novas, ~15 linhas em members.tsx, sem
      mudancas de logica.

  - id: project_CR77_CR78_CR82
    title: "Regressions Fix (expo-file-system v19 + GestureHandler)"
    status: completed
    crs_covered: [77, 78, 82]
    total_steps: 3
    summary: >
      Migracao para nova API do expo-file-system v19 (File/Paths API
      ao inves de cacheDirectory/EncodingType), fix de export CSV
      com lista vazia (cacheDirectory null), fix de import CSV
      (EncodingType undefined), remocao de constraint unique no
      phone de membros, adicao de GestureHandlerRootView como wrapper
      no root layout.

  - id: PLAN_CR76
    title: "Fix Users Screen HTTP 401 (Regression CR-64)"
    status: pending
    crs_covered: [76]
    total_steps: 2
    summary: >
      Remocao do header Authorization manual em callEdgeFunction
      (getAccessToken com JWT stale/expirado), delegando auth ao
      SDK do Supabase que gerencia tokens automaticamente via
      autoRefreshToken. Preservacao da logica de extracao de erro
      via error.context.json().

  - id: PLAN_CR79
    title: "Back Button on Users Screen"
    status: pending
    crs_covered: [79]
    total_steps: 3
    summary: >
      Adicao de botao de voltar na tela de Usuarios seguindo o
      padrao das demais sub-telas de Settings (Pressable com
      router.back(), layout 3 elementos: voltar | titulo | invite),
      ajuste de fontSize do titulo para consistencia.

  - id: PLAN_CR81
    title: "User Name Field"
    status: pending
    crs_covered: [81]
    total_steps: 13
    summary: >
      Campo Nome obrigatorio para usuarios: migracao DB (user_name
      em activity_log, RPC list_ward_users com full_name), atualizacao
      das Edge Functions (register-first-user com auto-ator para
      bispado, register-invited-user, novo update-user-name),
      AuthContext expondo userName, inputs de nome nas telas de
      registro, exibicao e edicao na tela de usuarios, pipeline
      de activity log com user_name em 6 hooks.

  - id: PLAN_P011
    title: "Batch 6 Phase 1: Members UX Improvements & Bug Fixes"
    status: pending
    crs_covered: [83, 84, 85, 86, 90]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P011.yaml"
    summary: >
      Fix do botao Delete no SwipeableCard (pointerEvents box-none),
      botoes Save/Cancel no MemberEditor e TopicEditor (remocao de
      auto-save no onBlur), modulo compartilhado countryCodes.ts com
      ~200 codigos de pais (single source of truth), dialogo de
      confirmacao antes de importar CSV (Alert.alert com i18n),
      componente reutilizavel SearchInput com botao X para limpar
      busca em 10 campos do app. 5 features, 28 ACs, 18 arquivos
      impactados (2 novos + 16 modificados).

  - id: PLAN_P012
    title: "Batch 6 Phase 2: Themes & Swipe UX Improvements"
    status: pending
    crs_covered: [87, 88, 89]
    total_steps: 7
    plan_ref: "docs/plans/PLAN_P012.yaml"
    summary: >
      Substituicao de texto Edit/Delete nos botoes de swipe por icones
      Unicode (lapis U+270F e lixeira U+1F5D1) no SwipeableCard, texto
      explicativo na tela de Temas descrevendo temas da ala e toggle de
      colecoes (i18n 3 idiomas), e visao expand/collapse de temas de
      colecao com padrao acordeao (uma expandida por vez), lazy-loading
      via novo hook useCollectionTopics, estados de loading/empty.
      3 features, 19 ACs, 6 arquivos impactados (0 novos + 6 modificados).

  - id: PLAN_P013
    title: "Batch 7 Phase 1: Bug Fixes"
    status: pending
    crs_covered: [91, 92, 93, 95, 98]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P013.yaml"
    summary: >
      5 bug fixes independentes sem overlap de arquivos: SECURITY DEFINER
      na funcao de trigger enqueue_speech_notification para resolver erro
      de RLS na notification_queue (nova migracao 013), fix de duplicate
      key warning no dropdown de paises (keyExtractor item.label), mudanca
      do protocolo de deep link de wardmanager:// para sacrmeetman://
      (app.json + Edge Function), fix de speech slots nao escondendo ao
      mudar tipo de domingo (verificacao direta tipo === 'speeches' ao
      inves de isExcludedFromAgenda), fix de campos de oracao nao
      clicaveis (props visible/onClose no PrayerSelector seguindo padrao
      ActorSelector). 5 features, 30 ACs, 7 arquivos impactados
      (1 novo + 6 modificados + 2 testes atualizados).

  - id: PLAN_P014
    title: "Batch 7 Phase 2: UX & Features"
    status: pending
    crs_covered: [94, 96, 97, 99, 100]
    total_steps: 12
    plan_ref: "docs/plans/PLAN_P014.yaml"
    summary: >
      5 melhorias de UX e features: templates WhatsApp i18n com
      DEFAULT_TEMPLATE_EN e DEFAULT_TEMPLATE_ES + getDefaultTemplate
      por idioma (F040), search fixo no topo em members.tsx e topics.tsx
      (F041), multi-select no campo Reconhecendo a Presenca com toggle
      add/remove e checkmark no ActorSelector (F042), labels de discurso
      Orador->Discurso em i18n (F043), campo read-only de discursante
      com icone lapis para troca de ultima hora e icone X para reverter
      + migracao DB 014 com speaker_*_override (F044). 5 features,
      39 ACs, 12 arquivos impactados (2 novos + 10 modificados).

  - id: PLAN_P015
    title: "Batch 8 Phase 1: Display Fixes & WhatsApp Template"
    status: completed
    crs_covered: [101, 102, 103, 104, 108, 109]
    total_steps: 8
    plan_ref: "docs/plans/PLAN_P015.yaml"
    summary: >
      5 bug fixes de exibicao e dados: LEDs de status condicionados a tipo
      'speeches' no SundayCard (F045), label amarelo de excecao filtrado para
      domingos de discursos na Agenda (F046), inicializacao do template WhatsApp
      na tela Settings com fallback para getDefaultTemplate por idioma (F047),
      correcao de variaveis WhatsApp (colecao, link, aspas no titulo, data
      human-readable por idioma) (F048), e condicao de SpeechSlots no Home
      corrigida para permitir renderizacao em domingos speeches (F049).
      5 features, 26 ACs, 6 arquivos impactados (1 novo + 5 modificados).

  - id: PLAN_P016
    title: "Batch 8 Phase 2: Invite Management UX"
    status: pending
    crs_covered: [105, 106, 107, 110, 111]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P016.yaml"
    summary: >
      5 melhorias de UX na secao de gerenciamento de convites: substituicao de
      botoes texto por icones (WhatsApp SVG + tres pontinhos Unicode U+22EE) (F050),
      substituicao de Alert.alert por dropdown customizado InviteActionDropdown com
      opcoes de status + nova transicao reversa assigned_invited -> assigned_not_invited
      (F051), segunda linha do invite row com label completo + StatusLED inline +
      nome do status traduzido (F052), permissao 'home:invite_mgmt' adicionada ao
      bishopric (F053), e aumento de gap (8->12) e fontSize do X (20->24) no
      SpeechSlot (F054). 5 features, 27 ACs, 8 arquivos impactados (2 novos +
      6 modificados + 3 testes).

  - id: PLAN_P017
    title: "Batch 9 Phase 1: Bug Fixes & Quick UI"
    status: pending
    crs_covered: [112, 113, 117, 122, 125]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P017.yaml"
    summary: >
      3 bug fixes e 2 UI tweaks: abrir conversa WhatsApp sem reenviar convite
      via nova funcao buildWhatsAppConversationUrl (F055), trocar titulo do
      InviteActionDropdown de speaker_name para t('speeches.changeStatus') i18n
      (F056), corrigir bandeira +1 mostrando Canada ao inves de USA com
      reordenacao e highlight por label (F057), trocar label '3o Discurso'
      para 'Ultimo Discurso' i18n em 4 locais com nova key speeches.lastSpeech
      (F058), e corrigir duplicacao visual do campo de oracao com nova prop
      modalOnly no PrayerSelector (F059). 5 features, 23 ACs, 10 arquivos
      impactados (0 novos + 10 modificados + 1 teste).

  - id: PLAN_P018
    title: "Batch 9 Phase 2: Speech Cards & Agenda"
    status: pending
    crs_covered: [114, 115, 116, 119, 121]
    total_steps: 11
    plan_ref: "docs/plans/PLAN_P018.yaml"
    summary: >
      5 melhorias de UX em speech cards e agenda: botao X para remover tema
      atribuido no SpeechSlot com wiring via assignTopic null (F060), dialogo
      de confirmacao Alert.alert ao mudar tipo de domingo quando ha discursantes
      ou temas atribuidos (F061), filtro de opcoes no LED click para assigned_invited
      mostrando apenas confirmado/desistiu via nova prop allowedStatuses no
      StatusChangeModal (F062), reorder do layout SpeechSlot para [LED][Field][X]
      com marginLeft 28px no topicField para alinhamento (F063), e label italico
      "(Designacao de ultima hora)" no AgendaForm SpeakerField quando override
      ativo (F064). 5 features, 30 ACs, 7 arquivos impactados (0 novos +
      7 modificados + 1 teste).

  - id: PLAN_P019
    title: "Batch 9 Phase 3: UX Polish"
    status: pending
    crs_covered: [118, 120, 123, 124]
    total_steps: 9
    plan_ref: "docs/plans/PLAN_P019.yaml"
    summary: >
      3 melhorias de UX polish + 1 CR ja implementado: flex:1 defensivo no
      container do SearchInput + botao "Fechar" nas 4 telas de Settings
      (members, topics, history, timezone) com flexDirection:'row' e gap:12
      (F065), auto-scroll para mostrar card expandido nas abas Discursos e
      Agenda com scrollToIndex viewPosition:0 e setTimeout 300ms (F066),
      campo "Reconhecendo a Presenca" com Pressable customizado exibindo um
      ator por linha ao inves de SelectorField truncado (F067). F068 (nomes
      customizados em oracoes) ja implementado - nenhuma alteracao necessaria.
      3 features ativas, 26 ACs, 8 arquivos impactados (0 novos +
      8 modificados + 1 teste).

  - id: PLAN_P020
    title: "Batch 10 Phase 1: LED Redesign, Sunday Type Data Cleanup, LED Filter, Country Code Fix"
    status: pending
    crs_covered: [126, 127, 129, 130]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P020.yaml"
    summary: >
      4 mudancas de UI/logica: redesign do StatusLED de 3 camadas 3D para
      circulo flat com novo esquema de cores (cinza, laranja, amarelo, verde,
      vinho escuro) e cores atualizadas no StatusChangeModal (F069), novo hook
      useDeleteSpeechesByDate para apagar speeches ao mudar tipo de domingo
      de 'speeches' para outro com wiring via prop onDeleteSpeeches no
      SundayTypeDropdown/SundayCard/speeches.tsx (F070), LED click filter
      constante excluindo not_assigned + desabilitar LED para assigned_confirmed
      e gave_up no SpeechSlot (F071), e fix de exibicao de bandeira para
      paises com codigo compartilhado (+1 US/Canada) usando getCountryByLabel
      ao inves de getFlagForCode em members.tsx (F072). 4 features, 35 ACs,
      7 arquivos impactados (0 novos + 7 modificados + 1 teste). Zero
      migracoes de banco, zero dependencias novas. 2 ADRs: ADR-049 (cores
      flat unicas), ADR-050 (hook dedicado para delete speeches).

  - id: PLAN_P021
    title: "Batch 10 Phase 2: Topic X Positioning, Hymn Search Width, Auto-scroll Fix, Prayer Name UX"
    status: pending
    crs_covered: [128, 131, 132, 133]
    total_steps: 9
    plan_ref: "docs/plans/PLAN_P021.yaml"
    summary: >
      4 mudancas de UI/UX: reposicionar botao X do tema para fora do campo dropdown
      no SpeechSlot seguindo padrao do speaker row (F073), simplificar styles.searchInput
      no AgendaForm para herdar estilos do SearchInput base (F074), remover getItemLayout
      com alturas fixas de speeches.tsx e agenda.tsx para permitir FlatList medir alturas
      reais e corrigir auto-scroll impreciso + aumentar delay de 300ms para 400ms (F075),
      e adicionar hint de discoverability + pre-populate no re-edit de nomes customizados
      no PrayerSelector com i18n em 3 idiomas (F076). 4 features, 26 ACs, 8 arquivos
      impactados (1 novo + 7 modificados + 1 teste). Zero migracoes de banco, zero
      dependencias novas. 2 ADRs: ADR-051 (remover getItemLayout), ADR-052 (substituir
      initialScrollIndex por useEffect).

  - id: PLAN_P022
    title: "Batch 11: Status Options Fix, Custom Name Help Text, Agenda Scroll, Checkbox Visual, Actor Delete Text"
    status: pending
    crs_covered: [134, 135, 136, 137, 138]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P022.yaml"
    summary: >
      5 mudancas de UI/logic/i18n: corrigir opcoes de transicao de status para mostrar
      todas exceto atual e not_assigned em InviteActionDropdown e StatusChangeModal via
      VALID_TRANSITIONS full mesh e opcoes dinamicas (F077), alterar texto de ajuda de
      nome customizado no PrayerSelector em 3 idiomas (F078), corrigir scroll inicial
      da aba Agenda com viewPosition: 0.5 e retry no onScrollToIndexFailed (F079),
      adicionar checkbox unicode (U+2611/U+2610) no ActorSelector em modo multi-select
      substituindo prefixo texto checkmark (F080), e alterar texto de confirmacao de
      exclusao de ator com nova i18n key actors.deleteConfirm separada de members (F081).
      5 features, 30 ACs, 7 arquivos impactados (1 novo + 6 modificados + 1 teste).
      Zero migracoes de banco, zero dependencias novas. 4 ADRs: ADR-053 (full mesh
      VALID_TRANSITIONS), ADR-054 (opcoes dinamicas via .map), ADR-055 (viewPosition
      0.5 apenas Agenda), ADR-056 (checkbox Unicode).

  - id: PLAN_P023
    title: "Batch 12: Integration Tests (Hooks, SyncProvider, AuthContext, Components)"
    status: pending
    crs_covered: [139]
    total_steps: 8
    plan_ref: "docs/plans/PLAN_P023.yaml"
    summary: >
      Testes de integracao para o projeto: setup-integration.ts com TestWrapper,
      createMockAuthContext, mockSupabaseFrom e 8 mock data factories;
      hooks-supabase.integration.test.ts com 9 hooks (useActors, useAgenda,
      useSpeeches, useMembers, useHymns, useTopics, useSundayList, useSundayTypes,
      useActivityLog) testados com Supabase mockado + React Query;
      sync-provider.integration.test.ts com SyncProvider orquestrando useConnection,
      useRealtimeSync (channel subscribe, polling fallback, reconnect invalidation),
      OfflineBanner; auth-flow.integration.test.ts com AuthProvider real (sessao,
      roles, signIn, signOut, hasPermission); components-hooks.integration.test.tsx
      com ActorSelector, SearchInput, OfflineBanner, StatusChangeModal,
      MemberSelectorModal, HymnSelector consumindo dados de hooks. Export do const
      AuthContext (ADR-060). 1 feature (F082), 30 ACs, 7 ECs, 6 arquivos impactados
      (5 novos + 1 modificado). Zero migracoes de banco, zero dependencias novas.
      4 ADRs: ADR-057 (chainable Supabase mock), ADR-058 (TestWrapper com
      AuthContext.Provider direto), ADR-059 (vi.mock per file), ADR-060
      (AuthContext export).

  - id: PLAN_P024
    title: "Batch 13: Settings Rename, Agenda Sunday Type, Activity Log, Supabase Fixes"
    status: pending
    crs_covered: [140, 141, 142, 143, 144]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P024.yaml"
    summary: >
      5 features cobrindo i18n, UI, activity log e seguranca SQL: rename de 10
      labels na aba Settings e titulos internos em 3 idiomas via alteracao de
      valores i18n sem mudanca de keys (F083), integracao de SundayTypeDropdown
      na aba Agenda como primeiro campo do card expandido com export do componente
      de SundayCard.tsx e reutilizacao de hooks existentes (F084), overhaul
      completo do activity log com formato estruturado pipe-delimited no banco
      e renderizacao i18n na UI via formatLogDescription com fallback para
      registros antigos + 24 event keys + actorRoles keys em 3 idiomas + novo
      log speech:assign_theme (F085), investigacao documentando que
      pg_timezone_names e externo ao app sem mudanca de codigo (F086), e
      migracao SQL 015 adicionando SET search_path = '' a 7 funcoes com
      qualificacao explicita de schema em todas as referencias a tabelas
      (F087). 5 features, 48 ACs, 17 arquivos impactados (2 novos + 15
      modificados), 1 migracao SQL. 3 ADRs: ADR-061 (export SundayTypeDropdown),
      ADR-062 (formato pipe-delimited), ADR-063 (search_path vazio).

  - id: PLAN_P025
    title: "Batch 14 Phase 1: Password Reset Email, Offline Degradation, Offline Banner, Alert Message, Button Visibility"
    status: pending
    crs_covered: [145, 146, 147, 148, 149]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P025.yaml"
    summary: >
      5 features cobrindo auth, offline UX, UI e i18n: adicionado redirectTo
      com deep link sacrmeetman:// na chamada resetPasswordForEmail + nova pagina
      reset-password.tsx para redefinicao de senha via deep link + 7 novas keys
      i18n de auth (F088), integracao TanStack Query onlineManager com useConnection
      para pausar queries offline + networkMode 'offlineFirst' + silenciamento de
      erros de mutacao offline + nova key i18n common.offlineNoData (F089), safe area
      insets e aumento de fontSize no OfflineBanner para legibilidade em iPhones com
      notch/Dynamic Island (F090), atualizacao de valores i18n do dialogo de confirmacao
      de mudanca de tipo de domingo com texto especifico do usuario mencionando
      discursantes/temas e apagamento de designacoes (F091), e remocao do condicional
      showMeetingButton no Home tab para botao de iniciar reuniao sempre visivel
      (F092). 5 features, 25 ACs, 8 arquivos impactados (1 novo + 7 modificados),
      zero migracoes de banco, zero dependencias novas. 2 ADRs: ADR-064 (supersede
      ADR-019 para customizar email de reset), ADR-065 (onlineManager integrado com
      useConnection).

  - id: PLAN_P026
    title: "Batch 14 Phase 2: Collapsed Card Layouts, Pianist/Conductor, Hymn Toggle, Agenda Status Lines"
    status: pending
    crs_covered: [150, 151, 152, 153]
    total_steps: 9
    plan_ref: "docs/plans/PLAN_P026.yaml"
    summary: >
      4 features cobrindo UI e data: layout de cards contraidos com 3 linhas de nomes
      de discursantes e LEDs verticais no SundayCard compartilhado entre Discursos e
      Home (F093), campos Pianista e Regente na secao Boas-Vindas do AgendaForm com
      ActorSelector roleFilter can_music + inclusao no Modo Apresentacao Card 1 (F094),
      toggle Hino Intermediario com persistencia via nova coluna has_intermediate_hymn
      BOOLEAN DEFAULT true + migracao 016 + condicional no AgendaForm e Modo Apresentacao
      (F095), e linhas de status no card de agenda contraido com novo hook useAgendaRange
      para carregar agendas do range visivel + calculo de campos faltantes/discursantes/
      oracoes/hinos + cores verde para linhas completas + 8 novas keys i18n (F096).
      4 features, 34 ACs, 13 ECs, 7 arquivos impactados (2 novos + 5 modificados),
      1 migracao SQL, zero dependencias novas. 2 ADRs: ADR-066 (useAgendaRange range
      query), ADR-067 (has_intermediate_hymn persistido como coluna DB).

  - id: PLAN_P027
    title: "Batch 15 Phase 1: Presentation Mode Improvements, Speech Labels, Card Redesigns"
    status: pending
    crs_covered: [156, 157, 158, 159, 160, 161, 162, 163]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P027.yaml"
    summary: >
      4 features cobrindo UI de apresentacao, labels e redesign de cards: melhorias no
      modo apresentacao com setas direcionais baseadas na posicao relativa ao card
      expandido, nomes reconhecidos um por linha (join newline), toggle de tamanho de
      fonte (normal/grande via useState) e titulos de secao iguais a aba Agenda (F097),
      remocao do caso especial position===3 em getPositionLabel/SundayCard para usar
      '3o Discurso' ao inves de 'Ultimo Discurso' no tab Discursos + fix do placeholder
      selectSpeaker para 'Selecionar Discursante' em 3 idiomas (F098), redesign do card
      de discursos contraido com LEDs inline antes do label, fonte 11->13, circulo
      14->10, marginBottom:4, sem designacao mostra so circulo (F099), e redesign do
      status no card expandido movendo StatusLED para a linha do label com texto de
      status alinhado a direita + remocao de marginLeft:28 do topicRow (F100).
      4 features, 44 ACs, 10 ECs, 6 arquivos impactados (1 novo + 5 modificados),
      zero migracoes de banco, zero dependencias novas. 2 ADRs: ADR-068 (font size
      toggle como useState), ADR-069 (getPositionLabel unificado sem caso especial).

  - id: PLAN_P029
    title: "Batch 16: UI Polish, Presentation Fix, Status Icons, Back Button, Collapsed Cards"
    status: pending
    crs_covered: [165, 166, 167, 168, 169, 170, 171]
    total_steps: 8
    plan_ref: "docs/plans/PLAN_P029.yaml"
    summary: >
      7 features cobrindo UI polish e UX improvements: paddingRight no statusSection do
      SpeechSlot para alinhar circulo de status com X de remover (F103), titulo da tela
      de apresentacao trocado para 'Reuniao Sacramental' via nova i18n key presentation.title
      com fontSize fixo 19 nao afetado pelo toggle (F104), correcao de acentos e cedilha
      em 3 section headers pt-BR (Boas-Vindas/Anuncios, Designacoes, Ultimo) e 2 em es.json
      (F105), hitSlop={12} no Pressable do botao Voltar em 8 telas de Settings para atingir
      touch target minimo 44x44 (F106), Text com espaco ' ' ao inves de null quando sem nome
      de discursante para manter altura uniforme das rows no card contraido (F107), remocao
      do sufixo redundante ' - Discurso' do label do ultimo discursante no modo apresentacao
      (F108), e 4 linhas de status (Falta, tipo amarelo, Oracoes Y/2, Hinos Z/3) nos cards
      contraidos de testimony_meeting e primary_presentation com nova i18n key
      agenda.statusPrayersLabel (F109). 7 features, 43 ACs, 15 ECs, 14 arquivos impactados
      (1 novo + 13 modificados), zero migracoes de banco, zero dependencias novas. 2 ADRs:
      ADR-074 (paddingRight no statusSection), ADR-075 (hitSlop={12} para back buttons).

  - id: PLAN_P030
    title: "Batch 17: Stake Announcements in Presentation, AgendaForm Label Fix, SpeechSlot Alignment"
    status: pending
    crs_covered: [172, 173, 174]
    total_steps: 4
    plan_ref: "docs/plans/PLAN_P030.yaml"
    summary: >
      3 features cobrindo presentation mode, label fix e layout restructure: novo campo
      de Apoios e Agradecimentos da Estaca no Card 2 do modo apresentacao quando toggle
      has_stake_announcements esta ligado, com nova i18n key presentation.stakeAnnouncementsText
      em 3 idiomas e campo posicionado apos baptism_confirmation e antes do hino sacramental
      (F110), correcao do label do ultimo discurso no AgendaForm de 'Ultimo Discurso - Discurso'
      para 'Ultimo Discurso' removendo concatenacao redundante com t('speeches.speaker'),
      mesma correcao que CR-170/F108 aplicou ao usePresentationMode.ts (F111), e reestruturacao
      do layout do SpeechSlot para coluna direita fixa (width:36) com StatusLED e botoes X
      centralizados na mesma coluna garantindo alinhamento centro-a-centro verdadeiro,
      substituindo abordagem paddingRight:5 do ADR-074 pelo ADR-076 (F112). 3 features,
      15 ACs, 7 ECs, 5 arquivos impactados (1 novo + 4 modificados), zero migracoes de
      banco, zero dependencias novas. 1 ADR: ADR-076 (fixed-width right column supersedes
      ADR-074). S01-S03 totalmente parallelizaveis (todos independentes), S04 (testes)
      depende de todos.

  - id: PLAN_P031
    title: "Batch 18: Deep Link Scheme Fix, HTTPS Email Redirect, Status Circle Alignment"
    status: pending
    crs_covered: [175, 176, 177]
    total_steps: 5
    plan_ref: "docs/plans/PLAN_P031.yaml"
    summary: >
      3 features cobrindo deep link, Edge Function e UI: mudanca do scheme de deep link
      de sacrmeetman:// para sacrmeetplan:// em 3 locais (app.json, create-invitation,
      send-reset-email) com atualizacao de testes existentes que assertam o scheme antigo
      (F113), nova Edge Function reset-redirect como bridge HTTPS->deep link que serve
      HTML com meta refresh + JS redirect + fallback button para tornar botao de reset de
      senha clicavel em email clients + alteracao do deepLink em send-reset-email para URL
      HTTPS apontando para reset-redirect (F114), e movimentacao do StatusLED do rightColumn
      de volta para o labelRow (leftColumn) agrupado com statusText em Pressable
      (statusSection) com flexDirection:'row', alignItems:'center', gap:6 para alinhar
      borda direita do circulo com borda direita do campo de nome do discursante,
      supersedendo abordagem ADR-076 pelo ADR-078 (F115). 3 features, 22 ACs, 12 ECs,
      6 arquivos impactados (1 novo + 5 modificados + 2 testes atualizados), zero
      migracoes de banco, zero dependencias novas. 2 ADRs: ADR-077 (HTTPS redirect
      Edge Function), ADR-078 (StatusLED no labelRow supersedes ADR-076). S01, S02, S03
      parallelizaveis (S04 pode paralelizar com S03), S05 (testes novos) depende de todos.

  - id: PLAN_P032
    title: "Batch 19 Phase 1: Language Control, Pianist/Conductor Split, Optional 2nd Speech, Password Reset Bug"
    status: pending
    crs_covered: [178, 180, 181, 191]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P032.yaml"
    summary: >
      4 features cobrindo controle de idioma, split de atores, toggle de discurso e bug fix:
      separacao do controle de idioma em idioma do app (per-user, salvo em Supabase Auth
      user_metadata) e idioma da ala (wards.language existente) com Observer ganhando aba
      Settings limitada (idioma app, tema, sobre), fix do bug de reativacao de colecoes ao
      trocar idioma da ala, traducao de placeholders WhatsApp por idioma do app, e label
      'Temas da Ala' traduzido via t() (F116). Split de can_music em can_pianist e
      can_conductor com CHECK constraint de exclusividade mutua, migracao de dados existentes
      para can_pianist, atualizacao de tipos TypeScript, useActors, ActorSelector e AgendaForm
      (F117). Toggle opcional de 2o discurso por domingo com has_second_speech BOOLEAN DEFAULT
      true, Switch UI no SpeechSlot posicao 2 (apenas Bispado), dialogo de confirmacao ao
      desligar com designacoes existentes, cards contraidos sem labels ordinais, LEDs filtrados,
      modo apresentacao, AgendaForm e InviteManagement respeitando o toggle, label de posicao 3
      trocado para 'Ultimo Discurso' (F118). Fix do bug de plain-text HTML na Edge Function
      reset-redirect com charset=utf-8, Cache-Control, e investigacao de causa raiz (F119).
      4 features, 44 ACs, 15 ECs, 20+ arquivos impactados (2 novos + 18+ modificados +
      1 teste novo), 2 migracoes SQL (017, 018), zero dependencias novas. 2 ADRs: ADR-079
      (user_metadata para idioma app), ADR-080 (CHECK constraint pianist/conductor). S01, S02,
      S09 parallelizaveis, S03 depende de S01+S02, S04+S05 dependem de S03, S06 depende de
      S04, S07 depende de S03, S08 depende de S04+S06+S07, S10 depende de todos.

  - id: PLAN_P033
    title: "Batch 19 Phase 2: Clear Buttons, Read-Only Speeches, Label Renames, X Alignment, Push Notifications"
    status: pending
    crs_covered: [179, 182, 183, 187, 189, 192]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P033.yaml"
    summary: >
      6 features cobrindo UI/UX de cards, renames de labels e bug fix de push notifications:
      botoes X de limpeza em todos os campos seletores (actor, hino, oracao, reconhecendo) do
      AgendaForm com SelectorField onClear callback, visivel apenas quando campo tem valor e
      usuario nao e Observer (F120). Substituicao da edicao de override de discursante no
      AgendaForm por display read-only + botao lapis que navega para aba Discursos com
      auto-expand do card via query param expandDate (ADR-082), remocao do SpeakerField e
      estilos associados, posicao 2 oculta quando has_second_speech=false (F121). Rename de
      'Proximas Designacoes' para 'Proximos Discursos' em 3 idiomas (F122). Rename de tab e
      titulo 'Agenda' para 'Agendas' em 3 idiomas (F123). Fix de alinhamento vertical dos
      botoes X no SpeechSlot com reestruturacao de layout two-column para row-per-element
      per ADR-081, garantindo alinhamento por alignItems:'center' na mesma flex row (F124).
      Fix de push notifications com leitura de projectId de Constants.expoConfig ao inves de
      undefined, com guard para Expo Go (F125). 6 features, 39 ACs, 11 ECs, 5 arquivos
      impactados (1 novo teste + 4 modificados), zero migracoes SQL, zero Edge Functions,
      zero dependencias novas. 2 ADRs: ADR-081 (row-per-element SpeechSlot), ADR-082
      (Expo Router query param cross-tab). S01-S04 parallelizaveis, S05 depende de S04,
      S07 depende de todos.

  - id: PLAN_P034
    title: "Batch 20 Phase 1: Navigation & Home Redesign (Pencil/Play Buttons, Preview Card, Non-expandable Cards)"
    status: pending
    crs_covered: [184, 185, 186, 188]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P034.yaml"
    summary: >
      4 features cobrindo navegacao cross-screen e redesign do Home tab: botao lapis (U+270F)
      na tela de Apresentacao para navegar a aba Agenda com expandDate + suporte a expandDate
      query param na aba Agenda seguindo padrao ADR-082 do speeches.tsx (F126), botao play
      (U+25B6) no header do card expandido da aba Agenda para navegar a tela de Apresentacao
      com data param + Apresentacao aceitando data opcional via useLocalSearchParams (F127),
      icone play no botao Iniciar do Home + card preview nao-expansivel abaixo do botao com
      dateBlock e status lines (speakers/prayers/hymns) identicas ao card contraido da Agenda +
      botao lapis no card para navegar a aba Agenda (F128), e simplificacao do NextSundaysSection
      removendo ~130 linhas de codigo de expand/edit (estados, 7 hooks de mutacao, 9 handlers,
      SpeechSlot/Modals) substituindo por cards nao-expansiveis com botao lapis navegando para
      aba Speeches via expandDate + nova prop renderHeaderRight no SundayCard (F129). 4 features,
      35 ACs, 12 ECs, 5 arquivos impactados (1 novo teste + 4 modificados), zero migracoes SQL,
      zero Edge Functions, zero dependencias novas. 2 ADRs: ADR-083 (extend ADR-082 to Agenda
      tab), ADR-084 (inline AgendaPreviewCard). S01, S02, S05 parallelizaveis, S03 depende de
      S02, S04 depende de S02, S06 depende de todos.

  - id: PLAN_P035
    title: "Batch 21 Phase 1: Bug Fixes (TypeScript Errors, Ward Language Switch, 2nd Speech Toggle, Password Reset Email/Redirect)"
    status: pending
    crs_covered: [194, 195, 196, 197, 198]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P035.yaml"
    summary: >
      5 bug fixes (regressions): fix de 16 erros TypeScript em test mocks (SundayAgenda missing
      fields), production code (null->string, undefined Member, BlurEvent type), e setup-integration
      (wardLanguage string) + limpeza de nomes de roles em documentacao can_piano->can_pianist,
      can_music->can_pianist/can_conductor em SPEC_F083, ARCH_M024, PLAN_P024, SPEC_CONSOLIDATED
      (F130). Fix do ward language switch que nao atualizava AuthContext apos mutation: expor
      setWardLanguage no AuthContextValue e chamar no onSuccess do wardLanguageChangeMutation
      (F131). Fix de 4 sub-bugs no toggle de 2o discurso: toggle off agora limpa topic fields
      via update direto no Supabase (sem modificar useRemoveAssignment), SpeechSlot mostra 2
      campos visiveis mas disabled com placeholder i18n ao inves de mensagem unica, AgendaForm
      mostra 2o speaker disabled com placeholder, e cards contraidos mostram X/2 dinamicamente
      quando has_second_speech=false (F132). Fix do email de reset de senha para usar idioma do
      app do usuario (user_metadata.language) com fallback para ward.language e pt-BR (F133).
      Remocao do tag <script> do reset-redirect Edge Function para funcionar em iframes
      sandboxed, mantendo meta refresh e botao <a href> como fallback (F134). 5 features,
      44 ACs, 15 ECs, 15 arquivos impactados (1 novo teste + 14 modificados + 4 docs), zero
      migracoes SQL, zero dependencias novas. 2 ADRs: ADR-085 (separate supabase update for
      topic clear), ADR-086 (user_metadata language priority). S01, S02, S08, S09 parallelizaveis,
      S03 paralleliza com S04/S05/S06, S04+S05+S06 dependem de S01, S07 depende de S04+S05+S06,
      S10 depende de todos.

  - id: PLAN_P037
    title: "Batch 22 Phase 1: Password Reset Web Page, Invitation Acceptance Web Page"
    status: pending
    crs_covered: [202, 203]
    total_steps: 7
    plan_ref: "docs/plans/PLAN_P037.yaml"
    summary: >
      2 features substituindo deep links quebrados por paginas web self-contained: rewrite
      completo da Edge Function reset-redirect para servir pagina HTML com formulario de
      redefinicao de senha usando Supabase JS CDN (verifyOtp + updateUser) com i18n em 3
      idiomas, loading/error/form/success states, validacao client-side (senha >= 6 chars,
      senhas iguais) e onerror handler para CDN failure (F138). Nova Edge Function
      invite-redirect servindo pagina HTML com formulario de aceite de convite, campos
      read-only (estaca, ala, funcao traduzida, email) e editaveis (nome completo, senha,
      confirmar senha), usando fetch para register-invited-user (validate-only no load,
      registration no submit), i18n em 3 idiomas com mensagens de erro especificas por
      codigo (token_invalid, token_used, token_expired), e atualizacao de create-invitation
      para gerar URL HTTPS ao inves de deep link sacrmeetplan:// (F139). 2 features,
      25 ACs, 12 ECs, 3 arquivos impactados (1 novo + 2 modificados + 1 teste), zero
      migracoes SQL, zero dependencias novas. 2 ADRs: ADR-089 (reset page substitui
      deep link), ADR-090 (invite page substitui deep link). S01, S03, S04 parallelizaveis,
      S02+S05 dependem de S01, S06 depende de S03, S07 depende de todos.

  - id: PLAN_P038
    title: "Batch 23 Phase 1: Invite Error Handling, Language Switch Collections/Template, WhatsApp Template Disconnect"
    status: pending
    crs_covered: [205, 206, 207]
    total_steps: 7
    plan_ref: "docs/plans/PLAN_P038.yaml"
    summary: >
      3 bug fixes criticos: fix do invite mutation error handling para mostrar err.message
      do servidor ao inves de texto generico t('users.inviteFailed') + meta suppressGlobalError
      para evitar alerta duplicado do MutationCache (F140). Fix do language switch que quebra
      colecoes (Topics vazio) e template WhatsApp: nova migracao 019_seed_en_es_collections.sql
      com seed data de general_collections e general_topics para idiomas 'en' e 'es', reset de
      whatsapp_template para NULL no wardLanguageChangeMutation com invalidacao de cache
      ['ward', wardId], e reset do flag initialized em whatsapp.tsx via useEffect com ref para
      recarregar template default do novo idioma (F141). Fix do WhatsApp send que ignora
      template customizado: useQuery(['ward', wardId]) no InviteManagementSection para buscar
      whatsapp_template do banco, wardLanguage do useAuth() ao inves de getCurrentLanguage()
      para locale de formatacao e idioma do template (F142). 3 features, 20 ACs, 10 ECs,
      5 arquivos impactados (1 novo + 4 modificados + 1 teste), 1 migracao SQL, zero
      dependencias novas. 3 ADRs: ADR-091 (err.message + suppressGlobalError), ADR-092
      (reset whatsapp_template + initialized flag), ADR-093 (useQuery ward template +
      wardLanguage). S01, S02, S03, S04, S05 parallelizaveis (todos independentes),
      S06 depende de S02, S07 depende de todos.

  - id: PLAN_P039
    title: "Batch 22 Phase 2: Fix Invite Creation Root Cause, External Hosting for HTML Pages"
    status: pending
    crs_covered: [208, 204]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P039.yaml"
    summary: >
      2 bug fixes no pipeline de convites: structured logging com console.error
      prefixado '[create-invitation]' em cada ponto de falha + error codes
      (auth/missing-header, auth/invalid-token, etc.) em todos os JSON de erro +
      modo diagnostico ({ diagnose: true }) que roda validacoes sem inserir no
      DB retornando relatorio de checks pass/fail (F143/CR-208). Migracao de
      paginas HTML inline nas Edge Functions reset-redirect e invite-redirect
      para arquivos estaticos em GitHub Pages (docs/public/): EFs convertidas
      em redirects 302 com EXTERNAL_PAGES_URL env var configuravel, 2 arquivos
      HTML self-contained (reset-password.html, accept-invite.html) extraidos
      dos templates inline com token lido de URLSearchParams ao inves de
      template interpolation, mesma UX/i18n/CSS/logica dos templates originais,
      Content-Type text/html correto servido pelo GitHub Pages (F144/CR-204).
      2 features, 20 ACs, 11 ECs, 5 arquivos impactados (2 novos + 3 modificados
      + 3 testes), zero migracoes de banco, zero dependencias novas. 2 ADRs:
      ADR-094 (structured error codes + diagnostic mode), ADR-095 (external
      hosting via GitHub Pages). S01, S02, S03 parallelizaveis (independentes),
      S04 e S05 parallelizaveis entre si (independentes), S06 depende de
      S01+S02+S03.

  - id: PLAN_P040
    title: "Batch 23 Phase 1: Replace All Unicode/Emoji Icons with Inline SVG, Play Icon Placement"
    status: pending
    crs_covered: [209, 210]
    total_steps: 7
    plan_ref: "docs/plans/PLAN_P040.yaml"
    summary: >
      2 features cobrindo consistencia visual cross-platform de icones: criacao de modulo
      centralizado src/components/icons/index.ts com 14 componentes SVG inline (13
      stroke-based Lucide + 1 fill-based WhatsApp) compartilhando interface { size?, color? },
      migracao de todos os 16 arquivos consumidores de Unicode/emoji para importar do modulo,
      consolidacao do WhatsAppIcon duplicado em InviteManagementSection/InviteActionDropdown,
      atualizacao de DD-25 para refletir padrao SVG inline, verificacao de zero caracteres
      Unicode restantes em codigo de producao (F145/CR-209). Ajuste de posicionamento do
      PlayIcon: Home tab com size=20 color=onPrimary dentro do meetingButtonContent (sem
      mudanca de layout), Agenda tab com marginRight:8 separando do chevron e
      color=textSecondary para aparencia sober em ambos os temas (F146/CR-210). 2 features,
      24 ACs, 7 ECs, 17 arquivos impactados (1 novo + 16 modificados + 1 teste), zero
      migracoes SQL, zero dependencias novas. 2 ADRs: ADR-096 (modulo centralizado SVG
      icons), ADR-097 (play icon placement Home/Agenda). S01 primeiro (cria modulo),
      S02+S03+S04 parallelizaveis (todos dependem de S01), S05 depende de S02+S03+S04,
      S06 depende de S04, S07 depende de todos.

  - id: PLAN_P042
    title: "Batch 24 Phase 1: WhatsApp No-Phone Dialog, Play Button Circle, Uniform Card Height"
    status: pending
    crs_covered: [216, 217, 219]
    total_steps: 5
    plan_ref: "docs/plans/PLAN_P042.yaml"
    summary: >
      3 UX/UI refinements independentes: dialogo Alert.alert quando botao WhatsApp pressionado
      e discursante nao tem telefone cadastrado, oferecendo marcar como convidado ou cancelar,
      com 3 novas keys i18n (invite.noPhoneTitle, invite.noPhoneMessage, invite.markAsInvited)
      em 3 idiomas e restructuring de handleNotInvitedAction para evitar mudanca silenciosa de
      status (F152/CR-216). Circulo delineado (borderWidth:1.5, borderRadius:15) ao redor do
      PlayIcon na aba Agenda com container 30x30, borderColor:colors.textSecondary, e aumento
      de marginRight de 8 para 16 para maior separacao do chevron (F153/CR-217). Altura uniforme
      de cards contraidos para TODOS os tipos (nao apenas speech-type) removendo condicao
      isSpeechesType do minHeight:62 no headerCenter do SundayCard, supersedendo F151/CR-215
      (F154/CR-219). 3 features, 22 ACs, 9 ECs, 6 arquivos impactados (0 novos + 6 modificados
      + 1 teste), zero migracoes SQL, zero dependencias novas. 1 ADR: ADR-099 (Alert.alert
      pattern reuse, circle border, F151 supersession). S01, S03, S04 parallelizaveis
      (independentes), S02 depende de S01, S05 depende de todos.

  - id: PLAN_P043
    title: "Batch 24 Phase 2: Light Theme Bluish Contrast, Speaker Fields Rework"
    status: pending
    crs_covered: [218, 220]
    total_steps: 5
    plan_ref: "docs/plans/PLAN_P043.yaml"
    summary: >
      2 visual improvements: shift light theme neutral palette from pure grays to Tailwind
      Slate blue-gray tones (Slate-50 through Slate-500) with background #FFFFFF -> #F1F5F9
      creating card-vs-background contrast, 10 lightColors values updated keeping card white,
      text colors and primary/status unchanged, zero component files modified thanks to
      semantic token architecture (F155/CR-218). Rework ReadOnlySpeakerRow text styling in
      AgendaForm with fontStyle:'italic' + color:colors.textSecondary for speaker names,
      keep textTertiary for empty placeholders, change 2nd speech disabled speakerName from
      '' to t('speeches.secondSpeechDisabledPlaceholder'), update i18n wording from
      'configurado'/'configured' to 'ajustado'/'adjusted' in 3 locales, F149 disabled visual
      preserved, SpeechSlot.tsx NOT modified (F156/CR-220). 2 features, 23 ACs, 7 ECs,
      5 arquivos impactados (0 novos + 5 modificados + 1 teste), zero migracoes SQL, zero
      dependencias novas. 2 ADRs: ADR-100 (Slate palette for light theme), ADR-101
      (italic+textSecondary for speaker names). S01, S02 parallelizaveis (independentes),
      S03 depende de S01, S04 depende de S02+S03, S05 depende de todos.

  - id: PLAN_P044
    title: "Batch 25: Managed Prayers (Oracoes Gerenciadas)"
    status: pending
    crs_covered: [221]
    total_steps: 22
    plan_ref: "docs/plans/PLAN_P044.yaml"
    summary: >
      Feature cross-cutting completa: migrar dados de oracao de sunday_agendas para speeches
      tabela (posicoes 0/4), toggle per-ward manage_prayers na wards table, auto-criacao
      de posicoes de oracao para tipos elegiveis (speeches/testimony/primary), slots de
      oracao no tab Speeches via SpeechSlot isPrayer prop (sem campo de tema, labels de
      oracao), AgendaForm condicional (PrayerSelector editavel quando OFF, read-only +
      pencil navega ao Speeches quando ON), linhas de oracao em cards contraidos (italico
      + prefixo '(Oracao)'), titulos dinamicos de tab e secao Home, segmented control 3-tabs
      no WhatsApp settings com templates separados para abertura/encerramento (apenas
      {nome}/{data}), regras de preservacao/delecao de oracoes em mudanca de tipo de
      domingo, trigger de notificacao com check manage_prayers para pos 0/4, gestao de
      convites com posicoes de oracao, modo apresentacao lendo de speeches, permissoes
      seguindo padroes de discursos, i18n ~15 novas keys em 3 idiomas (F157/CR-221).
      1 feature, 64 ACs, 13 ECs, 17 arquivos impactados (1 novo + 16 modificados + 1
      teste), 1 migracao SQL, zero dependencias novas. 7 ADRs: ADR-102 (oracoes como
      speeches pos 0/4), ADR-103 (toggle per-ward), ADR-104 (templates separados),
      ADR-105 (useLazyCreate com sundayType), ADR-106 (trigger check manage_prayers),
      ADR-107 (SpeechSlot isPrayer), ADR-108 (deleteSpeeches com positions filter).
      S01+S02 parallelizaveis, S03 depende S01, S04+S05+S06 parallelizaveis apos S03,
      S07 depende S04, S08+S16 parallelizaveis apos S02, S09 depende S04+S05+S08,
      S10 depende S04+S09, S11 depende S04+S05, S12 depende S03, S13+S15 dependem S04,
      S14 depende S04+S13, S17 depende S04+S16, S18 depende S06+S10, S19 depende S03,
      S20 depende S09+S11+S13, S21 depende varios, S22 depende todos.

  - id: PLAN_P047
    title: "Batch 26: UI Adjustments for Managed Prayers (CRs 222-230)"
    status: pending
    crs_covered: [222, 223, 224, 225, 226, 227, 228, 229, 230]
    total_steps: 10
    plan_ref: "docs/plans/PLAN_P047.yaml"
    summary: >
      9 UI adjustment CRs refining managed prayers (F157/CR-221): fix double-label
      bug in AgendaForm prayer fields by inline rendering content instead of
      ReadOnlySpeakerRow (F158/CR-230), add StatusLED circles to prayer lines in
      collapsed SundayCard for speeches/testimony/primary types (F158/CR-222),
      conditionally hide prayer prefix label when no speaker_name assigned showing
      only StatusLED + empty space (F158/CR-223), add marginTop:6 spacing gap
      between exception text and prayer lines in testimony/primary collapsed cards
      (F158/CR-227), reduce speechRow marginBottom from 4 to 1 for tighter collapsed
      layout (F158/CR-228), replace static minHeight:62 with dynamic calculation
      based on managePrayers state (5 lines when ON, 3 when OFF) per ADR-110
      (F158/CR-229), pass managePrayers prop to NextSundaysSection SundayCard via
      useWardManagePrayers hook (F158/CR-225), rename toggle label + reorder to 2nd
      position + add description text in Settings (F158/CR-224), and allow Speeches
      & Prayers tab label to wrap to 2 lines via custom tabBarLabel with
      numberOfLines={2} per ADR-111 (F158/CR-226). 1 feature (F158), 29 ACs, 7 ECs,
      8 arquivos impactados (0 novos + 8 modificados + 1 teste), zero migracoes SQL,
      zero dependencias novas. 3 ADRs: ADR-109 (inline prayer content in AgendaForm),
      ADR-110 (dynamic minHeight replaces 62px), ADR-111 (custom tabBarLabel
      numberOfLines). STEP-01/02/05/07/08/09 parallelizaveis (todos independentes),
      STEP-03/04 dependem de STEP-02, STEP-06 depende de STEP-05, STEP-10 depende
      de todos.

  - id: PLAN_P045
    title: "Batch 25 Phase 2: Managed Prayers - Speeches tab + Invite Management + WhatsApp templates"
    status: pending
    crs_covered: [221]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P045.yaml"
    summary: >
      Phase 2 de managed prayers (CR-221): SpeechSlot isPrayer prop para ocultar campo
      de tema e usar labels de oracao (posicoes 0/4), renderizacao de prayer SpeechSlots
      no tab Speeches (posicao 0 antes dos discursos, posicao 4 depois), linhas de oracao
      nos cards contraidos do SundayCard (italico + prefixo '(Oracao)' quando managePrayers=true),
      logica de preservacao/delecao de oracoes em mudanca de tipo de domingo (preserve entre
      speeches/testimony/primary, delete ao mudar para conference/other), InviteManagementSection
      incluindo posicoes 0/4 quando managePrayers=true com labels de oracao e selecao de template
      WhatsApp por posicao, 6 templates padrao de oracao em whatsappUtils.ts (abertura/encerramento
      x 3 idiomas, apenas {nome}/{data}), e segmented control 3-tabs no WhatsApp settings
      (Discurso/Abertura/Encerramento) com editors independentes por tab (F157/CR-221 Phase 2).
      20 ACs cobertos (AC-157-14/17/18/23/26/27/28/29/30/31/32/33/34/35/36/52/53/54/55/56),
      3 ECs cobertos (EC-157-04/11/12), 6 arquivos impactados (0 novos + 6 modificados),
      zero migracoes SQL, zero dependencias novas. Steps: STEP-08 (SpeechSlot isPrayer) +
      STEP-16 (WhatsApp templates) parallelizaveis, STEP-09 depende STEP-08, STEP-10 + STEP-14
      parallelizaveis apos STEP-09/STEP-08, STEP-17 depende STEP-16.

  - id: PLAN_P046
    title: "Batch 25 Phase 3: Managed Prayers - Agenda tab + Home tab + Tab layout + Presentation mode + Permissions + Regression + Tests"
    status: pending
    crs_covered: [221]
    total_steps: 8
    plan_ref: "docs/plans/PLAN_P046.yaml"
    summary: >
      Phase 3 de managed prayers (CR-221): mudanca de data source do AgendaForm para ler oracoes
      de speeches posicoes 0/4 ao inves de sunday_agendas com edicao condicional (PrayerSelector
      editavel quando OFF, campo read-only + icone lapis navegando para Speeches tab quando ON),
      atualizacao do card contraido de agenda para contar oracoes de speeches ('Oracoes Y/2'),
      titulo dinamico da secao de proximas designacoes no Home tab (Proximos Discursos e Oracoes
      quando ON, Proximos Discursos quando OFF), contagem de oracoes no preview card do Home de
      speeches, label dinamico da tab Speeches/_layout.tsx (Discursos e Oracoes quando ON),
      atualizacao do usePresentationMode para ler oracoes de speeches posicoes 0/4, verificacao
      de permissoes de oracao (Bispado designa, Secretario via Agenda quando OFF, Observador
      read-only), validacao de regressao (wards existentes nao afetadas, ciclo toggle ON/OFF
      restaura comportamento original), e testes abrangentes cobrindo todos os 64 ACs e 13 ECs
      de F157 (F157/CR-221 Phase 3).
      20 ACs cobertos (AC-157-13/15/16/22/24/25/37/38/39/40/41/42/43/44/45/59/60/62/63/64),
      10 ECs cobertos (EC-157-02/03/05/06/07/08/09/10/11/13), 8 arquivos impactados (0 novos +
      7 modificados + 1 teste), zero migracoes SQL, zero dependencias novas. Steps: STEP-11 +
      STEP-12 + STEP-13 + STEP-15 + STEP-19 parallelizaveis (todos independentes), STEP-20
      depende STEP-11 + STEP-13, STEP-21 depende STEP-11/12/13/15/20, STEP-22 depende todos.

# =============================================================================
# CRs pendentes sem plano
# =============================================================================

pending_without_plan: []

# =============================================================================
# CRs pendentes com plano (nao implementados ainda)
# =============================================================================

pending_with_plan:
  - cr_id: 76
    plan_id: PLAN_CR76
    description: "Edge Function erro na tela de Usuarios (regressao CR-64) - HTTP 401"
  - cr_id: 79
    plan_id: PLAN_CR79
    description: "Tela de Usuarios sem botao de voltar"
  - cr_id: 80
    plan_id: PLAN_CR80
    description: "Textos explicativos na tela de Membros (i18n pt/en/es)"
  - cr_id: 81
    plan_id: PLAN_CR81
    description: "Campo Nome para usuario (auto-ator, logs, tela usuarios)"
  - cr_id: 83
    plan_id: PLAN_P011
    description: "Save/Cancel buttons para MemberEditor e TopicEditor"
  - cr_id: 84
    plan_id: PLAN_P011
    description: "Botao X para limpar campos de search (SearchInput reutilizavel)"
  - cr_id: 85
    plan_id: PLAN_P011
    description: "Lista completa de codigos internacionais de telefone"
  - cr_id: 86
    plan_id: PLAN_P011
    description: "Dialogo de confirmacao antes de importar CSV"
  - cr_id: 90
    plan_id: PLAN_P011
    description: "Fix do botao Delete no SwipeableCard"
  - cr_id: 87
    plan_id: PLAN_P012
    description: "Substituir texto Edit/Delete nos botoes de swipe por icones lapis/lixeira"
  - cr_id: 88
    plan_id: PLAN_P012
    description: "Texto explicativo na tela de Temas sobre ativar/desativar colecoes"
  - cr_id: 89
    plan_id: PLAN_P012
    description: "Visao de temas de colecao (expand/collapse read-only list)"
  - cr_id: 91
    plan_id: PLAN_P013
    description: "Fix RLS policy error on notification_queue (SECURITY DEFINER)"
  - cr_id: 92
    plan_id: PLAN_P013
    description: "Fix duplicate key error in country dropdown (keyExtractor item.label)"
  - cr_id: 93
    plan_id: PLAN_P013
    description: "Change deep link protocol de wardmanager:// para sacrmeetman://"
  - cr_id: 95
    plan_id: PLAN_P013
    description: "Fix speech fields not hiding when changing sunday type"
  - cr_id: 98
    plan_id: PLAN_P013
    description: "Fix prayer fields not clickable (PrayerSelector visible/onClose)"
  - cr_id: 94
    plan_id: PLAN_P014
    description: "Templates WhatsApp i18n (padrao por idioma da ala)"
  - cr_id: 96
    plan_id: PLAN_P014
    description: "Search fixo no topo em members.tsx e topics.tsx"
  - cr_id: 97
    plan_id: PLAN_P014
    description: "Multi-select no campo Reconhecendo a Presenca"
  - cr_id: 99
    plan_id: PLAN_P014
    description: "Labels de discurso Orador->Discurso"
  - cr_id: 100
    plan_id: PLAN_P014
    description: "Campo read-only de discursante com troca de ultima hora"
  - cr_id: 105
    plan_id: PLAN_P016
    description: "Substituir botoes texto por icones (WhatsApp + tres pontinhos)"
  - cr_id: 106
    plan_id: PLAN_P016
    description: "Substituir Alert por dropdown customizado para acoes de convite"
  - cr_id: 107
    plan_id: PLAN_P016
    description: "Mostrar posicao + LED + status na segunda linha do invite row"
  - cr_id: 110
    plan_id: PLAN_P016
    description: "Mostrar secao de convites para o bispado"
  - cr_id: 111
    plan_id: PLAN_P016
    description: "Aumentar espaco entre LED e X e tamanho do X no SpeechSlot"
  - cr_id: 112
    plan_id: PLAN_P017
    description: "Ver Conversa no WhatsApp sem reenviar convite"
  - cr_id: 113
    plan_id: PLAN_P017
    description: "Titulo do InviteActionDropdown como 'Alterar status' (i18n)"
  - cr_id: 117
    plan_id: PLAN_P017
    description: "Fix +1 country code mostrando Canada ao inves de USA"
  - cr_id: 122
    plan_id: PLAN_P017
    description: "Trocar label '3o Discurso' para 'Ultimo Discurso' (i18n)"
  - cr_id: 125
    plan_id: PLAN_P017
    description: "Fix duplicacao visual do campo de oracao de encerramento"
  - cr_id: 114
    plan_id: PLAN_P018
    description: "Botao X para remover tema atribuido no SpeechSlot"
  - cr_id: 115
    plan_id: PLAN_P018
    description: "Confirmacao ao mudar tipo de domingo com atribuicoes existentes"
  - cr_id: 116
    plan_id: PLAN_P018
    description: "LED click mostra apenas confirmado/desistiu para assigned_invited"
  - cr_id: 119
    plan_id: PLAN_P018
    description: "Redesign layout SpeechSlot [LED][Field][X] com alinhamento de tema"
  - cr_id: 121
    plan_id: PLAN_P018
    description: "Label (Designacao de ultima hora) na agenda com override ativo"
  - cr_id: 118
    plan_id: PLAN_P019
    description: "SearchInput flex:1 defensivo + botao close nas telas de Settings"
  - cr_id: 120
    plan_id: PLAN_P019
    description: "Auto-scroll para mostrar card expandido nas abas Discursos e Agenda"
  - cr_id: 123
    plan_id: PLAN_P019
    description: "Campo Reconhecendo proporcional com um ator por linha"
  - cr_id: 124
    plan_id: PLAN_P019
    description: "Nomes customizados em campos de oracao (ja implementado)"
  - cr_id: 126
    plan_id: PLAN_P020
    description: "LED redesign - circulo flat sem 3D, novo esquema de cores"
  - cr_id: 127
    plan_id: PLAN_P020
    description: "Apagar speeches ao mudar tipo de domingo de 'speeches' para outro"
  - cr_id: 129
    plan_id: PLAN_P020
    description: "LED click mostra todas opcoes exceto not_assigned"
  - cr_id: 130
    plan_id: PLAN_P020
    description: "Fix bandeira de pais para codigos compartilhados (+1 US/Canada)"
  - cr_id: 128
    plan_id: PLAN_P021
    description: "Botao X do tema posicionado fora do campo dropdown"
  - cr_id: 131
    plan_id: PLAN_P021
    description: "Campo de busca de hinos com largura consistente com outros seletores"
  - cr_id: 132
    plan_id: PLAN_P021
    description: "Fix auto-scroll impreciso ao expandir cards (remover getItemLayout)"
  - cr_id: 133
    plan_id: PLAN_P021
    description: "Discoverability e re-edicao de nomes customizados nas oracoes"
  - cr_id: 134
    plan_id: PLAN_P022
    description: "Mostrar todas opcoes de status exceto atual e not_assigned"
  - cr_id: 135
    plan_id: PLAN_P022
    description: "Trocar texto de ajuda de nome customizado no PrayerSelector"
  - cr_id: 136
    plan_id: PLAN_P022
    description: "Fix scroll inicial da aba Agenda (proximo domingo centralizado)"
  - cr_id: 137
    plan_id: PLAN_P022
    description: "Checkbox visual no ActorSelector multi-select (Reconhecendo a Presenca)"
  - cr_id: 138
    plan_id: PLAN_P022
    description: "Texto de confirmacao de exclusao de ator especifico ao contexto"
  - cr_id: 139
    plan_id: PLAN_P023
    description: "Testes de integracao para hooks, providers e componentes"
  - cr_id: 140
    plan_id: PLAN_P024
    description: "Rename Settings tab labels com i18n (Discursantes, Biblioteca de Temas, etc.)"
  - cr_id: 141
    plan_id: PLAN_P024
    description: "Sunday type selector como primeiro campo no card da aba Agenda"
  - cr_id: 142
    plan_id: PLAN_P024
    description: "Activity log overhaul com formato estruturado e i18n rendering"
  - cr_id: 143
    plan_id: PLAN_P024
    description: "Investigacao pg_timezone_names (externo ao app, sem mudanca de codigo)"
  - cr_id: 144
    plan_id: PLAN_P024
    description: "Fix search_path mutavel em 7 funcoes SQL (migracao 015)"
  - cr_id: 145
    plan_id: PLAN_P025
    description: "Customizar email de reset de senha com deep link e redirect URL"
  - cr_id: 146
    plan_id: PLAN_P025
    description: "Degradacao graciosa offline com TanStack Query onlineManager"
  - cr_id: 147
    plan_id: PLAN_P025
    description: "Offline banner legivel no iPhone (safe area insets + fontSize)"
  - cr_id: 148
    plan_id: PLAN_P025
    description: "Mensagem especifica de confirmacao ao mudar tipo de domingo"
  - cr_id: 149
    plan_id: PLAN_P025
    description: "Botao Iniciar Reuniao sempre visivel (remover condicional)"
  - cr_id: 150
    plan_id: PLAN_P026
    description: "Cards contraidos com nomes de discursantes e LEDs verticais"
  - cr_id: 151
    plan_id: PLAN_P026
    description: "Campos Pianista e Regente na secao Boas-Vindas da Agenda"
  - cr_id: 152
    plan_id: PLAN_P026
    description: "Toggle Hino Intermediario com persistencia no DB"
  - cr_id: 153
    plan_id: PLAN_P026
    description: "Linhas de status no card de agenda contraido"
  - cr_id: 156
    plan_id: PLAN_P027
    description: "Setas direcionais no modo apresentacao (acima=baixo, abaixo=cima, expandido=sem)"
  - cr_id: 157
    plan_id: PLAN_P027
    description: "Nomes reconhecidos um por linha no modo apresentacao (join newline)"
  - cr_id: 158
    plan_id: PLAN_P027
    description: "Toggle de tamanho de fonte no modo apresentacao (normal/grande)"
  - cr_id: 159
    plan_id: PLAN_P027
    description: "Titulos de secao do modo apresentacao iguais a aba Agenda"
  - cr_id: 160
    plan_id: PLAN_P027
    description: "Label '3o Discurso' ao inves de 'Ultimo Discurso' no tab Discursos"
  - cr_id: 161
    plan_id: PLAN_P027
    description: "Redesign do card contraido com LEDs inline antes do label"
  - cr_id: 162
    plan_id: PLAN_P027
    description: "StatusLED movido para linha do label com texto de status no card expandido"
  - cr_id: 163
    plan_id: PLAN_P027
    description: "Placeholder 'Selecionar Discursante' em 3 idiomas"
  - cr_id: 155
    plan_id: PLAN_P028
    description: "Email multilingual de reset de senha via Edge Function send-reset-email"
  - cr_id: 164
    plan_id: PLAN_P028
    description: "Fix test suite 100% passing (bundleIdentifier + Edge Function flow tests)"
  - cr_id: 165
    plan_id: PLAN_P029
    description: "Alinhar circulo de status com X de remover no SpeechSlot expandido"
  - cr_id: 166
    plan_id: PLAN_P029
    description: "Trocar titulo da tela de apresentacao e travar tamanho de fonte"
  - cr_id: 167
    plan_id: PLAN_P029
    description: "Corrigir acentos em secoes da agenda em pt-BR e es"
  - cr_id: 168
    plan_id: PLAN_P029
    description: "Aumentar area clicavel do botao Voltar em 8 telas de Settings"
  - cr_id: 169
    plan_id: PLAN_P029
    description: "Igualar tamanho de circulos de status nos cards fechados"
  - cr_id: 170
    plan_id: PLAN_P029
    description: "Remover sufixo redundante do label do ultimo discurso no modo apresentacao"
  - cr_id: 171
    plan_id: PLAN_P029
    description: "Linhas de status nos cards contraidos de reuniao de testemunho e primaria"
  - cr_id: 172
    plan_id: PLAN_P030
    description: "Campo de Apoios e Agradecimentos da Estaca no modo apresentacao quando toggle ligado"
  - cr_id: 173
    plan_id: PLAN_P030
    description: "Fix label ultimo discurso no AgendaForm de 'Ultimo Discurso - Discurso' para 'Ultimo Discurso'"
  - cr_id: 174
    plan_id: PLAN_P030
    description: "Reestruturar SpeechSlot com coluna direita fixa para alinhamento centro-a-centro LED/X"
  - cr_id: 175
    plan_id: PLAN_P031
    description: "Mudar scheme de deep link de sacrmeetman:// para sacrmeetplan:// em 3 locais"
  - cr_id: 176
    plan_id: PLAN_P031
    description: "Nova Edge Function reset-redirect HTTPS para tornar botao de reset clicavel em emails"
  - cr_id: 177
    plan_id: PLAN_P031
    description: "Alinhar borda direita do circulo de status com borda direita do campo de nome"
  - cr_id: 178
    plan_id: PLAN_P032
    description: "Separar controle de idioma: idioma do app (per-user) vs idioma da ala (ward-wide)"
  - cr_id: 180
    plan_id: PLAN_P032
    description: "Split tipo de ator Musica em Pianista e Regente com CHECK constraint exclusividade mutua"
  - cr_id: 181
    plan_id: PLAN_P032
    description: "Toggle opcional de 2o discurso por domingo com has_second_speech column"
  - cr_id: 191
    plan_id: PLAN_P032
    description: "Fix Edge Function reset-redirect mostrando HTML como plain-text no Safari"
  - cr_id: 179
    plan_id: PLAN_P033
    description: "Botao X para limpar campos seletores (actor, hino, oracao) no card de Agenda"
  - cr_id: 182
    plan_id: PLAN_P033
    description: "Remover edicao de discursos do card de Agenda, navegar para aba Discursos com lapis"
  - cr_id: 183
    plan_id: PLAN_P033
    description: "Rename 'Proximas Designacoes' para 'Proximos Discursos' em 3 idiomas"
  - cr_id: 187
    plan_id: PLAN_P033
    description: "Rename tab e titulo 'Agenda' para 'Agendas' em 3 idiomas"
  - cr_id: 189
    plan_id: PLAN_P033
    description: "Fix alinhamento dos botoes X no card de Discursos (SpeechSlot row-per-element)"
  - cr_id: 192
    plan_id: PLAN_P033
    description: "Fix push notifications com projectId de Constants ao inves de undefined"
  - cr_id: 184
    plan_id: PLAN_P034
    description: "Botao lapis na tela de Apresentacao para navegar a aba Agenda com card expandido"
  - cr_id: 185
    plan_id: PLAN_P034
    description: "Botao play no card expandido da Agenda para navegar a tela de Apresentacao com data"
  - cr_id: 186
    plan_id: PLAN_P034
    description: "Home redesign: play icon no Iniciar, preview card com status, lapis para Agenda"
  - cr_id: 188
    plan_id: PLAN_P034
    description: "NextSundaysSection nao-expansivel com lapis navegando para aba Speeches"
  - cr_id: 194
    plan_id: PLAN_P035
    description: "Fix TS errors e naming consistency de actor roles apos Pianist/Conductor split (can_piano->can_pianist, can_music cleanup)"
  - cr_id: 195
    plan_id: PLAN_P035
    description: "Fix ward language switch nao atualizando AuthContext state apos mutation"
  - cr_id: 196
    plan_id: PLAN_P035
    description: "Fix 4 sub-bugs no toggle de 2o discurso: topic clear, disabled fields, dynamic count X/2 vs X/3"
  - cr_id: 197
    plan_id: PLAN_P035
    description: "Fix email de reset de senha para usar idioma do app do usuario (user_metadata.language)"
  - cr_id: 198
    plan_id: PLAN_P035
    description: "Remover <script> tag do reset-redirect Edge Function para funcionar em iframes sandboxed"
  - cr_id: 193
    plan_id: PLAN_P036
    description: "Reorganizar aba Settings em 2 grupos rotulados (Configuracoes da Ala e Configuracoes do App)"
  - cr_id: 199
    plan_id: PLAN_P036
    description: "Alinhar borda direita do StatusLED com borda direita do campo de discursante (paddingRight:36)"
  - cr_id: 200
    plan_id: PLAN_P036
    description: "Aumentar fontSize do icone play no Home (17->20) e Agenda (14->18) com marginRight ajustado"
  - cr_id: 202
    plan_id: PLAN_P037
    description: "Rewrite reset-redirect Edge Function para servir pagina web completa de redefinicao de senha"
  - cr_id: 203
    plan_id: PLAN_P037
    description: "Nova Edge Function invite-redirect com pagina web de aceite de convite + create-invitation com URL HTTPS"
  - cr_id: 205
    plan_id: PLAN_P038
    description: "Fix invite mutation error handling: mostrar err.message do servidor + suppressGlobalError"
  - cr_id: 206
    plan_id: PLAN_P038
    description: "Fix language switch: seed en/es collections + reset whatsapp_template + reset initialized flag"
  - cr_id: 207
    plan_id: PLAN_P038
    description: "Fix WhatsApp send: useQuery ward template + wardLanguage ao inves de app language"
  - cr_id: 208
    plan_id: PLAN_P039
    description: "Fix create-invitation: structured logging, error codes, e diagnostic mode"
  - cr_id: 204
    plan_id: PLAN_P039
    description: "External hosting para HTML pages (GitHub Pages) bypass Supabase Content-Type override"
  - cr_id: 209
    plan_id: PLAN_P040
    description: "Replace all Unicode/emoji icons with inline SVG components for cross-platform consistency"
  - cr_id: 210
    plan_id: PLAN_P040
    description: "Play icon placement adjustments in Home tab button and Agenda tab card header"
  - cr_id: 211
    plan_id: PLAN_P041
    description: "Blue border (colors.primary, borderWidth: 2) on Home tab collapsed agenda preview card"
  - cr_id: 212
    plan_id: PLAN_P041
    description: "i18n text swap: wardBusiness Agradecimentos->Desobrigacoes/Relevos, stakeAnnouncements adds Anuncios"
  - cr_id: 213
    plan_id: PLAN_P041
    description: "Disabled visual style (opacity 0.5, surfaceVariant bg) on ReadOnlySpeakerRow in AgendaForm"
  - cr_id: 214
    plan_id: PLAN_P041
    description: "Standard placeholders (selectSpeaker/selectTopic) when 2nd speech disabled instead of explanation text"
  - cr_id: 215
    plan_id: PLAN_P041
    description: "Collapsed speech cards uniform height via minHeight: 62 on headerCenter when !expanded && isSpeechesType"
  - cr_id: 216
    plan_id: PLAN_P042
    description: "WhatsApp no-phone dialog: Alert.alert quando speaker sem telefone com opcao marcar como convidado"
  - cr_id: 217
    plan_id: PLAN_P042
    description: "Play button circle outline (borderRadius:15, borderWidth:1.5) e aumento de spacing do chevron"
  - cr_id: 219
    plan_id: PLAN_P042
    description: "Uniform collapsed card height para TODOS os tipos (supersede F151 removendo isSpeechesType)"
  - cr_id: 218
    plan_id: PLAN_P043
    description: "Light theme bluish contrast: shift neutral palette from pure grays to Tailwind Slate blue-gray tones"
  - cr_id: 220
    plan_id: PLAN_P043
    description: "Speaker fields rework: italic + textSecondary em ReadOnlySpeakerRow, placeholder 'ajustado' para 2nd speech disabled"
  - cr_id: 222
    plan_id: PLAN_P047
    description: "Add StatusLED circles to prayer lines in collapsed SundayCard"
  - cr_id: 223
    plan_id: PLAN_P047
    description: "Hide prayer label when no speaker name assigned (show only StatusLED + empty space)"
  - cr_id: 224
    plan_id: PLAN_P047
    description: "Rename manage_prayers toggle, reorder to 2nd position, add description text"
  - cr_id: 225
    plan_id: PLAN_P047
    description: "Pass managePrayers prop to NextSundaysSection SundayCard via useWardManagePrayers"
  - cr_id: 226
    plan_id: PLAN_P047
    description: "Allow Speeches & Prayers tab label to wrap to 2 lines (numberOfLines={2})"
  - cr_id: 227
    plan_id: PLAN_P047
    description: "Add marginTop spacing gap between exception text and prayer lines in testimony/primary"
  - cr_id: 228
    plan_id: PLAN_P047
    description: "Reduce speechRow marginBottom from 4 to 1 for tighter collapsed card layout"
  - cr_id: 229
    plan_id: PLAN_P047
    description: "Dynamic minHeight for uniform collapsed card height (replaces static 62px)"
  - cr_id: 230
    plan_id: PLAN_P047
    description: "Fix double-label bug in AgendaForm prayer fields (inline rendering instead of ReadOnlySpeakerRow)"
  - cr_id: 231
    plan_id: PLAN_P048
    description: "Split speech WhatsApp template into 3 individual templates (whatsapp_template_speech_1/2/3), remove {posicao} placeholder"

# =============================================================================
# Convencoes de implementacao
# =============================================================================

conventions:
  commits: "Conventional Commits (feat:, fix:, chore:, test:, docs:)"
  testing: "Vitest + React Testing Library, testes junto com codigo"
  branching: "master para desenvolvimento, main para releases"
  code_style: "TypeScript strict, ESLint, Prettier"
  plan_structure: "1 commit por step, steps com done_when, covers, risks"
  snapshot_pattern: "ADR-003: dados de oradores e temas copiados como snapshot"
  offline_strategy: "ADR-008: last-write-wins com fila de mutacoes"
  error_handling: "ADR-022: extracao de erro via error.context.json()"
  auth_pattern: "ADR-023: SDK gerencia auth automaticamente, sem header manual"

# =============================================================================
# Changelog
# =============================================================================

changelog:
  - version: 37
    phase: "batch-27-split-speech-whatsapp-template"
    changes:
      - "Added PLAN_P048 for Batch 27 (F159, CR-231)"
      - "1 refactor CR: split single speech WhatsApp template into 3 per-position templates"
      - "10 steps, 21 ACs, 11 arquivos impactados (1 novo + 10 modificados + 1 teste)"
      - "1 migracao SQL (020_split_speech_template.sql), zero dependencias novas"
      - "2 ADRs: ADR-112 (per-position speech template columns), ADR-113 (segmented control always visible 3-5 tabs)"
      - "Migration 020 adds 3 columns (whatsapp_template_speech_1/2/3), copies existing data, drops old whatsapp_template"
      - "9 new default template constants (3 positions x 3 languages) with embedded ordinals (primeiro/first/primer, etc.)"
      - "getDefaultTemplate replaced by getDefaultSpeechTemplate(language, position)"
      - "WhatsAppVariables.position removed, resolveTemplate no longer replaces {posicao}"
      - "buildWhatsAppUrl gains position parameter for getDefaultSpeechTemplate fallback"
      - "InviteManagementSection maps speech.position to correct template column"
      - "Settings WhatsApp screen: 5-tab segmented control (1o Disc.|2o Disc.|3o Disc.|Abertura|Encerramento)"
      - "Segmented control always visible (3 tabs when managePrayers=false, 5 when true)"
      - "{posicao} removed from PLACEHOLDER_I18N_KEYS, PLACEHOLDER_TOKENS, and SAMPLE_DATA"
      - "Language change resets all 3 speech template columns to NULL"
      - "Edge function creates ward with 3 language-appropriate speech templates"
      - "i18n: remove placeholderPosition + tabSpeech, add tabSpeech1/2/3 in all 3 locales"
      - "STEP-01/09 parallelizaveis, STEP-02 depende STEP-01, STEP-03 depende STEP-02, STEP-04 depende STEP-03, STEP-05/06/07/08 parallelizaveis entre si, STEP-10 depende de todos"
  - version: 36
    phase: "batch-26-ui-adjustments-managed-prayers"
    changes:
      - "Added PLAN_P047 for Batch 26 (F158, CRs 222/223/224/225/226/227/228/229/230)"
      - "9 UI adjustment CRs refining managed prayers feature (F157/CR-221)"
      - "10 steps, 29 ACs, 7 ECs, 8 arquivos impactados (0 novos + 8 modificados + 1 teste)"
      - "Zero migracoes SQL, zero dependencias novas"
      - "3 ADRs: ADR-109 (inline prayer content in AgendaForm), ADR-110 (dynamic minHeight replaces 62px), ADR-111 (custom tabBarLabel numberOfLines)"
      - "CR-230 fixes double-label bug in AgendaForm prayer fields by inline rendering (not modifying ReadOnlySpeakerRow)"
      - "CR-222 adds StatusLED circles to prayer lines in collapsed SundayCard (speeches, testimony, primary)"
      - "CR-223 hides prayer prefix label when no speaker_name assigned (shows only StatusLED + empty space)"
      - "CR-227 adds marginTop:6 spacing gap between exception text and prayer lines in testimony/primary cards"
      - "CR-228 reduces speechRow marginBottom from 4 to 1 for tighter collapsed card layout"
      - "CR-229 replaces static minHeight:62 with dynamic calculation (5 lines when managePrayers ON, 3 when OFF)"
      - "CR-225 passes managePrayers prop to NextSundaysSection SundayCard via useWardManagePrayers hook"
      - "CR-224 renames toggle to 'Usar Convites para Oracoes', moves to 2nd position, adds description text"
      - "CR-226 allows Speeches & Prayers tab label to wrap to 2 lines via custom tabBarLabel with numberOfLines={2}"
      - "STEP-01/02/05/07/08/09 parallelizaveis (todos independentes), STEP-03/04 dependem de STEP-02, STEP-06 depende de STEP-05, STEP-10 depende de todos"
  - version: 32
    phase: "batch-24-phase-2-theme-speaker"
    changes:
      - "Added PLAN_P043 for Batch 24 Phase 2 (F155-F156, CRs 218/220)"
      - "2 visual improvements: light theme Slate palette + speaker name styling rework"
      - "5 steps, 23 ACs, 7 ECs, 5 arquivos impactados (0 novos + 5 modificados + 1 teste)"
      - "Zero migracoes SQL, zero dependencias novas"
      - "2 ADRs: ADR-100 (Tailwind Slate palette for light theme), ADR-101 (italic+textSecondary for speaker names)"
      - "F155 updates 10 lightColors values to Tailwind Slate blue-gray palette (Slate-50 through Slate-500)"
      - "F155 changes background from #FFFFFF to #F1F5F9 (Slate-100) so white cards (#FFFFFF) create visible contrast"
      - "F155 zero component files modified: all components use semantic tokens via useTheme()"
      - "F155 dark theme completely unchanged"
      - "F156 adds fontStyle:'italic' + color:colors.textSecondary to ReadOnlySpeakerRow speaker name text"
      - "F156 changes 2nd speech disabled speakerName from '' to t('speeches.secondSpeechDisabledPlaceholder')"
      - "F156 updates i18n wording: 'configurado'->'ajustado' (pt-BR, es), 'configured'->'adjusted' (en)"
      - "F156 preserves F149 disabled visual (opacity+surfaceVariant), SpeechSlot.tsx NOT modified"
      - "S01, S02 parallelizaveis (independentes), S03 depende de S01, S04 depende de S02+S03, S05 depende de todos"

  - version: 31
    phase: "batch-24-phase-1-ux-ui"
    changes:
      - "Added PLAN_P042 for Batch 24 Phase 1 (F152-F154, CRs 216/217/219)"
      - "3 UX/UI refinements: WhatsApp no-phone dialog with mark-as-invited option, play button circle outline + spacing, uniform collapsed card height for all types"
      - "5 steps, 22 ACs, 9 ECs, 6 arquivos impactados (0 novos + 6 modificados + 1 teste)"
      - "Zero migracoes SQL, zero dependencias novas"
      - "1 ADR: ADR-099 (Alert.alert pattern reuse, circle border, F151 supersession)"
      - "F152 restructures handleNotInvitedAction: mutate inside if(phone), Alert.alert in else block with Cancel/Mark as invited buttons"
      - "F152 adds 3 i18n keys (invite.noPhoneTitle, invite.noPhoneMessage, invite.markAsInvited) in 3 locales"
      - "F153 adds circular border (30x30, borderRadius:15, borderWidth:1.5, borderColor:textSecondary) to playButton Pressable in agenda.tsx"
      - "F153 changes playButton marginRight from 8 to 16"
      - "F154 supersedes F151: removes isSpeechesType from minHeight condition in SundayCard.tsx headerCenter"
      - "F154 changes from !expanded && isSpeechesType && { minHeight: 62 } to !expanded && { minHeight: 62 }"
      - "S01, S03, S04 parallelizaveis (independentes), S02 depende de S01 (i18n keys needed), S05 depende de todos"

  - id: PLAN_P041
    title: "Batch 23 Phase 2: Blue Border, i18n Swap, Disabled Visual, Standard Placeholders, Uniform Height"
    status: pending
    crs_covered: [211, 212, 213, 214, 215]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P041.yaml"
    summary: >
      5 UI/i18n refinements independentes: borda azul (colors.primary, borderWidth: 2) no card
      preview da Home tab seguindo padrao SundayCard isNext (F147/CR-211), swap de 5 valores
      i18n de wardBusiness e stakeAnnouncements em 3 locales com terminologia LDS correta
      (Desobrigacoes/Relevos ao inves de Agradecimentos, adicao de Anuncios em stakeAnnouncements)
      sem alterar en.wardBusiness (F148/CR-212), estilo visual disabled (opacity: 0.5 +
      backgroundColor: surfaceVariant) no ReadOnlySpeakerRow do AgendaForm quando disabled=true
      seguindo padrao SpeechSlot:201 (F149/CR-213), substituicao de t('speeches.secondSpeechDisabledPlaceholder')
      por t('speeches.selectSpeaker') e t('speeches.selectTopic') no SpeechSlot e string vazia
      no AgendaForm para fallback ao label via {speakerName || label} (F150/CR-214), e minHeight: 62
      no headerCenter do SundayCard quando !expanded && isSpeechesType para igualar altura de cards
      contraidos com 2 vs 3 posicoes (F151/CR-215). 5 features, 31 ACs, 9 ECs, 7 arquivos impactados
      (0 novos + 7 modificados + 1 teste), zero migracoes SQL, zero dependencias novas. 1 ADR:
      ADR-098 (reuse existing visual patterns). S01-S05 totalmente parallelizaveis (todos
      independentes), S06 (testes) depende de todos.
  - version: 30
    phase: "batch-23-phase-2-ui-i18n"
    changes:
      - "Added PLAN_P041 for Batch 23 Phase 2 (F147-F151, CRs 211/212/213/214/215)"
      - "5 UI/i18n refinements: blue border on Home preview card, i18n label swap, disabled visual on ReadOnlySpeakerRow, standard placeholders for disabled speech, uniform collapsed card height"
      - "6 steps, 31 ACs, 9 ECs, 7 arquivos impactados (0 novos + 7 modificados + 1 teste)"
      - "Zero migracoes SQL, zero dependencias novas"
      - "1 ADR: ADR-098 (reuse existing visual patterns for disabled fields and primary borders)"
      - "F147 changes borderColor from colors.border to colors.primary and borderWidth from 1 to 2 on Home tab previewCard (index.tsx)"
      - "F148 updates 5 i18n values across 3 locales: wardBusiness in pt-BR and es, stakeAnnouncements in pt-BR, en, and es. en.wardBusiness unchanged."
      - "F149 adds disabled && { backgroundColor: colors.surfaceVariant, opacity: 0.5 } to ReadOnlySpeakerRow in AgendaForm.tsx"
      - "F150 replaces t('speeches.secondSpeechDisabledPlaceholder') with t('speeches.selectSpeaker') and t('speeches.selectTopic') in SpeechSlot, and with '' in AgendaForm"
      - "F151 adds [styles.headerCenter, !expanded && isSpeechesType && { minHeight: 62 }] to SundayCard.tsx headerCenter View"
      - "S01-S05 totalmente parallelizaveis (todos independentes), S06 (testes) depende de todos"
  - version: 29
    phase: "batch-23-phase-1-svg"
    changes:
      - "Added PLAN_P040 for Batch 23 Phase 1 SVG (F145-F146, CRs 209/210)"
      - "2 UI improvements: replace all Unicode/emoji icons with inline SVG components, play icon placement adjustments"
      - "7 steps, 24 ACs, 7 ECs, 17 arquivos impactados (1 novo + 16 modificados + 1 teste)"
      - "Zero migracoes SQL, zero dependencias novas (react-native-svg ^15.12.1 ja presente)"
      - "2 ADRs: ADR-096 (modulo centralizado SVG icons), ADR-097 (play icon placement Home/Agenda)"
      - "F145 cria src/components/icons/index.ts com 14 componentes SVG (13 stroke-based Lucide + 1 fill-based WhatsApp)"
      - "F145 migra 16 arquivos de Unicode/emoji para SVG icons: _layout.tsx, SwipeableCard, SpeechSlot, SearchInput, SundayCard, AccordionCard, AgendaForm, InviteManagementSection, InviteActionDropdown, index.tsx, agenda.tsx, presentation.tsx, settings/index, users, timezone, theme"
      - "F145 consolida WhatsAppIcon duplicado de 2 arquivos para modulo compartilhado"
      - "F145 atualiza DD-25 de Unicode para inline SVG"
      - "F146 ajusta PlayIcon: Home tab (size=20, onPrimary, mesmo layout), Agenda tab (marginRight:8, textSecondary)"
      - "S01 primeiro (cria modulo), S02+S03+S04 parallelizaveis (dependem de S01), S05 depende de S02+S03+S04, S06 depende de S04, S07 depende de todos"

  - id: PLAN_P041
    title: "Batch 23 Phase 2: Blue Border, i18n Swap, Disabled Visual, Standard Placeholders, Uniform Height"
    status: pending
    crs_covered: [211, 212, 213, 214, 215]
    total_steps: 6
    plan_ref: "docs/plans/PLAN_P041.yaml"
    summary: >
      5 UI/i18n refinements independentes: borda azul (colors.primary, borderWidth: 2) no card
      preview da Home tab seguindo padrao SundayCard isNext (F147/CR-211), swap de 5 valores
      i18n de wardBusiness e stakeAnnouncements em 3 locales com terminologia LDS correta
      (Desobrigacoes/Relevos ao inves de Agradecimentos, adicao de Anuncios em stakeAnnouncements)
      sem alterar en.wardBusiness (F148/CR-212), estilo visual disabled (opacity: 0.5 +
      backgroundColor: surfaceVariant) no ReadOnlySpeakerRow do AgendaForm quando disabled=true
      seguindo padrao SpeechSlot:201 (F149/CR-213), substituicao de t('speeches.secondSpeechDisabledPlaceholder')
      por t('speeches.selectSpeaker') e t('speeches.selectTopic') no SpeechSlot e string vazia
      no AgendaForm para fallback ao label via {speakerName || label} (F150/CR-214), e minHeight: 62
      no headerCenter do SundayCard quando !expanded && isSpeechesType para igualar altura de cards
      contraidos com 2 vs 3 posicoes (F151/CR-215). 5 features, 31 ACs, 9 ECs, 7 arquivos impactados
      (0 novos + 7 modificados + 1 teste), zero migracoes SQL, zero dependencias novas. 1 ADR:
      ADR-098 (reuse existing visual patterns). S01-S05 totalmente parallelizaveis (todos
      independentes), S06 (testes) depende de todos.
  - version: 28
    phase: "batch-22-phase-2"
    changes:
      - "Added PLAN_P039 for Batch 22 Phase 2 (F143-F144, CRs 208/204)"
      - "2 bug fixes: invite creation structured logging + error codes + diagnostic mode, external hosting for HTML pages"
      - "6 steps, 20 ACs, 11 ECs, 5 arquivos impactados (2 novos + 3 modificados + 3 testes)"
      - "Zero migracoes SQL, zero dependencias novas"
      - "2 ADRs: ADR-094 (structured error codes + diagnostic mode), ADR-095 (external hosting via GitHub Pages)"
      - "F143 adds console.error at 6 failure points, 'code' field in all error responses, diagnostic mode returning checks report"
      - "F144 converts reset-redirect and invite-redirect EFs from inline HTML to 302 redirects to GitHub Pages"
      - "F144 creates 2 new HTML files in docs/public/ (reset-password.html, accept-invite.html) extracted from inline templates"
      - "S01, S02, S03 parallelizaveis (independentes), S04+S05 parallelizaveis entre si, S06 depende de S01+S02+S03"
  - version: 27
    phase: "batch-23-phase-1"
    changes:
      - "Added PLAN_P038 for Batch 23 Phase 1 (F140-F142, CRs 205/206/207)"
      - "3 bug fixes: invite error handling, language switch collections/template, WhatsApp template disconnect"
      - "7 steps, 20 ACs, 10 ECs, 5 arquivos impactados (1 novo + 4 modificados + 1 teste)"
      - "1 migracao SQL (019_seed_en_es_collections.sql), zero dependencias novas"
      - "3 ADRs: ADR-091 (err.message + suppressGlobalError), ADR-092 (reset whatsapp_template + initialized), ADR-093 (useQuery ward template + wardLanguage)"
      - "F140 is a 2-line fix in users.tsx (onError err.message + meta suppressGlobalError)"
      - "F141 has 3 parts: migration seed data (019), reset template in settings/index.tsx, reset initialized in whatsapp.tsx"
      - "F142 adds useQuery + wardLanguage in InviteManagementSection.tsx to use actual ward template"
      - "S01, S02, S03, S04, S05 parallelizaveis (todos independentes), S06 depende de S02, S07 depende de todos"
  - version: 26
    phase: "batch-22-phase-1"
    changes:
      - "Added PLAN_P037 for Batch 22 Phase 1 (F138-F139, CRs 202/203)"
  - version: 25
    phase: "batch-21-phase-2"
    changes:
      - "Added PLAN_P036 for Batch 21 Phase 2 (F135-F137, CRs 193/199/200)"
      - "3 UI refinements: Settings reorganization into 2 labeled groups, StatusLED right-edge alignment, play icon fontSize increase"
      - "5 steps, 24 ACs, 8 ECs, 7 arquivos impactados (1 novo teste + 6 modificados)"
      - "Zero migracoes SQL, zero Edge Functions, zero dependencias novas"
      - "2 ADRs: ADR-087 (Settings 2 labeled groups), ADR-088 (paddingRight:36 LED alignment)"
      - "F135 restructures settings/index.tsx from 3 unlabeled sections to 2 labeled groups (Ward Settings + App Settings) with i18n labels in 3 languages, Group 1 hidden for Observer, items reorganized (wardLanguage/timezone from Section 3 to Group 1, users/history from Section 2 to Group 2)"
      - "F136 adds paddingRight:36 to labelRow in SpeechSlot.tsx to align StatusLED right edge with speaker field right edge (matching actionArea width:36)"
      - "F137 increases playIcon fontSize 17->20 in index.tsx and playButton fontSize 14->18 + marginRight 8->12 in agenda.tsx"
      - "S01, S03, S04 parallelizaveis (independentes), S02 depende de S01 (i18n keys needed), S05 depende de todos"
  - version: 24
    phase: "batch-21-phase-1"
    changes:
      - "Added PLAN_P035 for Batch 21 Phase 1 (F130-F134, CRs 194/195/196/197/198)"
      - "5 bug fixes (regressions): TypeScript compilation errors + doc naming, ward language switch, 2nd speech toggle (4 sub-bugs), password reset email language, password reset script blocked"
      - "10 steps, 44 ACs, 15 ECs, 15 arquivos impactados (1 novo teste + 14 modificados + 4 docs)"
      - "Zero migracoes SQL, zero dependencias novas, 2 Edge Functions modificadas"
      - "2 ADRs: ADR-085 (separate supabase update for topic fields), ADR-086 (user_metadata language priority chain)"
      - "F130 fixes 16 TS errors: SundayAgenda mock fields, wardLanguage required string, speeches in SundayExceptionReason, null->string in speeches.tsx, undefined Member in AgendaForm, BlurEvent in DebouncedTextInput + doc naming can_piano->can_pianist, can_music cleanup"
      - "F131 exposes setWardLanguage in AuthContextValue and calls it in wardLanguageChangeMutation.onSuccess"
      - "F132 fixes 4 sub-bugs: topic clear on toggle off (separate supabase update per ADR-085), 2 disabled fields with placeholder in SpeechSlot (not single warning), AgendaForm disabled ReadOnlySpeakerRow, dynamic X/2 vs X/3 in collapsed cards"
      - "F133 changes email language resolution to user_metadata.language -> ward.language -> pt-BR"
      - "F134 removes <script> tag from reset-redirect, relies on meta refresh + <a href>"
      - "S01, S02, S08, S09 parallelizaveis; S03 paralleliza com S04/S05/S06; S04+S05+S06 dependem de S01; S07 depende de S04+S05+S06; S10 depende de todos"

  - id: PLAN_P036
    title: "Batch 21 Phase 2: Settings Reorganization, StatusLED Alignment, Play Icon Size"
    status: pending
    crs_covered: [193, 199, 200]
    total_steps: 5
    plan_ref: "docs/plans/PLAN_P036.yaml"
    summary: >
      3 UI refinements: reorganizacao da aba Settings de 3 secoes sem label para 2 grupos
      rotulados ("Configuracoes da Ala" com members/topics/whatsapp/wardLanguage/timezone e
      "Configuracoes do App" com users/history/appLanguage/theme/about) com labels i18n em
      3 idiomas, Group 1 oculto para Observer, styling uppercase/textSecondary (F135).
      Alinhamento do StatusLED com borda direita do campo de discursante via paddingRight:36
      no labelRow do SpeechSlot, igualando ao width da actionArea (F136). Aumento do fontSize
      do icone play no botao Iniciar do Home (17->20) e no card expandido da Agenda (14->18)
      com marginRight ajustado de 8 para 12 para espacamento do chevron (F137). 3 features,
      24 ACs, 8 ECs, 7 arquivos impactados (1 novo teste + 6 modificados), zero migracoes
      de banco, zero dependencias novas. 2 ADRs: ADR-087 (Settings 2 groups), ADR-088
      (paddingRight LED alignment). S01, S03, S04 parallelizaveis, S02 depende de S01,
      S05 depende de todos.
  - version: 23
    phase: "batch-20-phase-1"
    changes:
      - "Added PLAN_P034 for Batch 20 Phase 1 (F126-F129, CRs 184/185/186/188)"
      - "4 features: pencil button in Presentation to Agenda, play button in Agenda to Presentation, Home preview card + play icon, non-expandable NextSundaysSection with pencil navigation"
      - "6 steps, 35 ACs, 12 ECs, 5 arquivos impactados (1 novo teste + 4 modificados)"
      - "Zero migracoes SQL, zero Edge Functions, zero dependencias novas"
      - "2 ADRs: ADR-083 (extend ADR-082 expandDate pattern to Agenda tab), ADR-084 (inline AgendaPreviewCard in Home)"
      - "F126 adds pencil (U+270F) to Presentation header + expandDate support in agenda.tsx (ADR-082 copy from speeches.tsx)"
      - "F127 adds play (U+25B6) to expanded Agenda card header + date param support in presentation.tsx"
      - "F128 adds play icon to Iniciar button, inline AgendaPreviewCard with dateBlock + status lines + pencil to Agenda"
      - "F129 is a net ~130 lines removal: strips 7 mutation hooks, 9 handlers, SpeechSlot/Modals from NextSundaysSection, adds pencil + renderHeaderRight prop to SundayCard"
      - "S01, S02, S05 parallelizaveis (independentes), S03 depende de S02 (ambos agenda.tsx), S04 depende de S02 (expandDate), S06 depende de todos"
  - version: 22
    phase: "batch-19-phase-2"
    changes:
      - "Added PLAN_P033 for Batch 19 Phase 2 (F120-F125, CRs 179/182/183/187/189/192)"
      - "6 features: X clear buttons on selector fields, read-only speeches + pencil nav, label renames, SpeechSlot X alignment, push notification projectId fix"
      - "6 steps, 39 ACs, 11 ECs, 5 arquivos impactados (1 novo teste + 4 modificados)"
      - "Zero migracoes SQL, zero Edge Functions, zero dependencias novas"
      - "2 ADRs: ADR-081 (row-per-element SpeechSlot layout), ADR-082 (Expo Router query param cross-tab navigation)"
      - "F120 adiciona onClear/hasValue props ao SelectorField sub-component no AgendaForm com clear handlers para 11 campos (actor, hymn, prayer, recognizing)"
      - "F121 remove SpeakerField do AgendaForm, substitui por ReadOnlySpeakerRow com display read-only + botao lapis que navega para Speeches tab com expandDate param"
      - "F122+F123 sao mudancas de valor i18n apenas (no code changes): 'Proximas Designacoes'->'Proximos Discursos', 'Agenda'->'Agendas'"
      - "F124 reestrutura SpeechSlot de two-column para row-per-element garantindo X button alignment por alignItems:'center' (supersedes ADR-076, ADR-078 parcial)"
      - "F125 corrige projectId: undefined com Constants.expoConfig?.extra?.eas?.projectId + guard para Expo Go"
      - "S01-S04 parallelizaveis (independentes), S05 depende de S04 (ambos AgendaForm.tsx), S06 depende de todos"
  - version: 21
    phase: "batch-19"
    changes:
      - "Added PLAN_P032 for Batch 19 Phase 1 (F116-F119, CRs 178/180/181/191)"
      - "4 features: separate app/ward language control, pianist/conductor split, optional 2nd speech toggle, password reset plain-text HTML bug fix"
      - "10 steps, 44 ACs, 15 ECs, 20+ arquivos impactados (2 novos + 18+ modificados + 1 teste novo)"
      - "2 migracoes SQL (017_split_music_actor, 018_add_has_second_speech), zero dependencias novas"
      - "2 ADRs: ADR-079 (user_metadata for app language), ADR-080 (CHECK constraint pianist/conductor)"
      - "F116 e a mais complexa: AuthContext language split, Settings 2 pickers, Observer limited Settings tab, collection reactivation bug fix, WhatsApp placeholder translation, Topics ward language, useTopics label i18n"
      - "F117 e migracao destrutiva (drop can_music) + type/hook/component updates para can_pianist/can_conductor"
      - "F118 adiciona toggle per-Sunday com UI em SpeechSlot, SundayCard collapsed (remove labels ordinais), presentation mode, AgendaForm, InviteManagement"
      - "F119 e investigacao + fix de charset/Cache-Control na Edge Function reset-redirect"
      - "S01, S02, S09 parallelizaveis; S03 depende S01+S02; S04, S05 dependem S03; S06 depende S04; S07 depende S03; S08 depende S04+S06+S07; S10 depende todos"
  - version: 20
    phase: "batch-18"
    changes:
      - "Added PLAN_P031 for Batch 18 (F113-F115, CRs 175/176/177)"
      - "3 features: deep link scheme change sacrmeetman->sacrmeetplan, HTTPS redirect Edge Function for email reset, StatusLED right-edge alignment with speaker field"
      - "5 steps, 22 ACs, 12 ECs, 6 arquivos impactados (1 novo + 5 modificados + 2 testes atualizados)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-077 (HTTPS redirect Edge Function as email bridge), ADR-078 (StatusLED no labelRow supersedes ADR-076)"
      - "F113 e substituicao simples de scheme em 3 locais (app.json, create-invitation, send-reset-email)"
      - "F114 cria nova Edge Function reset-redirect como bridge HTTPS->deep link, altera send-reset-email para URL HTTPS"
      - "F115 supersedes F112/ADR-076 (move LED de rightColumn para labelRow no leftColumn)"
      - "S01, S02, S03 parallelizaveis (S04 pode paralelizar com S03), S05 depende de todos"
      - "S04 atualiza testes existentes em batch7-f035-f039.test.ts e batch15-phase2.test.ts"
  - version: 19
    phase: "batch-17"
    changes:
      - "Added PLAN_P030 for Batch 17 (F110-F112, CRs 172/173/174)"
      - "3 features: stake announcements field in presentation mode, AgendaForm last speech label fix, SpeechSlot fixed-width right column alignment"
      - "4 steps, 15 ACs, 7 ECs, 5 arquivos impactados (1 novo + 4 modificados)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "1 ADR: ADR-076 (fixed-width right column supersedes ADR-074 paddingRight:5)"
      - "F112 supersedes F103/CR-165 approach (paddingRight:5 replaced by layout restructure)"
      - "F111 is same fix pattern as F108/CR-170 (remove redundant label suffix) applied to AgendaForm"
      - "F110 follows existing conditional field pattern from baby_blessing/baptism_confirmation"
      - "S01-S03 totalmente parallelizaveis (todos independentes), S04 (testes) depende de todos"
  - version: 18
    phase: "batch-16"
    changes:
      - "Added PLAN_P029 for Batch 16 (F103-F109, CRs 165/166/167/168/169/170/171)"
      - "7 features: status circle alignment, presentation title fix, accent corrections, back button tap area, collapsed card row equalization, last speech label fix, special meeting status lines"
      - "8 steps, 43 ACs, 15 ECs, 14 arquivos impactados (1 novo + 13 modificados)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-074 (paddingRight no statusSection), ADR-075 (hitSlop={12} para back buttons)"
      - "S01-S07 totalmente parallelizaveis (todos independentes), S08 (testes) depende de todos"
      - "F109 e a mais complexa (status lines para testimony_meeting e primary_presentation com nova i18n key)"
      - "F106 modifica 8 arquivos (todas as sub-telas de Settings) com mudanca identica"
      - "F104, F105, F109 compartilham i18n locale files mas tocam keys diferentes (sem conflito)"
  - version: 17
    phase: "batch-15-phase-2"
    changes:
      - "Added PLAN_P028 for Batch 15 Phase 2 (F101-F102, CRs 155/164)"
      - "2 features: multilingual password reset email via Edge Function, test suite 100% passing"
      - "5 steps, 17 ACs, 6 ECs, 5 arquivos impactados (2 novos + 3 modificados + 3 testes)"
      - "Zero migracoes de banco, 2 env vars necessarias (RESEND_API_KEY, RESEND_FROM_EMAIL)"
      - "4 ADRs: ADR-070 (EF replaces Dashboard template), ADR-071 (invoke sem session guard), ADR-072 (verifyOtp token_hash), ADR-073 (Resend via fetch)"
      - "F101 cria nova Edge Function send-reset-email com i18n templates (pt-BR/en/es)"
      - "F101 modifica forgot-password.tsx (remove Linking, add functions.invoke) e reset-password.tsx (add useLocalSearchParams + verifyOtp)"
      - "F102 fixa 2 testes pre-existentes (com.wardmanager.app) e atualiza testes de auth para Edge Function flow"
      - "S01 -> S02/S03 (parallelizable) -> S04 -> S05 (sequencial: EF primeiro, client depois, testes, validacao)"
  - version: 16
    phase: "batch-15-phase-1"
    changes:
      - "Added PLAN_P027 for Batch 15 Phase 1 (F097-F100, CRs 156/157/158/159/160/161/162/163)"
      - "4 features: presentation mode improvements (arrows, names, font toggle, titles), speech label context, collapsed card redesign, expanded status redesign"
      - "6 steps, 44 ACs, 10 ECs, 6 arquivos impactados (1 novo + 5 modificados)"
      - "Zero migracoes de banco, zero dependencias novas, zero novos arquivos de codigo"
      - "2 ADRs: ADR-068 (font size toggle useState), ADR-069 (getPositionLabel unificado)"
      - "F097 e a mais complexa (4 CRs em 3 arquivos: AccordionCard, usePresentationMode, presentation.tsx)"
      - "F098 supersedes F093 posicao 3 label e F058 (speeches.lastSpeech)"
      - "F099 redesigns F093 layout (LEDs de vertical column para inline)"
      - "S01 a S05 podem ser implementados em paralelo (todos independentes)"

  - id: PLAN_P028
    title: "Batch 15 Phase 2: Multilingual Password Reset Email, Test Suite Fix"
    status: pending
    crs_covered: [155, 164]
    total_steps: 5
    plan_ref: "docs/plans/PLAN_P028.yaml"
    summary: >
      2 features cobrindo Edge Function multilingual e test fixes: nova Edge Function
      send-reset-email que recebe email, busca idioma da ala (ward.language), gera
      recovery token via admin.generateLink, e envia email traduzido (pt-BR/en/es)
      via Resend REST API com deep link sacrmeetman://reset-password?token=TOKEN
      (F101), forgot-password.tsx substituindo resetPasswordForEmail por
      functions.invoke('send-reset-email'), reset-password.tsx adicionando
      useLocalSearchParams + verifyOtp para token de deep link com PASSWORD_RECOVERY
      como fallback. Fix de 2 testes pre-existentes em batch7-f035-f039.test.ts
      (com.wardmanager.app -> com.sacramentmeetingmanager.app), atualizacao de testes
      batch14-phase1.test.ts para Edge Function flow, novos testes em
      batch15-phase2.test.ts, suite completa 100% passing (F102). 2 features,
      17 ACs, 6 ECs, 5 arquivos impactados (2 novos + 3 modificados + 3 testes),
      zero migracoes de banco. 4 ADRs: ADR-070 (Edge Function replaces Dashboard
      template), ADR-071 (direct invoke sem session guard), ADR-072 (verifyOtp com
      token_hash), ADR-073 (Resend via fetch).
  - version: 15
    phase: "batch-14-phase-2"
    changes:
      - "Added PLAN_P026 for Batch 14 Phase 2 (F093-F096, CRs 150/151/152/153)"
      - "4 features: collapsed card speaker names + vertical LEDs, pianist/conductor agenda fields, intermediate hymn toggle, agenda status lines"
      - "9 steps, 34 ACs, 13 ECs, 7 arquivos impactados (2 novos + 5 modificados)"
      - "1 migracao SQL (016_add_has_intermediate_hymn.sql)"
      - "2 ADRs: ADR-066 (useAgendaRange range query), ADR-067 (has_intermediate_hymn DB column)"
      - "F096 e a mais complexa (useAgendaRange + status computation + 8 i18n keys)"
      - "F093 modifica SundayCard compartilhado (afeta Discursos e Home automaticamente)"
      - "F094 reutiliza padrao ActorSelector existente (can_music)"
      - "S01, S02, S03 podem ser implementados em paralelo (independentes)"
  - version: 14
    phase: "batch-14"
    changes:
      - "Added PLAN_P025 for Batch 14 Phase 1 (F088-F092, CRs 145/146/147/148/149)"
      - "5 features: password reset email redirect + page, offline graceful degradation, offline banner readability, confirmation dialog text, button always visible"
      - "10 steps, 25 ACs, 8 arquivos impactados (1 novo + 7 modificados)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-064 (supersede ADR-019 email template), ADR-065 (onlineManager com useConnection)"
      - "F091 e F092 sao as mais simples (i18n-only e remove condicional)"
      - "F089 e a mais complexa (onlineManager + QueryClient config + mutation silencing)"
      - "F088 requer criacao de nova pagina reset-password.tsx + configuracao manual do Supabase Dashboard"
      - "S01, S02, S03, S04 podem ser implementados em paralelo (independentes)"
  - version: 13
    phase: "batch-13"
    changes:
      - "Added PLAN_P024 for Batch 13 (F083-F087, CRs 140/141/142/143/144)"
      - "5 features: settings label rename, agenda sunday type dropdown, activity log overhaul, pg_timezone_names investigation, SQL search_path fix"
      - "10 steps, 48 ACs, 17 arquivos impactados (2 novos + 15 modificados)"
      - "1 migracao SQL (015_fix_function_search_path.sql)"
      - "3 ADRs: ADR-061 (export SundayTypeDropdown), ADR-062 (pipe-delimited log format), ADR-063 (SET search_path = '')"
      - "F086 (pg_timezone_names) nao requer implementacao de codigo (investigation only)"
      - "F085 e a maior feature com 5 steps e 17 ACs (activity log overhaul)"
      - "F083, F087, F084 podem ser implementadas em paralelo (independentes)"
  - version: 12
    phase: "batch-12"
    changes:
      - "Added PLAN_P023 for Batch 12 (F082, CR-139)"
      - "1 feature: integration tests for hooks, providers, and component-hook data flow"
      - "8 steps, 30 ACs, 7 ECs, 6 arquivos impactados (5 novos + 1 modificado)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "4 ADRs: ADR-057 (chainable Supabase mock), ADR-058 (TestWrapper AuthContext.Provider), ADR-059 (vi.mock per file), ADR-060 (AuthContext export)"
      - "~50-62 test cases novos em 4 arquivos de teste + 1 setup"
      - "Export de AuthContext const como unica mudanca em codigo fonte"
  - version: 11
    phase: "batch-11"
    changes:
      - "Added PLAN_P022 for Batch 11 (F077-F081, CRs 134/135/136/137/138)"
      - "5 features: status options fix, custom name help text, agenda scroll, checkbox visual, actor delete text"
      - "10 steps, 30 ACs, 7 arquivos impactados (1 novo + 6 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "4 ADRs: ADR-053 (full mesh VALID_TRANSITIONS), ADR-054 (opcoes dinamicas via .map), ADR-055 (viewPosition 0.5 apenas Agenda), ADR-056 (checkbox Unicode)"
      - "F077 supersedes F062 e F071 (nunca implementados)"
  - version: 10
    phase: "batch-10-phase-2"
    changes:
      - "Added PLAN_P021 for Batch 10 Phase 2 (F073-F076, CRs 128/131/132/133)"
      - "4 features: topic X button positioning, hymn search width, auto-scroll fix, custom prayer name UX"
      - "9 steps, 26 ACs, 8 arquivos impactados (1 novo + 7 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-051 (remover getItemLayout), ADR-052 (substituir initialScrollIndex por useEffect)"
      - "F075 supersedes F066 (auto-scroll ja implementado, F075 corrige bug de alturas fixas)"
  - version: 9
    phase: "batch-10-phase-1"
    changes:
      - "Added PLAN_P020 for Batch 10 Phase 1 (F069-F072, CRs 126/127/129/130)"
      - "4 features: LED flat redesign, delete speeches on type change, LED status filter, country code display fix"
      - "10 steps, 35 ACs, 7 arquivos impactados (0 novos + 7 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-049 (cores flat unicas no StatusLED), ADR-050 (hook dedicado useDeleteSpeechesByDate)"
      - "1 novo hook: useDeleteSpeechesByDate, 1 nova prop: onDeleteSpeeches"
  - version: 8
    phase: "batch-9-phase-3"
    changes:
      - "Added PLAN_P019 for Batch 9 Phase 3 (F065-F067, CRs 118/120/123/124)"
      - "3 UX polish + 1 already implemented: SearchInput flex:1 + close button, auto-scroll on expand, recognizing field proportional"
      - "9 steps, 26 ACs, 8 arquivos impactados (0 novos + 8 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "3 ADRs: ADR-046 (flex:1 defensivo no SearchInput), ADR-047 (setTimeout 300ms para auto-scroll), ADR-048 (Pressable inline para Reconhecendo)"
      - "F068 (CR-124) marcado como already_implemented - nenhuma alteracao de codigo"
  - version: 7
    phase: "batch-9-phase-2"
    changes:
      - "Added PLAN_P018 for Batch 9 Phase 2 (F060-F064, CRs 114/115/116/119/121)"
      - "5 UX improvements: topic X button, type change confirmation, LED filter, layout reorder, last-minute label"
      - "11 steps, 30 ACs, 7 arquivos impactados (0 novos + 7 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-044 (assignTopic com null para clear), ADR-045 (Alert.alert nativo para confirmacao)"
      - "1 nova prop: onClearTopic, 1 nova prop: allowedStatuses, 1 novo estilo: lastMinuteLabel"
  - version: 6
    phase: "batch-9-phase-1"
    changes:
      - "Added PLAN_P017 for Batch 9 Phase 1 (F055-F059, CRs 112/113/117/122/125)"
      - "3 bug fixes + 2 UI tweaks: WhatsApp conversation URL, dropdown title i18n, +1 flag fix, last speech label, prayer duplication"
      - "10 steps, 23 ACs, 10 arquivos impactados (0 novos + 10 modificados + 1 teste)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "2 ADRs: ADR-042 (buildWhatsAppConversationUrl separada), ADR-043 (country label as selection key)"
      - "1 nova funcao: buildWhatsAppConversationUrl, 1 nova funcao: getCountryByLabel, 1 nova prop: modalOnly"
  - version: 5
    phase: "batch-8-phase-2"
    changes:
      - "Added PLAN_P016 for Batch 8 Phase 2 (F050-F054, CRs 105/106/107/110/111)"
      - "5 UX improvements: icon buttons, custom dropdown, enhanced second line, bishopric permission, SpeechSlot spacing"
      - "10 steps, 27 ACs, 8 arquivos impactados (2 novos + 6 modificados + 3 testes)"
      - "Zero migracoes de banco, zero dependencias novas"
      - "1 nova transicao de status: assigned_invited -> assigned_not_invited (reversa)"
      - "1 novo componente: InviteActionDropdown.tsx"
  - version: 4
    phase: "batch-8-phase-1"
    changes:
      - "Added PLAN_P015 for Batch 8 Phase 1 (F045-F049, CRs 101/102/103/104/108/109)"
      - "5 bug fixes: LEDs condicionais, label amarelo filtrado, template Settings, variaveis WhatsApp, SpeechSlots Home"
      - "8 steps, 26 ACs, 6 arquivos impactados (1 novo + 5 modificados)"
      - "Zero migracoes de banco, zero dependencias novas"
  - version: 3
    phase: "batch-7-phase-2"
    changes:
      - "Added PLAN_P014 for Batch 7 Phase 2 (F040-F044, CRs 94/96/97/99/100)"
      - "5 UX/features: WhatsApp i18n templates, search fixed top, multi-select recognizing, speech labels, speaker override"
      - "12 steps, 39 ACs, 12 arquivos impactados (2 novos + 10 modificados)"
      - "1 migracao DB (014_add_speaker_overrides.sql)"
  - version: 2
    phase: "batch-7-phase-1"
    changes:
      - "Added PLAN_P013 for Batch 7 Phase 1 (F035-F039, CRs 91/92/93/95/98)"
      - "5 bug fixes: RLS trigger, duplicate key, deep link protocol, speech fields, prayer fields"
      - "6 steps, 30 ACs, 7 arquivos impactados (1 novo + 6 modificados + 2 testes)"
  - version: 1
    phase: "batch-6"
    changes:
      - "Initial consolidated plan with all phases and CR plans"
