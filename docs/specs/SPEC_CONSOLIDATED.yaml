# =============================================================================
# SPEC_CONSOLIDATED.yaml
# Fonte unica de verdade para requisitos do projeto Sacrament Meeting Planner
# Gerado: 2026-02-18
# =============================================================================

metadata:
  project: Sacrament Meeting Planner
  description: >
    App mobile (React Native/Expo) para planejamento de reunioes sacramentais
    da Igreja de Jesus Cristo dos Santos dos Ultimos Dias. Permite ao bispado
    designar discursantes e temas, ao secretario gerenciar convites e montar a
    agenda completa da reuniao, com isolamento de dados entre alas, i18n
    (pt-BR, en, es), modo apresentacao, push notifications e audit log.
  created: "2026-02-18"
  last_updated: "2026-02-18"
  total_features: 54
  total_change_requests: 111
  implemented_crs: 95
  pending_crs: 16
  source_documents:
    - docs/PRODUCT_SPECIFICATION.md
    - docs/SPEC.final.md
    - docs/specs/history/SPEC_INDEX.md
    - docs/specs/history/SPEC_CR_batch1.md
    - docs/specs/history/SPEC_CR_batch2.md
    - docs/specs/history/SPEC_CR_batch3.md
    - docs/specs/history/SPEC_CR_batch4.md
    - docs/specs/history/SPEC_CONSOLIDATED_old.yaml
    - docs/CHANGE_REQUESTS.yaml
    - docs/specs/SPEC_F026.yaml
    - docs/specs/SPEC_F027_F031.yaml
    - docs/specs/SPEC_F032_F034.yaml
    - docs/specs/SPEC_F035_F039.yaml
    - docs/specs/SPEC_F040_F044.yaml
    - docs/specs/SPEC_F045_F049.yaml
    - docs/specs/SPEC_F050_F054.yaml
  detail_references: >
    Acceptance criteria individuais de cada feature estao nos arquivos
    docs/specs/history/SPEC_F*.md. Este arquivo nao duplica os ACs
    individuais; apenas referencia que existem.

# =============================================================================
# TECH STACK
# =============================================================================

tech_stack:
  framework: "React Native + Expo SDK 54 (TypeScript)"
  routing: "Expo Router (file-based)"
  state_management: "TanStack Query (server state) + React Context (local: theme, auth)"
  backend: "Supabase (Auth, PostgREST, Realtime, Edge Functions)"
  database: "PostgreSQL with RLS (Row-Level Security)"
  i18n: "react-i18next (pt-BR, en, es)"
  testing: "Vitest"
  gestures: "react-native-gesture-handler ~2.28.0 + react-native-reanimated"
  offline: "Fila de mutacoes em AsyncStorage + last-write-wins"
  push_notifications: "Expo Push Notifications (expo-notifications) + Supabase Edge Function"
  deep_links: "expo-linking (convites por link)"
  file_system: "expo-file-system ~19.0.21 (new File/Paths API, NOT legacy)"
  sharing: "expo-sharing ~14.0.8"
  document_picker: "expo-document-picker ~14.0.8"

# =============================================================================
# PERSONAS E PERMISSOES (estado atual apos todos os CRs implementados)
# =============================================================================

personas:
  - role: bispado
    description: >
      Bispo + 2 Conselheiros (3 pessoas por ala). Responsaveis por decisoes
      estrategicas: designam discursantes e temas, alteram status, gerenciam
      usuarios, convidam novos usuarios por link.
    typescript_type: "bishopric"

  - role: secretario
    description: >
      1 pessoa por ala. Executa decisoes do bispado: gerencia membros, temas,
      excecoes, altera status, envia convites via WhatsApp, gerencia usuarios
      (CR-23), convida novos usuarios por link. NAO designa discursantes pela
      aba Discursos nem Home, mas PODE designar pela aba Agenda (CR-31).
    typescript_type: "secretary"

  - role: observador
    description: >
      Membros com acesso somente-leitura. Visualizam discursos, designacoes
      e agenda sem poder editar. Sem acesso a aba Configuracoes.
    typescript_type: "observer"

  - role: admin_sistema
    description: >
      Papel tecnico (nao usa o app). Importa Colecoes Gerais e hinos via
      scripts CLI (pnpm import-themes, pnpm import-hymns).
    typescript_type: null

permissions:
  # Tabela de permissoes atualizada (reflete CR-23, CR-26, CR-31, CR-37, CR-71)
  speech_assign:
    description: "Designar discursantes/temas (aba Discursos e Home)"
    bispado: true
    secretario: false
    observador: false

  speech_unassign:
    description: "Remover designacao de discursante"
    bispado: true
    secretario: false
    observador: false

  speech_change_status:
    description: "Alterar status de discursos"
    bispado: true
    secretario: true
    observador: false

  member_read:
    description: "Visualizar lista de membros"
    bispado: true
    secretario: true
    observador: false

  member_write:
    description: "Criar, editar, excluir membros"
    bispado: true
    secretario: true
    observador: false

  member_import:
    description: "Importar/exportar membros via CSV"
    bispado: true
    secretario: true
    observador: false

  topic_write:
    description: "Gerenciar temas da Ala"
    bispado: true
    secretario: true
    observador: false

  collection_toggle:
    description: "Ativar/desativar Colecoes Gerais"
    bispado: true
    secretario: true
    observador: false

  sunday_type_write:
    description: "Marcar tipo de domingo (dropdown)"
    bispado: true
    secretario: true
    observador: false  # dropdown visivel mas desabilitado

  settings_access:
    description: "Acessar aba Configuracoes"
    bispado: true
    secretario: true
    observador: false

  settings_language:
    description: "Configurar idioma da Ala"
    bispado: true
    secretario: true
    observador: false

  settings_whatsapp:
    description: "Gerenciar convites WhatsApp"
    bispado: false
    secretario: true
    observador: false

  settings_users:
    description: "Gerenciar usuarios (CRUD) - atualizado pelo CR-23"
    bispado: true
    secretario: true  # adicionado CR-23
    observador: false

  invitation_create:
    description: "Convidar usuarios por link"
    bispado: true
    secretario: true
    observador: false

  home_next_assignments:
    description: "Ver secao 'Proximas designacoes' na Home"
    bispado: true
    secretario: false
    observador: false

  home_invite_mgmt:
    description: "Ver secao 'Gerenciamento de convites' na Home"
    bispado: true
    secretario: true
    observador: false

  agenda_read:
    description: "Visualizar aba Agenda"
    bispado: true
    secretario: true
    observador: true  # read-only

  agenda_write:
    description: "Editar agenda da reuniao"
    bispado: true
    secretario: true
    observador: false

  agenda_assign_speaker:
    description: "Designar discursante via Agenda (excecao para Secretario - CR-31)"
    bispado: true
    secretario: true  # excecao documentada em CR-31/ASM-AGD-003
    observador: false

  presentation_start:
    description: "Iniciar Modo Apresentacao"
    bispado: true
    secretario: true
    observador: true  # read-only

  push_receive:
    description: "Receber push notifications"
    bispado: true
    secretario: true
    observador: false

  history_read:
    description: "Visualizar Historico de acoes"
    bispado: true
    secretario: true
    observador: false

  theme_toggle:
    description: "Alterar tema visual (dark/light)"
    bispado: true
    secretario: true
    observador: false  # usa apenas tema do sistema

# =============================================================================
# FEATURES (estado atual apos 106 CRs, 95 implementados)
# =============================================================================

features:

  # ---------------------------------------------------------------------------
  # Core Data (F001-F006)
  # ---------------------------------------------------------------------------

  - id: F001
    name: "Authentication & Session Management"
    status: implemented
    rfs: [RF-33, RF-34, RF-35, RF-36]
    description: >
      Login com email/senha via Supabase Auth. Signup via self-registration
      (primeiro usuario cria ala + usuario) ou convite por link (deep link
      wardmanager://invite/{token}). Sessao persistente, password reset
      via email (CR-67). Suporte a gerenciadores de senha.
    modified_by_crs: [67]
    notes:
      - "CR-67: Adicionou 'Esqueci a senha' na tela de login"
      - "Self-registration do primeiro usuario cria ala + usuario"
      - "Convite por link expira em 30 dias"

  - id: F002
    name: "Multi-tenancy & Ward Management"
    status: implemented
    rfs: [RN-11, RN-13]
    description: >
      Criacao e configuracao de ala (nome, estaca, idioma, fuso horario,
      template WhatsApp). Isolamento completo de dados entre alas via RLS.
      Configuracao de idioma (pt-BR, en, es) e fuso horario (IANA timezone
      com seletor de busca - CR-41).
    modified_by_crs: [41]
    notes:
      - "CR-41: Formalizou spec do seletor de fuso horario"
      - "Timezone default: pt-BR -> America/Sao_Paulo, en -> America/New_York, es -> America/Mexico_City"

  - id: F003
    name: "Member Management (CRUD)"
    status: implemented
    rfs: [RF-01, RF-01.1, RF-01.2, RF-02, RF-03]
    description: >
      Tela de gerenciamento de membros com busca em tempo real (case-insensitive,
      ignora acentos). Adicionar membro via botao "+" no header. Editar/excluir
      via swipe-to-reveal. Campos: nome completo, codigo do pais (dropdown com
      bandeira emoji), telefone. Salvamento automatico ao clicar fora.
      Snapshot pattern: edicao de membro NAO propaga para discursos existentes.
    modified_by_crs: [40, 55, 78, 82, 83, 90]
    notes:
      - "CR-40: Resolveu inconsistencia de posicao do botao '+' (no header, nao FAB)"
      - "CR-55: Corrigiu desalinhamento do header quando canWrite=false"
      - "CR-78: Corrigiu unique constraint removendo phone da constraint (ward_id, full_name)"
      - "CR-82: GestureHandlerRootView para swipe funcionar"
      - "CR-83: Save/Cancel explicito ao inves de auto-save no blur"
      - "CR-90: Fix botao Delete no SwipeableCard"
      - "Observador: swipe desabilitado"

  - id: F004
    name: "Member Import/Export (CSV)"
    status: implemented
    rfs: [RF-04, RF-05]
    description: >
      Export CSV via share sheet (mobile) ou download (web). Import CSV via
      document picker (mobile) ou file input (web). Formato: Nome Completo,
      Codigo Pais, Telefone. Import sobrescreve toda a lista via Supabase RPC
      import_members. Usa expo-file-system v19 new File/Paths API (CR-77/78).
    modified_by_crs: [42, 54, 66, 77, 78, 86]
    notes:
      - "CR-42: Corrigiu botoes que nao funcionavam"
      - "CR-54: Corrigiu erro ao cancelar share sheet e msg hardcoded em ingles"
      - "CR-66: Corrigiu export vazio e import com erro generico"
      - "CR-77: Migrou para File/Paths API (cacheDirectory null fix)"
      - "CR-78: Migrou para File.text() (EncodingType undefined fix)"
      - "CR-86: Dialogo de confirmacao antes de importar CSV"

  - id: F005
    name: "Ward Topics Management"
    status: implemented
    rfs: [RF-06, RF-06.1, RF-06.2, RF-07, RF-08, RF-08.1]
    description: >
      Gerenciamento de temas da ala (CRUD) e colecoes gerais (toggle
      ativar/desativar). Temas com titulo obrigatorio e link opcional.
      Swipe-to-reveal para editar/excluir. Botao "+" dentro da secao
      Temas da Ala (CR-21). Campo de busca/filtro (CR-39). Salvamento
      automatico. Snapshot pattern para temas em discursos existentes.
    modified_by_crs: [8, 21, 39, 82, 83, 90]
    notes:
      - "CR-8: Corrigiu lista de colecoes nao scrollavel"
      - "CR-21: Moveu botao '+' para dentro da secao Ward Topics"
      - "CR-39: Adicionou campo de busca para filtrar temas"
      - "CR-82: GestureHandlerRootView para swipe funcionar"
      - "CR-83: Save/Cancel explicito ao inves de auto-save no blur"
      - "CR-90: Fix botao Delete no SwipeableCard"

  - id: F006
    name: "General Collections & Import"
    status: implemented
    rfs: [RF-08.2, RF-08.3]
    description: >
      Colecoes gerais de temas por idioma, importadas via script admin
      (pnpm import-themes). Ativar/desativar colecoes por ala. Ao mudar
      idioma da ala, colecoes do idioma anterior sao desativadas.
    modified_by_crs: []

  # ---------------------------------------------------------------------------
  # Sunday & Speech (F007-F008)
  # ---------------------------------------------------------------------------

  - id: F007
    name: "Sunday Type Management (Exceptions)"
    status: implemented
    rfs: [RF-09, RF-10, RF-11]
    description: >
      Dropdown no card expandido para tipo de domingo. Opcoes: Domingo com
      Discursos, Reuniao de Testemunho, Conferencia Geral, Conferencia de
      Estaca, Conferencia de Ala, Reuniao Especial da Primaria, Outro (com
      texto livre). Auto-atribuicao em lote ao carregar lista. Todos os
      valores (incluindo 'speeches') sao persistidos no banco.
    modified_by_crs: [4, 6, 7, 24, 56, 68]
    notes:
      - "CR-6: Corrigiu lista de opcoes do dropdown"
      - "CR-7: Escondeu secao de discursos quando nao e domingo com discursos"
      - "CR-24: Corrigiu dropdown ignorando selecao"
      - "CR-56: Corrigiu 'speeches' nao persistido no DB (CHECK constraint + filtro)"
      - "CR-68: Corrigiu revert de selecao de tipo (race condition optimistic update)"

  - id: F008
    name: "Speech Management & Assignment"
    status: implemented
    rfs: [RF-12, RF-13, RF-14, RF-15, RF-16]
    description: >
      3 slots de discurso por domingo (1o, 2o, 3o Discurso). Ciclo de status:
      Nao-designado -> Designado/Nao-Convidado -> Convidado -> Confirmado | Desistiu.
      LEDs 3D com animacao indicam status (apenas para domingos tipo 'speeches' -
      CR-101). Bispado designa pela aba Discursos/Home.
      Secretario altera status. Scroll infinito (12 meses passado/futuro, +6 ao scroll).
      Snapshot pattern para nome/telefone/tema.
    modified_by_crs: [5]
    notes:
      - "CR-5: Corrigiu labels de 'VAGA 1o' para '1o Discurso'"

  # ---------------------------------------------------------------------------
  # Tabs & Views (F009, F012, F016)
  # ---------------------------------------------------------------------------

  - id: F009
    name: "Home Tab"
    status: implemented
    rfs: [RF-18, RF-19, RF-20]
    description: >
      Aba Home com 3 proximos domingos. Bispado ve "Proximas designacoes"
      (4o+ domingo pendente). Secretario ve "Gerenciamento de convites".
      Observador ve somente leitura. Titulo "Agenda da Reuniao Sacramental"
      acima do botao Iniciar (visivel apenas domingos). Botao "Iniciar
      Reuniao Sacramental" abre Modo Apresentacao.
    modified_by_crs: [1, 3]
    notes:
      - "CR-1: Adicionou titulo para botao 'Iniciar Reuniao Sacramental'"
      - "CR-3: Corrigiu 'Nenhum resultado encontrado' ao iniciar reuniao"

  - id: F012
    name: "Meeting Agenda Management"
    status: implemented
    rfs: [RF-21, RF-21.1, RF-21.2, RF-21.3, RF-21.4]
    description: >
      Aba Agenda para configurar a agenda completa da reuniao sacramental.
      Secoes: Boas-vindas/Anuncios/Reconhecimentos, Designacoes/Sacramento,
      Primeiros Discursos, Ultimo Discurso. Secoes dinamicas para reunioes
      especiais (Testemunhos, Apresentacao da Primaria). Campos: presidir,
      dirigir, reconhecer, pianista, regente, hinos, oracoes, apoios,
      anuncios, apresentacao especial. Auto-save com debounce >= 500ms.
      Designacao de discursantes via Agenda (Bispado + Secretario).
    modified_by_crs: [25, 27, 28, 29, 30, 36, 69, 75]
    notes:
      - "CR-25: Corrigiu scroll inicial mostrando data passada"
      - "CR-27: Corrigiu letter-eating e resized campo de anuncios (3 linhas)"
      - "CR-28: Dialogo de hinos usa 2/3 da tela"
      - "CR-29: Renomeou labels das secoes"
      - "CR-30: Renomeou 'Numero musical' para 'Apresentacao especial'"
      - "CR-36: Definiu debounce 500ms para auto-save"
      - "CR-69: Renomeou labels adicionais (Dirigindo, Apoios, Reconhecendo a Presenca)"
      - "CR-75: Domingos sem agenda aparecem como cards nao-expansiveis"

  - id: F016
    name: "Presentation Mode"
    status: implemented
    rfs: [RF-25]
    description: >
      Tela full-screen read-only com cards acordeao mostrando a agenda
      completa da reuniao. Header com data completa no idioma da ala
      (ex: "Domingo, 16 de Fevereiro de 2026"). Botao de fechar (nao
      botao de voltar - excecao da convencao CR-33).
    modified_by_crs: [38]
    notes:
      - "CR-38: Definiu formato de data no header do Modo Apresentacao"

  # ---------------------------------------------------------------------------
  # Communication (F010, F017, F024)
  # ---------------------------------------------------------------------------

  - id: F010
    name: "WhatsApp Integration"
    status: implemented
    rfs: [RF-20]
    description: >
      Abertura de links wa.me com mensagem pre-preenchida a partir do template
      configuravel da ala. Placeholders validos: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Template editavel com preview. Placeholders
      clicaveis para inserir no texto (CR-15).
    modified_by_crs: [12, 13, 14, 15, 16, 17, 35, 63]
    notes:
      - "CR-12: Renomeou titulo da tela"
      - "CR-13: Removeu placeholder invalido {tema}"
      - "CR-14: Definiu template padrao correto"
      - "CR-15: Placeholders clicaveis"
      - "CR-16: Melhorou uso de espaco na tela"
      - "CR-17: Adicionou botao de voltar"
      - "CR-35: Removeu placeholder invalido {duracao}"
      - "CR-63: Corrigiu template padrao nao respeitado (null vs vazio)"

  - id: F017
    name: "Push Notifications"
    status: implemented
    rfs: [RF-26, RF-27, RF-28, RF-29, RF-30, RF-31, RF-32]
    description: >
      Push notifications via Expo Push Notifications. Tipos: notificacao ao
      secretario apos designacao (5 min, agrupada por domingo), lembrete
      semanal para bispado/secretario, notificacao imediata ao confirmar ou
      desistir. Fuso horario configuravel por ala. Edge Function agendada
      (cron) processa fila. Observadores nao recebem push.
    modified_by_crs: [52, 53]
    notes:
      - "CR-52/53: Conectou codigo morto (useRealtimeSync, useConnection, useNotifications)"

  - id: F024
    name: "WhatsApp Template"
    status: implemented
    rfs: [RF-20]
    description: >
      Tela de configuracao do template WhatsApp com editor, preview e chips
      de placeholders. 6 placeholders validos: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Template padrao configurado na criacao
      da ala. Botao de voltar no header.
    modified_by_crs: [12, 13, 14, 15, 16, 17, 35, 63]
    notes:
      - "Mesmas CRs que F010 (compartilham tela de template)"

  # ---------------------------------------------------------------------------
  # UX Improvements (F026)
  # ---------------------------------------------------------------------------

  - id: F026
    name: "Members Screen Explanatory Texts (i18n)"
    status: implemented
    rfs: []
    description: >
      Textos explicativos na tela de Membros para guiar o usuario. Inclui:
      descricao abaixo do titulo explicando funcionalidades da tela (adicionar,
      editar, remover membros via swipe), e texto de ajuda perto dos botoes CSV
      explicando exportacao, importacao (sobrescreve toda a lista) e formato
      esperado do arquivo (Nome, Telefone Completo com codigo do pais).
      Todos os textos traduzidos em pt-BR, en, es.
    modified_by_crs: [80]
    notes:
      - "CR-80: Adiciona textos explicativos com i18n (pt-BR, en, es)"
      - "Segue padrao visual de subtitle/description usado em telas de auth"
      - "CSV help text so visivel quando canImport=true"

  # ---------------------------------------------------------------------------
  # Batch 6 Phase 1 (F027-F031)
  # ---------------------------------------------------------------------------

  - id: F027
    name: "Explicit Save/Cancel for Members and Topics"
    status: implemented
    rfs: []
    description: >
      Substituir auto-save no blur por botoes explicitos Salvar e Cancelar
      nos editores de membros (MemberEditor) e temas (TopicEditor). Botoes
      posicionados abaixo dos campos, alinhados a direita. Cancelar descarta
      alteracoes, Salvar valida e persiste.
    modified_by_crs: [83]
    notes:
      - "CR-83: Salvar somente ao clicar Salvar, adicionar botao Cancelar"
      - "Usa i18n keys existentes: common.save e common.cancel"
      - "Afeta members.tsx e topics.tsx"

  - id: F028
    name: "Search Clear Button (X) for All Search Fields"
    status: implemented
    rfs: []
    description: >
      Adicionar botao X na direita de todos os campos de search do app para
      limpar a string de busca e restaurar a lista completa. Componente
      reutilizavel SearchInput. 10 campos afetados: members, topics, history,
      timezone, HymnSelector, MemberSelectorModal, TopicSelectorModal,
      PrayerSelector, ActorSelector, AgendaForm.
    modified_by_crs: [84]
    notes:
      - "CR-84: Botao X padrao para todos os campos de search"
      - "Criar componente SearchInput reutilizavel"
      - "X visivel apenas quando campo tem texto"

  - id: F029
    name: "Complete International Country Codes List"
    status: implemented
    rfs: []
    description: >
      Expandir a lista de codigos internacionais de telefone (COUNTRY_CODES)
      de 21 para ~150+ paises. Extrair para arquivo compartilhado
      (src/lib/countryCodes.ts) e atualizar splitPhoneNumber em csvUtils.ts
      para usar a mesma fonte. Manter emojis de bandeira Unicode.
    modified_by_crs: [85]
    notes:
      - "CR-85: Lista de codigos internacionais incompleta"
      - "Extrair para src/lib/countryCodes.ts (single source of truth)"
      - "Atualizar splitPhoneNumber para usar mesma lista"

  - id: F030
    name: "CSV Import Confirmation Dialog"
    status: implemented
    rfs: []
    description: >
      Adicionar dialogo de confirmacao (Alert.alert) ao clicar em Importar CSV,
      ANTES de abrir o file picker. O dialogo avisa que a importacao substitui
      toda a lista de membros e que designacoes existentes nao sao afetadas.
      Textos i18n em pt-BR, en, es.
    modified_by_crs: [86]
    notes:
      - "CR-86: Dialogo de confirmacao antes de importar CSV"
      - "Usa padrao Alert.alert ja existente no app"
      - "Novas i18n keys: members.importConfirmTitle, members.importConfirmMessage"

  - id: F031
    name: "Fix Delete Button for Members and Topics"
    status: implemented
    rfs: []
    description: >
      Fix do bug onde o botao Delete revelado pelo swipe-to-reveal no
      SwipeableCard nao faz nada quando pressionado. O botao Edit funciona
      corretamente. Causa provavel: GestureDetector intercepta evento de
      toque na area do botao Delete (rightmost). Fix no SwipeableCard.tsx.
    modified_by_crs: [90]
    notes:
      - "CR-90: Bug - botao Delete nao faz nada"
      - "Edit funciona com padrao identico de codigo"
      - "Fix no componente compartilhado SwipeableCard.tsx"

  # ---------------------------------------------------------------------------
  # Batch 6 Phase 2 (F032-F034)
  # ---------------------------------------------------------------------------

  - id: F032
    name: "Swipe Action Icons (pencil/trash) instead of Text"
    status: implemented
    rfs: []
    description: >
      Substituir texto dos botoes de acao do SwipeableCard ("Editar"/"Excluir")
      por icones Unicode: lapis (pencil) para editar, lixeira (wastebasket)
      para excluir. Manter accessibilityLabel com texto descritivo. Nao
      instalar biblioteca de icones.
    modified_by_crs: [87]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-87: Trocar texto por icones nos botoes de swipe"
      - "Usar caracteres Unicode (nao icon library)"
      - "accessibilityLabel mantem texto para screen readers"
      - "Unico arquivo afetado: SwipeableCard.tsx"

  - id: F033
    name: "Topics Screen Explanatory Text"
    status: implemented
    rfs: []
    description: >
      Adicionar texto explicativo na tela de Temas, abaixo do header, explicando
      temas da ala vs colecoes e o mecanismo de ativar/desativar colecoes.
      Segue padrao visual de CR-80 (F026). Textos i18n em pt-BR, en, es.
    modified_by_crs: [88]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-88: Texto explicativo na tela de temas"
      - "Segue padrao visual de F026 (fontSize 13, textSecondary, center)"
      - "Explica ativar/desativar colecoes"
      - "Adiciona tambem key topics.noTopics para uso por F034"

  - id: F034
    name: "Collection Topics View (expand/collapse read-only list)"
    status: implemented
    rfs: []
    description: >
      Ao clicar numa colecao na tela de Temas, expandir inline e mostrar todos
      os temas daquela colecao em lista simples read-only. Padrao acordeao
      (uma colecao expandida por vez). Busca lazy de general_topics por
      collection_id. Loading state, empty state, Switch independente do tap.
    modified_by_crs: [89]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-89: Mostrar temas de colecao ao clicar"
      - "Padrao expand/collapse inline (acordeao)"
      - "Novo hook useCollectionTopics em useTopics.ts"
      - "Switch toggle independente do tap na colecao"
      - "Depende de F033 para key topics.noTopics"

  # ---------------------------------------------------------------------------
  # Batch 7 Phase 1 (F035-F039) - Bug Fixes
  # ---------------------------------------------------------------------------

  - id: F035
    name: "Fix RLS policy error on notification_queue"
    status: pending
    rfs: []
    description: >
      Fix do bug onde designar um orador causa erro de RLS na tabela
      notification_queue. O trigger enqueue_speech_notification() nao usa
      SECURITY DEFINER, executando no contexto do usuario autenticado que
      nao tem acesso a notification_queue. Fix: adicionar SECURITY DEFINER
      a funcao de trigger.
    modified_by_crs: [91]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-91: Bug critico - erro de RLS ao designar orador"
      - "Trigger deve usar SECURITY DEFINER para bypass de RLS"
      - "notification_queue permanece sem policies de client"

  - id: F036
    name: "Fix duplicate key error in country dropdown"
    status: pending
    rfs: []
    description: >
      Fix do warning de React "duplicate key" no dropdown de codigos de pais.
      keyExtractor usa item.code mas existem duplicatas legitimas (+1 US/Canada,
      +7 Russia/Kazakhstan). Fix: usar item.label como key (unico).
    modified_by_crs: [92]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-92: Warning de duplicate key no FlatList de COUNTRY_CODES"
      - "item.label e unico (ex: 'United States (+1)' vs 'Canada (+1)')"
      - "Unico arquivo afetado: members.tsx (keyExtractor)"

  - id: F037
    name: "Change deep link protocol to sacrmeetman://"
    status: pending
    rfs: []
    description: >
      Alterar protocolo de deep link de wardmanager:// para sacrmeetman://.
      Afeta app.json (scheme) e create-invitation Edge Function (construcao
      do deep link). Deep links NAO funcionam no Expo Go (comportamento
      esperado, apenas em builds standalone).
    modified_by_crs: [93]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-93: Protocolo wardmanager:// deve ser sacrmeetman://"
      - "Alterar app.json scheme e Edge Function create-invitation"
      - "Deep links com custom schemes NAO funcionam no Expo Go (esperado)"

  - id: F038
    name: "Fix speech fields not hiding on sunday type change"
    status: pending
    rfs: []
    description: >
      Fix do bug onde speech slots (posicoes 1, 2, 3) continuam visiveis ao
      mudar tipo de domingo na aba Discursos. O codigo usava
      isExcludedFromAgenda() (que so filtra general_conference e
      stake_conference). Fix: verificar se tipo === 'speeches' diretamente.
    modified_by_crs: [95]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-95: Speech fields nao somem ao mudar tipo de domingo"
      - "Correcao completa do que CR-7 fez parcialmente"
      - "Usa verificacao direta de tipo === 'speeches' ao inves de isExcludedFromAgenda"

  - id: F039
    name: "Fix prayer fields not clickable"
    status: pending
    rfs: []
    description: >
      Fix do bug onde campos de oracao (abertura e fechamento) na aba Agenda
      nao respondem ao clique. PrayerSelector nao recebe prop 'visible' para
      auto-abrir modal (como ActorSelector e HymnSelectorModal fazem).
      Fix: adicionar props 'visible' e 'onClose' ao PrayerSelector.
    modified_by_crs: [98]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-98: Campos de oracao nao sao clicaveis"
      - "PrayerSelector precisa de props visible + onClose (padrao ActorSelector)"
      - "Completa integracao que CR-74 iniciou"

  # ---------------------------------------------------------------------------
  # Batch 7 Phase 2 (F040-F044) - UX & Features
  # ---------------------------------------------------------------------------

  - id: F040
    name: "Update default WhatsApp invitation template (i18n)"
    status: pending
    rfs: []
    description: >
      Adicionar templates padrao de convite WhatsApp por idioma (en, es alem do
      pt-BR existente). Ao gerar convite sem template customizado, usar o template
      do idioma da ala como default. Template existente pt-BR ja inclui todos os
      6 placeholders ({nome}, {data}, {posicao}, {colecao}, {titulo}, {link}).
    modified_by_crs: [94]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-94: Trocar template padrao para incluir posicao, tema e link"
      - "Template pt-BR atual ja satisfaz; melhoria e templates i18n"
      - "Novos exports: DEFAULT_TEMPLATE_EN, DEFAULT_TEMPLATE_ES"
      - "buildWhatsAppUrl agora aceita idioma da ala como parametro"

  - id: F041
    name: "Search fields fixed at top in Settings screens"
    status: pending
    rfs: []
    description: >
      Fixar campos de busca (SearchInput) no topo das telas de Settings de
      Membros e Temas, para que nao scrollem junto com o conteudo. Os selectors
      modais (MemberSelectorModal, TopicSelectorModal, ActorSelector,
      HymnSelectorModal) ja implementam esse padrao corretamente.
    modified_by_crs: [96]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-96: Campos de busca fixos no topo com espaco preenchido"
      - "Fix necessario apenas em members.tsx e topics.tsx (Settings)"
      - "Modais ja tem search fixo no header"

  - id: F042
    name: "Multi-select for Reconhecendo a Presenca field"
    status: pending
    rfs: []
    description: >
      Permitir selecao multipla de nomes no campo 'Reconhecendo a Presenca' da
      agenda. Atualmente cada selecao substitui a anterior. O banco de dados ja
      suporta array (string[]). Implementar toggle (add/remove) no handler de
      selecao, indicador visual no ActorSelector, e manter modal aberto para
      permitir selecoes adicionais.
    modified_by_crs: [97]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-97: Campo Reconhecendo deve permitir selecao multipla"
      - "DB ja suporta array (recognized_names: string[])"
      - "ActorSelector precisa de modo multi-select"
      - "Modal nao fecha apos selecao no modo multi-select"

  - id: F043
    name: "Change speech labels from Orador to Discurso"
    status: pending
    rfs: []
    description: >
      Alterar labels de discursantes na edicao de agenda e Modo Apresentacao
      de '1o Orador'/'2o Orador'/'3o Orador' para '1o Discurso'/'2o Discurso'/
      '3o Discurso'. Alterar i18n key 'speeches.speaker' de 'Orador' para
      'Discurso' (pt-BR), 'Speaker' para 'Speech' (en), 'Orador' para
      'Discurso' (es).
    modified_by_crs: [99]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-99: Labels '1o Orador' -> '1o Discurso' na agenda"
      - "Afeta AgendaForm.tsx e usePresentationMode.ts"
      - "Alterar valor da i18n key speeches.speaker nos 3 idiomas"
      - "Nao afeta aba Discursos (usa keys diferentes)"

  - id: F044
    name: "Read-only speaker field with last-minute swap"
    status: pending
    rfs: []
    description: >
      Campos de discursante na aba Agenda passam a ser read-only por padrao,
      mostrando o nome designado. Icone de lapis permite 'Troca de Ultima Hora':
      campo vira TextInput manual. Icone X reverte ao nome original designado.
      Override persistido em novos campos speaker_*_override na tabela
      sunday_agendas. Nao altera a designacao na tabela speeches.
    modified_by_crs: [100]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-100: Campo discursante read-only com icone de edicao"
      - "Nova migracao DB: speaker_1/2/3_override em sunday_agendas"
      - "Override nao altera tabela speeches (extensao do snapshot pattern)"
      - "Modo Apresentacao usa override quando existir"

  # ---------------------------------------------------------------------------
  # Batch 8 Phase 1 (F045-F049) - Display Fixes & WhatsApp Template
  # ---------------------------------------------------------------------------

  - id: F045
    name: "Hide status LEDs on non-speech Sundays"
    status: pending
    rfs: []
    description: >
      Na aba Discursos e no Home, os 3 LEDs de status de discurso sao renderizados
      incondicionalmente. Quando o domingo nao e do tipo 'speeches', os LEDs nao
      tem significado e nao devem ser mostrados. Fix: condicionar renderizacao dos
      LEDs a isSpeechesType no SundayCard.tsx.
    modified_by_crs: [101]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-101: LEDs renderizados incondicionalmente em SundayCard.tsx"
      - "Flag isSpeechesType ja existe (linha 269), basta usar para condicionar LEDs"
      - "Fix aplica-se automaticamente a speeches.tsx e NextSundaysSection.tsx"

  - id: F046
    name: "Hide exception label for speech Sundays in Agenda"
    status: pending
    rfs: []
    description: >
      Na aba Agenda, o label amarelo de excecao aparece para TODOS os domingos
      com registro em sunday_exceptions, incluindo domingos do tipo 'speeches'.
      Apos CR-56, todo domingo tem excecao persistida, gerando label "Discursos"
      redundante. Fix: nao exibir label quando exception.reason === 'speeches'.
    modified_by_crs: [102]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-102: exceptionLabel calculado para todos, incluindo reason='speeches'"
      - "Apos CR-56, todo domingo tem excecao, speech Sundays mostram label indesejado"
      - "Fix: filtrar 'speeches' no calculo de exceptionLabel"

  - id: F047
    name: "Fix WhatsApp template initialization in Settings"
    status: pending
    rfs: []
    description: >
      Tela de configuracoes WhatsApp inicializa template apenas do valor no DB.
      Se DB for null, campo fica vazio ao inves de mostrar template padrao
      (getDefaultTemplate). O envio via botao WhatsApp funciona corretamente
      pois buildWhatsAppUrl faz fallback. Fix: importar getDefaultTemplate e
      usar como fallback quando DB e null, respeitando idioma da ala.
    modified_by_crs: [103]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-103: Template inicializado apenas de ward.whatsapp_template (DB)"
      - "Sem import/fallback para getDefaultTemplate() de whatsappUtils.ts"
      - "Adicionar 'language' a query de ward para selecionar template correto"

  - id: F048
    name: "Fix WhatsApp message variables (collection, link, quotes, date)"
    status: pending
    rfs: []
    description: >
      Ao enviar convite via WhatsApp na secao de Gerenciamento de Convites, a
      mensagem tem 4 problemas: (1) titulo sem aspas, (2) colecao nao passada,
      (3) link nao passado, (4) data em formato compacto "22 FEV" ao inves de
      human-readable. Fix: passar collection e link do speech, trocar formatDate
      por formatDateHumanReadable, adicionar aspas ao redor de {titulo} nos
      templates padrao.
    modified_by_crs: [104, 108]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-104: WhatsAppVariables missing collection e link; template sem aspas em {titulo}"
      - "CR-108: formatDate() retorna '22 FEV', deve usar formatDateHumanReadable()"
      - "Alterar templates padrao para usar '\"{titulo}\"' com aspas"
      - "Afeta InviteManagementSection.tsx e whatsappUtils.ts"

  - id: F049
    name: "Fix speech slots not showing in Home NextSundaysSection"
    status: pending
    rfs: []
    description: >
      Na secao "Proximas Designacoes" do Home, cards de domingo nao expandem para
      mostrar SpeechSlots. Condicao !entry.exception bloqueia renderizacao pois
      apos CR-56 todos os domingos tem excecao. Fix: usar padrao de speeches.tsx
      (!exception || exception.reason === 'speeches').
    modified_by_crs: [109]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-109: Condicao !entry.exception sempre false apos CR-56"
      - "Padrao correto ja existe em speeches.tsx:276"
      - "Replicar condicao (!exception || exception.reason === 'speeches')"

  # ---------------------------------------------------------------------------
  # Batch 8 Phase 2 (F050-F054) - Invite Management UX
  # ---------------------------------------------------------------------------

  - id: F050
    name: "Replace WhatsApp text button with icon and status button with three-dots"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites (InviteManagementSection), substituir
      botao texto "WhatsApp" por icone do WhatsApp (SVG inline ou Unicode) e
      botao "Alterar status" por icone de tres pontinhos (Unicode U+22EE vertical
      ellipsis). Sem biblioteca de icones (DD-25).
    modified_by_crs: [105]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-105: Substituir texto por icones nos botoes de acao do invite row"
      - "WhatsApp: SVG inline ou emoji. Tres pontinhos: U+22EE"
      - "Manter accessibilityLabel com texto descritivo"
      - "Unico arquivo afetado: InviteManagementSection.tsx"

  - id: F051
    name: "Replace Alert with custom dropdown for invite status actions"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites, substituir Alert.alert nativo por
      dropdown/modal customizado com opcoes: Ver conversa (icone WhatsApp),
      Designado/Confirmado (LED verde), Designado/Nao-Convidado (LED amarelo),
      Desistiu (LED vermelho), Cancelar. Nova opcao "Designado/Nao-Convidado"
      permite reverter convite. Segue padrao visual do StatusChangeModal.
    modified_by_crs: [106]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-106: Dropdown customizado para opcoes de status de convite"
      - "Novo componente InviteActionDropdown.tsx"
      - "Nova opcao: assigned_not_invited (reverter convite)"
      - "Nova i18n key: speeches.viewConversation ('Ver conversa')"
      - "Ativado pelo botao tres pontinhos de F050"

  - id: F052
    name: "Show speech number with LED and status name in invite card second line"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites, alterar a segunda linha de cada
      invite row de apenas "1o" para o formato completo:
      "1o Discurso - <StatusLED> <nome do status traduzido>".
      Importar StatusLED, usar t('speeches.slot') e t('speechStatus.*').
    modified_by_crs: [107]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-107: Formato completo na segunda linha do invite row"
      - "Importar StatusLED com tamanho 10-12px (inline)"
      - "Layout: flexDirection row com alignItems center"
      - "Unico arquivo afetado: InviteManagementSection.tsx"

  - id: F053
    name: "Show invite management section for bishopric role"
    status: pending
    rfs: []
    description: >
      Adicionar permissao 'home:invite_mgmt' ao role bishopric em permissions.ts.
      Atualmente apenas secretary tem essa permissao. Bispado passara a ver a
      secao de Gerenciamento de Convites na Home, alem da secao de Proximas
      Designacoes que ja possui.
    modified_by_crs: [110]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-110: Bispado tambem ve secao de gerenciamento de convites"
      - "Unico arquivo afetado: permissions.ts (adicionar 'home:invite_mgmt' ao bishopric Set)"
      - "InviteManagementSection.tsx nao precisa alterar (guard ja usa hasPermission)"

  - id: F054
    name: "Increase spacing between LED and X button, increase X icon size"
    status: pending
    rfs: []
    description: >
      No SpeechSlot.tsx (card de domingo expandido), aumentar espaco entre
      StatusLED e botao X (remover designacao) de gap 8 para 12-16px, e
      aumentar fontSize do icone X de 20 para 24-26px.
    modified_by_crs: [111]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-111: Mais espaco entre LED e X, icone X maior"
      - "gap da row e/ou marginLeft no removeButton"
      - "fontSize do X de 20 para 24+"
      - "Unico arquivo afetado: SpeechSlot.tsx"

  # ---------------------------------------------------------------------------
  # Infrastructure (F011, F020-F023)
  # ---------------------------------------------------------------------------

  - id: F011
    name: "Real-time Sync"
    status: implemented
    rfs: [RF-17, RN-08]
    description: >
      Sincronizacao entre abas em ate 5 segundos via Supabase Realtime
      (WebSocket). Polling fallback a cada 2.5s quando WebSocket desconecta.
      Tabelas sincronizadas: members, speeches, sunday_exceptions,
      meeting_actors, sunday_agendas, ward_topics.
    modified_by_crs: [52]
    notes:
      - "CR-52: Conectou useRealtimeSync que era codigo morto"

  - id: F020
    name: "Internationalization (i18n)"
    status: implemented
    rfs: [RNF-08, RF-08.3]
    description: >
      Suporte a 3 idiomas: pt-BR, en, es via react-i18next. Idioma da ala
      configuravel. Ao iniciar o app, usa idioma da ala (se autenticado) ou
      idioma do dispositivo (fallback). Colecoes gerais filtradas por idioma.
      Todos os textos, labels, erros e mensagens traduzidos.
    modified_by_crs: [2, 11, 59]
    notes:
      - "CR-2: Corrigiu idioma nao aplicado apos criar ala"
      - "CR-11: Corrigiu idioma sempre em ingles ao iniciar Expo Go"
      - "CR-59: Internacionalizou ErrorBoundary e strings hardcoded"

  - id: F021
    name: "Dark/Light Mode"
    status: implemented
    rfs: [RNF-02]
    description: >
      Suporte a Automatico (deteccao do sistema), Light e Dark mode.
      Tela de selecao em Configuracoes. Toggle instantaneo (CR-65):
      estado atualizado imediatamente, persistencia assincrona via
      AsyncStorage. Todos os componentes usam cores do tema.
    modified_by_crs: [10, 65]
    notes:
      - "CR-10: Implementou tela de selecao de tema (antes onPress vazio)"
      - "CR-65: Corrigiu delay no toggle de tema (assincrono)"

  - id: F022
    name: "Offline Support"
    status: implemented
    rfs: [RNF-05]
    description: >
      Deteccao de conexao via useConnection. OfflineBanner exibido quando
      offline. Fila de mutacoes em AsyncStorage com last-write-wins.
      Sincronizacao ao reconectar.
    modified_by_crs: [52]
    notes:
      - "CR-52: Conectou useConnection e OfflineBanner que eram codigo morto"

  - id: F023
    name: "Permissions & Role-based Access"
    status: implemented
    rfs: [RN-11]
    description: >
      3 roles: bishopric, secretary, observer. Permissoes gerenciadas via
      lib/permissions.ts. Secretary pode designar via Agenda (excecao CR-31)
      mas nao via Discursos/Home. Secretary tem acesso a gerenciamento de
      usuarios (CR-23). Regra de auto-preside removida (CR-71).
    modified_by_crs: [23, 31, 37, 71]
    notes:
      - "CR-23: Secretary ganhou permissao settings:users"
      - "CR-31: Corrigiu contradicao ASM-009 (Secretary pode designar via Agenda)"
      - "CR-37: Atualizou docs para refletir CR-23"
      - "CR-71: Removeu regra de que ator que dirige tambem pode presidir"

  # ---------------------------------------------------------------------------
  # Admin & Audit (F013-F015, F018-F019)
  # ---------------------------------------------------------------------------

  - id: F013
    name: "Meeting Actors Management"
    status: implemented
    rfs: [RF-22]
    description: >
      Gestao inline de atores dentro dos cards da agenda (CR-26). Ao clicar
      em campo de ator (presidir, dirigir, pianista, regente), abre dialogo
      bottom-sheet 2/3 da tela com busca, lista filtrada por role, e opcoes
      de adicionar (so nome, role inferido do campo), editar nome e excluir.
      A palavra "ator/atores" NAO aparece na UI. Tela separada de atores
      em Configuracoes foi removida. Icones de edicao/exclusao com tamanho
      adequado (CR-70). Reconhecendo a Presenca usa ActorSelector (CR-73).
    modified_by_crs: [26, 34, 70, 71, 72, 73]
    notes:
      - "CR-26: Redesign completo - gestao inline na agenda"
      - "CR-34: Atualizou docs removendo checkboxes"
      - "CR-70: Aumentou icones de edicao/exclusao"
      - "CR-71: Removeu regra auto-preside (can_conduct nao implica can_preside)"
      - "CR-72: Bispado registrado auto-adicionado como ator (can_preside+can_conduct)"
      - "CR-73: Campo Reconhecendo usa ActorSelector com filtro can_recognize"

  - id: F014
    name: "Hymns Catalog & Import"
    status: implemented
    rfs: [RF-23, RF-23.1]
    description: >
      Tabela global de hinos da Igreja com suporte a i18n. Importacao via
      script CLI (pnpm import-hymns). Seletor de hinos em dialogo 2/3 da
      tela com busca por numero ou titulo. Subset de hinos sacramentais
      (is_sacramental=true). ~300 hinos por idioma.
    modified_by_crs: [28, 51]
    notes:
      - "CR-28: Dialogo de hinos usa 2/3 da tela"
      - "CR-51: Criou script CLI pnpm import-hymns"

  - id: F015
    name: "Prayer Selection"
    status: implemented
    rfs: [RF-24]
    description: >
      Campos de oracao de abertura e fechamento na agenda. Permite selecionar
      membro da ala (MemberSelectorModal) OU digitar nome customizado (CR-74).
      Nome customizado persistido apenas em *_name sem criar membro.
      *_member_id = null quando nome customizado.
    modified_by_crs: [74]
    notes:
      - "CR-74: Adicionou suporte a nomes customizados para oracoes"

  - id: F018
    name: "User Management (CRUD)"
    status: implemented
    rfs: [RF-33, RF-34, RF-35, RF-36]
    description: >
      Tela de gerenciamento de usuarios em Configuracoes. Listar, editar role,
      excluir usuarios. Convidar novos usuarios por link. Visivel para
      Bispado e Secretario (CR-23). Gerenciado via 6 Edge Functions:
      register-first-user, create-invitation, register-invited-user,
      list-users, update-user-role, delete-user.
    modified_by_crs: [23, 37, 64]
    notes:
      - "CR-23: Secretario ganhou acesso a tela de usuarios"
      - "CR-37: Docs atualizados para refletir CR-23"
      - "CR-64: Corrigiu erro vermelho na tela de usuarios para Secretario"

  - id: F019
    name: "Activity Log (History)"
    status: implemented
    rfs: [RF-37]
    description: >
      Historico de acoes read-only com busca. Retencao de 2 anos.
      Descricoes human-readable no idioma da ala (CR-22). Action types:
      member:create/update/delete/import, topic:create/update/delete,
      collection:activate/deactivate, sunday_type:change,
      speech:assign/unassign/status_change, user:*, settings:*.
    modified_by_crs: [18, 19, 22]
    notes:
      - "CR-18: Corrigiu mudanca de tipo de domingo nao logada"
      - "CR-19: Adicionou botao de voltar na tela"
      - "CR-22: Tornou descricoes human-readable"

# =============================================================================
# PENDING CHANGE REQUESTS (16 CRs pendentes de implementacao - Batch 7 Phase 2 + Batch 8 Phase 1 + Batch 8 Phase 2)
# =============================================================================

pending_crs:

  # --- Batch 7 Phase 2 (Features & UX) ---

  - id: 94
    type: ui
    area: "WhatsApp Template (F010, F024)"
    feature_id: F040
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [14, 63]
    description: >
      Adicionar templates padrao de convite WhatsApp por idioma (en, es).
      Template pt-BR existente ja satisfaz requisitos. Melhoria: usar
      template do idioma da ala como default.
    acceptance_criteria:
      - "Templates padrao existem para pt-BR, en, es"
      - "buildWhatsAppUrl usa template do idioma da ala como fallback"
      - "Todos os 6 placeholders presentes em todos os templates"
    files_likely_impacted:
      - src/lib/whatsappUtils.ts
      - src/lib/whatsapp.ts

  - id: 96
    type: ux
    area: "Search fields (Settings)"
    feature_id: F041
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [39, 84]
    description: >
      Campos de busca em Settings de Membros e Temas devem ser fixos no topo,
      nao scrollar com o conteudo. Selectors modais ja implementam corretamente.
    acceptance_criteria:
      - "SearchInput em members.tsx fixo acima do ScrollView/FlatList"
      - "SearchInput em topics.tsx fixo acima do ScrollView/FlatList"
      - "flex:1 para preencher espaco horizontal"
    files_likely_impacted:
      - src/app/(tabs)/settings/members.tsx
      - src/app/(tabs)/settings/topics.tsx

  - id: 97
    type: feature
    area: "Agenda (F012, F013)"
    feature_id: F042
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [73]
    description: >
      Campo 'Reconhecendo a Presenca' deve permitir selecao multipla de nomes.
      Toggle (add/remove) no handler, indicador visual no ActorSelector,
      modal permanece aberto para selecoes adicionais.
    acceptance_criteria:
      - "Selecionar ator adiciona ao array (toggle)"
      - "Atores selecionados indicados visualmente no modal"
      - "Modal nao fecha apos selecao"
      - "Array completo salvo em recognized_names"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/components/ActorSelector.tsx

  - id: 99
    type: ui
    area: "Agenda (F012)"
    feature_id: F043
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [29, 69]
    description: >
      Trocar labels dos discursos na edicao de agenda: '1o Orador' para
      '1o Discurso' (idem 2o e 3o). Alterar i18n key speeches.speaker.
    acceptance_criteria:
      - "pt-BR: '1o Discurso', '2o Discurso', '3o Discurso'"
      - "en: '1st Speech', '2nd Speech', '3rd Speech'"
      - "es: '1er Discurso', '2do Discurso', '3er Discurso'"
      - "Modo Apresentacao tambem usa labels atualizados"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 100
    type: feature
    area: "Agenda (F012)"
    feature_id: F044
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [26]
    description: >
      Campo de discursante read-only com icone de edicao para 'Troca de
      Ultima Hora'. Campo texto manual, icone X para reverter ao designado
      original. Override persistido em sunday_agendas (novos campos).
    acceptance_criteria:
      - "Campo mostra nome designado como read-only"
      - "Icone lapis permite modo edicao (TextInput)"
      - "Icone X reverte ao nome original"
      - "Override persistido em sunday_agendas (speaker_*_override)"
      - "Modo Apresentacao usa override quando existir"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/hooks/usePresentationMode.ts
      - src/types/database.ts
      - supabase/migrations/ (nova migracao)

  # --- Batch 8 Phase 1 (Display Fixes & WhatsApp Template) ---

  - id: 101
    type: bug
    area: "SundayCard (F008, F009)"
    feature_id: F045
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56]
    description: >
      LEDs de status de discurso renderizados incondicionalmente em SundayCard.tsx.
      Devem ser condicionados a isSpeechesType (tipo === 'speeches').
    acceptance_criteria:
      - "LEDs visiveis apenas quando tipo de domingo e 'speeches'"
      - "LEDs ocultos para todos os outros tipos de domingo"
      - "Fix aplica-se na aba Discursos e no Home (NextSundaysSection)"
    files_likely_impacted:
      - src/components/SundayCard.tsx

  - id: 102
    type: bug
    area: "Agenda (F012)"
    feature_id: F046
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56, 75]
    description: >
      Label amarelo de excecao aparece para domingos 'speeches' na aba Agenda.
      Apos CR-56, todo domingo tem excecao persistida, mostrando label redundante.
    acceptance_criteria:
      - "Label amarelo NAO mostrado quando exception.reason === 'speeches'"
      - "Label amarelo mostrado normalmente para outros tipos"
      - "Label 'other' continua mostrando custom_reason"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx

  - id: 103
    type: bug
    area: "WhatsApp Settings (F024)"
    feature_id: F047
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14, 63, 94]
    description: >
      Tela de configuracoes WhatsApp nao faz fallback para getDefaultTemplate()
      quando DB e null. Mostra campo vazio ou template antigo.
    acceptance_criteria:
      - "Template padrao exibido quando DB tem null"
      - "Template do DB exibido quando tem valor customizado"
      - "String vazia respeitada (BR-24)"
      - "Template padrao correto por idioma da ala"
    files_likely_impacted:
      - src/app/(tabs)/settings/whatsapp.tsx

  - id: 104
    type: bug
    area: "WhatsApp Invite (F009, F010)"
    feature_id: F048
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14, 63, 94]
    description: >
      WhatsAppVariables em InviteManagementSection.tsx nao passa collection
      (speech.topic_collection) nem link (speech.topic_link). Templates padrao
      em whatsappUtils.ts nao tem aspas ao redor de {titulo}.
    acceptance_criteria:
      - "collection passado de speech.topic_collection"
      - "link passado de speech.topic_link"
      - "Templates padrao usam '\"{titulo}\"' com aspas"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx
      - src/lib/whatsappUtils.ts

  - id: 108
    type: bug
    area: "WhatsApp Invite date format (F009, F010)"
    feature_id: F048
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14]
    description: >
      Placeholder {data} em InviteManagementSection.tsx usa formatDate() que
      retorna "22 FEV". Deve usar formatDateHumanReadable() para formato
      adequado ao idioma da ala.
    acceptance_criteria:
      - "pt-BR: '22 de Fevereiro de 2026'"
      - "en: 'February 22, 2026'"
      - "es: '22 de Febrero de 2026'"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 109
    type: bug
    area: "Home NextSundaysSection (F009)"
    feature_id: F049
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56, 95]
    description: >
      Condicao !entry.exception em NextSundaysSection.tsx bloqueia SpeechSlots.
      Apos CR-56, todos os domingos tem excecao, impedindo expansao. Usar padrao
      de speeches.tsx: (!exception || exception.reason === 'speeches').
    acceptance_criteria:
      - "SpeechSlots renderizados quando tipo e 'speeches'"
      - "SpeechSlots NAO renderizados para outros tipos"
      - "Consistencia com aba Discursos"
    files_likely_impacted:
      - src/components/NextSundaysSection.tsx

  # --- Batch 8 Phase 2 (Invite Management UX) ---

  - id: 105
    type: ui
    area: "InviteManagementSection (F009)"
    feature_id: F050
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Substituir botao texto "WhatsApp" por icone do WhatsApp e botao
      "Alterar status" por icone de tres pontinhos na secao de convites.
    acceptance_criteria:
      - "Botao not-invited mostra icone WhatsApp (SVG ou Unicode)"
      - "Botao invited mostra tres pontinhos (U+22EE)"
      - "Comportamento onPress inalterado"
      - "accessibilityLabel descritivo nos botoes"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 106
    type: ux
    area: "InviteManagementSection (F009)"
    feature_id: F051
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: [105]
    description: >
      Substituir Alert.alert por dropdown customizado com opcoes:
      Ver conversa, Designado/Confirmado, Designado/Nao-Convidado,
      Desistiu, Cancelar. Cada opcao com indicador visual (LED).
    acceptance_criteria:
      - "Alert.alert NAO usado para status de invited"
      - "Dropdown com 5 opcoes (Ver conversa, Confirmado, Nao-Convidado, Desistiu, Cancelar)"
      - "Nova opcao assigned_not_invited (reverter convite)"
      - "Indicadores visuais (LED colorido) por opcao"
      - "Tap fora fecha dropdown"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx
      - src/components/InviteActionDropdown.tsx

  - id: 107
    type: ui
    area: "InviteManagementSection (F009)"
    feature_id: F052
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Alterar segunda linha do invite row de "1o" para
      "1o Discurso - <LED> <nome do status>".
    acceptance_criteria:
      - "Segunda linha mostra '1o Discurso' completo"
      - "StatusLED inline na segunda linha (10-12px)"
      - "Nome do status traduzido apos o LED"
      - "Layout horizontal alinhado"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 110
    type: feature
    area: "Permissions (F023)"
    feature_id: F053
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Adicionar permissao 'home:invite_mgmt' ao role bishopric para que
      bispado tambem veja a secao de gerenciamento de convites na Home.
    acceptance_criteria:
      - "bishopric tem 'home:invite_mgmt' em PERMISSIONS_MAP"
      - "InviteManagementSection visivel para bishopric"
      - "Observer continua sem acesso"
    files_likely_impacted:
      - src/lib/permissions.ts

  - id: 111
    type: ux
    area: "SpeechSlot (F008)"
    feature_id: F054
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Aumentar espaco entre LED e botao X e aumentar tamanho do icone X
      no SpeechSlot expandido.
    acceptance_criteria:
      - "Gap ou margin entre LED e X maior que 8px"
      - "fontSize do X maior que 20"
      - "hitSlop adequado mantido"
      - "Layout nao quebra em telas estreitas"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

# =============================================================================
# DESIGN DECISIONS (consolidadas de todos os batches)
# =============================================================================

design_decisions:

  - id: DD-01
    title: "Sunday types: lista correta"
    decided_in: CR-6
    decision: >
      Opcoes de tipo de domingo sao exatamente: Domingo com Discursos,
      Reuniao de Testemunho, Conferencia Geral, Conferencia de Estaca,
      Conferencia de Ala, Reuniao Especial da Primaria, Outro (com texto livre).
      Valores no DB: speeches, testimony_meeting, general_conference,
      stake_conference, ward_conference, primary_presentation, other.

  - id: DD-02
    title: "Speeches type persists in DB"
    decided_in: CR-56
    decision: >
      O valor 'speeches' e persistido na tabela sunday_exceptions (nao e
      tratado como ausencia de registro). CHECK constraint inclui 'speeches'.
      Auto-atribuicao em lote persiste 'speeches' para domingos normais.

  - id: DD-03
    title: "Actor management: inline na agenda, sem tela separada"
    decided_in: CR-26
    decision: >
      Gestao de atores e feita inline nos campos da agenda, via dialogo
      bottom-sheet 2/3 da tela. Tela separada em Configuracoes foi removida.
      Ao adicionar ator, apenas nome e pedido; role inferido do campo que
      abriu o dialogo. A palavra "ator/atores" NAO aparece na UI.
    superseded:
      - "RF-22 original com checkboxes de role"
      - "Tela separada Settings > Actors"

  - id: DD-04
    title: "Auto-preside rule removida"
    decided_in: CR-71
    decision: >
      A regra de que can_conduct=true implica can_preside=true foi removida.
      enforceActorRules tornou-se no-op. Ao criar ator pelo campo "Dirigindo",
      apenas can_conduct=true e setado.
    superseded:
      - "Regra original: can_conduct implica can_preside (SPEC.final.md 6.3)"

  - id: DD-05
    title: "Snapshot pattern para dados desnormalizados"
    decided_in: "SPEC original (ADR-005)"
    decision: >
      Discursos armazenam speaker_name, speaker_phone, topic_title, topic_link,
      topic_collection como texto desnormalizado. Agenda armazena nomes de atores,
      oracoes, e reconhecidos como snapshots. Exclusao de membro/tema/ator
      preserva dados historicos. Edicao NAO propaga para registros existentes.

  - id: DD-06
    title: "Debounce 500ms para auto-save em campos de texto"
    decided_in: CR-36
    decision: >
      Campos de texto com auto-save DEVEM usar debounce >= 500ms. Estado
      do input gerenciado localmente (useState), sincronizado com servidor
      apos debounce expirar. Flush on unmount para salvar valores pendentes.
      Implementado via DebouncedTextInput component.

  - id: DD-07
    title: "Global back button convention"
    decided_in: CR-33
    decision: >
      Toda tela acessada via Stack navigation DEVE ter botao de voltar no
      header (top-left). Usa common.back i18n key. Estilo: fontSize 16,
      fontWeight 600, color colors.primary. Excecao: Presentation Mode usa
      botao "fechar". Modais nao precisam de back button.
    implementation: >
      Configurado globalmente via settings/_layout.tsx Stack screenOptions
      headerLeft para evitar repeticao.

  - id: DD-08
    title: "WhatsApp placeholders: 6 validos"
    decided_in: "CR-13, CR-35"
    decision: >
      Placeholders validos no template WhatsApp: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Removidos: {tema} (CR-13), {duracao} (CR-35).
    superseded:
      - "{tema} placeholder (nunca foi valido)"
      - "{duracao} placeholder (coluna duration nao existe no DB)"

  - id: DD-09
    title: "Secretario pode designar via Agenda (excecao ASM-009)"
    decided_in: CR-31
    decision: >
      Secretario NAO designa pela aba Discursos nem Home (speech:assign=false),
      MAS PODE designar pela aba Agenda (agenda:assign_speaker=true). Correcao
      de contradicao no ASM-009 do SPEC.final.md.

  - id: DD-10
    title: "expo-file-system v19: usar new File/Paths API"
    decided_in: "CR-77, CR-78"
    decision: >
      Usar import { File, Paths } from 'expo-file-system' (new class-based API)
      ao inves de legacy API. File.write() para escrita (sincrono), File.text()
      para leitura (async). Paths.cache para diretorio de cache. Legacy API
      (cacheDirectory, EncodingType, readAsStringAsync, writeAsStringAsync)
      esta deprecated e nao e exportada pelo modulo principal.

  - id: DD-11
    title: "GestureHandlerRootView no root layout"
    decided_in: CR-82
    decision: >
      GestureHandlerRootView wrapa toda a app tree em _layout.tsx, dentro do
      ErrorBoundary mas fora de todos os outros providers. style={{ flex: 1 }}.
      Necessario para SwipeableCard funcionar em Members e Topics.

  - id: DD-12
    title: "About screen: disclaimer e autor"
    decided_in: "CR-32, CR-62"
    decision: >
      Tela Sobre exibe: nome do app, versao, autor "Aloisio Almeida Jr",
      disclaimer "Esse nao e um app oficial da Igreja de Jesus Cristo Dos
      Santos Dos Ultimos Dias" (traduzido em 3 idiomas). Link de suporte
      opcional (oculto se nao configurado).

  - id: DD-13
    title: "Agenda section labels (estado final)"
    decided_in: "CR-29, CR-69"
    decision: >
      Secoes da agenda (pt-BR): "Boas-vindas, Anuncios e Reconhecimentos",
      "Designacoes e Sacramento", "Primeiros Discursos", "Ultimo Discurso".
      Reuniao de testemunho: "Testemunhos". Apresentacao da primaria:
      "Apresentacao Especial da Primaria". Labels de campos: "Dirigindo"
      (nao "Conduzindo"), "Apoios e Agradecimentos" (nao "Assuntos da Ala"),
      "Apoios e Agradecimentos da Estaca" (nao "Anuncios de Estaca"),
      "Reconhecendo a Presenca" (nao "Reconhecendo").

  - id: DD-14
    title: "Apresentacao Especial (nao Numero Musical)"
    decided_in: CR-30
    decision: >
      Toggle e campo entre discursos 2 e 3 chama-se "Apresentacao Especial"
      (nao "Numero Musical"). Traduzido em 3 idiomas.

  - id: DD-15
    title: "Prayer fields com nomes customizados"
    decided_in: CR-74
    decision: >
      Campos de oracao permitem selecionar membro da ala OU digitar nome
      customizado. Nome customizado: *_name preenchido, *_member_id = null.
      Membro selecionado: ambos preenchidos. Nome customizado nao cria
      registro na tabela members.

  - id: DD-16
    title: "Sundays sem agenda aparecem como cards nao-expansiveis"
    decided_in: CR-75
    decision: >
      Na aba Agenda, domingos sem registro de agenda aparecem como cards
      nao-expansiveis (sem acordeao). Mostram date block e badge amarelo
      com o tipo de excecao. Inclui general_conference e stake_conference
      (antes excluidos por EXCLUDED_EXCEPTION_TYPES).

  - id: DD-17
    title: "Bishopric auto-added as actors"
    decided_in: CR-72
    decision: >
      Quando usuario com role "bishopric" aceita convite, e automaticamente
      adicionado a meeting_actors com can_preside=true, can_conduct=true,
      can_recognize=false, can_music=false. Se nome ja existe, nao duplica.
      Mudanca de role de bishopric para outro NAO remove o ator.

  - id: DD-18
    title: "Logout via Settings"
    decided_in: CR-43
    decision: >
      Botao "Sair" no final da aba Configuracoes. Estilo destrutivo (vermelho).
      Dialogo de confirmacao antes de executar. Chama supabase.auth.signOut().
      Visivel para todos os roles. Limpa React Query cache.

  - id: DD-19
    title: "Error handling: onError em todas as mutations"
    decided_in: "CR-57, CR-58, CR-59, CR-60, CR-61"
    decision: >
      Todas as mutations tem onError com Alert.alert traduzido. Tabs tem
      QueryErrorView quando query falha. ErrorBoundary internacionalizado
      e com cores do tema. ErrorBoundaries granulares por tab. QueryClient
      com global error handlers, retry:2 para queries (exponential backoff),
      retry:0 para mutations, timeout 30s.

  - id: DD-20
    title: "Presentation mode date format"
    decided_in: CR-38
    decision: >
      Header do Modo Apresentacao exibe data completa no idioma da ala.
      pt-BR: "Domingo, DD de [Mes] de YYYY". en: "Sunday, [Month] DD, YYYY".
      es: "Domingo, DD de [Mes] de YYYY". Usa idioma da ala, nao device locale.

  - id: DD-21
    title: "Explicit Save/Cancel para editores de membros e temas"
    decided_in: CR-83
    decision: >
      MemberEditor e TopicEditor NAO salvam no onBlur. Salvamento e feito
      SOMENTE ao clicar no botao Salvar. Botao Cancelar descarta alteracoes.
      Botoes posicionados abaixo dos campos, alinhados a direita do card.
      Usa i18n keys existentes common.save e common.cancel.
    superseded:
      - "Auto-save no onBlur (comportamento anterior de F003/F005)"

  - id: DD-22
    title: "Componente SearchInput reutilizavel com botao X"
    decided_in: CR-84
    decision: >
      Todos os campos de search do app usam componente SearchInput que inclui
      botao X para limpar busca. X visivel apenas quando campo tem texto.
      Clicar X seta valor para '' e restaura lista completa. Componente e
      drop-in replacement para TextInput com props iguais.

  - id: DD-23
    title: "Country codes: lista completa extraida para arquivo compartilhado"
    decided_in: CR-85
    decision: >
      Lista de codigos internacionais extraida para src/lib/countryCodes.ts
      como single source of truth. COUNTRY_CODES e splitPhoneNumber usam
      a mesma fonte. Lista com ~150+ paises, Brasil (+55) primeiro, demais
      em ordem alfabetica.

  - id: DD-24
    title: "Dialogo de confirmacao antes de importar CSV"
    decided_in: CR-86
    decision: >
      Ao clicar em Importar CSV, exibir Alert.alert ANTES de abrir o file
      picker. Mensagem explica: (1) importacao substitui toda a lista de
      membros, (2) designacoes existentes nao sao afetadas. Confirmar abre
      file picker. Cancelar fecha dialogo.

  - id: DD-25
    title: "Unicode icons para swipe buttons (sem icon library)"
    decided_in: CR-87
    decision: >
      Botoes de acao do SwipeableCard usam caracteres Unicode ao inves de
      texto ou biblioteca de icones. Pencil (U+270F) para Edit, Wastebasket
      (U+1F5D1) para Delete. O app nao tem dependencia de icon library
      instalada; instalar uma para 2 icones seria desproporcional. Props
      editLabel/deleteLabel mantidas para accessibilityLabel.

  - id: DD-26
    title: "Topics screen explanatory text (padrao CR-80)"
    decided_in: CR-88
    decision: >
      Texto descritivo abaixo do header da tela de Temas, seguindo mesmo
      padrao visual de F026/CR-80 (fontSize 13, textAlign center,
      paddingHorizontal 16, color textSecondary). Um unico texto no topo
      da tela cobre ambos os conceitos (temas da ala e colecoes).

  - id: DD-27
    title: "Collection topics expand/collapse (acordeao)"
    decided_in: CR-89
    decision: >
      Ao clicar na area da colecao (fora do Switch), a lista de temas
      expande inline abaixo da linha. Padrao acordeao: uma colecao
      expandida por vez. Switch toggle funciona independentemente.
      Busca lazy de general_topics por collection_id (sob demanda).
      Hook useCollectionTopics em useTopics.ts. Chevron indicator
      (> / v) a esquerda do nome da colecao para indicar tappable.

  - id: DD-28
    title: "SECURITY DEFINER para triggers que acessam tabelas protegidas"
    decided_in: CR-91
    decision: >
      Funcoes de trigger que inserem em tabelas com RLS sem policies de client
      (como notification_queue) devem usar SECURITY DEFINER para executar com
      privilegios do owner. Isso garante que logica server-side (triggers) nao
      e bloqueada pela RLS enquanto mantem a tabela inacessivel a clientes.

  - id: DD-29
    title: "Speech slots condicionados a tipo === 'speeches' (nao isExcludedFromAgenda)"
    decided_in: CR-95
    decision: >
      Na aba Discursos (speeches.tsx), a renderizacao dos speech slots (posicoes
      1, 2, 3) deve verificar diretamente se o tipo de domingo e 'speeches'.
      Nao usar isExcludedFromAgenda() pois essa funcao tem semantica diferente
      (usada na aba Agenda para expandibilidade de cards). A condicao correta:
      !exception || exception.reason === 'speeches'.
    superseded:
      - "Uso de isExcludedFromAgenda em speeches.tsx (filtrava apenas 2 de 6 tipos)"

  - id: DD-30
    title: "Deep link protocol sacrmeetman:// (substituiu wardmanager://)"
    decided_in: CR-93
    decision: >
      O URL scheme do app e 'sacrmeetman'. Deep links gerados pela Edge
      Function create-invitation usam sacrmeetman://invite/${token}.
      Custom URL schemes NAO funcionam no Expo Go (apenas builds standalone).
    superseded:
      - "URL scheme 'wardmanager' (app.json original)"

  - id: DD-31
    title: "PrayerSelector com prop visible (padrao consistente com outros selectors)"
    decided_in: CR-98
    decision: >
      PrayerSelector aceita prop 'visible' para auto-abrir seu modal quando
      renderizado condicionalmente, e 'onClose' para notificar o parent quando
      o modal e fechado. Segue padrao identico a ActorSelector (visible prop)
      e HymnSelectorModal (visible prop). AgendaForm passa visible={true}
      ao renderizar PrayerSelector via selectorModal state.

  - id: DD-32
    title: "Default WhatsApp template por idioma da ala"
    decided_in: CR-94
    decision: >
      Templates padrao de convite WhatsApp existem para cada idioma suportado:
      DEFAULT_TEMPLATE_PT_BR, DEFAULT_TEMPLATE_EN, DEFAULT_TEMPLATE_ES.
      buildWhatsAppUrl recebe idioma da ala e usa template correspondente como
      fallback quando template customizado da ala e null/vazio. Anteriormente,
      sempre usava pt-BR independente do idioma.
    superseded:
      - "Sempre usar DEFAULT_TEMPLATE_PT_BR como fallback (comportamento anterior)"

  - id: DD-33
    title: "Search fixo no topo em telas de Settings (members, topics)"
    decided_in: CR-96
    decision: >
      Nas telas de gerenciamento de Membros e Temas em Settings, o SearchInput
      e posicionado fora do ScrollView/FlatList, fixo no topo da area de
      conteudo. A lista scrollavel fica abaixo. Textos explicativos (F026, F033)
      scrollam junto com o conteudo. Selectors modais ja implementam esse padrao.

  - id: DD-34
    title: "Multi-select para Reconhecendo a Presenca (toggle add/remove)"
    decided_in: CR-97
    decision: >
      O campo 'Reconhecendo a Presenca' usa ActorSelector em modo multi-select:
      selecionar ator que nao esta no array adiciona; selecionar ator que ja esta
      remove (toggle). Modal nao fecha automaticamente apos selecao. Atores
      selecionados tem indicador visual (checkmark ou background). Outros campos
      de ator (presidir, dirigir, pianista, regente) continuam single-select.

  - id: DD-35
    title: "Labels de discurso na agenda: 'Discurso' (nao 'Orador')"
    decided_in: CR-99
    decision: >
      Na edicao de agenda e Modo Apresentacao, labels de discursantes sao
      '1o Discurso', '2o Discurso', '3o Discurso' (pt-BR). Implementado via
      alteracao do valor da i18n key 'speeches.speaker' de 'Orador' para
      'Discurso'. Todos os usos dessa key sao em contexto de Agenda.
    superseded:
      - "Labels '1o Orador', '2o Orador', '3o Orador' (anteriores)"

  - id: DD-36
    title: "Speaker override para troca de ultima hora (campos em sunday_agendas)"
    decided_in: CR-100
    decision: >
      A tabela sunday_agendas recebe campos speaker_1_override, speaker_2_override,
      speaker_3_override (nullable text). Quando preenchido, o override substitui
      o speaker_name da tabela speeches na exibicao da agenda e Modo Apresentacao.
      O override NAO altera a tabela speeches. Icone lapis ativa modo edicao,
      icone X reverte ao nome original. Extensao do snapshot pattern (DD-05).

  - id: DD-37
    title: "LEDs de status condicionados a tipo de domingo 'speeches'"
    decided_in: CR-101
    decision: >
      Os 3 LEDs de status de discurso no SundayCard so sao renderizados quando
      o tipo de domingo e 'speeches' (isSpeechesType === true). Para domingos
      de outros tipos (testemunho, conferencia, etc.), os LEDs sao ocultos pois
      nao ha discursos designados.

  - id: DD-38
    title: "Label de excecao na Agenda exclui tipo 'speeches'"
    decided_in: CR-102
    decision: >
      Na aba Agenda, o label/badge amarelo de tipo de excecao no card contraido
      NAO e exibido quando exception.reason === 'speeches'. O tipo 'speeches' e
      o padrao e nao precisa de destaque visual. Apenas excecoes reais
      (testimony_meeting, general_conference, etc.) exibem o label.

  - id: DD-39
    title: "Settings WhatsApp fallback para getDefaultTemplate quando DB null"
    decided_in: CR-103
    decision: >
      A tela de configuracoes WhatsApp (settings/whatsapp.tsx) inicializa o campo
      template com getDefaultTemplate(idioma_da_ala) quando ward.whatsapp_template
      e null. Se o valor no DB for string vazia, respeita (BR-24). Query de ward
      inclui campo 'language' para selecionar template padrao correto por idioma.
      Garante consistencia entre o que o usuario ve em Settings e o que e enviado.

  - id: DD-40
    title: "WhatsApp variables devem incluir collection e link de speech"
    decided_in: CR-104
    decision: >
      Ao construir WhatsAppVariables em InviteManagementSection.tsx, os campos
      collection e link devem ser preenchidos com speech.topic_collection e
      speech.topic_link respectivamente. Placeholders {colecao} e {link} so
      funcionam se os valores forem passados. Quando nao disponivel, string vazia.

  - id: DD-41
    title: "Aspas duplas ASCII ao redor de {titulo} nos templates padrao"
    decided_in: CR-104
    decision: >
      Os templates padrao de WhatsApp (DEFAULT_TEMPLATE_PT_BR, EN, ES) usam
      aspas duplas ASCII ao redor do placeholder {titulo}: '"{titulo}"'. Isso
      destaca o titulo do tema na mensagem enviada ao discursante.

  - id: DD-42
    title: "Placeholder {data} do WhatsApp usa formatDateHumanReadable"
    decided_in: CR-108
    decision: >
      O placeholder {data} em mensagens WhatsApp de convite usa
      formatDateHumanReadable() ao inves de formatDate(). Formato resultante:
      "22 de Fevereiro de 2026" (pt-BR), "February 22, 2026" (en),
      "22 de Febrero de 2026" (es). Nao inclui dia da semana (reuniao
      sacramental e sempre domingo, seria redundante).

  - id: DD-43
    title: "Condicao de renderizacao de SpeechSlots: (!exception || exception.reason === 'speeches')"
    decided_in: CR-109
    decision: >
      Em todos os componentes que renderizam SpeechSlots (speeches.tsx,
      NextSundaysSection.tsx), a condicao para mostrar os slots e:
      (!exception || exception.reason === 'speeches'). Isso garante que
      slots aparecem tanto para domingos sem excecao (dados antigos) quanto
      para domingos com tipo 'speeches' explicitamente persistido (CR-56).

  - id: DD-44
    title: "Icones em botoes de acao do InviteManagementSection"
    decided_in: CR-105
    decision: >
      Botoes de acao na secao de gerenciamento de convites usam icones ao inves
      de texto: icone do WhatsApp (SVG inline ou emoji) para assigned_not_invited,
      icone de tres pontinhos (Unicode U+22EE vertical ellipsis) para assigned_invited.
      Segue principio DD-25 de nao usar biblioteca de icones.

  - id: DD-45
    title: "Dropdown customizado para opcoes de status de convite"
    decided_in: CR-106
    decision: >
      A interacao de mudanca de status para speeches convidados usa dropdown/modal
      customizado (InviteActionDropdown) ao inves de Alert.alert nativo. Opcoes:
      Ver conversa (abre WhatsApp), Designado/Confirmado, Designado/Nao-Convidado
      (nova - reverte convite), Desistiu, Cancelar. Cada opcao tem indicador
      visual (LED colorido) seguindo padrao do StatusChangeModal.

  - id: DD-46
    title: "Transicao reversa de status: assigned_invited -> assigned_not_invited"
    decided_in: CR-106
    decision: >
      O dropdown de opcoes de convite permite reverter o status de assigned_invited
      para assigned_not_invited via opcao "Designado/Nao-Convidado". Isso estende
      o ciclo de status original com uma transicao reversa para correcao de erros
      ou re-convite.

  - id: DD-47
    title: "Segunda linha do invite row com formato completo"
    decided_in: CR-107
    decision: >
      Cada invite row na secao de gerenciamento de convites mostra na segunda
      linha o formato: "No Discurso - <StatusLED> <nome do status traduzido>".
      StatusLED inline com tamanho 10-12px. Usa t('speeches.slot') para label
      e t('speechStatus.*') para nome do status.

  - id: DD-48
    title: "Bispado ve secao de gerenciamento de convites na Home"
    decided_in: CR-110
    decision: >
      A permissao 'home:invite_mgmt' e concedida ao role bishopric (alem de
      secretary). Bispado passa a ver AMBAS as secoes na Home: NextAssignmentsSection
      (controlada por 'home:next_assignments') e InviteManagementSection (controlada
      por 'home:invite_mgmt'). Observer continua sem acesso.

  - id: DD-49
    title: "Espaco e tamanho aumentados entre LED e X no SpeechSlot"
    decided_in: CR-111
    decision: >
      No SpeechSlot.tsx, o espaco entre StatusLED e botao X (remover designacao)
      e aumentado de 8px para 12-16px, e o fontSize do icone X e aumentado de
      20 para 24-26px para melhorar visualizacao e toque.

# =============================================================================
# BUSINESS RULES (globais, consolidadas)
# =============================================================================

business_rules:

  - id: BR-01
    rule: "Toda tela acessada via Stack DEVE ter botao de voltar no header"
    origin: CR-33
    exceptions: "Presentation Mode (usa botao 'fechar'), modais (dismiss overlay)"

  - id: BR-02
    rule: "Campos de texto com auto-save devem usar debounce >= 500ms com estado local (useState)"
    origin: CR-36
    implementation: "DebouncedTextInput component, flush on unmount"
    exception: "CR-83: MemberEditor e TopicEditor usam Save/Cancel explicito ao inves de auto-save"

  - id: BR-03
    rule: "A palavra 'ator/atores/actor/actors' NAO aparece em nenhum label ou texto na UI"
    origin: CR-26
    exception: "Tabela do DB pode se chamar 'meeting_actors'"

  - id: BR-04
    rule: "Secretario NAO designa pela aba Discursos nem Home, mas PODE designar pela aba Agenda"
    origin: "CR-31 (correcao de ASM-009)"

  - id: BR-05
    rule: "Snapshot pattern: edicao/exclusao de membro, tema ou ator NAO altera discursos/agendas existentes"
    origin: "SPEC original (ADR-005)"

  - id: BR-06
    rule: "Auto-atribuicao de tipo de domingo ao carregar lista, com persistencia imediata (incluindo 'speeches')"
    origin: "RF-10, CR-56"
    auto_assign_rules:
      - "Padrao: speeches"
      - "1o domingo de Jan, Fev, Mar, Mai, Jun, Jul, Ago, Set, Nov, Dez: testimony_meeting"
      - "1o domingo de Abr e Out: general_conference"
      - "2o domingo de Abr e Out: testimony_meeting"

  - id: BR-07
    rule: "Observador tem dropdown de tipo de domingo visivel mas desabilitado (read-only)"
    origin: RF-09

  - id: BR-08
    rule: "Ao mudar de tipo de domingo para excecao, discursos existentes sao apagados (com confirmacao)"
    origin: RF-09

  - id: BR-09
    rule: "Ao mudar de excecao para 'Discursos', 3 speeches vazios sao criados imediatamente"
    origin: RF-11

  - id: BR-10
    rule: "CSV import sobrescreve TODA a lista de membros (delete all + insert all, via RPC import_members)"
    origin: RF-05

  - id: BR-11
    rule: "Colecoes gerais filtradas por idioma da ala. Ao mudar idioma, colecoes do idioma anterior sao desativadas"
    origin: RF-08.3

  - id: BR-12
    rule: "Activity log: retencao de 2 anos, read-only, descricoes human-readable no idioma da ala"
    origin: "RF-37, CR-22"

  - id: BR-13
    rule: "Push notifications: Observadores NAO recebem push. Token registrado apenas para bishopric e secretary"
    origin: "RF-26, CR-53"

  - id: BR-14
    rule: "Convites por link expiram em 30 dias"
    origin: "SPEC original"

  - id: BR-15
    rule: "Mutations NAO fazem retry (retry:0). Queries fazem retry:2 com exponential backoff (1s, 2s)"
    origin: CR-61

  - id: BR-16
    rule: "Errors nunca mostram stack traces, codigos Supabase ou mensagens tecnicas ao usuario"
    origin: CR-57

  - id: BR-17
    rule: "Bishopric registrado e automaticamente adicionado como ator (can_preside + can_conduct)"
    origin: CR-72

  - id: BR-18
    rule: "can_conduct NAO implica can_preside (regra auto-preside removida)"
    origin: CR-71

  - id: BR-19
    rule: "Oracoes permitem nomes customizados (nao-membros). *_member_id = null para customizados"
    origin: CR-74

  - id: BR-20
    rule: "Domingos sem agenda aparecem na aba Agenda como cards nao-expansiveis com badge de tipo"
    origin: CR-75

  - id: BR-21
    rule: "Apenas 1 swipe card revelado por vez (Members e Topics)"
    origin: "RF-02, RF-08"

  - id: BR-22
    rule: "Tap no card de membro/tema NAO abre edicao (apenas swipe)"
    origin: "RF-02, RF-08"

  - id: BR-23
    rule: "Dialogo de confirmacao ao excluir membro com discursos futuros designados"
    origin: RF-03

  - id: BR-24
    rule: "Template WhatsApp null no DB: mostrar template padrao. String vazia: respeitar (usuario limpou intencionalmente)"
    origin: CR-63

  - id: BR-25
    rule: "Editores de membro e tema NAO salvam no onBlur. Salvamento e feito SOMENTE via botao Salvar"
    origin: CR-83
    supersedes: "Auto-save no blur (comportamento anterior)"

  - id: BR-26
    rule: "Todos os campos de search do app devem ter botao X para limpar busca (componente SearchInput)"
    origin: CR-84

  - id: BR-27
    rule: "Dialogo de confirmacao ANTES de importar CSV (Alert.alert com aviso de substituicao total)"
    origin: CR-86

  - id: BR-28
    rule: "Temas de colecao visiveis via expand/collapse inline (acordeao, uma por vez)"
    origin: CR-89
    notes: "Tap na colecao expande lista read-only de temas. Switch toggle independente."

  - id: BR-29
    rule: "Triggers de DB que inserem em tabelas protegidas por RLS devem usar SECURITY DEFINER"
    origin: CR-91
    notes: "enqueue_speech_notification() precisa SECURITY DEFINER para inserir em notification_queue"

  - id: BR-30
    rule: "Speech slots na aba Discursos visiveis SOMENTE quando tipo de domingo e 'speeches'"
    origin: CR-95
    supersedes: "Logica anterior usava isExcludedFromAgenda (filtrava apenas 2 de 6 tipos)"

  - id: BR-31
    rule: "Deep link protocol do app e sacrmeetman:// (nao wardmanager://)"
    origin: CR-93

  - id: BR-32
    rule: "Componentes de selecao modal (PrayerSelector, ActorSelector, HymnSelectorModal) devem aceitar prop 'visible' para auto-abrir"
    origin: CR-98
    notes: "Padrao consistente: componente recebe visible={true} e abre modal imediatamente"

  - id: BR-33
    rule: "Template padrao de WhatsApp varia por idioma da ala (pt-BR, en, es)"
    origin: CR-94
    notes: "buildWhatsAppUrl recebe idioma e seleciona template correspondente como fallback"

  - id: BR-34
    rule: "SearchInput em telas de Settings (Members, Topics) fixo no topo, fora do ScrollView"
    origin: CR-96
    notes: "Selectors modais ja implementam esse padrao. Fix apenas em telas fullscreen de Settings."

  - id: BR-35
    rule: "Campo 'Reconhecendo a Presenca' usa selecao multipla (toggle add/remove no array)"
    origin: CR-97
    notes: "Modal permanece aberto. Outros campos de ator (presidir, dirigir, etc.) continuam single-select."

  - id: BR-36
    rule: "Labels de discurso na agenda sao 'Discurso'/'Speech' (nao 'Orador'/'Speaker')"
    origin: CR-99
    supersedes: "Labels anteriores '1o Orador', '2o Orador', '3o Orador'"

  - id: BR-37
    rule: "Troca de ultima hora de discursante usa override na sunday_agendas, NAO altera speeches"
    origin: CR-100
    notes: "Campos speaker_*_override nullable. Quando null, exibe speaker_name da tabela speeches."

  - id: BR-38
    rule: "LEDs de status de discurso no SundayCard so renderizados quando tipo de domingo e 'speeches'"
    origin: CR-101
    notes: "isSpeechesType flag ja existe no SundayCard, usada para condicionar renderizacao da secao de LEDs"

  - id: BR-39
    rule: "Label de excecao na aba Agenda NAO exibido quando exception.reason === 'speeches'"
    origin: CR-102
    notes: "Tipo 'speeches' e o padrao e nao precisa de destaque visual. Apenas excecoes reais mostram label."

  - id: BR-40
    rule: "Tela de Settings WhatsApp faz fallback para getDefaultTemplate(idioma_da_ala) quando DB e null"
    origin: CR-103
    notes: "Garante consistencia entre Settings e envio. String vazia respeitada (BR-24)."

  - id: BR-41
    rule: "WhatsAppVariables deve incluir collection (speech.topic_collection) e link (speech.topic_link)"
    origin: CR-104
    notes: "Campos opcionais no tipo, mas devem ser preenchidos quando dados estao disponiveis no speech."

  - id: BR-42
    rule: "Templates padrao de WhatsApp usam aspas duplas ao redor de {titulo}: '\"{titulo}\"'"
    origin: CR-104

  - id: BR-43
    rule: "Placeholder {data} em WhatsApp usa formatDateHumanReadable (nao formatDate)"
    origin: CR-108
    notes: "Retorna formato human-readable por idioma: '22 de Fevereiro de 2026' (pt-BR)."

  - id: BR-44
    rule: "Condicao para renderizar SpeechSlots: (!exception || exception.reason === 'speeches')"
    origin: CR-109
    notes: "Padrao consistente em speeches.tsx e NextSundaysSection.tsx. Nao usar !exception sozinho."

  - id: BR-45
    rule: "Botoes de acao na secao de convites usam icones (nao texto)"
    origin: CR-105
    notes: "WhatsApp: SVG/emoji. Tres pontinhos: U+22EE. Sem icon library (DD-25)."

  - id: BR-46
    rule: "Opcoes de status de convite via dropdown customizado (nao Alert nativo)"
    origin: CR-106
    notes: "InviteActionDropdown com Ver conversa, Confirmado, Nao-Convidado, Desistiu, Cancelar."

  - id: BR-47
    rule: "Status pode reverter de assigned_invited para assigned_not_invited via dropdown"
    origin: CR-106
    notes: "Transicao reversa para correcao de erros ou re-convite."

  - id: BR-48
    rule: "Segunda linha do invite row mostra formato completo: 'No Discurso - LED StatusName'"
    origin: CR-107
    notes: "StatusLED inline 10-12px. Usa t('speeches.slot') + t('speechStatus.*')."

  - id: BR-49
    rule: "Secao de gerenciamento de convites visivel para bispado E secretario"
    origin: CR-110
    supersedes: "Secao visivel apenas para secretario (comportamento anterior)"
    notes: "Permissao 'home:invite_mgmt' adicionada ao bishopric."

  - id: BR-50
    rule: "Espaco entre LED e X no SpeechSlot >= 12px, fontSize do X >= 24"
    origin: CR-111
    notes: "Melhoria de UX para visualizacao e toque."

# =============================================================================
# DATA MODEL (schema principal, estado atual)
# =============================================================================

data_model:
  tables:
    - name: wards
      description: "Alas da igreja"
      key_columns: [id, name, stake_name, language, timezone, whatsapp_template]
      unique_constraints: ["(stake_name, name)"]

    - name: users
      description: "Usuarios via auth.users do Supabase com app_metadata (ward_id, role)"
      managed_by: "6 Edge Functions"
      edge_functions:
        - register-first-user
        - create-invitation
        - register-invited-user
        - list-users
        - update-user-role
        - delete-user

    - name: members
      description: "Membros da ala"
      key_columns: [id, ward_id, full_name, country_code, phone]
      unique_constraints: ["(ward_id, full_name)"]
      notes: "CR-78 removeu phone da unique constraint"

    - name: ward_topics
      description: "Temas da ala (CRUD manual)"
      key_columns: [id, ward_id, title, link]

    - name: general_collections
      description: "Colecoes globais por idioma (importadas via script admin)"

    - name: general_topics
      description: "Temas de colecoes globais"

    - name: ward_collection_config
      description: "Ponte ala-colecao com campo active (boolean)"

    - name: sunday_exceptions
      description: "Tipo de cada domingo"
      key_columns: [id, ward_id, date, reason, custom_reason]
      unique_constraints: ["(ward_id, date)"]
      check_constraint: "reason IN ('speeches', 'testimony_meeting', 'general_conference', 'stake_conference', 'ward_conference', 'primary_presentation', 'other')"
      notes: "'speeches' e persistido (CR-56). custom_reason usado apenas quando reason='other'"

    - name: speeches
      description: "Discursos (3 por domingo)"
      key_columns: [id, ward_id, sunday_date, position, member_id, speaker_name, speaker_phone, topic_title, topic_link, topic_collection, status]
      unique_constraints: ["(ward_id, sunday_date, position)"]
      valid_statuses: [not_assigned, assigned_not_invited, assigned_invited, assigned_confirmed, gave_up]
      snapshot_fields: [speaker_name, speaker_phone, topic_title, topic_link, topic_collection]

    - name: meeting_actors
      description: "Atores da reuniao (gerenciados inline na agenda)"
      key_columns: [id, ward_id, name, can_preside, can_conduct, can_recognize, can_music]
      notes: "can_conduct NAO implica can_preside (CR-71)"

    - name: hymns
      description: "Catalogo global de hinos por idioma (~300 por idioma)"
      key_columns: [id, language, number, title, is_sacramental]
      unique_constraints: ["(language, number)"]
      notes: "Importada via script pnpm import-hymns. Sem ward_id."

    - name: sunday_agendas
      description: "Agenda completa da reuniao sacramental por domingo"
      key_columns: >
        id, ward_id, sunday_date, presiding_name, presiding_actor_id,
        conducting_name, conducting_actor_id, recognized_names, announcements,
        pianist_name, pianist_actor_id, conductor_name, conductor_actor_id,
        opening_hymn_id, opening_prayer_member_id, opening_prayer_name,
        sustaining_releasing, has_baby_blessing, baby_blessing_names,
        has_baptism_confirmation, baptism_confirmation_names,
        has_stake_announcements, sacrament_hymn_id,
        has_special_presentation, special_presentation_description,
        intermediate_hymn_id, closing_hymn_id,
        closing_prayer_member_id, closing_prayer_name
      unique_constraints: ["(ward_id, sunday_date)"]
      notes: >
        Atores armazenados como snapshot (nome) + FK opcional. Oracoes: member_id
        para membros, null + name para nomes customizados (CR-74). Override de
        discursante para troca de ultima hora: speaker_*_override (CR-100).

    - name: device_push_tokens
      description: "Tokens de push notification por dispositivo"
      key_columns: [id, user_id, ward_id, expo_push_token]
      unique_constraints: ["(user_id, expo_push_token)"]

    - name: notification_queue
      description: "Fila de notificacoes pendentes"
      key_columns: [id, ward_id, type, sunday_date, speech_position, speaker_name, target_role, status, send_after]
      notification_types: [designation, weekly_assignment, weekly_confirmation, speaker_confirmed, speaker_withdrew]

    - name: invitations
      description: "Convites por link para novos usuarios"
      key_columns: [id, ward_id, email, role, token, expires_at, used_at, created_by]
      notes: "Token unico. Deep link: sacrmeetman://invite/{token}. Expira em 30 dias."

    - name: activity_log
      description: "Historico de acoes (audit log)"
      key_columns: [id, ward_id, user_id, user_email, action_type, description, created_at]
      retention: "2 anos"
      valid_action_types:
        - "member:create, member:update, member:delete, member:import"
        - "topic:create, topic:update, topic:delete"
        - "collection:activate, collection:deactivate"
        - "sunday_type:change"
        - "speech:assign, speech:unassign, speech:status_change"
        - "user:self_register, user:invite, user:register_via_invite, user:role_change, user:delete"
        - "settings:language, settings:timezone"

# =============================================================================
# NAVIGATION STRUCTURE
# =============================================================================

navigation:
  tabs:
    - name: Home
      route: "/(tabs)/index"
      access: "todos os roles (observador read-only)"
    - name: Discursos
      route: "/(tabs)/speeches"
      access: "todos os roles (observador read-only)"
    - name: Agenda
      route: "/(tabs)/agenda"
      access: "todos os roles (observador read-only)"
    - name: Configuracoes
      route: "/(tabs)/settings"
      access: "bispado e secretario (observador nao ve)"

  settings_sub_screens:
    - name: Members
      route: "/(tabs)/settings/members"
    - name: Topics
      route: "/(tabs)/settings/topics"
    - name: Users
      route: "/(tabs)/settings/users"
    - name: WhatsApp Template
      route: "/(tabs)/settings/whatsapp"
    - name: History
      route: "/(tabs)/settings/history"
    - name: Timezone
      route: "/(tabs)/settings/timezone"
    - name: Theme
      route: "/(tabs)/settings/theme"
    - name: About
      route: "/(tabs)/settings/about"

  auth_screens:
    - name: Login
      route: "/(auth)/login"
    - name: Register (self)
      route: "/(auth)/register"
    - name: Register (invited)
      route: "/(auth)/register-invited"

  modal_screens:
    - name: Presentation Mode
      route: "/presentation"
      notes: "Usa botao 'fechar' (excecao da convencao de back button)"

# =============================================================================
# SCOPE BOUNDARIES
# =============================================================================

in_scope:
  - "CRUD de membros (manual + CSV import/export)"
  - "CRUD de temas (ala + colecoes gerais via script admin)"
  - "Tipo de domingo via dropdown (7 opcoes + texto livre para 'Outro')"
  - "Auto-atribuicao em lote de tipo de domingo"
  - "Designacao de discursantes e temas (3 discursos por domingo)"
  - "Ciclo de status com LEDs 3D animados"
  - "Aba Home personalizada por role"
  - "WhatsApp integration (links wa.me com template)"
  - "Real-time sync (Supabase Realtime + polling fallback)"
  - "Scroll infinito (12 meses passado/futuro, +6 ao scroll)"
  - "i18n: pt-BR, en, es"
  - "Multi-tenancy com RLS"
  - "3 roles: bishopric, secretary, observer"
  - "CRUD de usuarios (Edge Functions)"
  - "Offline support (fila de mutacoes, OfflineBanner)"
  - "Dark/light mode"
  - "Agenda completa da reuniao sacramental"
  - "Gestao inline de atores da reuniao"
  - "Catalogo de hinos com i18n"
  - "Modo Apresentacao (full-screen read-only)"
  - "Push notifications (Expo + Edge Function)"
  - "Self-registration e convite por link"
  - "Historico de acoes (audit log, 2 anos)"
  - "Esqueci a senha"
  - "Logout"

out_of_scope:
  - "Envio direto de SMS/email (apenas push notifications e links wa.me)"
  - "Gestao de outros aspectos da ala (frequencia, chamados, financas)"
  - "Colaboracao multi-usuario simultanea"
  - "Integracao com sistemas oficiais da Igreja SUD"
  - "Gestao de Estacas"
  - "Fotos de membros"
  - "Autenticacao federada / SSO"
  - "Relatorios e analytics"
  - "Lista de convites pendentes na UI (apenas botao convidar)"

# =============================================================================
# CR HISTORY REFERENCE (para lookup rapido de todas as 90 CRs)
# =============================================================================

cr_history:
  batch_1:
    range: "CR-01 a CR-10"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch1.md"
    summary: "UI fixes, bugs criticos (sunday types, topics scroll), theme/about buttons"

  batch_2:
    range: "CR-11 a CR-30"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch2.md"
    summary: "i18n fix, WhatsApp template improvements, activity log, secretary permissions, sunday type dropdown fix, actors redesign, agenda enhancements"

  batch_3:
    range: "CR-31 a CR-43"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch3.md"
    summary: "Spec corrections, back button convention, debounce rules, CSV fixes, logout, timezone spec, topics search"

  batch_4:
    range: "CR-44 a CR-75"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch4.md"
    summary: "Docs update, speeches persistence, dead code wiring, error handling overhaul, CSV/members fixes, UI/UX improvements, auth fixes, agenda/actors enhancements, import-hymns CLI"

  batch_5:
    range: "CR-76 a CR-82"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CONSOLIDATED_old.yaml (CR-77, 78, 82)"
    summary: "Users screen regression, back button, members explanatory text, user name field, expo-file-system v19 migration, GestureHandlerRootView"

  batch_6:
    range: "CR-83 a CR-90"
    status: "todas implementadas"
    files:
      - "docs/specs/SPEC_F027_F031.yaml (CR-83, 84, 85, 86, 90 - Fase 1)"
      - "docs/specs/SPEC_F032_F034.yaml (CR-87, 88, 89 - Fase 2)"
    summary: "Save/Cancel explicito, search clear button, country codes completo, import confirmation dialog, swipe icons, topics explanatory text, collection detail view, delete button fix"

  batch_7:
    range: "CR-91 a CR-100"
    status: "5 implementadas (91, 92, 93, 95, 98), 5 pendentes (94, 96, 97, 99, 100)"
    files:
      - "docs/specs/SPEC_F035_F039.yaml (CR-91, 92, 93, 95, 98 - Fase 1: Bug Fixes)"
      - "docs/specs/SPEC_F040_F044.yaml (CR-94, 96, 97, 99, 100 - Fase 2: UX & Features)"
    summary: "Fase 1 (implementada): RLS policy fix, duplicate key fix, deep link protocol, speech fields visibility, prayer fields clickable. Fase 2 (pendente): WhatsApp template i18n, search fields layout, multi-select recognizing, agenda speech labels, last-minute speaker swap."

  batch_8:
    range: "CR-101 a CR-111"
    status: "11 pendentes (101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111)"
    files:
      - "docs/specs/SPEC_F045_F049.yaml (CR-101, 102, 103, 104, 108, 109 - Fase 1: Display Fixes & WhatsApp Template)"
      - "docs/specs/SPEC_F050_F054.yaml (CR-105, 106, 107, 110, 111 - Fase 2: Invite Management UX)"
    summary: "Fase 1 (pendente): Hide LEDs on non-speech Sundays, hide speech exception label in Agenda, fix WhatsApp template in Settings, fix WhatsApp message variables (collection, link, quotes, date format), fix speech slots in Home NextSundaysSection. Fase 2 (pendente): WhatsApp icon button, custom status dropdown, status line in invite row, bishopric access to invite section, LED-X spacing."
