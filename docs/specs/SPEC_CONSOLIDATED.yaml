# =============================================================================
# SPEC_CONSOLIDATED.yaml
# Fonte unica de verdade para requisitos do projeto Sacrament Meeting Planner
# Gerado: 2026-02-18
# =============================================================================

metadata:
  project: Sacrament Meeting Planner
  description: >
    App mobile (React Native/Expo) para planejamento de reunioes sacramentais
    da Igreja de Jesus Cristo dos Santos dos Ultimos Dias. Permite ao bispado
    designar discursantes e temas, ao secretario gerenciar convites e montar a
    agenda completa da reuniao, com isolamento de dados entre alas, i18n
    (pt-BR, en, es), modo apresentacao, push notifications e audit log.
  created: "2026-02-18"
  last_updated: "2026-02-22"
  total_features: 132
  total_change_requests: 196
  implemented_crs: 96
  pending_crs: 98
  source_documents:
    - docs/PRODUCT_SPECIFICATION.md
    - docs/SPEC.final.md
    - docs/specs/history/SPEC_INDEX.md
    - docs/specs/history/SPEC_CR_batch1.md
    - docs/specs/history/SPEC_CR_batch2.md
    - docs/specs/history/SPEC_CR_batch3.md
    - docs/specs/history/SPEC_CR_batch4.md
    - docs/specs/history/SPEC_CONSOLIDATED_old.yaml
    - docs/CHANGE_REQUESTS.yaml
    - docs/specs/SPEC_F026.yaml
    - docs/specs/SPEC_F027_F031.yaml
    - docs/specs/SPEC_F032_F034.yaml
    - docs/specs/SPEC_F035_F039.yaml
    - docs/specs/SPEC_F040_F044.yaml
    - docs/specs/SPEC_F045_F049.yaml
    - docs/specs/SPEC_F050_F054.yaml
    - docs/specs/SPEC_F055_F059.yaml
    - docs/specs/SPEC_F060_F064.yaml
    - docs/specs/SPEC_F065_F068.yaml
    - docs/specs/SPEC_F069_F072.yaml
    - docs/specs/SPEC_F073.yaml
    - docs/specs/SPEC_F074.yaml
    - docs/specs/SPEC_F075.yaml
    - docs/specs/SPEC_F076.yaml
    - docs/specs/SPEC_F077.yaml
    - docs/specs/SPEC_F078.yaml
    - docs/specs/SPEC_F079.yaml
    - docs/specs/SPEC_F080.yaml
    - docs/specs/SPEC_F081.yaml
    - docs/specs/SPEC_F082.yaml
    - docs/specs/SPEC_F083.yaml
    - docs/specs/SPEC_F088.yaml
    - docs/specs/SPEC_F089.yaml
    - docs/specs/SPEC_F090.yaml
    - docs/specs/SPEC_F091.yaml
    - docs/specs/SPEC_F092.yaml
    - docs/specs/SPEC_F093_F096.yaml
    - docs/specs/SPEC_F097_F100.yaml
    - docs/specs/SPEC_F101_F102.yaml
    - docs/specs/SPEC_F103_F109.yaml
    - docs/specs/SPEC_F110_F112.yaml
    - docs/specs/SPEC_F113_F115.yaml
    - docs/specs/SPEC_F116_F119.yaml
    - docs/specs/SPEC_F120_F125.yaml
    - docs/specs/SPEC_F126_F129.yaml
    - docs/specs/SPEC_F130_F134.yaml
    - docs/specs/SPEC_F135_F137.yaml
    - docs/specs/SPEC_F138_F139.yaml
    - docs/specs/SPEC_F140_F141_F142.yaml
    - docs/specs/SPEC_F143_F144.yaml
    - docs/specs/SPEC_F145.yaml
    - docs/specs/SPEC_F146.yaml
  detail_references: >
    Acceptance criteria individuais de cada feature estao nos arquivos
    docs/specs/history/SPEC_F*.md. Este arquivo nao duplica os ACs
    individuais; apenas referencia que existem.

# =============================================================================
# TECH STACK
# =============================================================================

tech_stack:
  framework: "React Native + Expo SDK 54 (TypeScript)"
  routing: "Expo Router (file-based)"
  state_management: "TanStack Query (server state) + React Context (local: theme, auth)"
  backend: "Supabase (Auth, PostgREST, Realtime, Edge Functions)"
  database: "PostgreSQL with RLS (Row-Level Security)"
  i18n: "react-i18next (pt-BR, en, es)"
  testing: "Vitest"
  gestures: "react-native-gesture-handler ~2.28.0 + react-native-reanimated"
  offline: "Fila de mutacoes em AsyncStorage + last-write-wins"
  push_notifications: "Expo Push Notifications (expo-notifications) + Supabase Edge Function"
  deep_links: "expo-linking (convites por link)"
  file_system: "expo-file-system ~19.0.21 (new File/Paths API, NOT legacy)"
  sharing: "expo-sharing ~14.0.8"
  document_picker: "expo-document-picker ~14.0.8"

# =============================================================================
# PERSONAS E PERMISSOES (estado atual apos todos os CRs implementados)
# =============================================================================

personas:
  - role: bispado
    description: >
      Bispo + 2 Conselheiros (3 pessoas por ala). Responsaveis por decisoes
      estrategicas: designam discursantes e temas, alteram status, gerenciam
      usuarios, convidam novos usuarios por link.
    typescript_type: "bishopric"

  - role: secretario
    description: >
      1 pessoa por ala. Executa decisoes do bispado: gerencia membros, temas,
      excecoes, altera status, envia convites via WhatsApp, gerencia usuarios
      (CR-23), convida novos usuarios por link. NAO designa discursantes pela
      aba Discursos nem Home, mas PODE designar pela aba Agenda (CR-31).
    typescript_type: "secretary"

  - role: observador
    description: >
      Membros com acesso somente-leitura. Visualizam discursos, designacoes
      e agenda sem poder editar. Sem acesso a aba Configuracoes.
    typescript_type: "observer"

  - role: admin_sistema
    description: >
      Papel tecnico (nao usa o app). Importa Colecoes Gerais e hinos via
      scripts CLI (pnpm import-themes, pnpm import-hymns).
    typescript_type: null

permissions:
  # Tabela de permissoes atualizada (reflete CR-23, CR-26, CR-31, CR-37, CR-71)
  speech_assign:
    description: "Designar discursantes/temas (aba Discursos e Home)"
    bispado: true
    secretario: false
    observador: false

  speech_unassign:
    description: "Remover designacao de discursante"
    bispado: true
    secretario: false
    observador: false

  speech_change_status:
    description: "Alterar status de discursos"
    bispado: true
    secretario: true
    observador: false

  member_read:
    description: "Visualizar lista de membros"
    bispado: true
    secretario: true
    observador: false

  member_write:
    description: "Criar, editar, excluir membros"
    bispado: true
    secretario: true
    observador: false

  member_import:
    description: "Importar/exportar membros via CSV"
    bispado: true
    secretario: true
    observador: false

  topic_write:
    description: "Gerenciar temas da Ala"
    bispado: true
    secretario: true
    observador: false

  collection_toggle:
    description: "Ativar/desativar Colecoes Gerais"
    bispado: true
    secretario: true
    observador: false

  sunday_type_write:
    description: "Marcar tipo de domingo (dropdown)"
    bispado: true
    secretario: true
    observador: false  # dropdown visivel mas desabilitado

  settings_access:
    description: "Acessar aba Configuracoes"
    bispado: true
    secretario: true
    observador: true  # limited: only app language, theme, about (CR-178/F116)

  settings_language:
    description: "Configurar idioma da Ala"
    bispado: true
    secretario: true
    observador: false

  settings_whatsapp:
    description: "Gerenciar convites WhatsApp"
    bispado: false
    secretario: true
    observador: false

  settings_users:
    description: "Gerenciar usuarios (CRUD) - atualizado pelo CR-23"
    bispado: true
    secretario: true  # adicionado CR-23
    observador: false

  invitation_create:
    description: "Convidar usuarios por link"
    bispado: true
    secretario: true
    observador: false

  home_next_assignments:
    description: "Ver secao 'Proximas designacoes' na Home"
    bispado: true
    secretario: false
    observador: false

  home_invite_mgmt:
    description: "Ver secao 'Gerenciamento de convites' na Home"
    bispado: true
    secretario: true
    observador: false

  agenda_read:
    description: "Visualizar aba Agenda"
    bispado: true
    secretario: true
    observador: true  # read-only

  agenda_write:
    description: "Editar agenda da reuniao"
    bispado: true
    secretario: true
    observador: false

  agenda_assign_speaker:
    description: "Designar discursante via Agenda (excecao para Secretario - CR-31)"
    bispado: true
    secretario: true  # excecao documentada em CR-31/ASM-AGD-003
    observador: false

  presentation_start:
    description: "Iniciar Modo Apresentacao"
    bispado: true
    secretario: true
    observador: true  # read-only

  push_receive:
    description: "Receber push notifications"
    bispado: true
    secretario: true
    observador: false

  history_read:
    description: "Visualizar Historico de acoes"
    bispado: true
    secretario: true
    observador: false

  theme_toggle:
    description: "Alterar tema visual (dark/light)"
    bispado: true
    secretario: true
    observador: false  # usa apenas tema do sistema

# =============================================================================
# FEATURES (estado atual apos 123 features, 189 CRs, 96 implementados)
# =============================================================================

features:

  # ---------------------------------------------------------------------------
  # Core Data (F001-F006)
  # ---------------------------------------------------------------------------

  - id: F001
    name: "Authentication & Session Management"
    status: implemented
    rfs: [RF-33, RF-34, RF-35, RF-36]
    description: >
      Login com email/senha via Supabase Auth. Signup via self-registration
      (primeiro usuario cria ala + usuario) ou convite por link (deep link
      wardmanager://invite/{token}). Sessao persistente, password reset
      via email (CR-67). Suporte a gerenciadores de senha.
    modified_by_crs: [67]
    notes:
      - "CR-67: Adicionou 'Esqueci a senha' na tela de login"
      - "Self-registration do primeiro usuario cria ala + usuario"
      - "Convite por link expira em 30 dias"

  - id: F002
    name: "Multi-tenancy & Ward Management"
    status: implemented
    rfs: [RN-11, RN-13]
    description: >
      Criacao e configuracao de ala (nome, estaca, idioma, fuso horario,
      template WhatsApp). Isolamento completo de dados entre alas via RLS.
      Configuracao de idioma (pt-BR, en, es) e fuso horario (IANA timezone
      com seletor de busca - CR-41).
    modified_by_crs: [41]
    notes:
      - "CR-41: Formalizou spec do seletor de fuso horario"
      - "Timezone default: pt-BR -> America/Sao_Paulo, en -> America/New_York, es -> America/Mexico_City"

  - id: F003
    name: "Member Management (CRUD)"
    status: implemented
    rfs: [RF-01, RF-01.1, RF-01.2, RF-02, RF-03]
    description: >
      Tela de gerenciamento de membros com busca em tempo real (case-insensitive,
      ignora acentos). Adicionar membro via botao "+" no header. Editar/excluir
      via swipe-to-reveal. Campos: nome completo, codigo do pais (dropdown com
      bandeira emoji), telefone. Salvamento automatico ao clicar fora.
      Snapshot pattern: edicao de membro NAO propaga para discursos existentes.
    modified_by_crs: [40, 55, 78, 82, 83, 90]
    notes:
      - "CR-40: Resolveu inconsistencia de posicao do botao '+' (no header, nao FAB)"
      - "CR-55: Corrigiu desalinhamento do header quando canWrite=false"
      - "CR-78: Corrigiu unique constraint removendo phone da constraint (ward_id, full_name)"
      - "CR-82: GestureHandlerRootView para swipe funcionar"
      - "CR-83: Save/Cancel explicito ao inves de auto-save no blur"
      - "CR-90: Fix botao Delete no SwipeableCard"
      - "Observador: swipe desabilitado"

  - id: F004
    name: "Member Import/Export (CSV)"
    status: implemented
    rfs: [RF-04, RF-05]
    description: >
      Export CSV via share sheet (mobile) ou download (web). Import CSV via
      document picker (mobile) ou file input (web). Formato: Nome Completo,
      Codigo Pais, Telefone. Import sobrescreve toda a lista via Supabase RPC
      import_members. Usa expo-file-system v19 new File/Paths API (CR-77/78).
    modified_by_crs: [42, 54, 66, 77, 78, 86]
    notes:
      - "CR-42: Corrigiu botoes que nao funcionavam"
      - "CR-54: Corrigiu erro ao cancelar share sheet e msg hardcoded em ingles"
      - "CR-66: Corrigiu export vazio e import com erro generico"
      - "CR-77: Migrou para File/Paths API (cacheDirectory null fix)"
      - "CR-78: Migrou para File.text() (EncodingType undefined fix)"
      - "CR-86: Dialogo de confirmacao antes de importar CSV"

  - id: F005
    name: "Ward Topics Management"
    status: implemented
    rfs: [RF-06, RF-06.1, RF-06.2, RF-07, RF-08, RF-08.1]
    description: >
      Gerenciamento de temas da ala (CRUD) e colecoes gerais (toggle
      ativar/desativar). Temas com titulo obrigatorio e link opcional.
      Swipe-to-reveal para editar/excluir. Botao "+" dentro da secao
      Temas da Ala (CR-21). Campo de busca/filtro (CR-39). Salvamento
      automatico. Snapshot pattern para temas em discursos existentes.
    modified_by_crs: [8, 21, 39, 82, 83, 90]
    notes:
      - "CR-8: Corrigiu lista de colecoes nao scrollavel"
      - "CR-21: Moveu botao '+' para dentro da secao Ward Topics"
      - "CR-39: Adicionou campo de busca para filtrar temas"
      - "CR-82: GestureHandlerRootView para swipe funcionar"
      - "CR-83: Save/Cancel explicito ao inves de auto-save no blur"
      - "CR-90: Fix botao Delete no SwipeableCard"

  - id: F006
    name: "General Collections & Import"
    status: implemented
    rfs: [RF-08.2, RF-08.3]
    description: >
      Colecoes gerais de temas por idioma, importadas via script admin
      (pnpm import-themes). Ativar/desativar colecoes por ala. Ao mudar
      idioma da ala, colecoes do idioma anterior sao desativadas.
    modified_by_crs: []

  # ---------------------------------------------------------------------------
  # Sunday & Speech (F007-F008)
  # ---------------------------------------------------------------------------

  - id: F007
    name: "Sunday Type Management (Exceptions)"
    status: implemented
    rfs: [RF-09, RF-10, RF-11]
    description: >
      Dropdown no card expandido para tipo de domingo. Opcoes: Domingo com
      Discursos, Reuniao de Testemunho, Conferencia Geral, Conferencia de
      Estaca, Conferencia de Ala, Reuniao Especial da Primaria, Outro (com
      texto livre). Auto-atribuicao em lote ao carregar lista. Todos os
      valores (incluindo 'speeches') sao persistidos no banco.
    modified_by_crs: [4, 6, 7, 24, 56, 68]
    notes:
      - "CR-6: Corrigiu lista de opcoes do dropdown"
      - "CR-7: Escondeu secao de discursos quando nao e domingo com discursos"
      - "CR-24: Corrigiu dropdown ignorando selecao"
      - "CR-56: Corrigiu 'speeches' nao persistido no DB (CHECK constraint + filtro)"
      - "CR-68: Corrigiu revert de selecao de tipo (race condition optimistic update)"

  - id: F008
    name: "Speech Management & Assignment"
    status: implemented
    rfs: [RF-12, RF-13, RF-14, RF-15, RF-16]
    description: >
      3 slots de discurso por domingo (1o, 2o, 3o Discurso). Ciclo de status:
      Nao-designado -> Designado/Nao-Convidado -> Convidado -> Confirmado | Desistiu.
      LEDs 3D com animacao indicam status (apenas para domingos tipo 'speeches' -
      CR-101). Bispado designa pela aba Discursos/Home.
      Secretario altera status. Scroll infinito (12 meses passado/futuro, +6 ao scroll).
      Snapshot pattern para nome/telefone/tema.
    modified_by_crs: [5]
    notes:
      - "CR-5: Corrigiu labels de 'VAGA 1o' para '1o Discurso'"

  # ---------------------------------------------------------------------------
  # Tabs & Views (F009, F012, F016)
  # ---------------------------------------------------------------------------

  - id: F009
    name: "Home Tab"
    status: implemented
    rfs: [RF-18, RF-19, RF-20]
    description: >
      Aba Home com 3 proximos domingos. Bispado ve "Proximas designacoes"
      (4o+ domingo pendente). Secretario ve "Gerenciamento de convites".
      Observador ve somente leitura. Titulo "Agenda da Reuniao Sacramental"
      acima do botao Iniciar (visivel apenas domingos). Botao "Iniciar
      Reuniao Sacramental" abre Modo Apresentacao.
    modified_by_crs: [1, 3]
    notes:
      - "CR-1: Adicionou titulo para botao 'Iniciar Reuniao Sacramental'"
      - "CR-3: Corrigiu 'Nenhum resultado encontrado' ao iniciar reuniao"

  - id: F012
    name: "Meeting Agenda Management"
    status: implemented
    rfs: [RF-21, RF-21.1, RF-21.2, RF-21.3, RF-21.4]
    description: >
      Aba Agenda para configurar a agenda completa da reuniao sacramental.
      Secoes: Boas-vindas/Anuncios/Reconhecimentos, Designacoes/Sacramento,
      Primeiros Discursos, Ultimo Discurso. Secoes dinamicas para reunioes
      especiais (Testemunhos, Apresentacao da Primaria). Campos: presidir,
      dirigir, reconhecer, pianista, regente, hinos, oracoes, apoios,
      anuncios, apresentacao especial. Auto-save com debounce >= 500ms.
      Designacao de discursantes via Agenda (Bispado + Secretario).
    modified_by_crs: [25, 27, 28, 29, 30, 36, 69, 75]
    notes:
      - "CR-25: Corrigiu scroll inicial mostrando data passada"
      - "CR-27: Corrigiu letter-eating e resized campo de anuncios (3 linhas)"
      - "CR-28: Dialogo de hinos usa 2/3 da tela"
      - "CR-29: Renomeou labels das secoes"
      - "CR-30: Renomeou 'Numero musical' para 'Apresentacao especial'"
      - "CR-36: Definiu debounce 500ms para auto-save"
      - "CR-69: Renomeou labels adicionais (Dirigindo, Apoios, Reconhecendo a Presenca)"
      - "CR-75: Domingos sem agenda aparecem como cards nao-expansiveis"

  - id: F016
    name: "Presentation Mode"
    status: implemented
    rfs: [RF-25]
    description: >
      Tela full-screen read-only com cards acordeao mostrando a agenda
      completa da reuniao. Header com data completa no idioma da ala
      (ex: "Domingo, 16 de Fevereiro de 2026"). Botao de fechar (nao
      botao de voltar - excecao da convencao CR-33).
    modified_by_crs: [38]
    notes:
      - "CR-38: Definiu formato de data no header do Modo Apresentacao"

  # ---------------------------------------------------------------------------
  # Communication (F010, F017, F024)
  # ---------------------------------------------------------------------------

  - id: F010
    name: "WhatsApp Integration"
    status: implemented
    rfs: [RF-20]
    description: >
      Abertura de links wa.me com mensagem pre-preenchida a partir do template
      configuravel da ala. Placeholders validos: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Template editavel com preview. Placeholders
      clicaveis para inserir no texto (CR-15).
    modified_by_crs: [12, 13, 14, 15, 16, 17, 35, 63]
    notes:
      - "CR-12: Renomeou titulo da tela"
      - "CR-13: Removeu placeholder invalido {tema}"
      - "CR-14: Definiu template padrao correto"
      - "CR-15: Placeholders clicaveis"
      - "CR-16: Melhorou uso de espaco na tela"
      - "CR-17: Adicionou botao de voltar"
      - "CR-35: Removeu placeholder invalido {duracao}"
      - "CR-63: Corrigiu template padrao nao respeitado (null vs vazio)"

  - id: F017
    name: "Push Notifications"
    status: implemented
    rfs: [RF-26, RF-27, RF-28, RF-29, RF-30, RF-31, RF-32]
    description: >
      Push notifications via Expo Push Notifications. Tipos: notificacao ao
      secretario apos designacao (5 min, agrupada por domingo), lembrete
      semanal para bispado/secretario, notificacao imediata ao confirmar ou
      desistir. Fuso horario configuravel por ala. Edge Function agendada
      (cron) processa fila. Observadores nao recebem push.
    modified_by_crs: [52, 53]
    notes:
      - "CR-52/53: Conectou codigo morto (useRealtimeSync, useConnection, useNotifications)"

  - id: F024
    name: "WhatsApp Template"
    status: implemented
    rfs: [RF-20]
    description: >
      Tela de configuracao do template WhatsApp com editor, preview e chips
      de placeholders. 6 placeholders validos: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Template padrao configurado na criacao
      da ala. Botao de voltar no header.
    modified_by_crs: [12, 13, 14, 15, 16, 17, 35, 63]
    notes:
      - "Mesmas CRs que F010 (compartilham tela de template)"

  # ---------------------------------------------------------------------------
  # UX Improvements (F026)
  # ---------------------------------------------------------------------------

  - id: F026
    name: "Members Screen Explanatory Texts (i18n)"
    status: implemented
    rfs: []
    description: >
      Textos explicativos na tela de Membros para guiar o usuario. Inclui:
      descricao abaixo do titulo explicando funcionalidades da tela (adicionar,
      editar, remover membros via swipe), e texto de ajuda perto dos botoes CSV
      explicando exportacao, importacao (sobrescreve toda a lista) e formato
      esperado do arquivo (Nome, Telefone Completo com codigo do pais).
      Todos os textos traduzidos em pt-BR, en, es.
    modified_by_crs: [80]
    notes:
      - "CR-80: Adiciona textos explicativos com i18n (pt-BR, en, es)"
      - "Segue padrao visual de subtitle/description usado em telas de auth"
      - "CSV help text so visivel quando canImport=true"

  # ---------------------------------------------------------------------------
  # Batch 6 Phase 1 (F027-F031)
  # ---------------------------------------------------------------------------

  - id: F027
    name: "Explicit Save/Cancel for Members and Topics"
    status: implemented
    rfs: []
    description: >
      Substituir auto-save no blur por botoes explicitos Salvar e Cancelar
      nos editores de membros (MemberEditor) e temas (TopicEditor). Botoes
      posicionados abaixo dos campos, alinhados a direita. Cancelar descarta
      alteracoes, Salvar valida e persiste.
    modified_by_crs: [83]
    notes:
      - "CR-83: Salvar somente ao clicar Salvar, adicionar botao Cancelar"
      - "Usa i18n keys existentes: common.save e common.cancel"
      - "Afeta members.tsx e topics.tsx"

  - id: F028
    name: "Search Clear Button (X) for All Search Fields"
    status: implemented
    rfs: []
    description: >
      Adicionar botao X na direita de todos os campos de search do app para
      limpar a string de busca e restaurar a lista completa. Componente
      reutilizavel SearchInput. 10 campos afetados: members, topics, history,
      timezone, HymnSelector, MemberSelectorModal, TopicSelectorModal,
      PrayerSelector, ActorSelector, AgendaForm.
    modified_by_crs: [84]
    notes:
      - "CR-84: Botao X padrao para todos os campos de search"
      - "Criar componente SearchInput reutilizavel"
      - "X visivel apenas quando campo tem texto"

  - id: F029
    name: "Complete International Country Codes List"
    status: implemented
    rfs: []
    description: >
      Expandir a lista de codigos internacionais de telefone (COUNTRY_CODES)
      de 21 para ~150+ paises. Extrair para arquivo compartilhado
      (src/lib/countryCodes.ts) e atualizar splitPhoneNumber em csvUtils.ts
      para usar a mesma fonte. Manter emojis de bandeira Unicode.
    modified_by_crs: [85]
    notes:
      - "CR-85: Lista de codigos internacionais incompleta"
      - "Extrair para src/lib/countryCodes.ts (single source of truth)"
      - "Atualizar splitPhoneNumber para usar mesma lista"

  - id: F030
    name: "CSV Import Confirmation Dialog"
    status: implemented
    rfs: []
    description: >
      Adicionar dialogo de confirmacao (Alert.alert) ao clicar em Importar CSV,
      ANTES de abrir o file picker. O dialogo avisa que a importacao substitui
      toda a lista de membros e que designacoes existentes nao sao afetadas.
      Textos i18n em pt-BR, en, es.
    modified_by_crs: [86]
    notes:
      - "CR-86: Dialogo de confirmacao antes de importar CSV"
      - "Usa padrao Alert.alert ja existente no app"
      - "Novas i18n keys: members.importConfirmTitle, members.importConfirmMessage"

  - id: F031
    name: "Fix Delete Button for Members and Topics"
    status: implemented
    rfs: []
    description: >
      Fix do bug onde o botao Delete revelado pelo swipe-to-reveal no
      SwipeableCard nao faz nada quando pressionado. O botao Edit funciona
      corretamente. Causa provavel: GestureDetector intercepta evento de
      toque na area do botao Delete (rightmost). Fix no SwipeableCard.tsx.
    modified_by_crs: [90]
    notes:
      - "CR-90: Bug - botao Delete nao faz nada"
      - "Edit funciona com padrao identico de codigo"
      - "Fix no componente compartilhado SwipeableCard.tsx"

  # ---------------------------------------------------------------------------
  # Batch 6 Phase 2 (F032-F034)
  # ---------------------------------------------------------------------------

  - id: F032
    name: "Swipe Action Icons (pencil/trash) instead of Text"
    status: implemented
    rfs: []
    description: >
      Substituir texto dos botoes de acao do SwipeableCard ("Editar"/"Excluir")
      por icones Unicode: lapis (pencil) para editar, lixeira (wastebasket)
      para excluir. Manter accessibilityLabel com texto descritivo. Nao
      instalar biblioteca de icones.
    modified_by_crs: [87]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-87: Trocar texto por icones nos botoes de swipe"
      - "Usar caracteres Unicode (nao icon library)"
      - "accessibilityLabel mantem texto para screen readers"
      - "Unico arquivo afetado: SwipeableCard.tsx"

  - id: F033
    name: "Topics Screen Explanatory Text"
    status: implemented
    rfs: []
    description: >
      Adicionar texto explicativo na tela de Temas, abaixo do header, explicando
      temas da ala vs colecoes e o mecanismo de ativar/desativar colecoes.
      Segue padrao visual de CR-80 (F026). Textos i18n em pt-BR, en, es.
    modified_by_crs: [88]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-88: Texto explicativo na tela de temas"
      - "Segue padrao visual de F026 (fontSize 13, textSecondary, center)"
      - "Explica ativar/desativar colecoes"
      - "Adiciona tambem key topics.noTopics para uso por F034"

  - id: F034
    name: "Collection Topics View (expand/collapse read-only list)"
    status: implemented
    rfs: []
    description: >
      Ao clicar numa colecao na tela de Temas, expandir inline e mostrar todos
      os temas daquela colecao em lista simples read-only. Padrao acordeao
      (uma colecao expandida por vez). Busca lazy de general_topics por
      collection_id. Loading state, empty state, Switch independente do tap.
    modified_by_crs: [89]
    spec_file: "docs/specs/SPEC_F032_F034.yaml"
    notes:
      - "CR-89: Mostrar temas de colecao ao clicar"
      - "Padrao expand/collapse inline (acordeao)"
      - "Novo hook useCollectionTopics em useTopics.ts"
      - "Switch toggle independente do tap na colecao"
      - "Depende de F033 para key topics.noTopics"

  # ---------------------------------------------------------------------------
  # Batch 7 Phase 1 (F035-F039) - Bug Fixes
  # ---------------------------------------------------------------------------

  - id: F035
    name: "Fix RLS policy error on notification_queue"
    status: pending
    rfs: []
    description: >
      Fix do bug onde designar um orador causa erro de RLS na tabela
      notification_queue. O trigger enqueue_speech_notification() nao usa
      SECURITY DEFINER, executando no contexto do usuario autenticado que
      nao tem acesso a notification_queue. Fix: adicionar SECURITY DEFINER
      a funcao de trigger.
    modified_by_crs: [91]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-91: Bug critico - erro de RLS ao designar orador"
      - "Trigger deve usar SECURITY DEFINER para bypass de RLS"
      - "notification_queue permanece sem policies de client"

  - id: F036
    name: "Fix duplicate key error in country dropdown"
    status: pending
    rfs: []
    description: >
      Fix do warning de React "duplicate key" no dropdown de codigos de pais.
      keyExtractor usa item.code mas existem duplicatas legitimas (+1 US/Canada,
      +7 Russia/Kazakhstan). Fix: usar item.label como key (unico).
    modified_by_crs: [92]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-92: Warning de duplicate key no FlatList de COUNTRY_CODES"
      - "item.label e unico (ex: 'United States (+1)' vs 'Canada (+1)')"
      - "Unico arquivo afetado: members.tsx (keyExtractor)"

  - id: F037
    name: "Change deep link protocol to sacrmeetman://"
    status: pending
    rfs: []
    description: >
      Alterar protocolo de deep link de wardmanager:// para sacrmeetman://.
      Afeta app.json (scheme) e create-invitation Edge Function (construcao
      do deep link). Deep links NAO funcionam no Expo Go (comportamento
      esperado, apenas em builds standalone).
    modified_by_crs: [93]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-93: Protocolo wardmanager:// deve ser sacrmeetman://"
      - "Alterar app.json scheme e Edge Function create-invitation"
      - "Deep links com custom schemes NAO funcionam no Expo Go (esperado)"

  - id: F038
    name: "Fix speech fields not hiding on sunday type change"
    status: pending
    rfs: []
    description: >
      Fix do bug onde speech slots (posicoes 1, 2, 3) continuam visiveis ao
      mudar tipo de domingo na aba Discursos. O codigo usava
      isExcludedFromAgenda() (que so filtra general_conference e
      stake_conference). Fix: verificar se tipo === 'speeches' diretamente.
    modified_by_crs: [95]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-95: Speech fields nao somem ao mudar tipo de domingo"
      - "Correcao completa do que CR-7 fez parcialmente"
      - "Usa verificacao direta de tipo === 'speeches' ao inves de isExcludedFromAgenda"

  - id: F039
    name: "Fix prayer fields not clickable"
    status: pending
    rfs: []
    description: >
      Fix do bug onde campos de oracao (abertura e fechamento) na aba Agenda
      nao respondem ao clique. PrayerSelector nao recebe prop 'visible' para
      auto-abrir modal (como ActorSelector e HymnSelectorModal fazem).
      Fix: adicionar props 'visible' e 'onClose' ao PrayerSelector.
    modified_by_crs: [98]
    spec_file: "docs/specs/SPEC_F035_F039.yaml"
    notes:
      - "CR-98: Campos de oracao nao sao clicaveis"
      - "PrayerSelector precisa de props visible + onClose (padrao ActorSelector)"
      - "Completa integracao que CR-74 iniciou"

  # ---------------------------------------------------------------------------
  # Batch 7 Phase 2 (F040-F044) - UX & Features
  # ---------------------------------------------------------------------------

  - id: F040
    name: "Update default WhatsApp invitation template (i18n)"
    status: pending
    rfs: []
    description: >
      Adicionar templates padrao de convite WhatsApp por idioma (en, es alem do
      pt-BR existente). Ao gerar convite sem template customizado, usar o template
      do idioma da ala como default. Template existente pt-BR ja inclui todos os
      6 placeholders ({nome}, {data}, {posicao}, {colecao}, {titulo}, {link}).
    modified_by_crs: [94]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-94: Trocar template padrao para incluir posicao, tema e link"
      - "Template pt-BR atual ja satisfaz; melhoria e templates i18n"
      - "Novos exports: DEFAULT_TEMPLATE_EN, DEFAULT_TEMPLATE_ES"
      - "buildWhatsAppUrl agora aceita idioma da ala como parametro"

  - id: F041
    name: "Search fields fixed at top in Settings screens"
    status: pending
    rfs: []
    description: >
      Fixar campos de busca (SearchInput) no topo das telas de Settings de
      Membros e Temas, para que nao scrollem junto com o conteudo. Os selectors
      modais (MemberSelectorModal, TopicSelectorModal, ActorSelector,
      HymnSelectorModal) ja implementam esse padrao corretamente.
    modified_by_crs: [96]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-96: Campos de busca fixos no topo com espaco preenchido"
      - "Fix necessario apenas em members.tsx e topics.tsx (Settings)"
      - "Modais ja tem search fixo no header"

  - id: F042
    name: "Multi-select for Reconhecendo a Presenca field"
    status: pending
    rfs: []
    description: >
      Permitir selecao multipla de nomes no campo 'Reconhecendo a Presenca' da
      agenda. Atualmente cada selecao substitui a anterior. O banco de dados ja
      suporta array (string[]). Implementar toggle (add/remove) no handler de
      selecao, indicador visual no ActorSelector, e manter modal aberto para
      permitir selecoes adicionais.
    modified_by_crs: [97]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-97: Campo Reconhecendo deve permitir selecao multipla"
      - "DB ja suporta array (recognized_names: string[])"
      - "ActorSelector precisa de modo multi-select"
      - "Modal nao fecha apos selecao no modo multi-select"

  - id: F043
    name: "Change speech labels from Orador to Discurso"
    status: pending
    rfs: []
    description: >
      Alterar labels de discursantes na edicao de agenda e Modo Apresentacao
      de '1o Orador'/'2o Orador'/'3o Orador' para '1o Discurso'/'2o Discurso'/
      '3o Discurso'. Alterar i18n key 'speeches.speaker' de 'Orador' para
      'Discurso' (pt-BR), 'Speaker' para 'Speech' (en), 'Orador' para
      'Discurso' (es).
    modified_by_crs: [99]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-99: Labels '1o Orador' -> '1o Discurso' na agenda"
      - "Afeta AgendaForm.tsx e usePresentationMode.ts"
      - "Alterar valor da i18n key speeches.speaker nos 3 idiomas"
      - "Nao afeta aba Discursos (usa keys diferentes)"

  - id: F044
    name: "Read-only speaker field with last-minute swap"
    status: pending
    rfs: []
    description: >
      Campos de discursante na aba Agenda passam a ser read-only por padrao,
      mostrando o nome designado. Icone de lapis permite 'Troca de Ultima Hora':
      campo vira TextInput manual. Icone X reverte ao nome original designado.
      Override persistido em novos campos speaker_*_override na tabela
      sunday_agendas. Nao altera a designacao na tabela speeches.
    modified_by_crs: [100]
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    notes:
      - "CR-100: Campo discursante read-only com icone de edicao"
      - "Nova migracao DB: speaker_1/2/3_override em sunday_agendas"
      - "Override nao altera tabela speeches (extensao do snapshot pattern)"
      - "Modo Apresentacao usa override quando existir"

  # ---------------------------------------------------------------------------
  # Batch 8 Phase 1 (F045-F049) - Display Fixes & WhatsApp Template
  # ---------------------------------------------------------------------------

  - id: F045
    name: "Hide status LEDs on non-speech Sundays"
    status: pending
    rfs: []
    description: >
      Na aba Discursos e no Home, os 3 LEDs de status de discurso sao renderizados
      incondicionalmente. Quando o domingo nao e do tipo 'speeches', os LEDs nao
      tem significado e nao devem ser mostrados. Fix: condicionar renderizacao dos
      LEDs a isSpeechesType no SundayCard.tsx.
    modified_by_crs: [101]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-101: LEDs renderizados incondicionalmente em SundayCard.tsx"
      - "Flag isSpeechesType ja existe (linha 269), basta usar para condicionar LEDs"
      - "Fix aplica-se automaticamente a speeches.tsx e NextSundaysSection.tsx"

  - id: F046
    name: "Hide exception label for speech Sundays in Agenda"
    status: pending
    rfs: []
    description: >
      Na aba Agenda, o label amarelo de excecao aparece para TODOS os domingos
      com registro em sunday_exceptions, incluindo domingos do tipo 'speeches'.
      Apos CR-56, todo domingo tem excecao persistida, gerando label "Discursos"
      redundante. Fix: nao exibir label quando exception.reason === 'speeches'.
    modified_by_crs: [102]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-102: exceptionLabel calculado para todos, incluindo reason='speeches'"
      - "Apos CR-56, todo domingo tem excecao, speech Sundays mostram label indesejado"
      - "Fix: filtrar 'speeches' no calculo de exceptionLabel"

  - id: F047
    name: "Fix WhatsApp template initialization in Settings"
    status: pending
    rfs: []
    description: >
      Tela de configuracoes WhatsApp inicializa template apenas do valor no DB.
      Se DB for null, campo fica vazio ao inves de mostrar template padrao
      (getDefaultTemplate). O envio via botao WhatsApp funciona corretamente
      pois buildWhatsAppUrl faz fallback. Fix: importar getDefaultTemplate e
      usar como fallback quando DB e null, respeitando idioma da ala.
    modified_by_crs: [103]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-103: Template inicializado apenas de ward.whatsapp_template (DB)"
      - "Sem import/fallback para getDefaultTemplate() de whatsappUtils.ts"
      - "Adicionar 'language' a query de ward para selecionar template correto"

  - id: F048
    name: "Fix WhatsApp message variables (collection, link, quotes, date)"
    status: pending
    rfs: []
    description: >
      Ao enviar convite via WhatsApp na secao de Gerenciamento de Convites, a
      mensagem tem 4 problemas: (1) titulo sem aspas, (2) colecao nao passada,
      (3) link nao passado, (4) data em formato compacto "22 FEV" ao inves de
      human-readable. Fix: passar collection e link do speech, trocar formatDate
      por formatDateHumanReadable, adicionar aspas ao redor de {titulo} nos
      templates padrao.
    modified_by_crs: [104, 108]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-104: WhatsAppVariables missing collection e link; template sem aspas em {titulo}"
      - "CR-108: formatDate() retorna '22 FEV', deve usar formatDateHumanReadable()"
      - "Alterar templates padrao para usar '\"{titulo}\"' com aspas"
      - "Afeta InviteManagementSection.tsx e whatsappUtils.ts"

  - id: F049
    name: "Fix speech slots not showing in Home NextSundaysSection"
    status: pending
    rfs: []
    description: >
      Na secao "Proximas Designacoes" do Home, cards de domingo nao expandem para
      mostrar SpeechSlots. Condicao !entry.exception bloqueia renderizacao pois
      apos CR-56 todos os domingos tem excecao. Fix: usar padrao de speeches.tsx
      (!exception || exception.reason === 'speeches').
    modified_by_crs: [109]
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    notes:
      - "CR-109: Condicao !entry.exception sempre false apos CR-56"
      - "Padrao correto ja existe em speeches.tsx:276"
      - "Replicar condicao (!exception || exception.reason === 'speeches')"

  # ---------------------------------------------------------------------------
  # Batch 8 Phase 2 (F050-F054) - Invite Management UX
  # ---------------------------------------------------------------------------

  - id: F050
    name: "Replace WhatsApp text button with icon and status button with three-dots"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites (InviteManagementSection), substituir
      botao texto "WhatsApp" por icone do WhatsApp (SVG inline ou Unicode) e
      botao "Alterar status" por icone de tres pontinhos (Unicode U+22EE vertical
      ellipsis). Sem biblioteca de icones (DD-25).
    modified_by_crs: [105]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-105: Substituir texto por icones nos botoes de acao do invite row"
      - "WhatsApp: SVG inline ou emoji. Tres pontinhos: U+22EE"
      - "Manter accessibilityLabel com texto descritivo"
      - "Unico arquivo afetado: InviteManagementSection.tsx"

  - id: F051
    name: "Replace Alert with custom dropdown for invite status actions"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites, substituir Alert.alert nativo por
      dropdown/modal customizado com opcoes: Ver conversa (icone WhatsApp),
      Designado/Confirmado (LED verde), Designado/Nao-Convidado (LED amarelo),
      Desistiu (LED vermelho), Cancelar. Nova opcao "Designado/Nao-Convidado"
      permite reverter convite. Segue padrao visual do StatusChangeModal.
    modified_by_crs: [106]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-106: Dropdown customizado para opcoes de status de convite"
      - "Novo componente InviteActionDropdown.tsx"
      - "Nova opcao: assigned_not_invited (reverter convite)"
      - "Nova i18n key: speeches.viewConversation ('Ver conversa')"
      - "Ativado pelo botao tres pontinhos de F050"

  - id: F052
    name: "Show speech number with LED and status name in invite card second line"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites, alterar a segunda linha de cada
      invite row de apenas "1o" para o formato completo:
      "1o Discurso - <StatusLED> <nome do status traduzido>".
      Importar StatusLED, usar t('speeches.slot') e t('speechStatus.*').
    modified_by_crs: [107]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-107: Formato completo na segunda linha do invite row"
      - "Importar StatusLED com tamanho 10-12px (inline)"
      - "Layout: flexDirection row com alignItems center"
      - "Unico arquivo afetado: InviteManagementSection.tsx"

  - id: F053
    name: "Show invite management section for bishopric role"
    status: pending
    rfs: []
    description: >
      Adicionar permissao 'home:invite_mgmt' ao role bishopric em permissions.ts.
      Atualmente apenas secretary tem essa permissao. Bispado passara a ver a
      secao de Gerenciamento de Convites na Home, alem da secao de Proximas
      Designacoes que ja possui.
    modified_by_crs: [110]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-110: Bispado tambem ve secao de gerenciamento de convites"
      - "Unico arquivo afetado: permissions.ts (adicionar 'home:invite_mgmt' ao bishopric Set)"
      - "InviteManagementSection.tsx nao precisa alterar (guard ja usa hasPermission)"

  - id: F054
    name: "Increase spacing between LED and X button, increase X icon size"
    status: pending
    rfs: []
    description: >
      No SpeechSlot.tsx (card de domingo expandido), aumentar espaco entre
      StatusLED e botao X (remover designacao) de gap 8 para 12-16px, e
      aumentar fontSize do icone X de 20 para 24-26px.
    modified_by_crs: [111]
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    notes:
      - "CR-111: Mais espaco entre LED e X, icone X maior"
      - "gap da row e/ou marginLeft no removeButton"
      - "fontSize do X de 20 para 24+"
      - "Unico arquivo afetado: SpeechSlot.tsx"

  # ---------------------------------------------------------------------------
  # Batch 9 Phase 1 (F055-F059) - Bug Fixes & Quick UI
  # ---------------------------------------------------------------------------

  - id: F055
    name: "View WhatsApp conversation without resending invite message"
    status: pending
    rfs: []
    description: >
      Na secao de gerenciamento de convites, "Ver Conversa" no InviteActionDropdown
      chama buildWhatsAppUrl() com texto de convite, reenviando a mensagem. Fix:
      abrir wa.me/{phone} sem ?text=, navegando diretamente para a conversa sem
      mensagem pre-preenchida. Criar funcao buildWhatsAppConversationUrl(phone).
    modified_by_crs: [112]
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    notes:
      - "CR-112: Ver Conversa reenvia convite ao inves de abrir conversa"
      - "handleDropdownWhatsApp deve usar URL sem ?text="
      - "Nova funcao buildWhatsAppConversationUrl em whatsappUtils.ts"
      - "Botao de primeiro envio (assigned_not_invited) nao afetado"

  - id: F056
    name: "Change InviteActionDropdown title to 'Alterar status' (i18n)"
    status: pending
    rfs: []
    description: >
      No InviteActionDropdown, o titulo exibe speaker_name. Trocar para
      t('speeches.changeStatus'). Chaves i18n ja existem: pt-BR "Alterar status",
      en "Change status", es "Cambiar estado".
    modified_by_crs: [113]
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    notes:
      - "CR-113: Titulo do dropdown mostra nome do discursante, deveria ser 'Alterar status'"
      - "Chave i18n speeches.changeStatus ja existe nos 3 locales"
      - "Unico arquivo afetado: InviteActionDropdown.tsx (linha 73-75)"

  - id: F057
    name: "Fix +1 country code showing Canada flag instead of USA"
    status: pending
    rfs: []
    description: >
      Canada (+1) e USA (+1) compartilham codigo. getFlagForCode() usa .find()
      retornando Canada (primeiro na lista alfabetica). Fix: reordenar para USA
      antes de Canada e ajustar highlight no dropdown de selecao para usar label
      (unico) ao inves de code.
    modified_by_crs: [117, 130]
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    notes:
      - "CR-117: +1 mostra bandeira do Canada ao inves de EUA"
      - "CR-130: Display ainda usa getFlagForCode ao inves de label (F072)"
      - "getFlagForCode usa .find() que retorna primeiro match"
      - "Reordenar USA antes de Canada em COUNTRY_CODES"
      - "Ajustar display e highlight para usar label ao inves de code"

  - id: F058
    name: "Change third speech label from ordinal to 'Ultimo Discurso'"
    status: pending
    rfs: []
    description: >
      O label do 3o discurso usa formato ordinal generico ("3o Discurso").
      Trocar para "Ultimo Discurso" (i18n). Afeta SpeechSlot, AgendaForm
      e InviteManagementSection. Nova i18n key speeches.lastSpeech nos 3 locales.
    modified_by_crs: [122]
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    notes:
      - "CR-122: 3o Discurso deve ser 'Ultimo Discurso'"
      - "getPositionLabel() sem caso especial para position === 3"
      - "Nova i18n key speeches.lastSpeech em pt-BR, en, es"
      - "Afeta SpeechSlot.tsx, AgendaForm.tsx, InviteManagementSection.tsx"

  - id: F059
    name: "Fix closing prayer field visual duplication in AgendaForm"
    status: pending
    rfs: []
    description: >
      Ao clicar no campo de oracao de encerramento na Agenda, ocorre duplicacao
      visual do campo e do modal. AgendaForm renderiza PrayerSelector com
      visible={true} que renderiza botao inline (duplicando SelectorField ja
      existente) alem de abrir modal. Fix: adicionar prop modalOnly ao
      PrayerSelector para suprimir botao inline quando usado como modal puro.
    modified_by_crs: [125]
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    notes:
      - "CR-125: Bug duplicacao visual no campo de oracao de encerramento"
      - "PrayerSelector renderiza botao inline + modal, duplicando SelectorField do AgendaForm"
      - "Nova prop modalOnly para PrayerSelector"
      - "AgendaForm passa modalOnly={true} no uso condicional"

  # ---------------------------------------------------------------------------
  # Batch 9 Phase 2 (F060-F064) - Speech Cards & Agenda
  # ---------------------------------------------------------------------------

  - id: F060
    name: "Add X button next to topic field to remove assigned topic"
    status: pending
    rfs: []
    description: >
      Adicionar botao X ao lado do campo de tema no SpeechSlot para remover
      a atribuicao de tema. Ao pressionar X, topic_title, topic_link e
      topic_collection sao setados para null. Botao visivel apenas quando
      tema esta atribuido e usuario tem permissao canAssign (bishopric).
      Sem dialogo de confirmacao (tema facilmente re-atribuivel).
    modified_by_crs: [114]
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    notes:
      - "CR-114: Botao X no campo de temas para remover tema"
      - "Padrao similar ao botao X de remover speaker (ja existente)"
      - "Nova prop onClearTopic no SpeechSlot"
      - "Sem confirmacao (diferente de speaker que tem ciclo de convites)"

  - id: F061
    name: "Confirmation dialog when changing sunday type with assignments"
    status: pending
    rfs: []
    description: >
      Ao mudar tipo de domingo DE 'speeches' quando ha discursantes ou temas
      atribuidos, exibir Alert.alert de confirmacao antes de efetuar a mudanca.
      Se nao ha atribuicoes, mudanca direta sem confirmacao. Reverter PARA
      speeches tambem nao requer confirmacao. SundayTypeDropdown recebe
      speeches[] para verificar atribuicoes.
    modified_by_crs: [115, 127]
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    notes:
      - "CR-115: Confirmacao ao mudar tipo de domingo com atribuicoes"
      - "CR-127: Apos confirmacao, tambem apagar speeches do banco (F070)"
      - "SundayTypeDropdown precisa acessar speeches[] do SundayCard"
      - "Novas i18n keys sundayExceptions.changeConfirmTitle/Message"
      - "Usa Alert.alert nativo (padrao consistente com app)"

  - id: F062
    name: "LED click shows only confirmed and gave_up for invited status"
    status: superseded
    superseded_by: F077
    rfs: []
    description: >
      Ao clicar no StatusLED no SpeechSlot quando status e assigned_invited,
      filtrar opcoes do StatusChangeModal para mostrar apenas assigned_confirmed
      e gave_up (as 2 acoes mais comuns apos convite). Para outros status,
      todas as transicoes validas sao mostradas normalmente. Nova prop opcional
      allowedStatuses no StatusChangeModal.
    modified_by_crs: [116, 129]
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    notes:
      - "CR-116: LED click mostra apenas 'confirmado' e 'desistiu'"
      - "CR-129: Alterar para mostrar todos exceto not_assigned (F071)"
      - "Nova prop allowedStatuses no StatusChangeModal"
      - "Filtro aplica-se a TODOS os status interativos"
      - "Outros contextos de uso do modal nao afetados"

  - id: F063
    name: "Redesign speech cards layout (LED left, X right)"
    status: pending
    rfs: []
    description: >
      Reordenar layout da row do speaker no SpeechSlot: LED a esquerda,
      speaker field no meio (flex:1), X button a direita. Anterior:
      [Speaker][LED][X]. Novo: [LED][Speaker][X]. Campo de tema alinhado
      com campo de speaker via marginLeft (28px = LED 16 + gap 12).
      Todas as 3 posicoes usam o mesmo componente SpeechSlot.
    modified_by_crs: [119]
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    notes:
      - "CR-119: LED a esquerda, X a direita, campo de tema alinhado"
      - "Reordenacao de JSX na styles.row do SpeechSlot"
      - "marginLeft no topicField para alinhamento visual"
      - "Secretary/Observer ja nao veem X (canUnassign=false)"

  - id: F064
    name: "Show '(Last-minute assignment)' label in agenda override"
    status: pending
    rfs: []
    description: >
      No SpeakerField do AgendaForm, quando override esta ativo
      (overrideName !== null && overrideName !== speakerName), exibir label
      "(Designacao de ultima hora)" abaixo do campo. Label i18n em 3 idiomas
      com estilo sutil (fontSize 11-12, italic, cor terciaria). Label
      desaparece ao reverter override ou em modo de edicao.
    modified_by_crs: [121]
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    notes:
      - "CR-121: Label de designacao de ultima hora na agenda"
      - "Usa variavel hasOverride ja existente no SpeakerField"
      - "Nova i18n key agenda.lastMinuteAssignment em 3 idiomas"
      - "Nao aparece no Modo Apresentacao (apenas edicao de agenda)"

  # ---------------------------------------------------------------------------
  # Batch 9 Phase 3 (F065-F068) - UX Polish
  # ---------------------------------------------------------------------------

  - id: F065
    name: "SearchInput with flex:1 and close button in search screens"
    status: pending
    rfs: []
    description: >
      Adicionar flex:1 defensivo ao container do SearchInput.tsx. Nas telas de
      Settings (members, topics, history, timezone), envolver SearchInput em
      container flexDirection:'row' com botao 'Fechar' a direita que limpa o
      campo de busca. Modais de selecao ja implementam esse padrao corretamente.
    modified_by_crs: [118]
    spec_file: "docs/specs/SPEC_F065_F068.yaml"
    notes:
      - "CR-118: Campo de busca com tamanho fixo preenchendo espaco com botao fechar"
      - "flex:1 defensivo no container do SearchInput.tsx"
      - "4 telas de Settings: searchContainer com flexDirection:'row' + close button"
      - "Modais nao afetados (ja tem padrao correto)"

  - id: F066
    name: "Auto-scroll to show expanded card after toggle"
    status: superseded_by_F075
    rfs: []
    description: >
      Ao expandir card nas abas Discursos e Agenda, scroll automatico para
      alinhar o topo do card com o topo da tela. Se card menor que tela, fica
      visivel do topo. Se maior, topo alinhado. Usa scrollToIndex com
      viewPosition:0 e setTimeout(300ms) apos setExpandedDate. Nao scrolla
      ao colapsar.
    modified_by_crs: [120]
    spec_file: "docs/specs/SPEC_F065_F068.yaml"
    notes:
      - "CR-120: Auto-scroll ao expandir cards"
      - "scrollToIndex com viewPosition:0 em speeches.tsx e agenda.tsx"
      - "setTimeout(300ms) para esperar re-render do card expandido"
      - "Nao scrolla ao colapsar (apenas ao expandir)"

  - id: F067
    name: "Recognizing field proportional height with one actor per line"
    status: pending
    rfs: []
    description: >
      Campo 'Reconhecendo a Presenca' no AgendaForm exibe cada ator em sua
      propria linha ao inves de truncar em 1 linha com join(', '). Substituir
      SelectorField por Pressable customizado com map de nomes. Campo cresce
      verticalmente conforme numero de atores selecionados.
    modified_by_crs: [123]
    spec_file: "docs/specs/SPEC_F065_F068.yaml"
    notes:
      - "CR-123: Um ator por linha no campo Reconhecendo a Presenca"
      - "Substituir SelectorField por Pressable customizado (apenas nesse uso)"
      - "Nomes renderizados via map com <Text> individual"
      - "Outros usos de SelectorField nao afetados"

  - id: F068
    name: "Custom name support in prayer selector fields"
    status: already_implemented
    rfs: []
    description: >
      Campos de oracao (abertura e encerramento) permitem nome customizado alem
      da lista de membros. PrayerSelector ja implementa: handleCustomName com
      memberId:null, botao customNameButton, sincronizacao search/customName.
      Nenhuma alteracao necessaria.
    modified_by_crs: [124]
    spec_file: "docs/specs/SPEC_F065_F068.yaml"
    notes:
      - "CR-124: JA IMPLEMENTADO"
      - "PrayerSelector.tsx ja suporta custom names (memberId: null)"
      - "handleCustomName, customNameButton ja existem"
      - "Nenhuma alteracao de codigo necessaria"

  # ---------------------------------------------------------------------------
  # Batch 10 Phase 1 (F069-F072) - LED Redesign, Data Cleanup, Status Options, Country Code Fix
  # ---------------------------------------------------------------------------

  - id: F069
    name: "StatusLED redesign - flat circle without 3D, new color scheme"
    status: pending
    rfs: []
    description: >
      Trocar StatusLED de design 3D (3 camadas: outerRing, innerCircle, glowDot)
      para circulo plano (flat) com cor solida unica. Novas cores:
      not_assigned=Cinza, assigned_not_invited=Laranja, assigned_invited=Amarelo,
      assigned_confirmed=Verde, gave_up=Vinho Escuro. Animacao de fading mantida
      para assigned_not_invited. Atualizar STATUS_INDICATOR_COLORS no
      StatusChangeModal com mesmas cores.
    modified_by_crs: [126]
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    notes:
      - "CR-126: LED flat sem efeito 3D com novo esquema de cores"
      - "Remover LEDColors interface, usar string simples"
      - "Remover 3 camadas (outerRing, innerCircle, glowDot)"
      - "Manter animacao de fading para assigned_not_invited"
      - "Atualizar STATUS_INDICATOR_COLORS no StatusChangeModal"

  - id: F070
    name: "Delete speeches when changing sunday type away from 'speeches'"
    status: pending
    rfs: []
    description: >
      Regressao do CR-115 (F061). Ao confirmar mudanca de tipo de domingo de
      'speeches' para outro, apagar registros de speeches (tabela speeches)
      para aquele ward_id + sunday_date. useSetSundayType so atualizava
      sunday_exceptions sem limpar speeches. Novo hook useDeleteSpeechesByDate
      chamado antes de setSundayType na callback de confirmacao.
    modified_by_crs: [127]
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    notes:
      - "CR-127: Bug critico - speeches nao apagados ao mudar tipo de domingo"
      - "Regressao de CR-115: confirmacao existe mas nao limpa dados"
      - "Novo hook useDeleteSpeechesByDate em useSpeeches.ts"
      - "Delete chamado antes de setSundayType na callback de confirmacao"
      - "Audit log registra a limpeza"

  - id: F071
    name: "LED click shows all status options except 'not_assigned'"
    status: superseded
    superseded_by: F077
    rfs: []
    description: >
      Regressao do CR-116 (F062). Ao clicar no LED, mostrar todas as opcoes
      de status EXCETO 'nao designado'. Isso substitui o filtro anterior que
      mostrava apenas 'confirmado' e 'desistiu' para assigned_invited.
      Para assigned_confirmed e gave_up, LED fica desabilitado pois a unica
      transicao (not_assigned) esta excluida pelo filtro.
    modified_by_crs: [129]
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    notes:
      - "CR-129: LED click mostra todos os status exceto not_assigned"
      - "Regressao de CR-116: filtro era muito restritivo"
      - "LED desabilitado para assigned_confirmed e gave_up"
      - "StatusChangeModal sem filtro nao afetado"

  - id: F072
    name: "Fix country code display for US/Canada (+1 ambiguity)"
    status: pending
    rfs: []
    description: >
      Regressao do CR-117 (F057). Display do pais selecionado usa
      getFlagForCode(countryCode) que retorna primeiro match para +1 (sempre US).
      Fix: usar getCountryByLabel(countryLabel)?.flag para exibir bandeira,
      pois countryLabel e unico ('Canada (+1)' vs 'United States (+1)').
    modified_by_crs: [130]
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    notes:
      - "CR-130: Selecionar Canada mostra bandeira de US"
      - "Regressao de CR-117: display usa code ao inves de label"
      - "getCountryByLabel ja existe em countryCodes.ts"
      - "Inicializacao com +1 mostra US por padrao (aceitavel)"

  # ---------------------------------------------------------------------------
  # Batch 10 Phase 2 (F073-F076) - Topic X Button, Hymn Search, Auto-Scroll Fix, Custom Prayer UX
  # ---------------------------------------------------------------------------

  - id: F073
    name: "Topic X button positioning - outside dropdown field"
    status: pending
    rfs: []
    description: >
      Botao X para limpar tema no SpeechSlot esta dentro do Pressable topicField
      (dentro da borda). Deve ser extraido e posicionado como sibling fora do
      campo, a direita, seguindo o padrao do botao X do campo de discursante.
    modified_by_crs: [128]
    spec_file: "docs/specs/SPEC_F073.yaml"
    notes:
      - "CR-128: X do topic dentro do campo, deveria estar fora como X do speaker"
      - "Criar topicRow (flexDirection:'row', gap:12) envolvendo topicField + X"
      - "Mover marginTop:6 e marginLeft:28 de topicField para topicRow"
      - "Adicionar flex:1 ao topicField"
      - "Padrao identico ao speaker row (styles.row)"

  - id: F074
    name: "Hymn search field width - match other selector search widths"
    status: pending
    rfs: []
    description: >
      Campo de search do HymnSelectorModal (bottom sheet) no AgendaForm tem
      estilo inconsistente (borderRadius:6, paddingHorizontal:10, sem height)
      vs outros seletores (height:40, borderRadius:8, paddingHorizontal:12).
      Simplificar styles.searchInput para { flex: 1 } e herdar estilos do
      SearchInput base.
    modified_by_crs: [131]
    spec_file: "docs/specs/SPEC_F074.yaml"
    notes:
      - "CR-131: Campo de search do hymn selector muito estreito"
      - "Remover overrides incorretos no styles.searchInput do AgendaForm"
      - "SearchInput.tsx base ja define estilos corretos (height:40, borderRadius:8)"
      - "Alteracao minima: simplificar para { flex: 1 }"

  - id: F075
    name: "Auto-scroll fix on card expand - remove getItemLayout"
    status: pending
    rfs: []
    supersedes: F066
    description: >
      Auto-scroll ao expandir cards ja implementado (ADR-047) mas impreciso
      porque getItemLayout retorna alturas fixas (70px speeches, 64px agenda)
      que nao correspondem a alturas reais dos cards. Remover getItemLayout
      de ambas as abas para que FlatList meca alturas reais. Substituir
      initialScrollIndex por useEffect em agenda.tsx.
    modified_by_crs: [132]
    spec_file: "docs/specs/SPEC_F075.yaml"
    notes:
      - "CR-132: Auto-scroll impreciso ao expandir cards"
      - "Supersede F066 (CR-120) que especificou o auto-scroll"
      - "Remover getItemLayout de speeches.tsx e agenda.tsx"
      - "Substituir initialScrollIndex por useEffect em agenda.tsx"
      - "Aumentar delay de 300ms para 400ms"

  - id: F076
    name: "Custom prayer name fields - improve discoverability and re-editing"
    status: pending
    rfs: []
    description: >
      Funcionalidade de nomes customizados para oracoes ja implementada
      (F068/CR-124) mas com UX ruim: (1) sem indicacao visual de que nomes
      customizados sao permitidos ao abrir o modal, (2) ao re-editar um nome
      customizado, campo de busca abre vazio sem mostrar o nome atual.
      Adicionar hint text fixo e pre-popular campo ao re-editar.
    modified_by_crs: [133]
    spec_file: "docs/specs/SPEC_F076.yaml"
    notes:
      - "CR-133: UX de nome customizado para oracoes ruim"
      - "Adicionar hint text descritivo abaixo do campo de busca"
      - "Pre-popular search/customName quando re-editando (memberId===null)"
      - "Adicionar i18n key agenda.customNameHint em 3 idiomas"

  # ---------------------------------------------------------------------------
  # Infrastructure (F011, F020-F023)
  # ---------------------------------------------------------------------------

  - id: F011
    name: "Real-time Sync"
    status: implemented
    rfs: [RF-17, RN-08]
    description: >
      Sincronizacao entre abas em ate 5 segundos via Supabase Realtime
      (WebSocket). Polling fallback a cada 2.5s quando WebSocket desconecta.
      Tabelas sincronizadas: members, speeches, sunday_exceptions,
      meeting_actors, sunday_agendas, ward_topics.
    modified_by_crs: [52]
    notes:
      - "CR-52: Conectou useRealtimeSync que era codigo morto"

  - id: F020
    name: "Internationalization (i18n)"
    status: implemented
    rfs: [RNF-08, RF-08.3]
    description: >
      Suporte a 3 idiomas: pt-BR, en, es via react-i18next. Idioma da ala
      configuravel. Ao iniciar o app, usa idioma da ala (se autenticado) ou
      idioma do dispositivo (fallback). Colecoes gerais filtradas por idioma.
      Todos os textos, labels, erros e mensagens traduzidos.
    modified_by_crs: [2, 11, 59]
    notes:
      - "CR-2: Corrigiu idioma nao aplicado apos criar ala"
      - "CR-11: Corrigiu idioma sempre em ingles ao iniciar Expo Go"
      - "CR-59: Internacionalizou ErrorBoundary e strings hardcoded"

  - id: F021
    name: "Dark/Light Mode"
    status: implemented
    rfs: [RNF-02]
    description: >
      Suporte a Automatico (deteccao do sistema), Light e Dark mode.
      Tela de selecao em Configuracoes. Toggle instantaneo (CR-65):
      estado atualizado imediatamente, persistencia assincrona via
      AsyncStorage. Todos os componentes usam cores do tema.
    modified_by_crs: [10, 65]
    notes:
      - "CR-10: Implementou tela de selecao de tema (antes onPress vazio)"
      - "CR-65: Corrigiu delay no toggle de tema (assincrono)"

  - id: F022
    name: "Offline Support"
    status: implemented
    rfs: [RNF-05]
    description: >
      Deteccao de conexao via useConnection. OfflineBanner exibido quando
      offline. Fila de mutacoes em AsyncStorage com last-write-wins.
      Sincronizacao ao reconectar.
    modified_by_crs: [52]
    notes:
      - "CR-52: Conectou useConnection e OfflineBanner que eram codigo morto"

  - id: F023
    name: "Permissions & Role-based Access"
    status: implemented
    rfs: [RN-11]
    description: >
      3 roles: bishopric, secretary, observer. Permissoes gerenciadas via
      lib/permissions.ts. Secretary pode designar via Agenda (excecao CR-31)
      mas nao via Discursos/Home. Secretary tem acesso a gerenciamento de
      usuarios (CR-23). Regra de auto-preside removida (CR-71).
    modified_by_crs: [23, 31, 37, 71]
    notes:
      - "CR-23: Secretary ganhou permissao settings:users"
      - "CR-31: Corrigiu contradicao ASM-009 (Secretary pode designar via Agenda)"
      - "CR-37: Atualizou docs para refletir CR-23"
      - "CR-71: Removeu regra de que ator que dirige tambem pode presidir"

  # ---------------------------------------------------------------------------
  # Admin & Audit (F013-F015, F018-F019)
  # ---------------------------------------------------------------------------

  - id: F013
    name: "Meeting Actors Management"
    status: implemented
    rfs: [RF-22]
    description: >
      Gestao inline de atores dentro dos cards da agenda (CR-26). Ao clicar
      em campo de ator (presidir, dirigir, pianista, regente), abre dialogo
      bottom-sheet 2/3 da tela com busca, lista filtrada por role, e opcoes
      de adicionar (so nome, role inferido do campo), editar nome e excluir.
      A palavra "ator/atores" NAO aparece na UI. Tela separada de atores
      em Configuracoes foi removida. Icones de edicao/exclusao com tamanho
      adequado (CR-70). Reconhecendo a Presenca usa ActorSelector (CR-73).
    modified_by_crs: [26, 34, 70, 71, 72, 73]
    notes:
      - "CR-26: Redesign completo - gestao inline na agenda"
      - "CR-34: Atualizou docs removendo checkboxes"
      - "CR-70: Aumentou icones de edicao/exclusao"
      - "CR-71: Removeu regra auto-preside (can_conduct nao implica can_preside)"
      - "CR-72: Bispado registrado auto-adicionado como ator (can_preside+can_conduct)"
      - "CR-73: Campo Reconhecendo usa ActorSelector com filtro can_recognize"

  - id: F014
    name: "Hymns Catalog & Import"
    status: implemented
    rfs: [RF-23, RF-23.1]
    description: >
      Tabela global de hinos da Igreja com suporte a i18n. Importacao via
      script CLI (pnpm import-hymns). Seletor de hinos em dialogo 2/3 da
      tela com busca por numero ou titulo. Subset de hinos sacramentais
      (is_sacramental=true). ~300 hinos por idioma.
    modified_by_crs: [28, 51]
    notes:
      - "CR-28: Dialogo de hinos usa 2/3 da tela"
      - "CR-51: Criou script CLI pnpm import-hymns"

  - id: F015
    name: "Prayer Selection"
    status: implemented
    rfs: [RF-24]
    description: >
      Campos de oracao de abertura e fechamento na agenda. Permite selecionar
      membro da ala (MemberSelectorModal) OU digitar nome customizado (CR-74).
      Nome customizado persistido apenas em *_name sem criar membro.
      *_member_id = null quando nome customizado.
    modified_by_crs: [74]
    notes:
      - "CR-74: Adicionou suporte a nomes customizados para oracoes"

  - id: F018
    name: "User Management (CRUD)"
    status: implemented
    rfs: [RF-33, RF-34, RF-35, RF-36]
    description: >
      Tela de gerenciamento de usuarios em Configuracoes. Listar, editar role,
      excluir usuarios. Convidar novos usuarios por link. Visivel para
      Bispado e Secretario (CR-23). Gerenciado via 6 Edge Functions:
      register-first-user, create-invitation, register-invited-user,
      list-users, update-user-role, delete-user.
    modified_by_crs: [23, 37, 64]
    notes:
      - "CR-23: Secretario ganhou acesso a tela de usuarios"
      - "CR-37: Docs atualizados para refletir CR-23"
      - "CR-64: Corrigiu erro vermelho na tela de usuarios para Secretario"

  - id: F019
    name: "Activity Log (History)"
    status: implemented
    rfs: [RF-37]
    description: >
      Historico de acoes read-only com busca. Retencao de 2 anos.
      Descricoes human-readable no idioma da ala (CR-22). Action types:
      member:create/update/delete/import, topic:create/update/delete,
      collection:activate/deactivate, sunday_type:change,
      speech:assign/unassign/status_change, user:*, settings:*.
    modified_by_crs: [18, 19, 22]
    notes:
      - "CR-18: Corrigiu mudanca de tipo de domingo nao logada"
      - "CR-19: Adicionou botao de voltar na tela"
      - "CR-22: Tornou descricoes human-readable"

  # ---------------------------------------------------------------------------
  # Testing Infrastructure (F082)
  # ---------------------------------------------------------------------------

  - id: F082
    name: "Integration Tests (hooks, providers, component-hook data flow)"
    status: pending
    rfs: []
    description: >
      Testes de integracao que verificam a interacao entre modulos reais do app:
      hooks + Supabase mockado + React Query, SyncProvider orquestrando sub-hooks,
      AuthContext com fluxo de sessao, componentes consumindo dados de hooks.
      Usa renderHook/render do @testing-library/react-native com wrappers reais
      (QueryClientProvider, AuthContext mock) e Supabase client mockado.
      4 categorias: (1) 9 hooks CRUD com Supabase, (2) SyncProvider orchestration,
      (3) AuthContext flow, (4) Components + hooks data flow.
      NAO sao testes e2e (nao usam backend real).
    modified_by_crs: [139]
    spec_file: "docs/specs/SPEC_F082.yaml"
    notes:
      - "CR-139: Adicionar testes de integracao ao projeto"
      - "30 acceptance criteria, ~60-80 test cases"
      - "5 novos arquivos (4 test files + 1 setup), 0 arquivos existentes modificados"
      - "Infraestrutura ja suporta: Vitest 4 + @testing-library/react-native 13"

  # ---------------------------------------------------------------------------
  # Batch 13: Settings Rename, Agenda Sunday Type, Activity Log i18n, Query Perf, Security (F083-F087)
  # ---------------------------------------------------------------------------

  - id: F083
    name: "Rename Settings tab options with i18n"
    status: pending
    rfs: []
    description: >
      Alterar os labels (nomes) de 5 opcoes na aba Configuracoes e seus
      respectivos titulos nas telas internas. Membros->Discursantes,
      Temas->Biblioteca de Temas, Usuarios->Usuarios do App,
      Historico->Historico de Uso, Tema->Tema Claro/Escuro. Mudancas
      exclusivamente nos 3 arquivos de i18n (pt-BR, en, es).
    modified_by_crs: [140]
    spec_file: "docs/specs/SPEC_F083.yaml"
    notes:
      - "CR-140: Renomear opcoes da aba Configuracoes com i18n"
      - "10 acceptance criteria (5 cards + 5 titulos internos)"
      - "3 arquivos modificados (somente locales JSON)"
      - "Nenhuma alteracao de codigo TypeScript"

  - id: F084
    name: "Sunday type selector as first field in Agenda card"
    status: pending
    rfs: []
    description: >
      Adicionar seletor de tipo de Domingo como primeiro campo do card de
      Agenda (igual aba Discursos). Se trocar de Discursos para outro tipo
      com designacoes, mostrar dialogo de confirmacao e apagar speeches.
      Reutiliza SundayTypeDropdown existente.
    modified_by_crs: [141]
    spec_file: "docs/specs/SPEC_F083.yaml"
    notes:
      - "CR-141: Seletor de tipo de domingo na aba Agenda"
      - "9 acceptance criteria"
      - "Reutiliza componente SundayTypeDropdown existente"
      - "Reutiliza logica de confirmacao + delete de F061/F070"

  - id: F085
    name: "Activity log entries overhaul with friendly i18n descriptions"
    status: pending
    rfs: []
    description: >
      Revisao completa das entradas do historico de atividades. Formato
      estruturado no banco (action_type|key=value) com renderizacao i18n
      na UI. 24 tipos de eventos com templates traduzidos em 3 idiomas.
      Fallback para registros antigos em formato texto plano.
    modified_by_crs: [142]
    spec_file: "docs/specs/SPEC_F083.yaml"
    notes:
      - "CR-142: Activity log entries overhaul com i18n"
      - "17 acceptance criteria"
      - "24 action_types com templates i18n"
      - "Abordagem hibrida: formato estruturado no banco + renderizacao i18n na UI"
      - "Fallback para registros antigos (texto plano)"
      - "Adiciona logAction faltante em useAssignTopic"

  - id: F086
    name: "Replace pg_timezone_names with static timezone list"
    status: pending
    rfs: []
    description: >
      Query pg_timezone_names com 0% cache hit rate e 270ms mean. App ja
      usa lista estatica de timezones. Verificar se ha referencia server-side
      a pg_timezone_names e remover. Se for query do dashboard, documentar.
    modified_by_crs: [143]
    spec_file: "docs/specs/SPEC_F083.yaml"
    notes:
      - "CR-143: Otimizacao de query performance Supabase"
      - "3 acceptance criteria (verificacao, nao implementacao)"
      - "App ja usa lista estatica TIMEZONES no timezone.tsx"
      - "Potencialmente nada a implementar se for query do dashboard"

  - id: F087
    name: "Fix mutable search_path in 7 PostgreSQL functions"
    status: pending
    rfs: []
    description: >
      7 funcoes PostgreSQL sem search_path fixo: update_updated_at_column,
      ward_id, list_ward_users, create_weekly_reminders,
      enqueue_speech_notification, delete_old_activity_log, import_members.
      Nova migracao SQL (015) recria todas com SET search_path = '' e
      referencias de tabela qualificadas com schema explicito.
    modified_by_crs: [144]
    spec_file: "docs/specs/SPEC_F083.yaml"
    notes:
      - "CR-144: Correcoes de seguranca Supabase (search_path)"
      - "9 acceptance criteria"
      - "1 novo arquivo SQL de migracao"
      - "Leaked Password Protection: configuracao de dashboard (nao codigo)"

  # ---------------------------------------------------------------------------
  # Batch 14 Phase 1: Email Reset, Offline UX, Alert Messages, Button Logic (F088-F092)
  # ---------------------------------------------------------------------------

  - id: F088
    name: "Customize password reset email template and redirect URL"
    status: pending
    rfs: []
    description: >
      Email de reset de senha mostra branding "Supabase" e link aponta para
      localhost. Criar Edge Function para envio customizado de email com
      template traduzido (pt-BR, en, es) conforme ward.language. Redirect
      via deep link sacrmeetman://reset-password que abre tela no app.
      Nova tela de redefinicao de senha acessivel via deep link.
    modified_by_crs: [145]
    spec_file: "docs/specs/SPEC_F088.yaml"
    notes:
      - "CR-145: Email de reset sem referencia ao app e link para localhost"
      - "5 acceptance criteria"
      - "Edge Function send-reset-email com template i18n (3 idiomas)"
      - "Deep link sacrmeetman://reset-password para abrir no app"
      - "Nova tela reset-password.tsx acessivel via deep link"
      - "Modifica forgot-password.tsx para chamar Edge Function"

  - id: F089
    name: "Graceful degradation when app is offline"
    status: pending
    rfs: []
    description: >
      Quando offline, mensagens de erro tecnicas aparecem em todas as tabs.
      Integrar TanStack Query onlineManager com useConnection para pausar
      queries, mostrar dados em cache, suprimir Alert.alert de erros de rede,
      e re-executar queries ao reconectar. Estende F022 (Offline Support).
    modified_by_crs: [146]
    spec_file: "docs/specs/SPEC_F089.yaml"
    notes:
      - "CR-146: Degradacao graciosa quando offline"
      - "6 acceptance criteria"
      - "Integra onlineManager com useConnection"
      - "Suprime erros de rede no MutationCache.onError"
      - "Estende F022 sem quebrar comportamento existente"

  - id: F090
    name: "Improve offline banner readability on iPhone"
    status: pending
    rfs: []
    description: >
      OfflineBanner fica atras do notch/Dynamic Island do iPhone. Adicionar
      useSafeAreaInsets para paddingTop, aumentar fontSize de 14/12 para 15/13.
      react-native-safe-area-context ja instalado no projeto.
    modified_by_crs: [147]
    spec_file: "docs/specs/SPEC_F090.yaml"
    notes:
      - "CR-147: Banner offline dificil de ler no iPhone"
      - "4 acceptance criteria"
      - "1 arquivo modificado (OfflineBanner.tsx)"
      - "Adicionar useSafeAreaInsets para paddingTop"

  - id: F091
    name: "Improve sunday type change confirmation message with specific text"
    status: pending
    rfs: []
    description: >
      Mensagem de confirmacao ao mudar tipo de domingo com designacoes
      atualizada para texto especifico pedido pelo usuario. Atualizacao
      apenas de valores i18n (changeConfirmTitle e changeConfirmMessage)
      nos 3 locales. Nenhuma alteracao de codigo TypeScript.
    modified_by_crs: [148]
    spec_file: "docs/specs/SPEC_F091.yaml"
    notes:
      - "CR-148: Mensagem de alerta ao trocar tipo de domingo"
      - "5 acceptance criteria"
      - "3 arquivos modificados (somente locales JSON)"
      - "Nenhuma alteracao de codigo TypeScript"
      - "Mesmo dialogo usado na aba Discursos e Agenda (F084)"

  - id: F092
    name: "Make 'Start Sacrament Meeting' button always visible with date-based logic"
    status: pending
    rfs: []
    description: >
      Botao "Iniciar Reuniao Sacramental" na Home passa a ser visivel
      sempre (nao apenas aos domingos). Remover condicao isTodaySunday().
      getTodaySundayDate() ja implementa logica de data correta (seg-sab:
      proximo domingo, domingo: hoje). Mudanca apenas em index.tsx.
    modified_by_crs: [149]
    spec_file: "docs/specs/SPEC_F092.yaml"
    notes:
      - "CR-149: Botao 'Iniciar Reuniao' visivel sempre"
      - "5 acceptance criteria"
      - "1 arquivo modificado (index.tsx)"
      - "Remover condicao showMeetingButton/isTodaySunday"
      - "getTodaySundayDate() ja tem logica de data correta"

  # ---------------------------------------------------------------------------
  # Batch 14 Phase 2: Card Layouts, Pianist/Conductor, Hymn Toggle, Status Lines (F093-F096)
  # ---------------------------------------------------------------------------

  - id: F093
    name: "Collapsed designation card layouts with speaker names and vertical LEDs"
    status: pending
    rfs: []
    description: >
      Card de domingo contraido (Home e Discursos) mostra 3 linhas de nomes dos
      discursantes ('{N}o Discurso: <nome>') e LEDs verticais alinhados a direita.
      Linhas vazias mantidas para alinhamento. Escondidos ao expandir.
    modified_by_crs: [150]
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    notes:
      - "CR-150: Layout dos cards contraidos com nomes de discursantes"
      - "7 acceptance criteria"
      - "1 arquivo modificado (SundayCard.tsx)"
      - "LEDs de horizontal para vertical no collapsed"
      - "Afeta aba Discursos e Home (componente compartilhado)"

  - id: F094
    name: "Pianist and Conductor fields in Agenda Welcome section"
    status: pending
    rfs: []
    description: >
      Campos Pianista e Regente na secao Boas-Vindas da agenda, usando
      ActorSelector com roleFilter can_music. Posicao: apos Anuncios, antes
      de Hino de Abertura. DB ja tem colunas; falta apenas UI e apresentacao.
    modified_by_crs: [151]
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    notes:
      - "CR-151: Campos Pianista e Regente na agenda"
      - "9 acceptance criteria"
      - "2 arquivos modificados (AgendaForm.tsx, usePresentationMode.ts)"
      - "DB colunas ja existem (pianist_*, conductor_*)"
      - "i18n keys ja existem nos 3 idiomas"

  - id: F095
    name: "Toggle for Intermediate Hymn in Agenda"
    status: pending
    rfs: []
    description: >
      Toggle para Hino Intermediario na agenda. Ligado por padrao em reuniao
      normal. Auto-desligado e escondido quando apresentacao especial ligada
      ou reuniao de testemunho/primaria. Controla visibilidade do seletor de hino.
      Estado persistido no DB via nova coluna has_intermediate_hymn BOOLEAN
      DEFAULT true (decisao OQ-2). Requer nova migracao SQL.
    modified_by_crs: [152]
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    notes:
      - "CR-152: Toggle para Hino Intermediario"
      - "7 acceptance criteria"
      - "2 arquivos modificados (AgendaForm.tsx, database.ts) + 1 migracao SQL"
      - "Nova coluna has_intermediate_hymn BOOLEAN DEFAULT true (decisao OQ-2)"
      - "Interacao com toggle de Apresentacao Especial"

  - id: F096
    name: "Collapsed agenda card status lines with completion info"
    status: pending
    rfs: []
    description: >
      Card de agenda contraido mostra linhas de status: Falta (campos vazios),
      Discursantes X/3, Oradores Y/2 (oracoes, decisao OQ-4), Hinos Z/W.
      Para excecoes nao-discursos, mostra texto da excecao em amarelo. Linhas
      completas em verde. Agendas carregadas via query de range (decisao OQ-1).
    modified_by_crs: [153]
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    notes:
      - "CR-153: Layout dos cards de agenda contraidos com status"
      - "11 acceptance criteria"
      - "1 arquivo modificado (agenda.tsx) + 1 novo hook (useAgendaRange.ts)"
      - "Agendas carregadas para range visivel (decisao OQ-1)"
      - "Oradores = oracoes opening/closing prayer (decisao OQ-4)"
      - "Depende de F094 (Pianista/Regente) e F095 (toggle Hino)"

  # ---------------------------------------------------------------------------
  # Batch 15 Phase 1 (F097-F100) - Presentation mode, Speech labels, Card redesign
  # ---------------------------------------------------------------------------

  - id: F097
    name: "Presentation mode improvements: arrows, recognized names, font size, section titles"
    status: pending
    rfs: []
    description: >
      Presentation mode UI improvements: (1) arrows based on position relative
      to expanded card (above=down, below=up, expanded=none), (2) recognized
      names one per line (join with newline instead of comma), (3) font size
      toggle button (normal/large) next to close button, (4) section titles
      matching AgendaForm section headers (sectionWelcome, sectionSacrament,
      sectionFirstSpeeches, sectionLastSpeech).
    modified_by_crs: [156, 157, 158, 159]
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    notes:
      - "CR-156: Arrows based on card position relative to expanded card"
      - "CR-157: Recognized names one per line"
      - "CR-158: Font size toggle (normal +1 / large) with button in header"
      - "CR-159: Section titles matching agenda card section headers"
      - "14 acceptance criteria"
      - "3 files modified (AccordionCard.tsx, presentation.tsx, usePresentationMode.ts)"

  - id: F098
    name: "Speech label context-aware display and speaker placeholder fix"
    status: pending
    rfs: []
    description: >
      Position 3 label shows "3o Discurso" in Speeches tab (collapsed and
      expanded) instead of "Ultimo Discurso". Agenda tab keeps "Ultimo Discurso".
      Speaker placeholder changed from "Selecionar orador" to "Selecionar
      Discursante" in pt-BR and es. English keeps "Select Speaker" (capitalized).
    modified_by_crs: [160, 163]
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    notes:
      - "CR-160: 'Ultimo Discurso' only in Agenda tab, '3o Discurso' in Speeches tab"
      - "CR-163: Placeholder 'Selecionar Orador' -> 'Selecionar Discursante' all languages"
      - "8 acceptance criteria"
      - "5 files modified (SundayCard.tsx, SpeechSlot.tsx, 3 locale files)"
      - "Modifies F093 label for position 3 in Speeches tab context"

  - id: F099
    name: "Collapsed speech card redesign - LED before label, increased font, reduced circle"
    status: pending
    rfs: []
    description: >
      Redesign collapsed speech card: move LED circles from right side to before
      each label text ('<circle> 1o Discurso: <nome>'). Increase font from 11
      to 13, add line spacing, reduce circle size from 14 to 10. When no speaker
      assigned, show only the status circle with no text.
    modified_by_crs: [161]
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    notes:
      - "CR-161: LED before label, increased font, reduced circle, no-assignment behavior"
      - "10 acceptance criteria"
      - "1 file modified (SundayCard.tsx)"
      - "Redesigns F093 collapsed card layout"
      - "Affects Speeches tab and Home tab (shared SundayCard component)"

  - id: F100
    name: "Expanded speech card status circle moved to label line, right-aligned"
    status: pending
    rfs: []
    description: >
      Move StatusLED from speaker field row to label row, right-aligned with
      status text. Format: '{label}...{status text} {circle}'. Speaker and
      topic fields now use full line width (no LED offset). Status text uses
      speechStatus i18n keys. LED and text are pressable for status change.
    modified_by_crs: [162]
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    notes:
      - "CR-162: Move LED to label line with status text, right-aligned"
      - "11 acceptance criteria"
      - "1 file modified (SpeechSlot.tsx)"
      - "Speaker/topic fields use full width (marginLeft:28 removed)"
      - "Status text from speechStatus i18n keys (already exist)"

  # ---------------------------------------------------------------------------
  # Batch 15 Phase 2 (F101-F102) - Multilingual reset email, Test suite fix
  # ---------------------------------------------------------------------------

  - id: F101
    name: "Multilingual password reset email via Edge Function"
    status: pending
    rfs: []
    description: >
      Implementar Opcao B da SPEC F088: Edge Function send-reset-email que
      recebe email, busca ward.language, gera token via generateLink, envia
      email traduzido nos 3 idiomas (pt-BR, en, es) via Resend API. Deep link
      sacrmeetman://reset-password?token=TOKEN no email. forgot-password.tsx
      chama Edge Function. reset-password.tsx aceita token via query params
      e usa verifyOtp para estabelecer sessao.
    modified_by_crs: [155]
    spec_file: "docs/specs/SPEC_F101_F102.yaml"
    notes:
      - "CR-155: Substituir Opcao A (template unico) por Opcao B (Edge Function i18n)"
      - "12 acceptance criteria"
      - "1 file created (send-reset-email Edge Function), 2 files modified"
      - "Requer RESEND_API_KEY e RESEND_FROM_EMAIL como secrets"
      - "Modifica forgot-password.tsx e reset-password.tsx"

  - id: F102
    name: "Test suite 100% passing"
    status: pending
    rfs: []
    description: >
      Corrigir 2 testes falhando em batch7-f035-f039.test.ts que esperam
      com.wardmanager.app mas o valor real e com.sacramentmeetingmanager.app.
      Atualizar testes afetados pelas mudancas da F101 (forgot-password e
      reset-password). Garantir 100% da suite passando.
    modified_by_crs: [164]
    spec_file: "docs/specs/SPEC_F101_F102.yaml"
    notes:
      - "CR-164: Fix 2 pre-existing failures + update tests for F101 changes"
      - "5 acceptance criteria"
      - "Modify batch7-f035-f039.test.ts and batch14-f088-f092.test.ts"
      - "Must run after F101 implementation"

  # ---------------------------------------------------------------------------
  # Batch 17 (F110-F112) - Stake announcements in presentation, AgendaForm label, SpeechSlot alignment
  # ---------------------------------------------------------------------------

  - id: F110
    name: "Presentation mode: show Stake Sustainings and Releases card when toggle is on"
    status: pending
    rfs: []
    description: >
      Quando toggle has_stake_announcements esta ligado, adicionar campo no
      Card 2 (Designacoes e Sacramento) da tela de apresentacao com subtitulo
      (label) usando i18n key agenda.stakeAnnouncements e valor (texto) usando
      novo i18n key presentation.stakeAnnouncementsText. Posicao: apos
      baptism_confirmation, antes do sacrament_hymn. Novo i18n key nos 3 idiomas.
    modified_by_crs: [172]
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    notes:
      - "CR-172: Stake announcements in presentation mode"
      - "5 acceptance criteria"
      - "4 files modified (usePresentationMode.ts, 3 locale files)"
      - "New i18n key: presentation.stakeAnnouncementsText"
      - "Existing i18n key used as label: agenda.stakeAnnouncements"

  - id: F111
    name: "AgendaForm: fix last speech label from 'Ultimo Discurso - Discurso' to 'Ultimo Discurso'"
    status: pending
    rfs: []
    description: >
      Trocar label redundante no campo do ultimo discursante na AgendaForm de
      '${t("speeches.lastSpeech")} - ${t("speeches.speaker")}' para apenas
      t("speeches.lastSpeech"). Mesma correcao que CR-170/F108 fez na
      usePresentationMode.ts, agora aplicada na AgendaForm.tsx (linha 429).
    modified_by_crs: [173]
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    notes:
      - "CR-173: Same fix as CR-170 but in AgendaForm"
      - "4 acceptance criteria"
      - "1 file modified (AgendaForm.tsx)"
      - "No new i18n keys needed"

  - id: F112
    name: "SpeechSlot: vertically align center of StatusLED with center of X remove button"
    status: pending
    rfs: []
    description: >
      Reestruturar layout do SpeechSlot para alinhar centro-a-centro o circulo
      do StatusLED (label row) com o botao X de remover (speaker row). Abordagem
      recomendada: coluna de largura fixa a direita compartilhada entre as rows.
      Substitui a abordagem do CR-165/F103 (paddingRight:5 insuficiente).
    modified_by_crs: [174]
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    notes:
      - "CR-174: Center-to-center alignment supersedes CR-165/F103"
      - "6 acceptance criteria"
      - "1 file modified (SpeechSlot.tsx)"
      - "Removes paddingRight:5 from statusSection (CR-165 remnant)"
      - "Fixed-width right column approach recommended"

  - id: F113
    name: "Change deep link scheme from sacrmeetman:// to sacrmeetplan://"
    status: pending
    rfs: []
    description: >
      Alterar scheme de deep link de sacrmeetman:// para sacrmeetplan:// em
      3 locais: app.json (scheme), create-invitation Edge Function (deep link
      de convite), send-reset-email Edge Function (deep link de reset de
      senha). Nao alterar bundleIdentifier ou package do app. Atualizar
      Redirect URLs no Supabase Dashboard (manual).
    modified_by_crs: [175]
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    notes:
      - "CR-175: Scheme sacrmeetman:// deve ser sacrmeetplan://"
      - "3 arquivos de codigo fonte impactados"
      - "6 acceptance criteria"
      - "Requer atualizacao manual das Redirect URLs no Supabase Dashboard"
      - "Supersede parcial do CR-93/F037 (que mudou wardmanager -> sacrmeetman)"

  - id: F114
    name: "Email reset: HTTPS redirect Edge Function to make reset button clickable"
    status: pending
    rfs: []
    description: >
      Email de recuperacao de senha usa custom URL scheme no href do botao,
      que email clients bloqueiam. Criar Edge Function HTTPS intermediaria
      (reset-redirect) que recebe token via query params e serve pagina HTML
      com auto-redirect para sacrmeetplan://reset-password. Alterar
      send-reset-email para usar URL HTTPS no email ao inves do scheme custom.
    modified_by_crs: [176]
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    notes:
      - "CR-176: Botao do email nao clicavel por bloqueio de custom schemes"
      - "1 arquivo criado (reset-redirect Edge Function), 1 modificado (send-reset-email)"
      - "8 acceptance criteria"
      - "URL HTTPS: https://poizgglzdjqwrhsnhkke.supabase.co/functions/v1/reset-redirect?token=...&type=recovery"
      - "Fallback button na pagina HTML para redirect manual"

  - id: F115
    name: "SpeechSlot: align right edge of status circle with right edge of speaker name field"
    status: pending
    rfs: []
    description: >
      Mover StatusLED do rightColumn para o labelRow (leftColumn), ao lado
      do texto de status. Isso alinha a borda direita do circulo com a borda
      direita do campo do discursante. rightColumn permanece apenas para
      botoes X. Supersede a abordagem de alinhamento centro-a-centro do
      CR-174/F112.
    modified_by_crs: [177]
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    notes:
      - "CR-177: Alinhar direita do circulo com direita do campo do nome"
      - "Supersede CR-174/F112 (alinhamento centro-a-centro)"
      - "8 acceptance criteria"
      - "1 arquivo modificado (SpeechSlot.tsx)"
      - "Move StatusLED de rightColumn para labelRow"

  # ---------------------------------------------------------------------------
  # Batch 19 Phase 1 (F116-F119): Language control, Pianist/Conductor split,
  #   Optional 2nd speech, Password reset bug
  # ---------------------------------------------------------------------------

  - id: F116
    name: "Separate language control: app language (per-user) vs ward language"
    status: pending
    rfs: []
    description: >
      Separar controle de idioma em dois: idioma do app (per-user, salvo em
      auth.users.raw_user_meta_data via Supabase Auth) e idioma da ala
      (wards.language, inalterado). Idioma do app controla UI e nomes de
      placeholders do WhatsApp. Idioma da ala controla template WhatsApp,
      colecoes de temas, e logs. Observer ganha aba Settings limitada (idioma
      do app, tema, sobre). Fix do bug de reativacao de colecoes ao trocar
      idioma da ala.
    modified_by_crs: [178]
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    notes:
      - "CR-178: Controle de idioma separado app vs ala"
      - "Idioma do app salvo em Supabase Auth user_metadata"
      - "Observer ganha Settings limitado (3 opcoes)"
      - "Placeholders do WhatsApp traduzidos por idioma do APP"
      - "Bug fix: reativacao de colecoes ao trocar idioma da ala"
      - "11 acceptance criteria, 4 edge cases"
      - "10+ arquivos impactados"

  - id: F117
    name: "Split Music actor type into Pianist and Conductor"
    status: pending
    rfs: []
    description: >
      Dividir can_music em can_pianist e can_conductor na tabela meeting_actors.
      Constraint CHECK: ator nao pode ser pianista E regente ao mesmo tempo
      (entradas separadas). Migracao: can_music=true vira can_pianist=true.
      AgendaForm usa roleFilter separados. Designacoes existentes preservadas.
    modified_by_crs: [180]
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    notes:
      - "CR-180: Split Musica em Pianista + Regente"
      - "CHECK constraint: NOT (can_pianist AND can_conductor)"
      - "Migracao: can_music -> can_pianist"
      - "12 acceptance criteria, 4 edge cases"
      - "5 arquivos impactados + 1 migracao SQL"

  - id: F118
    name: "Optional 2nd speech toggle per Sunday"
    status: pending
    rfs: []
    description: >
      Toggle para tornar o 2o discurso opcional por domingo. Novo campo
      has_second_speech na sunday_agendas (default true). Toggle pequeno no
      SpeechSlot posicao 2 (Bispado only). Confirmacao ao desligar SO quando
      ha designacoes. Card contraido: sem labels ordinais, sem linha pos 2
      quando desligado. Label posicao 3 vira 'Ultimo Discurso'. Apresentacao:
      secao 'Primeiros Discursos' mostra so 1o quando desligado.
    modified_by_crs: [181]
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    notes:
      - "CR-181: 2o discurso opcional por domingo"
      - "Toggle por domingo, default ligado"
      - "Sem confirmacao quando sem designacoes"
      - "Labels ordinais removidos do card contraido"
      - "'3o Discurso' -> 'Ultimo Discurso' no card expandido"
      - "14 acceptance criteria, 4 edge cases"
      - "10+ arquivos impactados + 1 migracao SQL"

  - id: F119
    name: "Fix password reset redirect showing HTML as plain-text"
    status: pending
    rfs: []
    description: >
      Bug: ao clicar 'Redefinir Senha' no email (Gmail->Safari iOS), browser
      mostra plain-text do HTML. Requer investigacao profunda: charset fix +
      Cache-Control como baseline, mas root cause deve ser identificado
      (Supabase proxy, Deno runtime, browser-specific behavior).
    modified_by_crs: [191]
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    notes:
      - "CR-191: Reset senha mostra HTML como plain-text"
      - "Investigacao profunda (nao apenas charset fix)"
      - "7 acceptance criteria, 3 edge cases"
      - "1 arquivo impactado (reset-redirect/index.ts)"

  # ---------------------------------------------------------------------------
  # Batch 19 Phase 2 (F120-F125): Card UI/UX, label renames, push notifications
  # ---------------------------------------------------------------------------

  - id: F120
    name: "X button to clear non-free-text, non-switch fields in Agenda card"
    status: pending
    rfs: []
    description: >
      Adicionar botao X a todos os campos de selecao (atores, hinos, oracoes,
      reconhecendo) no AgendaForm para limpar valor atual. X visivel quando campo
      tem valor e usuario nao e Observer. Sem dialogo de confirmacao. Campos de
      texto livre e switches nao afetados.
    modified_by_crs: [179]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-179: X button para limpar campos de selecao na agenda"
      - "10 acceptance criteria"
      - "Afeta SelectorField e AgendaForm.tsx"
      - "Campos afetados: presidir, dirigir, reconhecendo, pianista, regente, hinos (4), oracoes (2)"
      - "Nao afeta DebouncedTextInput, Switch, nem SpeakerField"

  - id: F121
    name: "Remove speech editing from Agenda card; navigate to Speeches tab"
    status: pending
    rfs: []
    description: >
      Remover edicao de discursos (SpeakerField com override) do card de agenda.
      Campos mostram nome do discursante como read-only. Botao com icone de lapis
      a direita de cada campo navega para aba Discursos com card do domingo expandido.
      Override DB fields permanecem (Presentation Mode ainda usa). Supersede
      SpeakerField editing do F044 no AgendaForm.
    modified_by_crs: [182]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-182: Remover edicao de discursos do card de agenda"
      - "8 acceptance criteria, 3 edge cases"
      - "Supersede SpeakerField editing do F044 no AgendaForm"
      - "Pencil button navega para Speeches tab com expandDate param"
      - "Observer nao ve pencil button"

  - id: F122
    name: "Rename 'Proximas Designacoes' to 'Proximos Discursos' in all languages"
    status: pending
    rfs: []
    description: >
      Trocar texto da secao 'Proximas Designacoes' na Home para 'Proximos
      Discursos' em todos os 3 idiomas. Key i18n home.nextAssignments permanece
      (apenas o valor muda). pt-BR: 'Proximos Discursos', en: 'Upcoming Speeches',
      es: 'Proximos Discursos'.
    modified_by_crs: [183]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-183: Renomear secao na Home"
      - "4 acceptance criteria"
      - "3 arquivos modificados (somente locales JSON)"
      - "Nenhuma alteracao de codigo TypeScript"

  - id: F123
    name: "Rename tab 'Agenda' to 'Agendas' in all languages"
    status: pending
    rfs: []
    description: >
      Trocar nome da aba 'Agenda' para 'Agendas' em todos os 3 idiomas. Afeta
      tabs.agenda e agenda.title nos 3 locales. 'Agendas' e a mesma palavra
      nos 3 idiomas (plural).
    modified_by_crs: [187]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-187: Renomear aba Agenda para Agendas"
      - "4 acceptance criteria"
      - "3 arquivos modificados (somente locales JSON)"
      - "Nenhuma alteracao de codigo TypeScript"

  - id: F124
    name: "Fix alignment of X clear buttons in SpeechSlot"
    status: pending
    rfs: []
    description: >
      Corrigir alinhamento dos icones X no SpeechSlot. Centro do icone X do
      speaker deve alinhar horizontalmente com centro do campo de selecao do
      discursante. Centro do X do tema deve alinhar com centro do campo de tema.
      Causa: statusLedPlaceholder no rightColumn cria offset vertical.
    modified_by_crs: [189]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-189: Alinhamento dos icones X no card de discursos"
      - "6 acceptance criteria, 2 edge cases"
      - "1 arquivo modificado (SpeechSlot.tsx)"
      - "Deve ser compativel com F115/CR-177 layout"

  - id: F125
    name: "Fix push notifications not working (projectId undefined)"
    status: pending
    rfs: []
    description: >
      Push notifications nao funcionam porque useNotifications.ts passa
      projectId: undefined para getExpoPushTokenAsync. O correto e usar
      Constants.expoConfig?.extra?.eas?.projectId (valor:
      '6ce6536e-08c4-4c3a-ac06-f1c224e43dbd' do app.json). Fix client-side
      apenas. Server-side Edge Function esta correta.
    modified_by_crs: [192]
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    notes:
      - "CR-192: Bug critico - push notifications nao funcionam"
      - "7 acceptance criteria, 3 edge cases"
      - "1 arquivo modificado (useNotifications.ts)"
      - "Root cause: projectId: undefined no getExpoPushTokenAsync"
      - "Fix: importar Constants e passar projectId correto"

  # ---------------------------------------------------------------------------
  # Batch 20 Phase 1 (F126-F129): Navigation & Home redesign
  # ---------------------------------------------------------------------------

  - id: F126
    name: "Pencil icon in Presentation screen to navigate to Agenda tab for editing"
    status: pending
    rfs: []
    description: >
      Adicionar icone de lapis na tela de Apresentacao (header) ao lado do botao
      de tamanho de fonte. Ao clicar, navega para aba Agendas com card do domingo
      expandido para edicao. Requer suporte a expandDate query param na aba Agendas
      (seguindo padrao ADR-082 do speeches.tsx).
    modified_by_crs: [184]
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    notes:
      - "CR-184: Pencil button na tela de Apresentacao -> Agenda tab"
      - "7 acceptance criteria, 3 edge cases"
      - "2 arquivos impactados: presentation.tsx, agenda.tsx"
      - "Requer implementacao de expandDate na aba Agendas (ADR-082)"
      - "Pencil button identico ao fontToggleButton (36x36 circle)"

  - id: F127
    name: "Play button in expanded Agenda card to navigate to Presentation screen"
    status: pending
    rfs: []
    description: >
      Adicionar botao play no card expandido da agenda (ao lado da seta de colapsar).
      Ao clicar, navega para tela de Apresentacao com o domingo selecionado. Requer
      que Presentation screen aceite parametro de data opcional.
    modified_by_crs: [185]
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    notes:
      - "CR-185: Play button no card expandido -> Presentation"
      - "7 acceptance criteria, 3 edge cases"
      - "2 arquivos impactados: agenda.tsx, presentation.tsx"
      - "Play button visivel apenas quando card expandido"
      - "Presentation screen precisa aceitar date param"

  - id: F128
    name: "Home - Agenda section redesign with Sunday preview card and play icon"
    status: pending
    rfs: []
    description: >
      Redesign da secao 'Agenda da Reuniao Sacramental' no Home. Botao Iniciar
      ganha icone de play antes do texto. Abaixo do botao, card de domingo
      identico ao contraido da aba Agendas (nao expansivel) mostrando status
      (roles, speakers, prayers, hymns). Card do proximo domingo (seg-sab) ou
      do dia (domingo). A direita do card, botao quadrado com lapis que navega
      para aba Agendas com card expandido.
    modified_by_crs: [186]
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    notes:
      - "CR-186: Preview card + play icon no botao Iniciar"
      - "10 acceptance criteria, 3 edge cases"
      - "1 arquivo impactado: index.tsx (Home)"
      - "Requer fetch de agenda data no Home (useAgenda, useSpeeches)"
      - "Preview card replica status lines do card contraido da aba Agendas"
      - "Pencil button quadrado (36x36, borderRadius:8)"

  - id: F129
    name: "Home - Upcoming Speeches: non-expandable cards with pencil navigation"
    status: pending
    rfs: []
    description: >
      Cards na secao 'Proximos Discursos' do Home nao sao mais expansiveis.
      Remover SpeechSlot, MemberSelectorModal, TopicSelectorModal e hooks de
      mutacao. Adicionar botao lapis a direita de cada card que navega para aba
      Discursos com card expandido (ADR-082 expandDate). NextAssignmentsSection
      (Bishopric-only) nao e afetada.
    modified_by_crs: [188]
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    notes:
      - "CR-188: Cards nao-expansiveis + pencil button -> Speeches tab"
      - "11 acceptance criteria, 3 edge cases"
      - "2 arquivos impactados: NextSundaysSection.tsx, SundayCard.tsx"
      - "Remove expand/edit: SpeechSlot, modais, hooks de mutacao"
      - "Pencil button identico ao de F128 (quadrado, 36x36)"
      - "NextAssignmentsSection nao afetada (Bishopric-only)"

  - id: F130
    name: "Fix TypeScript errors and actor role naming consistency after Pianist/Conductor split"
    status: pending
    rfs: []
    description: >
      Fix TS compilation errors after CR-180 (can_music -> can_pianist/can_conductor):
      SundayAgenda mock missing fields, null-to-string assignments, undefined 'Member' type,
      BlurEvent incompatibility, missing 'speeches' in SundayExceptionReason records.
      Also fix documentation naming: can_piano -> can_pianist, can_music -> can_pianist/can_conductor.
    modified_by_crs: [194]
    spec_file: "docs/specs/SPEC_F130_F134.yaml"
    notes:
      - "CR-194: Regression of CR-180 (Pianist/Conductor split)"
      - "12 acceptance criteria, 4 edge cases"
      - "14 files impacted (10 code + 4 docs)"
      - "Canonical roles: can_preside, can_conduct, can_recognize, can_pianist, can_conductor"

  - id: F131
    name: "Fix ward language switch not updating AuthContext state"
    status: pending
    rfs: []
    description: >
      wardLanguageChangeMutation onSuccess only invalidates topic cache but does NOT
      update AuthContext.wardLanguage. UI remains stale after language change until
      app restart. Fix: update AuthContext state in onSuccess handler.
    modified_by_crs: [195]
    spec_file: "docs/specs/SPEC_F130_F134.yaml"
    notes:
      - "CR-195: Regression of CR-178 (Separate app/ward language)"
      - "5 acceptance criteria, 3 edge cases"
      - "OQ-3 delegated to architect: verify setWardLanguage availability"

  - id: F132
    name: "Fix multiple bugs in 2nd speech toggle functionality"
    status: pending
    rfs: []
    description: >
      3 sub-bugs: (4.1) toggle off clears speaker but not topic fields - fix via
      separate direct update; (4.2) Speeches tab replaces 2 fields with 1 warning
      message - fix: show 2 visible disabled fields with placeholder text;
      (4.3) Agenda tab desired behavior confirmed (visible+disabled+placeholder);
      (4.4) collapsed card hardcodes X/3 - fix: dynamic X/2 when has_second_speech=false.
    modified_by_crs: [196]
    spec_file: "docs/specs/SPEC_F130_F134.yaml"
    notes:
      - "CR-196: Regression of CR-181 (Optional 2nd speech toggle)"
      - "11 acceptance criteria, 4 edge cases"
      - "4.1: separate direct update, NOT extend useRemoveAssignment"
      - "4.2: 2 visible disabled fields with i18n placeholder"
      - "4.3: desired behavior confirmed by user (NOT a bug)"
      - "4.4: dynamic X/2 vs X/3 in agenda and home collapsed cards"

  - id: F133
    name: "Fix password reset email to use user's app language instead of ward language"
    status: pending
    rfs: []
    description: >
      send-reset-email Edge Function uses ward.language for email template.
      After CR-178, should use user.user_metadata.language with fallback chain:
      user_metadata.language -> ward.language -> pt-BR.
    modified_by_crs: [197]
    spec_file: "docs/specs/SPEC_F130_F134.yaml"
    notes:
      - "CR-197: Regression of CR-155 (Multilingual password reset email)"
      - "5 acceptance criteria, 3 edge cases"
      - "Supersedes F101 language selection behavior"

  - id: F134
    name: "Fix password reset redirect to work without JavaScript in sandboxed iframes"
    status: pending
    rfs: []
    description: >
      reset-redirect HTML has <script> tag blocked in sandboxed iframes without
      allow-scripts. Fix: remove <script> tag entirely, rely on meta http-equiv
      refresh and manual <a href> button fallback.
    modified_by_crs: [198]
    spec_file: "docs/specs/SPEC_F130_F134.yaml"
    notes:
      - "CR-198: Regression of CR-191 (Password reset redirect)"
      - "5 acceptance criteria, 3 edge cases"
      - "Remove script tag, keep meta refresh + manual button"

  # ---------------------------------------------------------------------------
  # Batch 21 Phase 2 (F135-F137): Settings Reorganization, StatusLED Alignment, Play Icon Size
  # ---------------------------------------------------------------------------

  - id: F135
    name: "Reorganize Settings tab into 2 labeled groups: Ward Settings and App Settings"
    status: pending
    rfs: []
    description: >
      Reorganize Settings tab from 3 unlabeled sections into 2 labeled groups:
      Group 1 'Configuracoes da Ala' (Discursantes, Biblioteca de Temas, WhatsApp,
      Idioma da Ala, Fuso Horario) and Group 2 'Configuracoes do App' (Usuarios do App,
      Historico de Uso, Idioma do App, Tema Claro/Escuro, Sobre). Each group has a
      labeled header. Observer sees only Group 2 (limited items). Permission gating
      unchanged. New i18n keys for group labels in all 3 languages.
    modified_by_crs: [193]
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    notes:
      - "CR-193: Reorganizar aba Configuracoes em 2 grupos"
      - "12 acceptance criteria, 3 edge cases"
      - "4 arquivos impactados (settings/index.tsx + 3 locales)"
      - "New i18n keys: settings.wardSettingsGroup, settings.appSettingsGroup"

  - id: F136
    name: "Align StatusLED right edge with speaker field right edge in expanded speech card"
    status: pending
    rfs: []
    description: >
      StatusLED right edge is 36px further right than speaker field right edge
      because labelRow spans full width but speaker field is followed by 36px
      actionArea. Fix: add paddingRight equal to actionArea width (36px) to
      statusSection/labelRow so StatusLED right edge aligns with speaker field.
      X button position unchanged.
    modified_by_crs: [199]
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    notes:
      - "CR-199: Alinhar direita do circulo com direita do campo do discursante"
      - "6 acceptance criteria, 3 edge cases"
      - "1 arquivo impactado (SpeechSlot.tsx)"
      - "Root cause: actionArea width:36 not accounted for in labelRow"

  - id: F137
    name: "Enlarge play icon to match text line height in Home button and Agenda card"
    status: pending
    rfs: []
    description: >
      Play icon (U+25B6) too small in Home button (fontSize:17 same as text but
      renders smaller) and Agenda card (fontSize:14, stuck to chevron). Fix: increase
      Home play to fontSize >= 20, Agenda play to fontSize >= 18, add marginRight
      to Agenda play for spacing from chevron.
    modified_by_crs: [200]
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    notes:
      - "CR-200: Trocar icone de play por icone bem maior"
      - "6 acceptance criteria, 2 edge cases"
      - "2 arquivos impactados (index.tsx, agenda.tsx)"
      - "Style-only changes, no structural modifications"

  # ---------------------------------------------------------------------------
  # Batch 22 Phase 1 (F138-F139): Password Reset Web Page, Invitation Acceptance Web Page
  # ---------------------------------------------------------------------------

  - id: F138
    name: "Rewrite reset-redirect Edge Function to serve a complete password reset web page"
    status: pending
    rfs: []
    description: >
      Rewrite reset-redirect to serve a self-contained HTML page with a password reset form
      instead of redirecting to a deep link (sacrmeetplan://reset-password). Uses Supabase JS
      client via CDN to call verifyOtp + updateUser directly in the browser. Multilingual
      (pt-BR, en, es via navigator.language). send-reset-email NOT modified. Existing reset
      emails continue to work since the endpoint URL is unchanged.
    modified_by_crs: [202]
    spec_file: "docs/specs/SPEC_F138_F139.yaml"
    notes:
      - "CR-202: Pagina web de reset de senha"
      - "12 acceptance criteria, 5 edge cases"
      - "1 arquivo impactado (reset-redirect/index.ts)"
      - "send-reset-email NAO muda"
      - "Tela do app reset-password.tsx mantida como fallback"

  - id: F139
    name: "Create invite-redirect Edge Function to serve a complete invitation acceptance web page"
    status: pending
    rfs: []
    description: >
      New Edge Function (invite-redirect) that serves a self-contained HTML page with an
      invitation acceptance form. Validates token via fetch to register-invited-user, displays
      invitation details (ward, stake, role, email as read-only), and provides registration
      form (fullName, password). create-invitation updated to return HTTPS URL instead of
      sacrmeetplan:// deep link. register-invited-user NOT modified.
    modified_by_crs: [203]
    spec_file: "docs/specs/SPEC_F138_F139.yaml"
    notes:
      - "CR-203: Pagina web de aceitar convite"
      - "13 acceptance criteria, 7 edge cases"
      - "1 arquivo novo (invite-redirect/index.ts), 1 modificado (create-invitation/index.ts)"
      - "register-invited-user NAO muda"
      - "Tela do app invite/[token].tsx mantida como fallback"

  # ---------------------------------------------------------------------------
  # Batch 23 Phase 1 (F140-F142): Bug fixes - Invite Error, Language Switch, WhatsApp Template
  # ---------------------------------------------------------------------------

  - id: F140
    name: "Improve invite user error handling to show server error message"
    status: pending
    rfs: []
    description: >
      Fix invite user error handling: inviteMutation.onError shows actual server error
      message (from err.message extracted by callEdgeFunction) instead of generic
      t('users.inviteFailed'). Add meta: { suppressGlobalError: true } to prevent
      duplicate alert from global MutationCache handler.
    modified_by_crs: [205]
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    notes:
      - "CR-205: Erro ao clicar em Convidar Usuario"
      - "4 acceptance criteria, 3 edge cases"
      - "1 arquivo impactado (users.tsx)"
      - "callEdgeFunction nao muda, onError usa err.message"

  - id: F141
    name: "Fix language switch: seed general_collections for en/es and reset whatsapp_template"
    status: pending
    rfs: []
    description: >
      Two fixes: (1) Create migration 019_seed_en_es_collections.sql with seed data for
      general_collections and general_topics for 'en' and 'es' languages. (2) Reset
      whatsapp_template to NULL when ward language changes (settings/index.tsx), reset
      initialized flag in whatsapp.tsx when wardLanguage changes, invalidate ward cache.
    modified_by_crs: [206]
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    notes:
      - "CR-206: Troca de idioma quebra colecoes e template WhatsApp"
      - "10 acceptance criteria, 4 edge cases"
      - "3 arquivos impactados (migration nova, settings/index.tsx, whatsapp.tsx)"
      - "useTopics.ts e topics.tsx NAO mudam"

  - id: F142
    name: "Fix WhatsApp send to use ward template instead of hardcoded empty string"
    status: pending
    rfs: []
    description: >
      Fix InviteManagementSection to fetch wards.whatsapp_template and pass it to
      buildWhatsAppUrl instead of hardcoded empty string. Use wardLanguage from useAuth()
      instead of getCurrentLanguage() for template language and date formatting.
    modified_by_crs: [207]
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    notes:
      - "CR-207: Template WhatsApp desconectado do envio real"
      - "6 acceptance criteria, 3 edge cases"
      - "1 arquivo impactado (InviteManagementSection.tsx)"
      - "whatsappUtils.ts e whatsapp.ts NAO mudam"

  # ---------------------------------------------------------------------------
  # Batch 22 Phase 2 (F143-F144) - Fix invite creation root cause, External page hosting
  # ---------------------------------------------------------------------------

  - id: F143
    name: "Debug and fix create-invitation Edge Function to successfully create invitations"
    status: pending
    rfs: []
    description: >
      Fix the create-invitation Edge Function which returns non-2xx errors when
      clicking 'Invite User'. Add detailed logging at each failure point, structured
      error codes in responses, and a diagnostic mode for troubleshooting. CR-205/F140
      improved error visibility but did not fix the root cause.
    modified_by_crs: [208]
    spec_file: "docs/specs/SPEC_F143_F144.yaml"
    notes:
      - "CR-208: Invite creation fails with non-2xx (root cause unknown, needs diagnosis)"
      - "6 acceptance criteria, 6 edge cases"
      - "1 arquivo impactado (create-invitation/index.ts)"
      - "users.tsx e register-invited-user NAO mudam"
      - "Diagnostic mode: POST { diagnose: true } returns health check report"
      - "Deve ser implementado ANTES de F144"

  - id: F144
    name: "Host password reset and invitation acceptance pages externally to bypass Supabase Content-Type restriction"
    status: pending
    rfs: []
    description: >
      Supabase overrides Content-Type from text/html to text/plain for Edge Function
      GET responses returning HTML (anti-phishing security restriction). Both
      reset-redirect (F138) and invite-redirect (F139) pages show raw HTML as plain
      text in mobile browsers. Fix: host the HTML pages on GitHub Pages (free) and
      change the Edge Functions to return 302 redirects to the external pages.
    modified_by_crs: [204]
    spec_file: "docs/specs/SPEC_F143_F144.yaml"
    notes:
      - "CR-204: Supabase sobrescreve Content-Type text/html para text/plain"
      - "14 acceptance criteria, 5 edge cases"
      - "4 arquivos impactados (2 EFs modificados, 2 HTML novos em docs/public/)"
      - "send-reset-email, create-invitation, register-invited-user NAO mudam"
      - "GitHub Pages: docs/public/reset-password.html, docs/public/accept-invite.html"
      - "EXTERNAL_PAGES_URL env var configuravel com fallback para GitHub Pages URL"

# =============================================================================
# PENDING CHANGE REQUESTS (96 CRs pendentes de implementacao - Batch 7 Phase 2 + Batch 8 + Batch 9 + Batch 10 + Batch 11 + Batch 12 + Batch 13 + Batch 14 + Batch 15 + Batch 16 + Batch 17 + Batch 18 + Batch 19 + Batch 20 + Batch 21 + Batch 22 + Batch 23)
# =============================================================================

pending_crs:

  # --- Batch 7 Phase 2 (Features & UX) ---

  - id: 94
    type: ui
    area: "WhatsApp Template (F010, F024)"
    feature_id: F040
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [14, 63]
    description: >
      Adicionar templates padrao de convite WhatsApp por idioma (en, es).
      Template pt-BR existente ja satisfaz requisitos. Melhoria: usar
      template do idioma da ala como default.
    acceptance_criteria:
      - "Templates padrao existem para pt-BR, en, es"
      - "buildWhatsAppUrl usa template do idioma da ala como fallback"
      - "Todos os 6 placeholders presentes em todos os templates"
    files_likely_impacted:
      - src/lib/whatsappUtils.ts
      - src/lib/whatsapp.ts

  - id: 96
    type: ux
    area: "Search fields (Settings)"
    feature_id: F041
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [39, 84]
    description: >
      Campos de busca em Settings de Membros e Temas devem ser fixos no topo,
      nao scrollar com o conteudo. Selectors modais ja implementam corretamente.
    acceptance_criteria:
      - "SearchInput em members.tsx fixo acima do ScrollView/FlatList"
      - "SearchInput em topics.tsx fixo acima do ScrollView/FlatList"
      - "flex:1 para preencher espaco horizontal"
    files_likely_impacted:
      - src/app/(tabs)/settings/members.tsx
      - src/app/(tabs)/settings/topics.tsx

  - id: 97
    type: feature
    area: "Agenda (F012, F013)"
    feature_id: F042
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [73]
    description: >
      Campo 'Reconhecendo a Presenca' deve permitir selecao multipla de nomes.
      Toggle (add/remove) no handler, indicador visual no ActorSelector,
      modal permanece aberto para selecoes adicionais.
    acceptance_criteria:
      - "Selecionar ator adiciona ao array (toggle)"
      - "Atores selecionados indicados visualmente no modal"
      - "Modal nao fecha apos selecao"
      - "Array completo salvo em recognized_names"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/components/ActorSelector.tsx

  - id: 99
    type: ui
    area: "Agenda (F012)"
    feature_id: F043
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [29, 69]
    description: >
      Trocar labels dos discursos na edicao de agenda: '1o Orador' para
      '1o Discurso' (idem 2o e 3o). Alterar i18n key speeches.speaker.
    acceptance_criteria:
      - "pt-BR: '1o Discurso', '2o Discurso', '3o Discurso'"
      - "en: '1st Speech', '2nd Speech', '3rd Speech'"
      - "es: '1er Discurso', '2do Discurso', '3er Discurso'"
      - "Modo Apresentacao tambem usa labels atualizados"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 100
    type: feature
    area: "Agenda (F012)"
    feature_id: F044
    spec_file: "docs/specs/SPEC_F040_F044.yaml"
    related_crs: [26]
    description: >
      Campo de discursante read-only com icone de edicao para 'Troca de
      Ultima Hora'. Campo texto manual, icone X para reverter ao designado
      original. Override persistido em sunday_agendas (novos campos).
    acceptance_criteria:
      - "Campo mostra nome designado como read-only"
      - "Icone lapis permite modo edicao (TextInput)"
      - "Icone X reverte ao nome original"
      - "Override persistido em sunday_agendas (speaker_*_override)"
      - "Modo Apresentacao usa override quando existir"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/hooks/usePresentationMode.ts
      - src/types/database.ts
      - supabase/migrations/ (nova migracao)

  # --- Batch 8 Phase 1 (Display Fixes & WhatsApp Template) ---

  - id: 101
    type: bug
    area: "SundayCard (F008, F009)"
    feature_id: F045
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56]
    description: >
      LEDs de status de discurso renderizados incondicionalmente em SundayCard.tsx.
      Devem ser condicionados a isSpeechesType (tipo === 'speeches').
    acceptance_criteria:
      - "LEDs visiveis apenas quando tipo de domingo e 'speeches'"
      - "LEDs ocultos para todos os outros tipos de domingo"
      - "Fix aplica-se na aba Discursos e no Home (NextSundaysSection)"
    files_likely_impacted:
      - src/components/SundayCard.tsx

  - id: 102
    type: bug
    area: "Agenda (F012)"
    feature_id: F046
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56, 75]
    description: >
      Label amarelo de excecao aparece para domingos 'speeches' na aba Agenda.
      Apos CR-56, todo domingo tem excecao persistida, mostrando label redundante.
    acceptance_criteria:
      - "Label amarelo NAO mostrado quando exception.reason === 'speeches'"
      - "Label amarelo mostrado normalmente para outros tipos"
      - "Label 'other' continua mostrando custom_reason"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx

  - id: 103
    type: bug
    area: "WhatsApp Settings (F024)"
    feature_id: F047
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14, 63, 94]
    description: >
      Tela de configuracoes WhatsApp nao faz fallback para getDefaultTemplate()
      quando DB e null. Mostra campo vazio ou template antigo.
    acceptance_criteria:
      - "Template padrao exibido quando DB tem null"
      - "Template do DB exibido quando tem valor customizado"
      - "String vazia respeitada (BR-24)"
      - "Template padrao correto por idioma da ala"
    files_likely_impacted:
      - src/app/(tabs)/settings/whatsapp.tsx

  - id: 104
    type: bug
    area: "WhatsApp Invite (F009, F010)"
    feature_id: F048
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14, 63, 94]
    description: >
      WhatsAppVariables em InviteManagementSection.tsx nao passa collection
      (speech.topic_collection) nem link (speech.topic_link). Templates padrao
      em whatsappUtils.ts nao tem aspas ao redor de {titulo}.
    acceptance_criteria:
      - "collection passado de speech.topic_collection"
      - "link passado de speech.topic_link"
      - "Templates padrao usam '\"{titulo}\"' com aspas"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx
      - src/lib/whatsappUtils.ts

  - id: 108
    type: bug
    area: "WhatsApp Invite date format (F009, F010)"
    feature_id: F048
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [14]
    description: >
      Placeholder {data} em InviteManagementSection.tsx usa formatDate() que
      retorna "22 FEV". Deve usar formatDateHumanReadable() para formato
      adequado ao idioma da ala.
    acceptance_criteria:
      - "pt-BR: '22 de Fevereiro de 2026'"
      - "en: 'February 22, 2026'"
      - "es: '22 de Febrero de 2026'"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 109
    type: bug
    area: "Home NextSundaysSection (F009)"
    feature_id: F049
    spec_file: "docs/specs/SPEC_F045_F049.yaml"
    related_crs: [56, 95]
    description: >
      Condicao !entry.exception em NextSundaysSection.tsx bloqueia SpeechSlots.
      Apos CR-56, todos os domingos tem excecao, impedindo expansao. Usar padrao
      de speeches.tsx: (!exception || exception.reason === 'speeches').
    acceptance_criteria:
      - "SpeechSlots renderizados quando tipo e 'speeches'"
      - "SpeechSlots NAO renderizados para outros tipos"
      - "Consistencia com aba Discursos"
    files_likely_impacted:
      - src/components/NextSundaysSection.tsx

  # --- Batch 8 Phase 2 (Invite Management UX) ---

  - id: 105
    type: ui
    area: "InviteManagementSection (F009)"
    feature_id: F050
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Substituir botao texto "WhatsApp" por icone do WhatsApp e botao
      "Alterar status" por icone de tres pontinhos na secao de convites.
    acceptance_criteria:
      - "Botao not-invited mostra icone WhatsApp (SVG ou Unicode)"
      - "Botao invited mostra tres pontinhos (U+22EE)"
      - "Comportamento onPress inalterado"
      - "accessibilityLabel descritivo nos botoes"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 106
    type: ux
    area: "InviteManagementSection (F009)"
    feature_id: F051
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: [105]
    description: >
      Substituir Alert.alert por dropdown customizado com opcoes:
      Ver conversa, Designado/Confirmado, Designado/Nao-Convidado,
      Desistiu, Cancelar. Cada opcao com indicador visual (LED).
    acceptance_criteria:
      - "Alert.alert NAO usado para status de invited"
      - "Dropdown com 5 opcoes (Ver conversa, Confirmado, Nao-Convidado, Desistiu, Cancelar)"
      - "Nova opcao assigned_not_invited (reverter convite)"
      - "Indicadores visuais (LED colorido) por opcao"
      - "Tap fora fecha dropdown"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx
      - src/components/InviteActionDropdown.tsx

  - id: 107
    type: ui
    area: "InviteManagementSection (F009)"
    feature_id: F052
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Alterar segunda linha do invite row de "1o" para
      "1o Discurso - <LED> <nome do status>".
    acceptance_criteria:
      - "Segunda linha mostra '1o Discurso' completo"
      - "StatusLED inline na segunda linha (10-12px)"
      - "Nome do status traduzido apos o LED"
      - "Layout horizontal alinhado"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  - id: 110
    type: feature
    area: "Permissions (F023)"
    feature_id: F053
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Adicionar permissao 'home:invite_mgmt' ao role bishopric para que
      bispado tambem veja a secao de gerenciamento de convites na Home.
    acceptance_criteria:
      - "bishopric tem 'home:invite_mgmt' em PERMISSIONS_MAP"
      - "InviteManagementSection visivel para bishopric"
      - "Observer continua sem acesso"
    files_likely_impacted:
      - src/lib/permissions.ts

  - id: 111
    type: ux
    area: "SpeechSlot (F008)"
    feature_id: F054
    spec_file: "docs/specs/SPEC_F050_F054.yaml"
    related_crs: []
    description: >
      Aumentar espaco entre LED e botao X e aumentar tamanho do icone X
      no SpeechSlot expandido.
    acceptance_criteria:
      - "Gap ou margin entre LED e X maior que 8px"
      - "fontSize do X maior que 20"
      - "hitSlop adequado mantido"
      - "Layout nao quebra em telas estreitas"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  # --- Batch 9 Phase 1 (Bug Fixes & Quick UI) ---

  - id: 112
    type: bug
    area: "InviteManagementSection (F009, F010)"
    feature_id: F055
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    related_crs: [105, 106]
    description: >
      "Ver Conversa" no InviteActionDropdown chama buildWhatsAppUrl() com texto
      de convite, reenviando mensagem. Deve abrir wa.me/{phone} sem ?text=.
    acceptance_criteria:
      - "Ver Conversa abre WhatsApp sem mensagem pre-preenchida"
      - "URL gerada e wa.me/{phone} sem ?text="
      - "Botao de envio inicial (not_invited) continua com mensagem"
      - "Ver Conversa desabilitado quando sem telefone"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx
      - src/lib/whatsappUtils.ts

  - id: 113
    type: ui
    area: "InviteActionDropdown (F051)"
    feature_id: F056
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    related_crs: [106]
    description: >
      Titulo do InviteActionDropdown mostra speaker_name. Trocar para
      t('speeches.changeStatus'). Chave i18n ja existe nos 3 locales.
    acceptance_criteria:
      - "Titulo do dropdown exibe 'Alterar status' (pt-BR)"
      - "Titulo do dropdown exibe 'Change status' (en)"
      - "Titulo do dropdown exibe 'Cambiar estado' (es)"
    files_likely_impacted:
      - src/components/InviteActionDropdown.tsx

  - id: 117
    type: bug
    area: "Country Codes (F003, F029)"
    feature_id: F057
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    related_crs: [85, 92]
    description: >
      +1 mostra bandeira do Canada ao inves de EUA. getFlagForCode() usa
      .find() que retorna Canada (primeiro na lista). Dropdown mostra ambos
      como selecionados. Fix: reordenar USA antes de Canada e usar label
      para highlight.
    acceptance_criteria:
      - "Bandeira dos EUA mostrada para +1 por padrao"
      - "Lista de selecao mostra apenas um pais selecionado para +1"
      - "Selecionar Canada funciona corretamente"
      - "Outros codigos duplicados (+7) nao afetados"
    files_likely_impacted:
      - src/lib/countryCodes.ts
      - src/app/(tabs)/settings/members.tsx

  - id: 122
    type: ui
    area: "Speech Labels (F008, F012)"
    feature_id: F058
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    related_crs: [99]
    description: >
      Label do 3o discurso usa formato ordinal generico. Trocar para
      "Ultimo Discurso" (i18n). Afeta SpeechSlot, AgendaForm e
      InviteManagementSection. Nova i18n key speeches.lastSpeech.
    acceptance_criteria:
      - "pt-BR: 'Ultimo Discurso' para posicao 3"
      - "en: 'Final Speech' para posicao 3"
      - "es: 'Ultimo Discurso' para posicao 3"
      - "Labels do 1o e 2o discurso nao afetados"
      - "Modo Apresentacao tambem usa novo label"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx
      - src/components/AgendaForm.tsx
      - src/components/InviteManagementSection.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 125
    type: bug
    area: "Agenda Prayer (F012, F015)"
    feature_id: F059
    spec_file: "docs/specs/SPEC_F055_F059.yaml"
    related_crs: [74, 98]
    description: >
      Clicar no campo de oracao de encerramento duplica campo e modal.
      AgendaForm renderiza PrayerSelector com visible={true} que renderiza
      botao inline (duplicando SelectorField) alem de abrir modal.
    acceptance_criteria:
      - "Clicar em oracao de encerramento nao duplica campo"
      - "Apenas um modal de selecao aberto por vez"
      - "Oracao de abertura tambem nao duplica"
      - "Selecao de membro funciona corretamente"
      - "Nome customizado funciona corretamente"
    files_likely_impacted:
      - src/components/PrayerSelector.tsx
      - src/components/AgendaForm.tsx

  # --- Batch 9 Phase 2 (Speech Cards & Agenda) ---

  - id: 114
    type: ux
    area: "SpeechSlot (F008)"
    feature_id: F060
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    related_crs: []
    description: >
      Adicionar botao X ao lado do campo de temas no SpeechSlot para remover
      tema atribuido. Sem confirmacao (tema facilmente re-atribuivel).
    acceptance_criteria:
      - "X visivel quando tema atribuido e canAssign=true"
      - "X nao visivel quando sem tema ou sem permissao"
      - "Pressionar X limpa topic_title, topic_link, topic_collection"
      - "Fluxo de atribuicao via TopicSelectorModal inalterado"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx
      - src/app/(tabs)/speeches.tsx
      - src/components/NextSundaysSection.tsx

  - id: 115
    type: ux
    area: "SundayCard (F007, F008)"
    feature_id: F061
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    related_crs: [6, 7, 56, 95]
    description: >
      Confirmacao ao mudar tipo de domingo DE 'speeches' quando ha
      discursantes ou temas atribuidos. Sem confirmacao quando sem
      atribuicoes ou ao reverter PARA speeches.
    acceptance_criteria:
      - "Alert.alert exibido quando speeches tem speaker_name ou topic_title"
      - "Sem confirmacao quando sem atribuicoes"
      - "Cancelar preserva tipo atual"
      - "Confirmar efetua mudanca"
      - "Reverter para speeches nao pede confirmacao"
      - "Textos i18n em 3 idiomas"
    files_likely_impacted:
      - src/components/SundayCard.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 116
    type: feature
    area: "StatusChangeModal (F008)"
    feature_id: F062
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    related_crs: [106]
    description: >
      LED click no SpeechSlot com status assigned_invited mostra apenas
      opcoes 'Confirmado' e 'Desistiu'. Para outros status, todas as
      transicoes validas sao mostradas.
    acceptance_criteria:
      - "assigned_invited: apenas assigned_confirmed e gave_up"
      - "Outros status: todas as transicoes validas"
      - "StatusChangeModal sem prop de filtro funciona normalmente"
      - "LED nao-interativo para not_assigned preservado"
    files_likely_impacted:
      - src/components/StatusChangeModal.tsx
      - src/components/SpeechSlot.tsx

  - id: 119
    type: ui
    area: "SpeechSlot (F008)"
    feature_id: F063
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    related_crs: [100, 111]
    description: >
      Reordenar layout do SpeechSlot: [LED][Speaker][X] ao inves de
      [Speaker][LED][X]. Campo de tema alinhado com speaker via marginLeft.
    acceptance_criteria:
      - "LED primeiro na row (esquerda)"
      - "Speaker field segundo (flex:1, centro)"
      - "X button terceiro (direita, condicional)"
      - "Campo de tema alinhado com speaker (marginLeft 28px)"
      - "Secretary/Observer nao veem X"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 121
    type: feature
    area: "Agenda (F012, F044)"
    feature_id: F064
    spec_file: "docs/specs/SPEC_F060_F064.yaml"
    related_crs: [100]
    description: >
      Label "(Designacao de ultima hora)" no SpeakerField da agenda quando
      override esta ativo (overrideName !== speakerName). Estilo sutil
      (italic, fontSize 11-12, cor terciaria). Traduzido em 3 idiomas.
    acceptance_criteria:
      - "Label visivel quando hasOverride=true"
      - "Label nao visivel quando sem override"
      - "Label desaparece ao reverter override"
      - "Label em 3 idiomas (pt-BR, en, es)"
      - "Estilo sutil (italic, cor terciaria)"
      - "Nao aparece durante modo de edicao"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  # --- Batch 10 Phase 1 (LED Redesign, Data Cleanup, Status Options, Country Code Fix) ---

  - id: 126
    type: ui
    area: "StatusLED (F008, F051)"
    feature_id: F069
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    related_crs: [116, 119]
    description: >
      Trocar StatusLED de design 3D para circulo plano (flat). Novas cores:
      not_assigned=Cinza, assigned_not_invited=Laranja, assigned_invited=Amarelo,
      assigned_confirmed=Verde, gave_up=Vinho Escuro. Atualizar
      STATUS_INDICATOR_COLORS no StatusChangeModal.
    acceptance_criteria:
      - "LED e circulo flat sem efeito 3D (unica camada)"
      - "Cores corretas por status (cinza, laranja, amarelo, verde, vinho)"
      - "Animacao de fading mantida para assigned_not_invited"
      - "Reduced motion respeitado"
      - "StatusChangeModal usa mesmas novas cores"
    files_likely_impacted:
      - src/components/StatusLED.tsx
      - src/components/StatusChangeModal.tsx

  - id: 127
    type: bug_critical
    area: "SundayTypes (F007, F061)"
    feature_id: F070
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    related_crs: [6, 7, 56, 95, 115]
    description: >
      Regressao de CR-115. Ao confirmar mudanca de tipo de domingo, speeches
      nao sao apagados do banco. Fix: deletar registros de speeches para
      ward_id + sunday_date apos confirmacao.
    acceptance_criteria:
      - "Speeches apagados do banco apos confirmar mudanca de tipo"
      - "Cancelar no dialogo NAO apaga speeches"
      - "Reverter para speeches NAO tenta deletar"
      - "Query cache invalidado apos delete"
      - "Audit log registra limpeza"
    files_likely_impacted:
      - src/hooks/useSpeeches.ts
      - src/components/SundayCard.tsx
      - src/app/(tabs)/speeches.tsx

  - id: 129
    type: feature
    area: "SpeechSlot (F008, F062)"
    feature_id: F071
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    related_crs: [116]
    description: >
      Regressao de CR-116. LED click mostra todas as opcoes exceto
      not_assigned. LED desabilitado para assigned_confirmed e gave_up.
    acceptance_criteria:
      - "assigned_not_invited: mostra apenas assigned_invited"
      - "assigned_invited: mostra 3 opcoes (sem not_assigned)"
      - "assigned_confirmed e gave_up: LED desabilitado"
      - "not_assigned: LED desabilitado (preservado)"
      - "Observer nao pode clicar LED (preservado)"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 130
    type: bug
    area: "Country Codes (F003, F057)"
    feature_id: F072
    spec_file: "docs/specs/SPEC_F069_F072.yaml"
    related_crs: [85, 92, 117]
    description: >
      Regressao de CR-117. Display usa getFlagForCode(countryCode) que
      retorna US para +1. Fix: usar getCountryByLabel(countryLabel) para
      exibir bandeira correta.
    acceptance_criteria:
      - "Selecionar Canada mostra bandeira do Canada"
      - "Selecionar US mostra bandeira dos US"
      - "Russia vs Kazakhstan (+7) funciona corretamente"
      - "Highlight na lista mostra apenas pais selecionado"
      - "Inicializacao com +1 mostra US por padrao (aceitavel)"
    files_likely_impacted:
      - src/app/(tabs)/settings/members.tsx

  # --- Batch 10 Phase 2 (Topic X Button, Hymn Search, Auto-Scroll Fix, Custom Prayer UX) ---

  - id: 128
    type: ui
    area: "SpeechSlot (F008, F060)"
    feature_id: F073
    spec_file: "docs/specs/SPEC_F073.yaml"
    related_crs: [114]
    description: >
      Botao X para limpar tema no SpeechSlot esta dentro do topicField Pressable
      (dentro da borda). Deve ser extraido e posicionado como sibling fora do
      campo, a direita, seguindo padrao do X do speaker.
    acceptance_criteria:
      - "X do topic renderizado fora do topicField como sibling"
      - "topicRow com flexDirection:'row', gap:12 envolve topicField + X"
      - "Seta dropdown permanece dentro do topicField"
      - "Funcionalidade de clear topic preservada"
      - "X visivel apenas com tema + canAssign"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 131
    type: ui
    area: "AgendaForm HymnSelectorModal (F014)"
    feature_id: F074
    spec_file: "docs/specs/SPEC_F074.yaml"
    related_crs: [118]
    description: >
      Campo de search do HymnSelectorModal no AgendaForm tem estilo
      inconsistente com outros seletores. Simplificar styles.searchInput
      para herdar estilos corretos do SearchInput base.
    acceptance_criteria:
      - "Campo de busca tem height:40 (herdado do SearchInput base)"
      - "Campo de busca tem borderRadius:8 (herdado do SearchInput base)"
      - "Campo de busca tem paddingHorizontal:12 (herdado do SearchInput base)"
      - "Funcionalidade de busca de hinos preservada"
    files_likely_impacted:
      - src/components/AgendaForm.tsx

  - id: 132
    type: ux
    area: "Speeches/Agenda tabs (F066)"
    feature_id: F075
    spec_file: "docs/specs/SPEC_F075.yaml"
    related_crs: [120]
    description: >
      Auto-scroll ao expandir cards impreciso porque getItemLayout retorna
      alturas fixas. Remover getItemLayout de ambas as abas. Substituir
      initialScrollIndex por useEffect em agenda.tsx.
    acceptance_criteria:
      - "Card expandido alinhado com topo da area visivel"
      - "Scroll preciso com cards de alturas variadas"
      - "Colapsar card nao faz auto-scroll"
      - "Initial scroll ao proximo domingo funciona em ambas as abas"
    files_likely_impacted:
      - src/app/(tabs)/speeches.tsx
      - src/app/(tabs)/agenda.tsx

  - id: 133
    type: ux
    area: "PrayerSelector (F015, F068)"
    feature_id: F076
    spec_file: "docs/specs/SPEC_F076.yaml"
    related_crs: [74, 98, 124]
    description: >
      Funcionalidade de nomes customizados para oracoes ja implementada
      mas com UX ruim: sem indicacao visual upfront e re-editing nao
      pre-popula campo. Adicionar hint text e pre-populate.
    acceptance_criteria:
      - "Hint de discoverability visivel ao abrir PrayerSelector"
      - "Pre-populate do campo quando re-editando nome customizado"
      - "customNameButton visivel imediatamente ao re-editar"
      - "Selecao de membro da lista continua funcionando"
      - "Hint traduzido em 3 idiomas"
    files_likely_impacted:
      - src/components/PrayerSelector.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  # --- Batch 11 (Status Options Fix, Text Changes, Scroll Fix, Checkbox UX) ---

  - id: 134
    type: bug
    area: "InviteActionDropdown / StatusChangeModal (F051, F062)"
    feature_id: F077
    spec_file: "docs/specs/SPEC_F077.yaml"
    related_crs: [106, 116, 129]
    description: >
      Regressao do CR-129. Em DOIS locais (InviteActionDropdown na Home e
      StatusChangeModal na aba Discursos), ao trocar status, mostrar TODAS
      as opcoes exceto o status atual E exceto not_assigned. Corrigir
      opcoes hardcoded no dropdown e VALID_TRANSITIONS restritivo.
    acceptance_criteria:
      - "InviteActionDropdown mostra opcoes dinamicas (3 opcoes, excluindo status atual)"
      - "not_assigned NUNCA aparece como opcao clicavel"
      - "LED clicavel para assigned_confirmed e gave_up (antes bloqueado)"
      - "StatusChangeModal mostra 3 opcoes (excluindo status atual e not_assigned)"
      - "LED nao-clicavel para not_assigned (preservado)"
      - "Observer nao pode clicar LED (preservado)"
    supersedes: [F062, F071]
    files_likely_impacted:
      - src/components/InviteActionDropdown.tsx
      - src/components/SpeechSlot.tsx
      - src/hooks/useSpeeches.ts

  - id: 135
    type: ui
    area: "PrayerSelector (F076)"
    feature_id: F078
    spec_file: "docs/specs/SPEC_F078.yaml"
    related_crs: [124, 133]
    description: >
      Trocar texto de ajuda do PrayerSelector de 'Digite um nome para usar
      nome personalizado' para 'Para escolher um nao membro, digite o nome
      da pessoa e adicione como nome personalizado'. Alterar em 3 idiomas.
    acceptance_criteria:
      - "Texto pt-BR atualizado para novo texto"
      - "Texto en atualizado para equivalente"
      - "Texto es atualizado para equivalente"
      - "PrayerSelector renderiza hint na mesma posicao"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 136
    type: bug
    area: "Agenda tab (F012)"
    feature_id: F079
    spec_file: "docs/specs/SPEC_F079.yaml"
    related_crs: [132]
    description: >
      Scroll inicial da aba Agenda nao posiciona no proximo domingo.
      Adicionar viewPosition: 0.5 ao scrollToIndex e implementar
      onScrollToIndexFailed robusto.
    acceptance_criteria:
      - "Proximo domingo centralizado na tela ao abrir Agenda"
      - "scrollToIndex usa viewPosition: 0.5"
      - "Fallback de scroll funciona quando scrollToIndex falha"
      - "Aba Discursos nao afetada"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx

  - id: 137
    type: ux
    area: "ActorSelector multi-select (F040)"
    feature_id: F080
    spec_file: "docs/specs/SPEC_F080.yaml"
    related_crs: [97, 123]
    description: >
      Melhorar UX da lista de Reconhecendo a Presenca: substituir prefixo
      de texto checkmark por checkbox visual (quadrado com check). Resolver
      confusao entre X de exclusao e de-selecao.
    acceptance_criteria:
      - "Checkbox visual a esquerda do nome em multi-select mode"
      - "Checkbox marcado para selecionados, vazio para nao selecionados"
      - "Toggle via checkbox ou nome"
      - "Icones edit/delete nao confundidos com selecao"
      - "Single-select mode inalterado"
    files_likely_impacted:
      - src/components/ActorSelector.tsx

  - id: 138
    type: ui
    area: "ActorSelector delete confirm (F040)"
    feature_id: F081
    spec_file: "docs/specs/SPEC_F081.yaml"
    related_crs: [73, 97]
    description: >
      Trocar texto de confirmacao de exclusao de ator de generico
      (members.deleteConfirm) para texto especifico ao contexto de
      reconhecimento de presenca. Nova i18n key actors.deleteConfirm.
    acceptance_criteria:
      - "ActorSelector usa nova key actors.deleteConfirm"
      - "Texto pt-BR conforme especificado pelo usuario"
      - "Texto en equivalente"
      - "Texto es equivalente"
      - "members.deleteConfirm inalterada"
    files_likely_impacted:
      - src/components/ActorSelector.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  # --- Batch 12 (Integration Tests) ---

  - id: 139
    type: testing
    area: "Testing Infrastructure"
    feature_id: F082
    spec_file: "docs/specs/SPEC_F082.yaml"
    related_crs: []
    description: >
      Adicionar testes de integracao ao projeto. 4 categorias: hooks + Supabase
      mockado + React Query, SyncProvider orchestration, AuthContext flow,
      components + hooks data flow. Usa renderHook/render com wrappers reais
      e Supabase mockado. 30 ACs, 5 novos arquivos, 0 modificacoes.
    acceptance_criteria:
      - "9 hooks testados com Supabase mockado + React Query (fetch, create, update, delete)"
      - "SyncProvider orchestration testada (connection, realtime, offline queue)"
      - "AuthContext flow testado (session init, role extraction, signIn, signOut, permissions)"
      - "Components + hooks data flow testado (ActorSelector, SearchInput, OfflineBanner, StatusChangeModal, MemberSelectorModal, HymnSelector)"
      - "Todos testes unitarios existentes continuam passando sem modificacao"
      - "Nenhum arquivo de codigo fonte modificado"
    files_likely_impacted:
      - src/__tests__/integration/setup-integration.ts
      - src/__tests__/integration/hooks-supabase.integration.test.ts
      - src/__tests__/integration/sync-provider.integration.test.ts
      - src/__tests__/integration/auth-flow.integration.test.ts
      - src/__tests__/integration/components-hooks.integration.test.tsx

  # --- Batch 13 (Settings Rename, Agenda Sunday Type, Activity Log i18n, Query Perf, Security) ---

  - id: 140
    type: ui_text_change
    area: "Settings tab (F003, F005, F018, F019, F021)"
    feature_id: F083
    spec_file: "docs/specs/SPEC_F083.yaml"
    related_crs: []
    description: >
      Renomear opcoes da aba Configuracoes com i18n: Membros->Discursantes,
      Temas->Biblioteca de Temas, Usuarios->Usuarios do App,
      Historico->Historico de Uso, Tema->Tema Claro/Escuro. Tanto no card
      do settings/index.tsx quanto no titulo da tela interna.
    acceptance_criteria:
      - "Label e titulo de Members alterados para Discursantes/Speakers/Oradores"
      - "Label e titulo de Topics alterados para Biblioteca de Temas/Topic Library/Biblioteca de Temas"
      - "Label e titulo de Users alterados para Usuarios do App/App Users/Usuarios de la App"
      - "Label e titulo de History alterados para Historico de Uso/Usage History/Historial de Uso"
      - "Label e titulo de Theme alterados para Tema Claro/Escuro/Light/Dark Theme/Tema Claro/Oscuro"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 141
    type: feature
    area: "Agenda tab (F012, F007)"
    feature_id: F084
    spec_file: "docs/specs/SPEC_F083.yaml"
    related_crs: [95, 127]
    description: >
      Adicionar seletor de tipo de Domingo como primeiro campo do card de
      Agenda (igual aba Discursos). Se trocar de Discursos para outro tipo
      com designacoes, mostrar dialogo de confirmacao e apagar speeches.
    acceptance_criteria:
      - "SundayTypeDropdown visivel como primeiro campo no card expandido da Agenda"
      - "Dropdown mostra mesmas opcoes da aba Discursos"
      - "Trocar de Discursos para outro tipo com designacoes mostra confirmacao"
      - "Confirmar apaga speeches; cancelar preserva"
      - "Observador ve dropdown desabilitado"
      - "Mudanca na Agenda reflete na aba Discursos (cache invalidation)"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx

  - id: 142
    type: ui_text_change
    area: "Activity Log (F019)"
    feature_id: F085
    spec_file: "docs/specs/SPEC_F083.yaml"
    related_crs: [22]
    description: >
      Revisao completa das entradas do historico de atividades: formato
      estruturado no banco com renderizacao i18n na UI. 24 tipos de eventos.
      Fallback para registros antigos em formato texto plano.
    acceptance_criteria:
      - "24 action_types com templates i18n em 3 idiomas"
      - "Formato estruturado no banco (action_type|key=value)"
      - "Renderizacao amigavel na UI via t() com interpolacao"
      - "Registros antigos exibidos como fallback (texto plano)"
      - "Logs exibidos no idioma correto (nao mais hardcoded)"
      - "speech:assign_theme passa a ser logado (antes nao era)"
    files_likely_impacted:
      - src/lib/activityLog.ts
      - src/app/(tabs)/settings/history.tsx
      - src/hooks/useMembers.ts
      - src/hooks/useSpeeches.ts
      - src/hooks/useTopics.ts
      - src/hooks/useActors.ts
      - src/hooks/useSundayTypes.ts
      - src/hooks/useAgenda.ts
      - src/app/(tabs)/settings/users.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 143
    type: performance
    area: "Timezone (F002)"
    feature_id: F086
    spec_file: "docs/specs/SPEC_F083.yaml"
    related_crs: []
    description: >
      pg_timezone_names com 0% cache hit rate e 270ms mean. App ja usa
      lista estatica. Verificar se ha referencia server-side e documentar.
    acceptance_criteria:
      - "Nenhuma referencia a pg_timezone_names no codebase do app"
      - "Nenhuma referencia a pg_timezone_names nos arquivos de migracao SQL"
      - "Timezone selector continua usando lista estatica"
    files_likely_impacted:
      - src/app/(tabs)/settings/timezone.tsx

  - id: 144
    type: security
    area: "Database Functions (F001, F002, F003, F004, F017, F019)"
    feature_id: F087
    spec_file: "docs/specs/SPEC_F083.yaml"
    related_crs: []
    description: >
      7 funcoes sem search_path fixo. Nova migracao SQL com SET search_path = ''
      e referencias de tabela qualificadas. Leaked Password Protection e
      configuracao de dashboard (nao codigo).
    acceptance_criteria:
      - "7 funcoes recriadas com SET search_path = ''"
      - "Todas as tabelas qualificadas com schema explicito (public.*, auth.*)"
      - "Funcionalidade preservada apos migracao"
      - "Supabase Database Linter sem warnings function_search_path_mutable"
    files_likely_impacted:
      - supabase/migrations/015_fix_function_search_path.sql

  # --- Batch 14 Phase 1 (Email Reset, Offline UX, Alert Messages, Button Logic) ---

  - id: 145
    type: bug
    area: "Authentication (F001)"
    feature_id: F088
    spec_file: "docs/specs/SPEC_F088.yaml"
    related_crs: [67]
    description: >
      Email de reset de senha mostra branding Supabase e link para localhost.
      Edge Function com template i18n (3 idiomas) + deep link sacrmeetman://
      + nova tela reset-password no app.
    acceptance_criteria:
      - "Email mostra nome do app no idioma da ala (pt-BR, en, es)"
      - "Link usa deep link sacrmeetman://reset-password?token=..."
      - "App tem tela de redefinicao de senha via deep link"
      - "Fluxo completo: email -> deep link -> app -> nova senha"
      - "Email traduzido conforme ward.language"
    files_likely_impacted:
      - supabase/functions/send-reset-email/index.ts
      - src/app/(auth)/forgot-password.tsx
      - src/app/(auth)/reset-password.tsx

  - id: 146
    type: ux
    area: "Offline Support (F022)"
    feature_id: F089
    spec_file: "docs/specs/SPEC_F089.yaml"
    related_crs: [52, 53]
    description: >
      Degradacao graciosa quando offline. Integrar onlineManager com
      useConnection, suprimir erros de rede, mostrar cache, re-executar
      queries ao reconectar.
    acceptance_criteria:
      - "Queries pausadas quando offline (onlineManager)"
      - "Nenhum Alert.alert de erro quando offline"
      - "Dados em cache visiveis quando offline"
      - "Estado vazio amigavel quando sem cache"
      - "Queries re-executam ao reconectar"
    files_likely_impacted:
      - src/app/_layout.tsx
      - src/hooks/useConnection.ts
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 147
    type: ui
    area: "Offline Support (F022)"
    feature_id: F090
    spec_file: "docs/specs/SPEC_F090.yaml"
    related_crs: [146]
    description: >
      OfflineBanner escondido atras do notch/Dynamic Island do iPhone.
      Adicionar useSafeAreaInsets e aumentar fontSize.
    acceptance_criteria:
      - "Banner abaixo da safe area (respeitando insets)"
      - "fontSize adequado (15/13)"
      - "Funciona em dark/light mode"
      - "Conteudo empurrado para baixo, nao sobreposto"
    files_likely_impacted:
      - src/components/OfflineBanner.tsx

  - id: 148
    type: ui
    area: "Sunday Type (F007, F061)"
    feature_id: F091
    spec_file: "docs/specs/SPEC_F091.yaml"
    related_crs: [115, 127]
    description: >
      Mensagem de confirmacao ao mudar tipo de domingo atualizada com
      texto especifico. Apenas atualizacao de valores i18n existentes.
    acceptance_criteria:
      - "Titulo: 'Alterar tipo de domingo?'"
      - "Mensagem menciona discursantes e/ou temas designados"
      - "Traduzido em pt-BR, en, es"
      - "Funciona em aba Discursos e Agenda"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 149
    type: feature
    area: "Home Tab (F009)"
    feature_id: F092
    spec_file: "docs/specs/SPEC_F092.yaml"
    related_crs: [1, 3]
    description: >
      Botao 'Iniciar Reuniao Sacramental' visivel sempre (nao so domingos).
      Remover condicao isTodaySunday(). getTodaySundayDate() ja tem logica correta.
    acceptance_criteria:
      - "Botao visivel de segunda a sabado (mostra proximo domingo)"
      - "Botao visivel no domingo (mostra dia atual)"
      - "Visivel para todos os roles"
      - "Label e estilo identicos ao atual"
    files_likely_impacted:
      - src/app/(tabs)/index.tsx

  # --- Batch 14 Phase 2 (Card Layouts, Pianist/Conductor, Hymn Toggle, Status Lines) ---

  - id: 150
    type: ui
    area: "Speech Cards (F008, F009, F045)"
    feature_id: F093
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    related_crs: [101, 119]
    description: >
      Layout dos cards de designacoes contraidos (Home e Discursos): mostrar
      nomes dos 3 discursantes (um por linha) e LEDs verticais alinhados a direita.
      Esconder ao expandir. Linhas vazias mantidas para alinhamento.
    acceptance_criteria:
      - "Card collapsed speeches mostra 3 linhas de discursantes"
      - "LEDs dispostos verticalmente, alinhados a direita"
      - "Linhas vazias mantidas para alinhamento"
      - "Nomes e LEDs escondidos ao expandir"
      - "Funciona na aba Discursos e Home"
    files_likely_impacted:
      - src/components/SundayCard.tsx

  - id: 151
    type: feature
    area: "Agenda (F012, F013)"
    feature_id: F094
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    related_crs: [73]
    description: >
      Campos Pianista e Regente na secao Boas-Vindas da agenda. ActorSelector
      com roleFilter can_music. Posicao: apos Anuncios, antes de Hino de Abertura.
      Aparecem tambem no Modo Apresentacao.
    acceptance_criteria:
      - "Campo Pianista visivel na secao Boas-Vindas"
      - "Campo Regente visivel na secao Boas-Vindas"
      - "Ambos usam ActorSelector com filtro can_music"
      - "Selecao salva automaticamente via auto-save"
      - "Campos read-only para Observer"
      - "Aparecem no Modo Apresentacao Card 1"
      - "Ordem: Anuncios, Pianista, Regente, Hino de Abertura"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/hooks/usePresentationMode.ts

  - id: 152
    type: feature
    area: "Agenda (F012)"
    feature_id: F095
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    related_crs: []
    description: >
      Toggle para Hino Intermediario na agenda. Ligado por padrao em reuniao
      normal. Auto-desligado e escondido quando apresentacao especial ou
      reuniao especial. Controla visibilidade do seletor de hino.
    acceptance_criteria:
      - "Toggle visivel em reuniao normal sem apresentacao especial"
      - "Ligado por padrao"
      - "Seletor de hino visivel quando toggle ligado"
      - "Toggle escondido quando Apresentacao Especial ligada"
      - "Toggle escondido em reuniao de testemunho/primaria"
      - "Modo Apresentacao respeita toggle"
    files_likely_impacted:
      - src/components/AgendaForm.tsx

  - id: 153
    type: ui
    area: "Agenda (F012, F046)"
    feature_id: F096
    spec_file: "docs/specs/SPEC_F093_F096.yaml"
    related_crs: [102]
    description: >
      Layout dos cards de agenda contraidos com linhas de status: Falta
      (Presidir|Dirigir|Pianista|Regente), Discursantes X/3, Oradores Y/2,
      Hinos Z/W. Para excecoes nao-discursos, texto da excecao em amarelo.
    acceptance_criteria:
      - "Linha 'Falta' mostra campos vazios"
      - "Linha 'Falta' escondida quando todos preenchidos"
      - "Contagem de discursantes X/3"
      - "Contagem de hinos Z/W"
      - "Linha completa em verde"
      - "Excecao nao-speeches mostra texto em amarelo"
      - "Status lines escondidas ao expandir"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx

  # --- Batch 15 Phase 1 (Presentation mode, Speech labels, Card redesign) ---

  - id: 156
    type: ui
    area: "Presentation Mode (F044)"
    feature_id: F097
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: []
    description: >
      Arrows based on position relative to expanded card: cards above show
      down-arrow, cards below show up-arrow, expanded card has no arrow.
    acceptance_criteria:
      - "Cards above expanded show down-arrow"
      - "Cards below expanded show up-arrow"
      - "Expanded card has no arrow"
    files_likely_impacted:
      - src/components/AccordionCard.tsx

  - id: 157
    type: ui
    area: "Presentation Mode (F044)"
    feature_id: F097
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: []
    description: >
      Recognized names displayed one per line in Presentation Mode.
      Join with newline instead of comma-space.
    acceptance_criteria:
      - "Each recognized name on its own line"
      - "Field type changed to multiline"
    files_likely_impacted:
      - src/hooks/usePresentationMode.ts

  - id: 158
    type: ui
    area: "Presentation Mode (F044)"
    feature_id: F097
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: []
    description: >
      Font size toggle button next to close button in Presentation Mode header.
      Normal mode: current +1. Large mode: substantially bigger for visually
      impaired users. State not persisted.
    acceptance_criteria:
      - "Toggle button visible in header next to close button"
      - "Normal mode: current font sizes +1"
      - "Large mode: substantially bigger (fieldValue=26, fieldLabel=18)"
      - "Toggle switches between normal and large"
    files_likely_impacted:
      - src/app/presentation.tsx
      - src/components/AccordionCard.tsx

  - id: 159
    type: ui
    area: "Presentation Mode (F044)"
    feature_id: F097
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: []
    description: >
      Section titles in Presentation Mode match AgendaForm section headers:
      sectionWelcome, sectionSacrament, sectionFirstSpeeches, sectionLastSpeech.
    acceptance_criteria:
      - "Card 1 title = agenda.sectionWelcome"
      - "Card 2 title = agenda.sectionSacrament"
      - "Card 3 title = agenda.sectionFirstSpeeches"
      - "Card 4 title = agenda.sectionLastSpeech"
      - "Works in all 3 locales (pt-BR, en, es)"
    files_likely_impacted:
      - src/hooks/usePresentationMode.ts

  - id: 160
    type: ui
    area: "Speeches (F008, F009)"
    feature_id: F098
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: [150]
    description: >
      Position 3 label shows "3o Discurso" in Speeches tab and Home tab
      instead of "Ultimo Discurso". Agenda tab keeps "Ultimo Discurso".
    acceptance_criteria:
      - "Collapsed SundayCard position 3 shows '3o Discurso'"
      - "Expanded SpeechSlot position 3 shows '3o Discurso'"
      - "Agenda tab keeps 'Ultimo Discurso'"
    files_likely_impacted:
      - src/components/SundayCard.tsx
      - src/components/SpeechSlot.tsx

  - id: 161
    type: ui
    area: "Speeches (F008, F093)"
    feature_id: F099
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: [150]
    description: >
      Collapsed speech card redesign: move LED circles before label text,
      increase font (11->13), add line spacing, reduce circle size (14->10).
      No designation shows only circle, no text.
    acceptance_criteria:
      - "LED before label: '<circle> 1o Discurso: <nome>'"
      - "No separate LED column on right"
      - "Font size 13, circle size 10"
      - "No designation shows only circle"
    files_likely_impacted:
      - src/components/SundayCard.tsx

  - id: 162
    type: ui
    area: "Speeches (F008, F009)"
    feature_id: F100
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: [161]
    description: >
      Expanded speech card: move status circle to label line, right-aligned
      with status text. Format: '<status text> <circle>'. Speaker/topic
      fields use full line width.
    acceptance_criteria:
      - "LED on label line, right-aligned"
      - "Status text shown next to LED"
      - "Speaker/topic fields use full width"
      - "LED and status text are pressable"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 163
    type: i18n
    area: "Speeches (F008)"
    feature_id: F098
    spec_file: "docs/specs/SPEC_F097_F100.yaml"
    related_crs: []
    description: >
      Change speaker placeholder from "Selecionar orador" to "Selecionar
      Discursante" in pt-BR and es. English keeps "Select Speaker" (capitalized).
    acceptance_criteria:
      - "pt-BR: 'Selecionar Discursante'"
      - "en: 'Select Speaker'"
      - "es: 'Seleccionar Discursante'"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  # --- Batch 15 Phase 2 (Multilingual reset email, Test suite fix) ---

  - id: 155
    type: feature
    area: "Auth (F001, F088)"
    feature_id: F101
    spec_file: "docs/specs/SPEC_F101_F102.yaml"
    related_crs: [145]
    description: >
      Implementar Edge Function send-reset-email com email traduzido em 3
      idiomas (pt-BR, en, es) conforme ward.language. Substituir chamada
      resetPasswordForEmail em forgot-password.tsx por Edge Function.
      reset-password.tsx aceita token via deep link query params.
    acceptance_criteria:
      - "Edge Function send-reset-email envia email traduzido"
      - "Email com deep link sacrmeetman://reset-password?token=TOKEN"
      - "forgot-password.tsx chama Edge Function"
      - "reset-password.tsx aceita token via query params"
      - "Nao revela se email existe (retorna sucesso generico)"
    files_likely_impacted:
      - supabase/functions/send-reset-email/index.ts
      - src/app/(auth)/forgot-password.tsx
      - src/app/(auth)/reset-password.tsx

  - id: 164
    type: fix
    area: "Testing (F037, F101)"
    feature_id: F102
    spec_file: "docs/specs/SPEC_F101_F102.yaml"
    related_crs: [155]
    description: >
      Fix 2 pre-existing test failures (com.wardmanager.app ->
      com.sacramentmeetingmanager.app). Update tests affected by F101.
      Ensure 100% test suite passing.
    acceptance_criteria:
      - "bundleIdentifier test expects com.sacramentmeetingmanager.app"
      - "Android package test expects com.sacramentmeetingmanager.app"
      - "forgot-password tests updated for Edge Function"
      - "reset-password tests updated for token handling"
      - "Full suite passes 100%"
    files_likely_impacted:
      - src/__tests__/batch7-f035-f039.test.ts
      - src/__tests__/batch14-f088-f092.test.ts

  # --- Batch 16 (UI Polish, Accent Fixes, UX Improvements) ---

  - id: 165
    type: ui
    area: "SpeechSlot (F100)"
    feature_id: F103
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [119, 162]
    description: >
      Alinhar verticalmente o circulo de status com o botao X de remover
      designacao no card expandido de discursos. Trazer circulo e texto do
      status um pouco para a esquerda.
    acceptance_criteria:
      - "StatusLED circle vertically aligned with X remove button"
      - "Status text and circle shifted slightly left"
      - "Alignment works for all 3 speech positions"
      - "Consistent regardless of X button visibility"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 166
    type: ui
    area: "Presentation Mode (F097)"
    feature_id: F104
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [158]
    description: >
      Trocar titulo da tela de apresentacao de 'Iniciar Reuniao Sacramental'
      para 'Reuniao Sacramental'. Titulo nao muda de tamanho com toggle de
      fonte (font size fixo).
    acceptance_criteria:
      - "Title shows 'Reuniao Sacramental' in pt-BR"
      - "Title shows 'Sacrament Meeting' in en"
      - "Title shows 'Reunion Sacramental' in es"
      - "Title font size does NOT change with font toggle"
      - "Date label remains fixed size (no regression)"
    files_likely_impacted:
      - src/app/presentation.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 167
    type: bug
    area: "i18n (F097, F096)"
    feature_id: F105
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [29, 69, 159]
    description: >
      Corrigir 4 secoes da agenda em pt-BR sem acentos e cedilha. Correto:
      'Boas-Vindas, Anuncios e Reconhecimentos', 'Designacoes e Sacramento',
      'Primeiros Discursos', 'Ultimo Discurso'.
    acceptance_criteria:
      - "pt-BR sectionWelcome with capital V and tilde"
      - "pt-BR sectionSacrament with cedilla and tilde"
      - "pt-BR sectionLastSpeech with accent"
      - "sectionFirstSpeeches unchanged (already correct)"
      - "Presentation Mode card titles show corrected text"
      - "Agenda form section headers show corrected text"
      - "es.json accents also fixed"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/es.json

  - id: 168
    type: ux
    area: "Settings (F033)"
    feature_id: F106
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [33]
    description: >
      Aumentar area clicavel do botao Voltar em todas as 8 sub-telas de
      Configuracoes. Area atual muito pequena (sem hitSlop ou padding extra).
    acceptance_criteria:
      - "Back button touch area meets 44x44 minimum"
      - "All 8 Settings sub-screens updated consistently"
      - "Navigation still works correctly"
      - "Visual appearance not drastically changed"
    files_likely_impacted:
      - src/app/(tabs)/settings/theme.tsx
      - src/app/(tabs)/settings/whatsapp.tsx
      - src/app/(tabs)/settings/about.tsx
      - src/app/(tabs)/settings/history.tsx
      - src/app/(tabs)/settings/timezone.tsx
      - src/app/(tabs)/settings/members.tsx
      - src/app/(tabs)/settings/users.tsx
      - src/app/(tabs)/settings/topics.tsx

  - id: 169
    type: ui
    area: "SundayCard (F099, F093)"
    feature_id: F107
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [126, 150, 161]
    description: >
      Igualar tamanho visual e espacamento dos circulos de status nos cards
      contraidos. Circulo piscante parece maior devido a animacao de opacidade.
    acceptance_criteria:
      - "All 3 status circles appear same size visually"
      - "Consistent spacing between circles and text"
      - "Animation still distinguishes assigned_not_invited"
      - "Change applies to both Home and Speeches tabs"
    files_likely_impacted:
      - src/components/StatusLED.tsx
      - src/components/SundayCard.tsx

  - id: 170
    type: ui
    area: "Presentation Mode (F097, F098)"
    feature_id: F108
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [122, 160]
    description: >
      Trocar label redundante 'Ultimo Discurso - Discurso' para 'Ultimo
      Discurso' na tela de apresentacao.
    acceptance_criteria:
      - "Last speech label shows 'Ultimo Discurso' in pt-BR"
      - "Label shows 'Final Speech' in en"
      - "Label shows 'Ultimo Discurso' in es"
      - "First and second speaker labels unchanged"
    files_likely_impacted:
      - src/hooks/usePresentationMode.ts

  - id: 171
    type: feature
    area: "Agenda (F096, F094)"
    feature_id: F109
    spec_file: "docs/specs/SPEC_F103_F109.yaml"
    related_crs: [102, 153]
    description: >
      Cards contraidos de agenda para testimony_meeting e primary_presentation
      SOMENTE mostram 4 linhas de status: Falta roles, tipo em amarelo,
      Oraes Y de 2, Hinos Z de 3. Outros tipos de excecao nao afetados.
    acceptance_criteria:
      - "Falta line shows missing roles"
      - "Exception type shown in yellow"
      - "Oraes count Y de 2 (new i18n key)"
      - "Hymns count Z de 3 (always 3 for special meetings)"
      - "Falta line hidden when all roles filled"
      - "Green color when all items complete"
      - "ONLY testimony_meeting and primary_presentation affected"
      - "ward_conference, other, general_conference, stake_conference unchanged"
      - "Status lines hidden when expanded"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  # --- Batch 17 (Stake Announcements in Presentation, AgendaForm Label, SpeechSlot Alignment) ---

  - id: 172
    type: feature
    area: "Presentation Mode (F097)"
    feature_id: F110
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    related_crs: []
    description: >
      Quando toggle has_stake_announcements esta ligado, mostrar campo no
      Card 2 da apresentacao com label 'Apoios e Agradecimentos da Estaca'
      e valor 'Passar palavra a Estaca'. Novo i18n key nos 3 idiomas.
    acceptance_criteria:
      - "Stake field shown in presentation when toggle is on"
      - "Stake field NOT shown when toggle is off"
      - "Position: after baptism confirmation, before sacrament hymn"
      - "pt-BR: label 'Apoios e Agradecimentos da Estaca', value 'Passar palavra a Estaca'"
      - "en: label 'Stake Sustainings and Releases', value 'Turn the time over to the Stake'"
      - "es: label 'Apoyos y Agradecimientos de Estaca', value 'Ceder la palabra a la Estaca'"
    files_likely_impacted:
      - src/hooks/usePresentationMode.ts
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 173
    type: ui
    area: "AgendaForm (F012)"
    feature_id: F111
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    related_crs: [170]
    description: >
      Trocar label redundante 'Ultimo Discurso - Discurso' para 'Ultimo
      Discurso' no AgendaForm (mesma correcao que CR-170 na presentation).
    acceptance_criteria:
      - "Last speech label shows 'Ultimo Discurso' in pt-BR"
      - "Label shows 'Final Speech' in en"
      - "Label shows 'Ultimo Discurso' in es"
      - "First and second speaker labels unchanged"
    files_likely_impacted:
      - src/components/AgendaForm.tsx

  - id: 174
    type: ui
    area: "SpeechSlot (F100)"
    feature_id: F112
    spec_file: "docs/specs/SPEC_F110_F112.yaml"
    related_crs: [162, 165]
    description: >
      Alinhar verticalmente o CENTRO do circulo do StatusLED com o CENTRO
      do icone X de remover designacao. Substitui abordagem do CR-165
      (paddingRight:5 insuficiente). Reestruturar layout com coluna fixa.
    acceptance_criteria:
      - "StatusLED circle center vertically aligned with X button center"
      - "Alignment works for all 3 speech positions"
      - "Topic clear button also aligned in same column"
      - "Alignment consistent when X is not visible"
      - "Status text and modal interaction preserved"
      - "Layout does not break on narrow screens"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  # --- Batch 18 (Deep link scheme fix, Email reset redirect, Status circle alignment) ---

  - id: 175
    type: bug
    area: "Deep Links (F037, F001, F101)"
    feature_id: F113
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    related_crs: [93]
    description: >
      Deep link scheme deve ser sacrmeetplan:// em vez de sacrmeetman://.
      Trocar em app.json, create-invitation Edge Function e send-reset-email
      Edge Function. Atualizar Redirect URLs no Supabase Dashboard (manual).
    acceptance_criteria:
      - "app.json scheme is 'sacrmeetplan'"
      - "create-invitation uses sacrmeetplan://invite/"
      - "send-reset-email uses sacrmeetplan://reset-password"
      - "No sacrmeetman:// or wardmanager:// in production code"
      - "bundleIdentifier and package unchanged"
    files_likely_impacted:
      - app.json
      - supabase/functions/create-invitation/index.ts
      - supabase/functions/send-reset-email/index.ts

  - id: 176
    type: bug
    area: "Password Reset (F101, F088)"
    feature_id: F114
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    related_crs: [67, 145, 155]
    description: >
      Email de recuperacao de senha tem botao nao clicavel porque email
      clients bloqueiam custom URL schemes. Criar Edge Function HTTPS
      intermediaria (reset-redirect) que serve HTML com auto-redirect
      para sacrmeetplan://reset-password. Alterar send-reset-email para
      usar URL HTTPS no email.
    acceptance_criteria:
      - "Email href uses HTTPS URL (not custom scheme)"
      - "reset-redirect Edge Function exists"
      - "reset-redirect returns HTML with auto-redirect to sacrmeetplan://"
      - "Fallback button included in HTML"
      - "Required params (token, type) validated"
      - "CORS preflight handled"
      - "Deep link uses sacrmeetplan:// (not sacrmeetman://)"
    files_likely_impacted:
      - supabase/functions/send-reset-email/index.ts
      - supabase/functions/reset-redirect/index.ts (new)

  - id: 177
    type: ui
    area: "SpeechSlot (F100, F112)"
    feature_id: F115
    spec_file: "docs/specs/SPEC_F113_F115.yaml"
    related_crs: [119, 162, 165, 174]
    description: >
      Alinhar direita do circulo de status com direita do campo do nome
      do discursante. Mover StatusLED do rightColumn para labelRow
      (leftColumn). Supersede alinhamento centro-a-centro do CR-174/F112.
    acceptance_criteria:
      - "StatusLED right edge aligned with speaker field right edge"
      - "Alignment works for all 3 speech positions"
      - "Status text visible and pressable"
      - "Status change modal still opens"
      - "X remove button still functional"
      - "Topic clear button still functional"
      - "Layout does not break on narrow screens"
      - "Alignment consistent when X is not visible"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  # --- Batch 19 Phase 1 (Language control, Pianist/Conductor split, Optional 2nd speech, Password reset bug) ---

  - id: 178
    type: feature
    area: "i18n / Settings (F002, F005, F006, F020)"
    feature_id: F116
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    related_crs: [2, 11, 41, 59, 94, 140]
    description: >
      Separar controle de idioma em: idioma do app (per-user, Supabase Auth
      user_metadata) e idioma da ala (wards.language). Idioma do app controla
      UI e nomes de placeholders WhatsApp. Idioma da ala controla template
      WhatsApp e colecoes. Observer ganha Settings limitado (idioma app, tema,
      sobre). Fix bug reativacao de colecoes ao trocar idioma da ala.
    acceptance_criteria:
      - "App language saved per-user in auth.users.raw_user_meta_data"
      - "Ward language unchanged in wards.language"
      - "Observer sees limited Settings (3 options)"
      - "WhatsApp placeholder names translated per app language"
      - "Collection reactivation bug fixed"
      - "Settings shows 'Idioma do App' + 'Idioma da Ala' for bishopric/secretary"
      - "Login loads user language from metadata"
    files_likely_impacted:
      - src/contexts/AuthContext.tsx
      - src/app/(tabs)/settings/index.tsx
      - src/app/(tabs)/settings/whatsapp.tsx
      - src/app/(tabs)/settings/topics.tsx
      - src/app/(tabs)/_layout.tsx
      - src/hooks/useTopics.ts
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 180
    type: feature
    area: "Actors / Agenda (F012, F013)"
    feature_id: F117
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    related_crs: [26, 34, 70, 71, 72, 73, 151]
    description: >
      Dividir can_music em can_pianist + can_conductor com CHECK constraint
      de exclusividade mutua. Migracao: can_music=true vira can_pianist=true.
      AgendaForm usa roleFilter separados. Designacoes existentes preservadas.
    acceptance_criteria:
      - "can_pianist and can_conductor columns exist, can_music removed"
      - "CHECK constraint: NOT (can_pianist AND can_conductor)"
      - "Migration: can_music=true -> can_pianist=true"
      - "Pianist field filters by can_pianist"
      - "Conductor field filters by can_conductor"
      - "Creating from pianist field sets can_pianist=true"
      - "Creating from conductor field sets can_conductor=true"
      - "No can_music references in production code"
    files_likely_impacted:
      - supabase/migrations/NNN_split_music_actor.sql
      - src/types/database.ts
      - src/hooks/useActors.ts
      - src/components/AgendaForm.tsx
      - src/components/ActorSelector.tsx

  - id: 181
    type: feature
    area: "Speeches (F007, F008, F009, F012)"
    feature_id: F118
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    related_crs: [4, 56, 99, 122, 160]
    description: >
      Toggle para 2o discurso opcional por domingo. has_second_speech na
      sunday_agendas (default true). Confirmacao ao desligar so quando ha
      designacoes. Card contraido sem labels ordinais. '3o Discurso' vira
      'Ultimo Discurso'. Apresentacao mostra so 1o discurso quando desligado.
    acceptance_criteria:
      - "has_second_speech BOOLEAN DEFAULT true in sunday_agendas"
      - "Toggle visible for Bispado on position 2"
      - "Confirmation only when assignments exist"
      - "Collapsed card: no ordinal labels, hides pos 2 when off"
      - "Position 3 label: 'Ultimo Discurso'"
      - "Presentation: only speech 1 in 'Primeiros Discursos' when off"
      - "Agenda: disabled placeholder when off"
      - "Invite management: hides pos 2 when off"
    files_likely_impacted:
      - supabase/migrations/NNN_add_has_second_speech.sql
      - src/types/database.ts
      - src/app/(tabs)/speeches.tsx
      - src/components/SpeechSlot.tsx
      - src/components/SundayCard.tsx
      - src/hooks/usePresentationMode.ts
      - src/components/AgendaForm.tsx
      - src/components/InviteManagementSection.tsx
      - src/components/NextSundaysSection.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 191
    type: bug
    area: "Password Reset (F001, F088, F114)"
    feature_id: F119
    spec_file: "docs/specs/SPEC_F116_F119.yaml"
    related_crs: [67, 145, 155, 176]
    description: >
      Ao clicar 'Redefinir Senha' no email (Gmail->Safari iOS), browser
      mostra plain-text do HTML. Requer investigacao profunda: charset fix
      + Cache-Control como baseline, mas root cause deve ser identificado
      (Supabase proxy, Deno runtime, browser-specific behavior).
    acceptance_criteria:
      - "Content-Type: 'text/html; charset=utf-8'"
      - "Cache-Control header set"
      - "HTML not escaped or double-encoded"
      - "No conflicting Content-Type in corsHeaders"
      - "Deep link uses sacrmeetplan:// scheme"
      - "HTML renders properly in Safari on iOS"
      - "Root cause identified and documented"
    files_likely_impacted:
      - supabase/functions/reset-redirect/index.ts

  # --- Batch 19 Phase 2 (Card UI/UX, Label Renames, Push Notifications Bug) ---

  - id: 179
    type: feature
    area: "AgendaForm (F012, F013, F014, F015)"
    feature_id: F120
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: [26, 73, 114, 128]
    description: >
      Adicionar botao X a todos os campos de selecao (atores, hinos, oracoes,
      reconhecendo) no AgendaForm para limpar valor atual. X visivel quando campo
      tem valor e usuario nao e Observer. Sem dialogo de confirmacao.
    acceptance_criteria:
      - "X visible on actor fields (preside, conduct, pianist, conductor) when value set"
      - "X visible on hymn fields (opening, sacrament, intermediate, closing) when hymn selected"
      - "X visible on prayer fields (opening, closing) when prayer name set"
      - "X visible on recognizing field when names selected"
      - "X NOT visible when field is empty"
      - "X NOT visible for Observer role"
      - "No confirmation dialog on clear"
      - "Auto-save triggered after clear via updateField()"
      - "Free-text, switch, and SpeakerField NOT affected"
    files_likely_impacted:
      - src/components/AgendaForm.tsx

  - id: 182
    type: feature
    area: "AgendaForm (F012, F008, F044)"
    feature_id: F121
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: [31, 100]
    description: >
      Remover edicao de discursos (SpeakerField com override) do card de agenda.
      Campos mostram nome do discursante como read-only. Botao lapis a direita
      navega para aba Discursos com card do domingo expandido. Supersede
      SpeakerField editing do F044 no AgendaForm.
    acceptance_criteria:
      - "Speaker names shown as read-only in Agenda card"
      - "Pencil button visible next to each speaker field"
      - "Pencil button navigates to Speeches tab with card expanded"
      - "Speaker override editing removed from Agenda UI"
      - "Position 2 hidden when has_second_speech=false"
      - "Empty state shows placeholder text"
      - "Presentation Mode still uses overrides (unchanged)"
      - "Observer sees read-only fields without pencil button"
    files_likely_impacted:
      - src/components/AgendaForm.tsx
      - src/app/(tabs)/speeches.tsx

  - id: 183
    type: ui_text_change
    area: "Home Tab (F009)"
    feature_id: F122
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: []
    description: >
      Trocar texto 'Proximas Designacoes' para 'Proximos Discursos' na Home
      em todos os 3 idiomas. Key i18n home.nextAssignments permanece (valor muda).
    acceptance_criteria:
      - "pt-BR: 'Proximos Discursos'"
      - "en: 'Upcoming Speeches'"
      - "es: 'Proximos Discursos'"
      - "NextSundaysSection also updated (uses same i18n key)"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 187
    type: ui_text_change
    area: "Agenda Tab (F012)"
    feature_id: F123
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: []
    description: >
      Trocar nome da aba 'Agenda' para 'Agendas' em todos os 3 idiomas.
      Afeta tabs.agenda e agenda.title nos 3 locales.
    acceptance_criteria:
      - "Tab label shows 'Agendas' in pt-BR"
      - "Tab label shows 'Agendas' in en"
      - "Tab label shows 'Agendas' in es"
      - "Screen title updated to 'Agendas'"
    files_likely_impacted:
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 189
    type: bug
    area: "SpeechSlot (F008, F060, F073, F112, F115)"
    feature_id: F124
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: [114, 128, 162, 174, 177]
    description: >
      Icones X no SpeechSlot deslocados. Centro do X do speaker deve alinhar
      com centro do campo de selecao. Centro do X do tema deve alinhar com
      centro do campo de tema. Causa: statusLedPlaceholder cria offset vertical.
    acceptance_criteria:
      - "Speaker X center aligns with speaker field center"
      - "Topic X center aligns with topic field center"
      - "Alignment works for all 3 speech positions"
      - "Layout does not break on narrow screens"
      - "Alignment correct when X is not visible"
      - "StatusLED positioning not regressed (F115)"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 192
    type: bug_critical
    area: "Push Notifications (F017)"
    feature_id: F125
    spec_file: "docs/specs/SPEC_F120_F125.yaml"
    related_crs: [52, 53]
    description: >
      Push notifications nao funcionam. Root cause: useNotifications.ts passa
      projectId: undefined para getExpoPushTokenAsync. O correto e usar
      Constants.expoConfig?.extra?.eas?.projectId. Fix client-side apenas.
    acceptance_criteria:
      - "projectId correctly passed to getExpoPushTokenAsync"
      - "Constants imported from expo-constants"
      - "Push token registered successfully on EAS build"
      - "Notifications received after fix"
      - "Fallback when projectId unavailable (Expo Go)"
      - "Observer still excluded from push registration"
      - "Server-side Edge Function not modified"
    files_likely_impacted:
      - src/hooks/useNotifications.ts

  # --- Batch 20 Phase 1 (Navigation & Home Redesign) ---

  - id: 184
    type: feature
    area: "Presentation Mode (F016, F012)"
    feature_id: F126
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    related_crs: [158]
    description: >
      Adicionar icone de lapis na tela de Apresentacao (ao lado do botao de
      tamanho de fonte) que navega para aba Agendas com card expandido.
      Requer suporte a expandDate query param na aba Agendas (ADR-082).
    acceptance_criteria:
      - "Pencil button visible in Presentation screen header"
      - "Pencil navigates to Agenda tab with card expanded for the Sunday"
      - "Agenda tab auto-expands card when expandDate param provided"
      - "expandDate param cleared after handling"
      - "Agenda record lazy-created when expandDate provided"
      - "Pencil visible and functional for all roles"
      - "Pencil button style matches existing header buttons (36x36 circle)"
    files_likely_impacted:
      - src/app/presentation.tsx
      - src/app/(tabs)/agenda.tsx

  - id: 185
    type: feature
    area: "Agenda (F012, F016)"
    feature_id: F127
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    related_crs: [149]
    description: >
      Adicionar botao play no card expandido da agenda (ao lado da seta de
      colapsar) que navega para tela de Apresentacao com o domingo selecionado.
      Requer que Presentation screen aceite date param opcional.
    acceptance_criteria:
      - "Play button visible when Agenda card is expanded"
      - "Play button NOT visible when collapsed"
      - "Play navigates to Presentation screen with correct date"
      - "Presentation screen accepts date parameter"
      - "Presentation falls back to getTodaySundayDate when no param"
      - "Play button not shown for non-expandable cards"
      - "Play button accessible for all roles"
    files_likely_impacted:
      - src/app/(tabs)/agenda.tsx
      - src/app/presentation.tsx

  - id: 186
    type: feature
    area: "Home (F009, F012, F016)"
    feature_id: F128
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    related_crs: [149, 1, 3]
    description: >
      Home - sessao 'Agenda da Reuniao Sacramental': botao Iniciar ganha icone
      de play. Abaixo, card de domingo identico ao contraido da aba Agendas
      (nao expansivel). Pencil button navega para aba Agendas com card expandido.
    acceptance_criteria:
      - "Play icon (U+25B6) visible before 'Iniciar' text"
      - "Sunday preview card visible below Iniciar button"
      - "Preview card shows correct date (next Sunday or today)"
      - "Preview card shows status lines (missing roles, speakers, prayers, hymns)"
      - "Pencil button on card navigates to Agenda tab with expandDate"
      - "Preview card NOT expandable"
      - "Preview card shows exception label for special meetings"
      - "All roles see preview card and pencil button"
      - "Pencil button style: square 36x36, borderRadius 8"
    files_likely_impacted:
      - src/app/(tabs)/index.tsx

  - id: 188
    type: ux
    area: "Home (F009, F008)"
    feature_id: F129
    spec_file: "docs/specs/SPEC_F126_F129.yaml"
    related_crs: [150]
    description: >
      Home - secao 'Proximos Discursos': cards nao sao mais expansiveis.
      Remover edicao inline. Botao lapis navega para aba Discursos com card
      expandido (ADR-082). NextAssignmentsSection nao afetada.
    acceptance_criteria:
      - "Cards NOT expandable (no toggle, no SpeechSlot)"
      - "No chevron shown on cards"
      - "Pencil button visible on each card"
      - "Pencil navigates to Speeches tab with expandDate"
      - "Cards still show speaker names and LEDs"
      - "No MemberSelectorModal or TopicSelectorModal rendered"
      - "Exception label still shown for special Sundays"
      - "isNext highlighting preserved"
      - "F118 has_second_speech respected"
      - "Pencil button style identical to CR-186 (square, 36x36)"
      - "Observer can see cards and pencil button"
    files_likely_impacted:
      - src/components/NextSundaysSection.tsx
      - src/components/SundayCard.tsx

  # --- Batch 21 Phase 2 (Settings Reorganization, StatusLED Alignment, Play Icon Size) ---

  - id: 193
    type: ui
    area: "Settings (F083, F116)"
    feature_id: F135
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    related_crs: [140, 178]
    description: >
      Reorganizar aba Configuracoes em 2 grupos rotulados: 'Configuracoes da Ala'
      (Discursantes, Biblioteca de Temas, WhatsApp, Idioma da Ala, Fuso Horario)
      e 'Configuracoes do App' (Usuarios do App, Historico de Uso, Idioma do App,
      Tema Claro/Escuro, Sobre). Label com nome de cada grupo antes dos cards.
    acceptance_criteria:
      - "Group 1 label 'Configuracoes da Ala' displayed above first card section"
      - "Group 2 label 'Configuracoes do App' displayed above second card section"
      - "Group 1 contains: Discursantes, Biblioteca de Temas, WhatsApp, Idioma da Ala, Fuso Horario"
      - "Group 2 contains: Usuarios do App, Historico de Uso, Idioma do App, Tema Claro/Escuro, Sobre"
      - "Observer sees only Group 2 (limited items), Group 1 hidden"
      - "New i18n keys in all 3 languages for group labels"
      - "Permission gating unchanged"
      - "Sign Out button remains at bottom"
    files_likely_impacted:
      - src/app/(tabs)/settings/index.tsx
      - src/i18n/locales/pt-BR.json
      - src/i18n/locales/en.json
      - src/i18n/locales/es.json

  - id: 199
    type: ui
    area: "SpeechSlot (F115, F124)"
    feature_id: F136
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    related_crs: [177, 189]
    description: >
      Alinhar direita do circulo de status (StatusLED) com direita do campo do
      discursante sem mexer posicao do X. Root cause: actionArea width:36 not
      accounted for in labelRow. Fix: add paddingRight:36 to statusSection/labelRow.
    acceptance_criteria:
      - "StatusLED right edge aligns with speaker field right edge"
      - "X button position unchanged"
      - "Alignment works for all 3 speech positions"
      - "Status text remains left of StatusLED"
      - "Position 2 disabled state not affected"
      - "Toggle switch for position 2 not affected"
    files_likely_impacted:
      - src/components/SpeechSlot.tsx

  - id: 200
    type: ui
    area: "Home (F128), Agenda (F127)"
    feature_id: F137
    spec_file: "docs/specs/SPEC_F135_F137.yaml"
    related_crs: [185, 186]
    description: >
      Trocar icone de play (Home Iniciar Reuniao e card de agenda) por icone bem
      maior (altura da fonte). Home: fontSize 17 -> >= 20. Agenda: fontSize 14 ->
      >= 18, com marginRight adequado para separar do chevron.
    acceptance_criteria:
      - "Home play icon fontSize >= 20 (visual height matches button text)"
      - "Agenda play icon fontSize >= 18"
      - "Agenda play icon has marginRight >= 8 from chevron"
      - "Vertical alignment maintained in Home button"
      - "Play icon visually distinct from chevron in Agenda"
      - "Navigation behavior unchanged"
    files_likely_impacted:
      - src/app/(tabs)/index.tsx
      - src/app/(tabs)/agenda.tsx

  # --- Batch 22 Phase 1 (Password Reset & Invitation Web Pages) ---

  - id: 202
    type: enhancement
    area: "Auth (F001, F088, F114)"
    feature_id: F138
    spec_file: "docs/specs/SPEC_F138_F139.yaml"
    related_crs: [67, 155, 176, 191, 197, 198]
    description: >
      Reescrever reset-redirect para servir pagina web com formulario de nova senha.
      Usa Supabase JS via CDN para chamar verifyOtp + updateUser direto no browser.
      send-reset-email NAO muda (link ja aponta para reset-redirect com token+type).
      Endpoint reset-redirect mantido para nao quebrar emails ja enviados.
    acceptance_criteria:
      - "Pagina HTML com formulario de reset de senha (sem deep link)"
      - "verifyOtp chamado on load para validar token"
      - "updateUser chamado on submit com nova senha"
      - "Validacao client-side: senha >= 6 chars, senhas coincidem"
      - "Multilingue (pt-BR, en, es) via navigator.language"
      - "Supabase JS carregado via CDN"
      - "send-reset-email inalterado"
      - "Content-Type: text/html; charset=utf-8"
      - "Estado de loading, erro e sucesso"
    files_likely_impacted:
      - supabase/functions/reset-redirect/index.ts

  - id: 203
    type: feature
    area: "Auth (F001)"
    feature_id: F139
    spec_file: "docs/specs/SPEC_F138_F139.yaml"
    related_crs: [67]
    description: >
      Nova Edge Function (invite-redirect) com pagina web + formulario de registro.
      Formulario com campos: nome completo e senha (email/role/ward sao read-only,
      vindos do convite). Chama register-invited-user via fetch direto do browser.
      create-invitation muda deepLink de sacrmeetplan://invite/... para URL HTTPS
      da nova pagina.
    acceptance_criteria:
      - "Nova Edge Function invite-redirect serve pagina HTML"
      - "Token validado via fetch para register-invited-user (validate-only)"
      - "Campos read-only: estaca, ala, funcao, email"
      - "Campos editaveis: nome completo, senha, confirmar senha"
      - "Submit chama register-invited-user com token+password+fullName"
      - "create-invitation retorna URL HTTPS ao inves de deep link"
      - "Multilingue (pt-BR, en, es) via navigator.language"
      - "register-invited-user inalterado"
      - "Funcao (role) traduzida na exibicao"
      - "Content-Type: text/html; charset=utf-8"
      - "Estado de loading, erro e sucesso"
    files_likely_impacted:
      - supabase/functions/invite-redirect/index.ts (NEW)
      - supabase/functions/create-invitation/index.ts

  # --- Batch 23 Phase 1 (Invite Error, Language Switch, WhatsApp Template) ---

  - id: 205
    type: bugfix
    area: "Settings (F001)"
    feature_id: F140
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    related_crs: [67]
    description: >
      Erro generico ao clicar em 'Convidar Usuario'. inviteMutation.onError descarta
      err.message e mostra apenas t('users.inviteFailed'). MutationCache global dispara
      alerta duplicado. Fix: usar err.message no onError, fallback para texto generico.
      Adicionar meta.suppressGlobalError para evitar alerta duplo.
    acceptance_criteria:
      - "onError mostra err.message (mensagem do servidor)"
      - "suppressGlobalError evita alerta duplicado do MutationCache"
      - "Fallback para t('users.inviteFailed') se err.message vazio"
      - "Fluxo de sucesso nao muda"
    files_likely_impacted:
      - src/app/(tabs)/settings/users.tsx

  - id: 206
    type: bugfix
    area: "Settings (F116, F131)"
    feature_id: F141
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    related_crs: [67, 155]
    description: >
      Troca de idioma da ala quebra colecoes (nenhuma aparece) e template WhatsApp
      (nao troca). Root causes: (1) Tabela general_collections nao tem dados para
      'en' e 'es'. (2) Flag initialized em whatsapp.tsx impede re-avaliacao quando
      wardLanguage muda. (3) wardLanguageChangeMutation nao reseta whatsapp_template.
      Fix: seed data en/es, resetar template no banco, resetar flag initialized.
    acceptance_criteria:
      - "Seed data para general_collections em en e es"
      - "Colecoes aparecem apos trocar idioma para en ou es"
      - "whatsapp_template resetado para NULL ao trocar idioma"
      - "Template screen mostra default do novo idioma"
      - "Flag initialized reseta quando wardLanguage muda"
      - "Cache do ward invalidado apos troca de idioma"
      - "Dados pt-BR existentes nao modificados"
    files_likely_impacted:
      - supabase/migrations/019_seed_en_es_collections.sql (NEW)
      - src/app/(tabs)/settings/index.tsx
      - src/app/(tabs)/settings/whatsapp.tsx

  - id: 207
    type: bugfix
    area: "Home (F001, F116)"
    feature_id: F142
    spec_file: "docs/specs/SPEC_F140_F141_F142.yaml"
    related_crs: [67, 155]
    description: >
      Template WhatsApp configurado em Configuracoes nao e usado no envio real.
      InviteManagementSection passa template='' (hardcoded) para buildWhatsAppUrl,
      que SEMPRE usa default. Tambem usa getCurrentLanguage() (idioma do app) em vez
      de wardLanguage. Fix: buscar wards.whatsapp_template, passar para buildWhatsAppUrl,
      usar wardLanguage.
    acceptance_criteria:
      - "Busca wards.whatsapp_template do banco"
      - "Passa template real para buildWhatsAppUrl"
      - "Usa wardLanguage em vez de getCurrentLanguage()"
      - "formatDateHumanReadable usa wardLanguage"
      - "Mensagem WhatsApp corresponde ao preview em Configuracoes"
      - "Fallback para default quando template e null"
    files_likely_impacted:
      - src/components/InviteManagementSection.tsx

  # --- Batch 22 Phase 2 (Invite Root Cause, External Page Hosting) ---

  - id: 208
    type: bugfix
    area: "Settings (F001, F139, F140)"
    feature_id: F143
    spec_file: "docs/specs/SPEC_F143_F144.yaml"
    related_crs: [93, 203, 205]
    description: >
      Ao clicar em 'Convidar Usuario' recebe erro: Edge Function returned a
      non-2xx status code. CR-205/F140 melhorou visibilidade do erro mas nao
      resolveu a causa raiz. create-invitation tem multiplos pontos de falha
      (auth header, JWT, metadata, role, payload, DB). Fix: logging detalhado,
      error codes estruturados, modo diagnostico para identificar ponto de falha.
    acceptance_criteria:
      - "Cada ponto de falha loga erro estruturado com contexto"
      - "Respostas de erro incluem 'code' para mapeamento i18n"
      - "Modo diagnostico { diagnose: true } retorna health check"
      - "Criacao de convite continua funcionando sem regressao"
      - "callEdgeFunction preserva error code do servidor"
      - "Erro auth/no-session mostra mensagem adequada"
    files_likely_impacted:
      - supabase/functions/create-invitation/index.ts

  - id: 204
    type: bugfix
    area: "Auth (F138, F139)"
    feature_id: F144
    spec_file: "docs/specs/SPEC_F143_F144.yaml"
    related_crs: [67, 145, 155, 176, 191, 198, 202]
    description: >
      Supabase sobrescreve Content-Type de text/html para text/plain em respostas
      GET de Edge Functions que retornam HTML (restricao de seguranca anti-phishing).
      Browser mostra codigo HTML como texto. Fix: hospedar paginas em GitHub Pages
      (gratuito) e mudar Edge Functions para retornar 302 redirect para as paginas
      externas. Env var EXTERNAL_PAGES_URL configuravel.
    acceptance_criteria:
      - "reset-redirect retorna 302 para pagina externa"
      - "invite-redirect retorna 302 para pagina externa"
      - "Paginas externas renderizam corretamente com Content-Type text/html"
      - "Todas as funcionalidades preservadas (verifyOtp, updateUser, registro)"
      - "i18n (pt-BR, en, es) preservado"
      - "Links antigos continuam funcionando (redirect transparente)"
      - "Validacao de formato do token antes do redirect"
      - "EXTERNAL_PAGES_URL configuravel via env var"
    files_likely_impacted:
      - supabase/functions/reset-redirect/index.ts
      - supabase/functions/invite-redirect/index.ts
      - docs/public/reset-password.html (NEW)
      - docs/public/accept-invite.html (NEW)

  # --- Batch 23 Phase 1 (SVG icons, Play icon placement) ---

  - id: 209
    type: ui_improvement
    area: "Icons / UI (global)"
    feature_id: F145
    spec_file: "docs/specs/SPEC_F145.yaml"
    related_crs: [87, 105]
    description: >
      Substituir todos os icones Unicode/emoji por componentes SVG inline
      (react-native-svg) para consistencia visual cross-platform. Emojis
      (casa, clipboard, microfone, engrenagem, lixeira) ignoram cor do tema.
      Unicode (setas, X, checkmark, pencil) variam entre plataformas. Criar
      src/components/icons/index.ts com 14 componentes SVG (padrao WhatsAppIcon).
      Path data do Lucide Icons (MIT). Zero dependencias novas. Consolida
      WhatsAppIcon duplicado.
    acceptance_criteria:
      - "14 icon components exportados de icons/index.ts"
      - "Todos usam react-native-svg com props size/color"
      - "Tab bar icons usam SVG (HomeIcon, ClipboardListIcon, MicIcon, SettingsIcon)"
      - "SwipeableCard usa TrashIcon e PencilIcon"
      - "PlayIcon, PencilIcon, XIcon, ChevronDown/Up/Right, CheckIcon, MoreVerticalIcon"
      - "WhatsAppIcon consolidado de 2 arquivos para icons/index.ts"
      - "Zero caracteres Unicode/emoji para icones no codigo"
      - "Zero dependencias novas no package.json"
      - "Icones identicos em iOS e Android"
    files_likely_impacted:
      - src/components/icons/index.ts (NEW)
      - src/app/(tabs)/_layout.tsx
      - src/components/SwipeableCard.tsx
      - src/app/(tabs)/index.tsx
      - src/app/presentation.tsx
      - src/components/SpeechSlot.tsx
      - src/components/SearchInput.tsx
      - src/components/SundayCard.tsx
      - src/components/AccordionCard.tsx
      - src/components/AgendaForm.tsx
      - src/components/InviteManagementSection.tsx
      - src/components/InviteActionDropdown.tsx
      - src/app/(tabs)/agenda.tsx
      - src/app/(tabs)/settings/index.tsx
      - src/app/(tabs)/settings/users.tsx
      - src/app/(tabs)/settings/timezone.tsx
      - src/app/(tabs)/settings/theme.tsx

  - id: 210
    type: ui_improvement
    area: "Home / Agenda (F044)"
    feature_id: F146
    spec_file: "docs/specs/SPEC_F146.yaml"
    related_crs: [209]
    description: >
      Ajustar posicionamento do icone de play (agora PlayIcon SVG de F145).
      Home tab: manter dentro do botao "Iniciar Reuniao Sacramental" (sem
      mudanca de posicao). Agenda tab: posicionar ao lado do chevron de
      expansao/contracao com gap (marginRight: 8). Icones sobrios que
      funcionam com temas claro/escuro via prop color (colors.textSecondary).
    acceptance_criteria:
      - "Home tab: PlayIcon dentro do botao, sem mudanca de posicao"
      - "Agenda tab: PlayIcon ao lado do chevron com marginRight: 8"
      - "Play icon funciona com tema claro (colors.textSecondary)"
      - "Play icon funciona com tema escuro (colors.textSecondary)"
      - "Play icon so visivel quando card expandido"
      - "Icone monocromatico, nao colorido"
    files_likely_impacted:
      - src/app/(tabs)/index.tsx
      - src/app/(tabs)/agenda.tsx

# =============================================================================

design_decisions:

  - id: DD-01
    title: "Sunday types: lista correta"
    decided_in: CR-6
    decision: >
      Opcoes de tipo de domingo sao exatamente: Domingo com Discursos,
      Reuniao de Testemunho, Conferencia Geral, Conferencia de Estaca,
      Conferencia de Ala, Reuniao Especial da Primaria, Outro (com texto livre).
      Valores no DB: speeches, testimony_meeting, general_conference,
      stake_conference, ward_conference, primary_presentation, other.

  - id: DD-02
    title: "Speeches type persists in DB"
    decided_in: CR-56
    decision: >
      O valor 'speeches' e persistido na tabela sunday_exceptions (nao e
      tratado como ausencia de registro). CHECK constraint inclui 'speeches'.
      Auto-atribuicao em lote persiste 'speeches' para domingos normais.

  - id: DD-03
    title: "Actor management: inline na agenda, sem tela separada"
    decided_in: CR-26
    decision: >
      Gestao de atores e feita inline nos campos da agenda, via dialogo
      bottom-sheet 2/3 da tela. Tela separada em Configuracoes foi removida.
      Ao adicionar ator, apenas nome e pedido; role inferido do campo que
      abriu o dialogo. A palavra "ator/atores" NAO aparece na UI.
    superseded:
      - "RF-22 original com checkboxes de role"
      - "Tela separada Settings > Actors"

  - id: DD-04
    title: "Auto-preside rule removida"
    decided_in: CR-71
    decision: >
      A regra de que can_conduct=true implica can_preside=true foi removida.
      enforceActorRules tornou-se no-op. Ao criar ator pelo campo "Dirigindo",
      apenas can_conduct=true e setado.
    superseded:
      - "Regra original: can_conduct implica can_preside (SPEC.final.md 6.3)"

  - id: DD-05
    title: "Snapshot pattern para dados desnormalizados"
    decided_in: "SPEC original (ADR-005)"
    decision: >
      Discursos armazenam speaker_name, speaker_phone, topic_title, topic_link,
      topic_collection como texto desnormalizado. Agenda armazena nomes de atores,
      oracoes, e reconhecidos como snapshots. Exclusao de membro/tema/ator
      preserva dados historicos. Edicao NAO propaga para registros existentes.

  - id: DD-06
    title: "Debounce 500ms para auto-save em campos de texto"
    decided_in: CR-36
    decision: >
      Campos de texto com auto-save DEVEM usar debounce >= 500ms. Estado
      do input gerenciado localmente (useState), sincronizado com servidor
      apos debounce expirar. Flush on unmount para salvar valores pendentes.
      Implementado via DebouncedTextInput component.

  - id: DD-07
    title: "Global back button convention"
    decided_in: CR-33
    decision: >
      Toda tela acessada via Stack navigation DEVE ter botao de voltar no
      header (top-left). Usa common.back i18n key. Estilo: fontSize 16,
      fontWeight 600, color colors.primary. Excecao: Presentation Mode usa
      botao "fechar". Modais nao precisam de back button.
    implementation: >
      Configurado globalmente via settings/_layout.tsx Stack screenOptions
      headerLeft para evitar repeticao.

  - id: DD-08
    title: "WhatsApp placeholders: 6 validos"
    decided_in: "CR-13, CR-35"
    decision: >
      Placeholders validos no template WhatsApp: {nome}, {data}, {posicao},
      {colecao}, {titulo}, {link}. Removidos: {tema} (CR-13), {duracao} (CR-35).
    superseded:
      - "{tema} placeholder (nunca foi valido)"
      - "{duracao} placeholder (coluna duration nao existe no DB)"

  - id: DD-09
    title: "Secretario pode designar via Agenda (excecao ASM-009)"
    decided_in: CR-31
    decision: >
      Secretario NAO designa pela aba Discursos nem Home (speech:assign=false),
      MAS PODE designar pela aba Agenda (agenda:assign_speaker=true). Correcao
      de contradicao no ASM-009 do SPEC.final.md.

  - id: DD-10
    title: "expo-file-system v19: usar new File/Paths API"
    decided_in: "CR-77, CR-78"
    decision: >
      Usar import { File, Paths } from 'expo-file-system' (new class-based API)
      ao inves de legacy API. File.write() para escrita (sincrono), File.text()
      para leitura (async). Paths.cache para diretorio de cache. Legacy API
      (cacheDirectory, EncodingType, readAsStringAsync, writeAsStringAsync)
      esta deprecated e nao e exportada pelo modulo principal.

  - id: DD-11
    title: "GestureHandlerRootView no root layout"
    decided_in: CR-82
    decision: >
      GestureHandlerRootView wrapa toda a app tree em _layout.tsx, dentro do
      ErrorBoundary mas fora de todos os outros providers. style={{ flex: 1 }}.
      Necessario para SwipeableCard funcionar em Members e Topics.

  - id: DD-12
    title: "About screen: disclaimer e autor"
    decided_in: "CR-32, CR-62"
    decision: >
      Tela Sobre exibe: nome do app, versao, autor "Aloisio Almeida Jr",
      disclaimer "Esse nao e um app oficial da Igreja de Jesus Cristo Dos
      Santos Dos Ultimos Dias" (traduzido em 3 idiomas). Link de suporte
      opcional (oculto se nao configurado).

  - id: DD-13
    title: "Agenda section labels (estado final)"
    decided_in: "CR-29, CR-69"
    decision: >
      Secoes da agenda (pt-BR): "Boas-vindas, Anuncios e Reconhecimentos",
      "Designacoes e Sacramento", "Primeiros Discursos", "Ultimo Discurso".
      Reuniao de testemunho: "Testemunhos". Apresentacao da primaria:
      "Apresentacao Especial da Primaria". Labels de campos: "Dirigindo"
      (nao "Conduzindo"), "Apoios e Agradecimentos" (nao "Assuntos da Ala"),
      "Apoios e Agradecimentos da Estaca" (nao "Anuncios de Estaca"),
      "Reconhecendo a Presenca" (nao "Reconhecendo").

  - id: DD-14
    title: "Apresentacao Especial (nao Numero Musical)"
    decided_in: CR-30
    decision: >
      Toggle e campo entre discursos 2 e 3 chama-se "Apresentacao Especial"
      (nao "Numero Musical"). Traduzido em 3 idiomas.

  - id: DD-15
    title: "Prayer fields com nomes customizados"
    decided_in: CR-74
    decision: >
      Campos de oracao permitem selecionar membro da ala OU digitar nome
      customizado. Nome customizado: *_name preenchido, *_member_id = null.
      Membro selecionado: ambos preenchidos. Nome customizado nao cria
      registro na tabela members.

  - id: DD-16
    title: "Sundays sem agenda aparecem como cards nao-expansiveis"
    decided_in: CR-75
    decision: >
      Na aba Agenda, domingos sem registro de agenda aparecem como cards
      nao-expansiveis (sem acordeao). Mostram date block e badge amarelo
      com o tipo de excecao. Inclui general_conference e stake_conference
      (antes excluidos por EXCLUDED_EXCEPTION_TYPES).

  - id: DD-17
    title: "Bishopric auto-added as actors"
    decided_in: CR-72
    decision: >
      Quando usuario com role "bishopric" aceita convite, e automaticamente
      adicionado a meeting_actors com can_preside=true, can_conduct=true,
      can_recognize=false, can_music=false. Se nome ja existe, nao duplica.
      Mudanca de role de bishopric para outro NAO remove o ator.

  - id: DD-18
    title: "Logout via Settings"
    decided_in: CR-43
    decision: >
      Botao "Sair" no final da aba Configuracoes. Estilo destrutivo (vermelho).
      Dialogo de confirmacao antes de executar. Chama supabase.auth.signOut().
      Visivel para todos os roles. Limpa React Query cache.

  - id: DD-19
    title: "Error handling: onError em todas as mutations"
    decided_in: "CR-57, CR-58, CR-59, CR-60, CR-61"
    decision: >
      Todas as mutations tem onError com Alert.alert traduzido. Tabs tem
      QueryErrorView quando query falha. ErrorBoundary internacionalizado
      e com cores do tema. ErrorBoundaries granulares por tab. QueryClient
      com global error handlers, retry:2 para queries (exponential backoff),
      retry:0 para mutations, timeout 30s.

  - id: DD-20
    title: "Presentation mode date format"
    decided_in: CR-38
    decision: >
      Header do Modo Apresentacao exibe data completa no idioma da ala.
      pt-BR: "Domingo, DD de [Mes] de YYYY". en: "Sunday, [Month] DD, YYYY".
      es: "Domingo, DD de [Mes] de YYYY". Usa idioma da ala, nao device locale.

  - id: DD-21
    title: "Explicit Save/Cancel para editores de membros e temas"
    decided_in: CR-83
    decision: >
      MemberEditor e TopicEditor NAO salvam no onBlur. Salvamento e feito
      SOMENTE ao clicar no botao Salvar. Botao Cancelar descarta alteracoes.
      Botoes posicionados abaixo dos campos, alinhados a direita do card.
      Usa i18n keys existentes common.save e common.cancel.
    superseded:
      - "Auto-save no onBlur (comportamento anterior de F003/F005)"

  - id: DD-22
    title: "Componente SearchInput reutilizavel com botao X"
    decided_in: CR-84
    decision: >
      Todos os campos de search do app usam componente SearchInput que inclui
      botao X para limpar busca. X visivel apenas quando campo tem texto.
      Clicar X seta valor para '' e restaura lista completa. Componente e
      drop-in replacement para TextInput com props iguais.

  - id: DD-23
    title: "Country codes: lista completa extraida para arquivo compartilhado"
    decided_in: CR-85
    decision: >
      Lista de codigos internacionais extraida para src/lib/countryCodes.ts
      como single source of truth. COUNTRY_CODES e splitPhoneNumber usam
      a mesma fonte. Lista com ~150+ paises, Brasil (+55) primeiro, demais
      em ordem alfabetica.

  - id: DD-24
    title: "Dialogo de confirmacao antes de importar CSV"
    decided_in: CR-86
    decision: >
      Ao clicar em Importar CSV, exibir Alert.alert ANTES de abrir o file
      picker. Mensagem explica: (1) importacao substitui toda a lista de
      membros, (2) designacoes existentes nao sao afetadas. Confirmar abre
      file picker. Cancelar fecha dialogo.

  - id: DD-25
    title: "Unicode icons para swipe buttons (sem icon library)"
    decided_in: CR-87
    decision: >
      Botoes de acao do SwipeableCard usam caracteres Unicode ao inves de
      texto ou biblioteca de icones. Pencil (U+270F) para Edit, Wastebasket
      (U+1F5D1) para Delete. O app nao tem dependencia de icon library
      instalada; instalar uma para 2 icones seria desproporcional. Props
      editLabel/deleteLabel mantidas para accessibilityLabel.

  - id: DD-26
    title: "Topics screen explanatory text (padrao CR-80)"
    decided_in: CR-88
    decision: >
      Texto descritivo abaixo do header da tela de Temas, seguindo mesmo
      padrao visual de F026/CR-80 (fontSize 13, textAlign center,
      paddingHorizontal 16, color textSecondary). Um unico texto no topo
      da tela cobre ambos os conceitos (temas da ala e colecoes).

  - id: DD-27
    title: "Collection topics expand/collapse (acordeao)"
    decided_in: CR-89
    decision: >
      Ao clicar na area da colecao (fora do Switch), a lista de temas
      expande inline abaixo da linha. Padrao acordeao: uma colecao
      expandida por vez. Switch toggle funciona independentemente.
      Busca lazy de general_topics por collection_id (sob demanda).
      Hook useCollectionTopics em useTopics.ts. Chevron indicator
      (> / v) a esquerda do nome da colecao para indicar tappable.

  - id: DD-28
    title: "SECURITY DEFINER para triggers que acessam tabelas protegidas"
    decided_in: CR-91
    decision: >
      Funcoes de trigger que inserem em tabelas com RLS sem policies de client
      (como notification_queue) devem usar SECURITY DEFINER para executar com
      privilegios do owner. Isso garante que logica server-side (triggers) nao
      e bloqueada pela RLS enquanto mantem a tabela inacessivel a clientes.

  - id: DD-29
    title: "Speech slots condicionados a tipo === 'speeches' (nao isExcludedFromAgenda)"
    decided_in: CR-95
    decision: >
      Na aba Discursos (speeches.tsx), a renderizacao dos speech slots (posicoes
      1, 2, 3) deve verificar diretamente se o tipo de domingo e 'speeches'.
      Nao usar isExcludedFromAgenda() pois essa funcao tem semantica diferente
      (usada na aba Agenda para expandibilidade de cards). A condicao correta:
      !exception || exception.reason === 'speeches'.
    superseded:
      - "Uso de isExcludedFromAgenda em speeches.tsx (filtrava apenas 2 de 6 tipos)"

  - id: DD-30
    title: "Deep link protocol sacrmeetman:// (substituiu wardmanager://)"
    decided_in: CR-93
    decision: >
      O URL scheme do app e 'sacrmeetman'. Deep links gerados pela Edge
      Function create-invitation usam sacrmeetman://invite/${token}.
      Custom URL schemes NAO funcionam no Expo Go (apenas builds standalone).
    superseded:
      - "URL scheme 'wardmanager' (app.json original)"

  - id: DD-31
    title: "PrayerSelector com prop visible (padrao consistente com outros selectors)"
    decided_in: CR-98
    decision: >
      PrayerSelector aceita prop 'visible' para auto-abrir seu modal quando
      renderizado condicionalmente, e 'onClose' para notificar o parent quando
      o modal e fechado. Segue padrao identico a ActorSelector (visible prop)
      e HymnSelectorModal (visible prop). AgendaForm passa visible={true}
      ao renderizar PrayerSelector via selectorModal state.

  - id: DD-32
    title: "Default WhatsApp template por idioma da ala"
    decided_in: CR-94
    decision: >
      Templates padrao de convite WhatsApp existem para cada idioma suportado:
      DEFAULT_TEMPLATE_PT_BR, DEFAULT_TEMPLATE_EN, DEFAULT_TEMPLATE_ES.
      buildWhatsAppUrl recebe idioma da ala e usa template correspondente como
      fallback quando template customizado da ala e null/vazio. Anteriormente,
      sempre usava pt-BR independente do idioma.
    superseded:
      - "Sempre usar DEFAULT_TEMPLATE_PT_BR como fallback (comportamento anterior)"

  - id: DD-33
    title: "Search fixo no topo em telas de Settings (members, topics)"
    decided_in: CR-96
    decision: >
      Nas telas de gerenciamento de Membros e Temas em Settings, o SearchInput
      e posicionado fora do ScrollView/FlatList, fixo no topo da area de
      conteudo. A lista scrollavel fica abaixo. Textos explicativos (F026, F033)
      scrollam junto com o conteudo. Selectors modais ja implementam esse padrao.

  - id: DD-34
    title: "Multi-select para Reconhecendo a Presenca (toggle add/remove)"
    decided_in: CR-97
    decision: >
      O campo 'Reconhecendo a Presenca' usa ActorSelector em modo multi-select:
      selecionar ator que nao esta no array adiciona; selecionar ator que ja esta
      remove (toggle). Modal nao fecha automaticamente apos selecao. Atores
      selecionados tem indicador visual (checkmark ou background). Outros campos
      de ator (presidir, dirigir, pianista, regente) continuam single-select.

  - id: DD-35
    title: "Labels de discurso na agenda: 'Discurso' (nao 'Orador')"
    decided_in: CR-99
    decision: >
      Na edicao de agenda e Modo Apresentacao, labels de discursantes sao
      '1o Discurso', '2o Discurso', '3o Discurso' (pt-BR). Implementado via
      alteracao do valor da i18n key 'speeches.speaker' de 'Orador' para
      'Discurso'. Todos os usos dessa key sao em contexto de Agenda.
    superseded:
      - "Labels '1o Orador', '2o Orador', '3o Orador' (anteriores)"

  - id: DD-36
    title: "Speaker override para troca de ultima hora (campos em sunday_agendas)"
    decided_in: CR-100
    decision: >
      A tabela sunday_agendas recebe campos speaker_1_override, speaker_2_override,
      speaker_3_override (nullable text). Quando preenchido, o override substitui
      o speaker_name da tabela speeches na exibicao da agenda e Modo Apresentacao.
      O override NAO altera a tabela speeches. Icone lapis ativa modo edicao,
      icone X reverte ao nome original. Extensao do snapshot pattern (DD-05).

  - id: DD-37
    title: "LEDs de status condicionados a tipo de domingo 'speeches'"
    decided_in: CR-101
    decision: >
      Os 3 LEDs de status de discurso no SundayCard so sao renderizados quando
      o tipo de domingo e 'speeches' (isSpeechesType === true). Para domingos
      de outros tipos (testemunho, conferencia, etc.), os LEDs sao ocultos pois
      nao ha discursos designados.

  - id: DD-38
    title: "Label de excecao na Agenda exclui tipo 'speeches'"
    decided_in: CR-102
    decision: >
      Na aba Agenda, o label/badge amarelo de tipo de excecao no card contraido
      NAO e exibido quando exception.reason === 'speeches'. O tipo 'speeches' e
      o padrao e nao precisa de destaque visual. Apenas excecoes reais
      (testimony_meeting, general_conference, etc.) exibem o label.

  - id: DD-39
    title: "Settings WhatsApp fallback para getDefaultTemplate quando DB null"
    decided_in: CR-103
    decision: >
      A tela de configuracoes WhatsApp (settings/whatsapp.tsx) inicializa o campo
      template com getDefaultTemplate(idioma_da_ala) quando ward.whatsapp_template
      e null. Se o valor no DB for string vazia, respeita (BR-24). Query de ward
      inclui campo 'language' para selecionar template padrao correto por idioma.
      Garante consistencia entre o que o usuario ve em Settings e o que e enviado.

  - id: DD-40
    title: "WhatsApp variables devem incluir collection e link de speech"
    decided_in: CR-104
    decision: >
      Ao construir WhatsAppVariables em InviteManagementSection.tsx, os campos
      collection e link devem ser preenchidos com speech.topic_collection e
      speech.topic_link respectivamente. Placeholders {colecao} e {link} so
      funcionam se os valores forem passados. Quando nao disponivel, string vazia.

  - id: DD-41
    title: "Aspas duplas ASCII ao redor de {titulo} nos templates padrao"
    decided_in: CR-104
    decision: >
      Os templates padrao de WhatsApp (DEFAULT_TEMPLATE_PT_BR, EN, ES) usam
      aspas duplas ASCII ao redor do placeholder {titulo}: '"{titulo}"'. Isso
      destaca o titulo do tema na mensagem enviada ao discursante.

  - id: DD-42
    title: "Placeholder {data} do WhatsApp usa formatDateHumanReadable"
    decided_in: CR-108
    decision: >
      O placeholder {data} em mensagens WhatsApp de convite usa
      formatDateHumanReadable() ao inves de formatDate(). Formato resultante:
      "22 de Fevereiro de 2026" (pt-BR), "February 22, 2026" (en),
      "22 de Febrero de 2026" (es). Nao inclui dia da semana (reuniao
      sacramental e sempre domingo, seria redundante).

  - id: DD-43
    title: "Condicao de renderizacao de SpeechSlots: (!exception || exception.reason === 'speeches')"
    decided_in: CR-109
    decision: >
      Em todos os componentes que renderizam SpeechSlots (speeches.tsx,
      NextSundaysSection.tsx), a condicao para mostrar os slots e:
      (!exception || exception.reason === 'speeches'). Isso garante que
      slots aparecem tanto para domingos sem excecao (dados antigos) quanto
      para domingos com tipo 'speeches' explicitamente persistido (CR-56).

  - id: DD-44
    title: "Icones em botoes de acao do InviteManagementSection"
    decided_in: CR-105
    decision: >
      Botoes de acao na secao de gerenciamento de convites usam icones ao inves
      de texto: icone do WhatsApp (SVG inline ou emoji) para assigned_not_invited,
      icone de tres pontinhos (Unicode U+22EE vertical ellipsis) para assigned_invited.
      Segue principio DD-25 de nao usar biblioteca de icones.

  - id: DD-45
    title: "Dropdown customizado para opcoes de status de convite"
    decided_in: CR-106
    decision: >
      A interacao de mudanca de status para speeches convidados usa dropdown/modal
      customizado (InviteActionDropdown) ao inves de Alert.alert nativo. Opcoes:
      Ver conversa (abre WhatsApp), Designado/Confirmado, Designado/Nao-Convidado
      (nova - reverte convite), Desistiu, Cancelar. Cada opcao tem indicador
      visual (LED colorido) seguindo padrao do StatusChangeModal.

  - id: DD-46
    title: "Transicao reversa de status: assigned_invited -> assigned_not_invited"
    decided_in: CR-106
    decision: >
      O dropdown de opcoes de convite permite reverter o status de assigned_invited
      para assigned_not_invited via opcao "Designado/Nao-Convidado". Isso estende
      o ciclo de status original com uma transicao reversa para correcao de erros
      ou re-convite.

  - id: DD-47
    title: "Segunda linha do invite row com formato completo"
    decided_in: CR-107
    decision: >
      Cada invite row na secao de gerenciamento de convites mostra na segunda
      linha o formato: "No Discurso - <StatusLED> <nome do status traduzido>".
      StatusLED inline com tamanho 10-12px. Usa t('speeches.slot') para label
      e t('speechStatus.*') para nome do status.

  - id: DD-48
    title: "Bispado ve secao de gerenciamento de convites na Home"
    decided_in: CR-110
    decision: >
      A permissao 'home:invite_mgmt' e concedida ao role bishopric (alem de
      secretary). Bispado passa a ver AMBAS as secoes na Home: NextAssignmentsSection
      (controlada por 'home:next_assignments') e InviteManagementSection (controlada
      por 'home:invite_mgmt'). Observer continua sem acesso.

  - id: DD-49
    title: "Espaco e tamanho aumentados entre LED e X no SpeechSlot"
    decided_in: CR-111
    decision: >
      No SpeechSlot.tsx, o espaco entre StatusLED e botao X (remover designacao)
      e aumentado de 8px para 12-16px, e o fontSize do icone X e aumentado de
      20 para 24-26px para melhorar visualizacao e toque.

  - id: DD-50
    title: "Status change via InviteActionDropdown: apenas muda status, sem enviar WhatsApp"
    decided_in: CR-134
    decision: >
      Ao mudar status via InviteActionDropdown na secao de convites (Home), a
      acao apenas muda o status no banco. NAO envia convite WhatsApp automaticamente.
      O envio de WhatsApp continua sendo acao separada (botao WhatsApp para
      assigned_not_invited).

  - id: DD-51
    title: "InviteActionDropdown: manter regra de visibilidade (apenas assigned_invited)"
    decided_in: CR-134
    decision: >
      O botao de tres pontinhos (que abre InviteActionDropdown) continua
      aparecendo APENAS para speeches com status assigned_invited na secao
      de convites. O dropdown NAO e expandido para outros status. O escopo
      do CR-134 e sobre as OPCOES dentro do dropdown, nao sobre quando ele
      aparece.

  - id: DD-52
    title: "Checkbox visual para multi-select: manter icones edit/delete visiveis"
    decided_in: CR-137
    decision: >
      No ActorSelector em modo multiSelect, os icones de edicao (pencil) e
      exclusao (X) permanecem visiveis e na mesma posicao (direita). O checkbox
      visual a esquerda do nome resolve a ambiguidade entre de-selecionar e
      excluir. NAO esconder os icones no modo multi-select.

  - id: DD-53
    title: "viewPosition: 0.5 apenas na aba Agenda (nao em Discursos)"
    decided_in: CR-136
    decision: >
      A correcao de viewPosition: 0.5 para centralizar o proximo domingo
      aplica-se APENAS a aba Agenda. A aba Discursos ja funciona corretamente
      e NAO deve ser alterada. Respeitar escopo do pedido do usuario.

  - id: DD-54
    title: "Settings labels renomeados para refletir funcao no app"
    decided_in: CR-140
    decision: >
      Labels da aba Configuracoes renomeados para melhor comunicar a funcao
      de cada tela: Membros->Discursantes (sao pessoas que discursam),
      Temas->Biblioteca de Temas (e um catalogo), Usuarios->Usuarios do App
      (distingue de membros), Historico->Historico de Uso (mais descritivo),
      Tema->Tema Claro/Escuro (explicita a funcao). Tanto no card do index
      quanto no titulo da tela interna. Somente alteracao de i18n values.

  - id: DD-55
    title: "SundayTypeDropdown na aba Agenda (reutilizacao de componente)"
    decided_in: CR-141
    decision: >
      A aba Agenda reutiliza o SundayTypeDropdown da aba Discursos como
      primeiro campo do card expandido. Toda a logica de selecao, confirmacao
      e apagamento de speeches e herdada do componente existente. Nao e
      necessario criar componente novo.

  - id: DD-56
    title: "Activity log: formato estruturado no banco com renderizacao i18n na UI"
    decided_in: CR-142
    decision: >
      Descricoes de log mudam de texto plano para formato estruturado:
      "action_type|key1=valor1|key2=valor2". Na UI, formatLogDescription()
      faz parse e usa t('activityLog.events.{type}', {params}). Registros
      antigos (sem '|') exibidos como fallback. Isso permite que logs
      aparecam no idioma correto da ala apos mudanca de idioma.

  - id: DD-57
    title: "Funcoes PL/pgSQL com search_path imutavel (SET search_path = '')"
    decided_in: CR-144
    decision: >
      Todas as funcoes PL/pgSQL devem ter SET search_path = '' para prevenir
      ataques de search_path manipulation. Referencias a tabelas devem ser
      qualificadas com schema explicito (public.tabela, auth.tabela).
      Migracao 015 recria as 7 funcoes afetadas.

# =============================================================================
# BUSINESS RULES (globais, consolidadas)
# =============================================================================

business_rules:

  - id: BR-01
    rule: "Toda tela acessada via Stack DEVE ter botao de voltar no header"
    origin: CR-33
    exceptions: "Presentation Mode (usa botao 'fechar'), modais (dismiss overlay)"

  - id: BR-02
    rule: "Campos de texto com auto-save devem usar debounce >= 500ms com estado local (useState)"
    origin: CR-36
    implementation: "DebouncedTextInput component, flush on unmount"
    exception: "CR-83: MemberEditor e TopicEditor usam Save/Cancel explicito ao inves de auto-save"

  - id: BR-03
    rule: "A palavra 'ator/atores/actor/actors' NAO aparece em nenhum label ou texto na UI"
    origin: CR-26
    exception: "Tabela do DB pode se chamar 'meeting_actors'"

  - id: BR-04
    rule: "Secretario NAO designa pela aba Discursos nem Home, mas PODE designar pela aba Agenda"
    origin: "CR-31 (correcao de ASM-009)"

  - id: BR-05
    rule: "Snapshot pattern: edicao/exclusao de membro, tema ou ator NAO altera discursos/agendas existentes"
    origin: "SPEC original (ADR-005)"

  - id: BR-06
    rule: "Auto-atribuicao de tipo de domingo ao carregar lista, com persistencia imediata (incluindo 'speeches')"
    origin: "RF-10, CR-56"
    auto_assign_rules:
      - "Padrao: speeches"
      - "1o domingo de Jan, Fev, Mar, Mai, Jun, Jul, Ago, Set, Nov, Dez: testimony_meeting"
      - "1o domingo de Abr e Out: general_conference"
      - "2o domingo de Abr e Out: testimony_meeting"

  - id: BR-07
    rule: "Observador tem dropdown de tipo de domingo visivel mas desabilitado (read-only)"
    origin: RF-09

  - id: BR-08
    rule: "Ao mudar de tipo de domingo para excecao, discursos existentes sao apagados (com confirmacao)"
    origin: RF-09

  - id: BR-09
    rule: "Ao mudar de excecao para 'Discursos', 3 speeches vazios sao criados imediatamente"
    origin: RF-11

  - id: BR-10
    rule: "CSV import sobrescreve TODA a lista de membros (delete all + insert all, via RPC import_members)"
    origin: RF-05

  - id: BR-11
    rule: "Colecoes gerais filtradas por idioma da ala. Ao mudar idioma, colecoes do idioma anterior sao desativadas"
    origin: RF-08.3

  - id: BR-12
    rule: "Activity log: retencao de 2 anos, read-only, descricoes human-readable no idioma da ala"
    origin: "RF-37, CR-22"

  - id: BR-13
    rule: "Push notifications: Observadores NAO recebem push. Token registrado apenas para bishopric e secretary"
    origin: "RF-26, CR-53"

  - id: BR-14
    rule: "Convites por link expiram em 30 dias"
    origin: "SPEC original"

  - id: BR-15
    rule: "Mutations NAO fazem retry (retry:0). Queries fazem retry:2 com exponential backoff (1s, 2s)"
    origin: CR-61

  - id: BR-16
    rule: "Errors nunca mostram stack traces, codigos Supabase ou mensagens tecnicas ao usuario"
    origin: CR-57

  - id: BR-17
    rule: "Bishopric registrado e automaticamente adicionado como ator (can_preside + can_conduct)"
    origin: CR-72

  - id: BR-18
    rule: "can_conduct NAO implica can_preside (regra auto-preside removida)"
    origin: CR-71

  - id: BR-19
    rule: "Oracoes permitem nomes customizados (nao-membros). *_member_id = null para customizados"
    origin: CR-74

  - id: BR-20
    rule: "Domingos sem agenda aparecem na aba Agenda como cards nao-expansiveis com badge de tipo"
    origin: CR-75

  - id: BR-21
    rule: "Apenas 1 swipe card revelado por vez (Members e Topics)"
    origin: "RF-02, RF-08"

  - id: BR-22
    rule: "Tap no card de membro/tema NAO abre edicao (apenas swipe)"
    origin: "RF-02, RF-08"

  - id: BR-23
    rule: "Dialogo de confirmacao ao excluir membro com discursos futuros designados"
    origin: RF-03

  - id: BR-24
    rule: "Template WhatsApp null no DB: mostrar template padrao. String vazia: respeitar (usuario limpou intencionalmente)"
    origin: CR-63

  - id: BR-25
    rule: "Editores de membro e tema NAO salvam no onBlur. Salvamento e feito SOMENTE via botao Salvar"
    origin: CR-83
    supersedes: "Auto-save no blur (comportamento anterior)"

  - id: BR-26
    rule: "Todos os campos de search do app devem ter botao X para limpar busca (componente SearchInput)"
    origin: CR-84

  - id: BR-27
    rule: "Dialogo de confirmacao ANTES de importar CSV (Alert.alert com aviso de substituicao total)"
    origin: CR-86

  - id: BR-28
    rule: "Temas de colecao visiveis via expand/collapse inline (acordeao, uma por vez)"
    origin: CR-89
    notes: "Tap na colecao expande lista read-only de temas. Switch toggle independente."

  - id: BR-29
    rule: "Triggers de DB que inserem em tabelas protegidas por RLS devem usar SECURITY DEFINER"
    origin: CR-91
    notes: "enqueue_speech_notification() precisa SECURITY DEFINER para inserir em notification_queue"

  - id: BR-30
    rule: "Speech slots na aba Discursos visiveis SOMENTE quando tipo de domingo e 'speeches'"
    origin: CR-95
    supersedes: "Logica anterior usava isExcludedFromAgenda (filtrava apenas 2 de 6 tipos)"

  - id: BR-31
    rule: "Deep link protocol do app e sacrmeetman:// (nao wardmanager://)"
    origin: CR-93

  - id: BR-32
    rule: "Componentes de selecao modal (PrayerSelector, ActorSelector, HymnSelectorModal) devem aceitar prop 'visible' para auto-abrir"
    origin: CR-98
    notes: "Padrao consistente: componente recebe visible={true} e abre modal imediatamente"

  - id: BR-33
    rule: "Template padrao de WhatsApp varia por idioma da ala (pt-BR, en, es)"
    origin: CR-94
    notes: "buildWhatsAppUrl recebe idioma e seleciona template correspondente como fallback"

  - id: BR-34
    rule: "SearchInput em telas de Settings (Members, Topics) fixo no topo, fora do ScrollView"
    origin: CR-96
    notes: "Selectors modais ja implementam esse padrao. Fix apenas em telas fullscreen de Settings."

  - id: BR-35
    rule: "Campo 'Reconhecendo a Presenca' usa selecao multipla (toggle add/remove no array)"
    origin: CR-97
    notes: "Modal permanece aberto. Outros campos de ator (presidir, dirigir, etc.) continuam single-select."

  - id: BR-36
    rule: "Labels de discurso na agenda sao 'Discurso'/'Speech' (nao 'Orador'/'Speaker')"
    origin: CR-99
    supersedes: "Labels anteriores '1o Orador', '2o Orador', '3o Orador'"

  - id: BR-37
    rule: "Troca de ultima hora de discursante usa override na sunday_agendas, NAO altera speeches"
    origin: CR-100
    notes: "Campos speaker_*_override nullable. Quando null, exibe speaker_name da tabela speeches."

  - id: BR-38
    rule: "LEDs de status de discurso no SundayCard so renderizados quando tipo de domingo e 'speeches'"
    origin: CR-101
    notes: "isSpeechesType flag ja existe no SundayCard, usada para condicionar renderizacao da secao de LEDs"

  - id: BR-39
    rule: "Label de excecao na aba Agenda NAO exibido quando exception.reason === 'speeches'"
    origin: CR-102
    notes: "Tipo 'speeches' e o padrao e nao precisa de destaque visual. Apenas excecoes reais mostram label."

  - id: BR-40
    rule: "Tela de Settings WhatsApp faz fallback para getDefaultTemplate(idioma_da_ala) quando DB e null"
    origin: CR-103
    notes: "Garante consistencia entre Settings e envio. String vazia respeitada (BR-24)."

  - id: BR-41
    rule: "WhatsAppVariables deve incluir collection (speech.topic_collection) e link (speech.topic_link)"
    origin: CR-104
    notes: "Campos opcionais no tipo, mas devem ser preenchidos quando dados estao disponiveis no speech."

  - id: BR-42
    rule: "Templates padrao de WhatsApp usam aspas duplas ao redor de {titulo}: '\"{titulo}\"'"
    origin: CR-104

  - id: BR-43
    rule: "Placeholder {data} em WhatsApp usa formatDateHumanReadable (nao formatDate)"
    origin: CR-108
    notes: "Retorna formato human-readable por idioma: '22 de Fevereiro de 2026' (pt-BR)."

  - id: BR-44
    rule: "Condicao para renderizar SpeechSlots: (!exception || exception.reason === 'speeches')"
    origin: CR-109
    notes: "Padrao consistente em speeches.tsx e NextSundaysSection.tsx. Nao usar !exception sozinho."

  - id: BR-45
    rule: "Botoes de acao na secao de convites usam icones (nao texto)"
    origin: CR-105
    notes: "WhatsApp: SVG/emoji. Tres pontinhos: U+22EE. Sem icon library (DD-25)."

  - id: BR-46
    rule: "Opcoes de status de convite via dropdown customizado (nao Alert nativo)"
    origin: CR-106
    notes: "InviteActionDropdown com Ver conversa, Confirmado, Nao-Convidado, Desistiu, Cancelar."

  - id: BR-47
    rule: "Status pode reverter de assigned_invited para assigned_not_invited via dropdown"
    origin: CR-106
    notes: "Transicao reversa para correcao de erros ou re-convite."

  - id: BR-48
    rule: "Segunda linha do invite row mostra formato completo: 'No Discurso - LED StatusName'"
    origin: CR-107
    notes: "StatusLED inline 10-12px. Usa t('speeches.slot') + t('speechStatus.*')."

  - id: BR-49
    rule: "Secao de gerenciamento de convites visivel para bispado E secretario"
    origin: CR-110
    supersedes: "Secao visivel apenas para secretario (comportamento anterior)"
    notes: "Permissao 'home:invite_mgmt' adicionada ao bishopric."

  - id: BR-50
    rule: "Espaco entre LED e X no SpeechSlot >= 12px, fontSize do X >= 24"
    origin: CR-111
    notes: "Melhoria de UX para visualizacao e toque."

  - id: BR-51
    rule: "Status change UI (dropdown e modal) mostra TODAS as opcoes exceto status atual e not_assigned"
    origin: CR-134
    supersedes: "F062 (apenas confirmed/gave_up) e F071 (todos exceto not_assigned sem filtrar atual)"
    notes: "Aplica-se a InviteActionDropdown (Home) e StatusChangeModal (Discursos). Sempre 3 opcoes visiveis."

  - id: BR-52
    rule: "LED clicavel para QUALQUER status exceto not_assigned (assigned_confirmed e gave_up agora clicaveis)"
    origin: CR-134
    supersedes: "LED desabilitado para assigned_confirmed e gave_up (comportamento anterior)"

  - id: BR-53
    rule: "InviteActionDropdown muda apenas status, NAO envia WhatsApp automaticamente"
    origin: CR-134
    notes: "Envio de WhatsApp continua como acao separada via botao WhatsApp para assigned_not_invited."

  - id: BR-54
    rule: "Checkbox visual em ActorSelector multiSelect mode (nao prefixo de texto)"
    origin: CR-137
    notes: "Checkbox marcado/vazio a esquerda do nome. Icones edit/delete permanecem visiveis a direita."

  - id: BR-55
    rule: "Confirmacao de exclusao de ator usa texto especifico (actors.deleteConfirm), nao generico"
    origin: CR-138
    supersedes: "Uso de members.deleteConfirm em ActorSelector (compartilhava com members/topics)"

  - id: BR-56
    rule: "SundayTypeDropdown deve estar disponivel na aba Agenda como primeiro campo do card expandido"
    origin: CR-141
    notes: "Mesmas opcoes e logica da aba Discursos. Observador ve dropdown desabilitado."

  - id: BR-57
    rule: "Activity log armazena formato estruturado (action_type|key=value) e renderiza via i18n na UI"
    origin: CR-142
    notes: "Registros antigos (texto plano sem '|') exibidos como fallback. 24 action_types definidos."

  - id: BR-58
    rule: "Toda funcao PL/pgSQL deve ter SET search_path = '' e referencias de tabela qualificadas com schema"
    origin: CR-144
    notes: "Previne ataques de search_path manipulation. 7 funcoes corrigidas na migracao 015."

# =============================================================================
# DATA MODEL (schema principal, estado atual)
# =============================================================================

data_model:
  tables:
    - name: wards
      description: "Alas da igreja"
      key_columns: [id, name, stake_name, language, timezone, whatsapp_template]
      unique_constraints: ["(stake_name, name)"]

    - name: users
      description: "Usuarios via auth.users do Supabase com app_metadata (ward_id, role)"
      managed_by: "6 Edge Functions"
      edge_functions:
        - register-first-user
        - create-invitation
        - register-invited-user
        - list-users
        - update-user-role
        - delete-user

    - name: members
      description: "Membros da ala"
      key_columns: [id, ward_id, full_name, country_code, phone]
      unique_constraints: ["(ward_id, full_name)"]
      notes: "CR-78 removeu phone da unique constraint"

    - name: ward_topics
      description: "Temas da ala (CRUD manual)"
      key_columns: [id, ward_id, title, link]

    - name: general_collections
      description: "Colecoes globais por idioma (importadas via script admin)"

    - name: general_topics
      description: "Temas de colecoes globais"

    - name: ward_collection_config
      description: "Ponte ala-colecao com campo active (boolean)"

    - name: sunday_exceptions
      description: "Tipo de cada domingo"
      key_columns: [id, ward_id, date, reason, custom_reason]
      unique_constraints: ["(ward_id, date)"]
      check_constraint: "reason IN ('speeches', 'testimony_meeting', 'general_conference', 'stake_conference', 'ward_conference', 'primary_presentation', 'other')"
      notes: "'speeches' e persistido (CR-56). custom_reason usado apenas quando reason='other'"

    - name: speeches
      description: "Discursos (3 por domingo)"
      key_columns: [id, ward_id, sunday_date, position, member_id, speaker_name, speaker_phone, topic_title, topic_link, topic_collection, status]
      unique_constraints: ["(ward_id, sunday_date, position)"]
      valid_statuses: [not_assigned, assigned_not_invited, assigned_invited, assigned_confirmed, gave_up]
      snapshot_fields: [speaker_name, speaker_phone, topic_title, topic_link, topic_collection]

    - name: meeting_actors
      description: "Atores da reuniao (gerenciados inline na agenda)"
      key_columns: [id, ward_id, name, can_preside, can_conduct, can_recognize, can_pianist, can_conductor]
      notes: "can_conduct NAO implica can_preside (CR-71). can_music split into can_pianist + can_conductor (CR-180/F117). CHECK constraint: NOT (can_pianist AND can_conductor)."

    - name: hymns
      description: "Catalogo global de hinos por idioma (~300 por idioma)"
      key_columns: [id, language, number, title, is_sacramental]
      unique_constraints: ["(language, number)"]
      notes: "Importada via script pnpm import-hymns. Sem ward_id."

    - name: sunday_agendas
      description: "Agenda completa da reuniao sacramental por domingo"
      key_columns: >
        id, ward_id, sunday_date, presiding_name, presiding_actor_id,
        conducting_name, conducting_actor_id, recognized_names, announcements,
        pianist_name, pianist_actor_id, conductor_name, conductor_actor_id,
        opening_hymn_id, opening_prayer_member_id, opening_prayer_name,
        sustaining_releasing, has_baby_blessing, baby_blessing_names,
        has_baptism_confirmation, baptism_confirmation_names,
        has_stake_announcements, sacrament_hymn_id,
        has_special_presentation, special_presentation_description,
        intermediate_hymn_id, closing_hymn_id,
        closing_prayer_member_id, closing_prayer_name
      unique_constraints: ["(ward_id, sunday_date)"]
      notes: >
        Atores armazenados como snapshot (nome) + FK opcional. Oracoes: member_id
        para membros, null + name para nomes customizados (CR-74). Override de
        discursante para troca de ultima hora: speaker_*_override (CR-100).

    - name: device_push_tokens
      description: "Tokens de push notification por dispositivo"
      key_columns: [id, user_id, ward_id, expo_push_token]
      unique_constraints: ["(user_id, expo_push_token)"]

    - name: notification_queue
      description: "Fila de notificacoes pendentes"
      key_columns: [id, ward_id, type, sunday_date, speech_position, speaker_name, target_role, status, send_after]
      notification_types: [designation, weekly_assignment, weekly_confirmation, speaker_confirmed, speaker_withdrew]

    - name: invitations
      description: "Convites por link para novos usuarios"
      key_columns: [id, ward_id, email, role, token, expires_at, used_at, created_by]
      notes: "Token unico. Deep link: sacrmeetman://invite/{token}. Expira em 30 dias."

    - name: activity_log
      description: "Historico de acoes (audit log)"
      key_columns: [id, ward_id, user_id, user_email, action_type, description, created_at]
      retention: "2 anos"
      valid_action_types:
        - "member:create, member:update, member:delete, member:import"
        - "topic:create, topic:update, topic:delete"
        - "collection:activate, collection:deactivate"
        - "sunday_type:change"
        - "speech:assign, speech:assign_theme, speech:unassign, speech:status_change, speech_cleanup"
        - "actor:create, actor:update, actor:delete"
        - "agenda:edit, agenda:last_minute_speech, agenda:last_minute_speech_removed"
        - "user:self_register, user:invite, user:register_via_invite, user:role_change, user:delete"
        - "user:invitation, user:invitation_accepted, user:name-update, user:removed"
        - "settings:language, settings:timezone"
      notes: "CR-142: formato estruturado 'action_type|key=value|key=value' para novos registros. Registros antigos (texto plano) mantidos como fallback."

# =============================================================================
# NAVIGATION STRUCTURE
# =============================================================================

navigation:
  tabs:
    - name: Home
      route: "/(tabs)/index"
      access: "todos os roles (observador read-only)"
    - name: Discursos
      route: "/(tabs)/speeches"
      access: "todos os roles (observador read-only)"
    - name: Agenda
      route: "/(tabs)/agenda"
      access: "todos os roles (observador read-only)"
    - name: Configuracoes
      route: "/(tabs)/settings"
      access: "bispado e secretario (observador nao ve)"

  settings_sub_screens:
    - name: Members
      route: "/(tabs)/settings/members"
    - name: Topics
      route: "/(tabs)/settings/topics"
    - name: Users
      route: "/(tabs)/settings/users"
    - name: WhatsApp Template
      route: "/(tabs)/settings/whatsapp"
    - name: History
      route: "/(tabs)/settings/history"
    - name: Timezone
      route: "/(tabs)/settings/timezone"
    - name: Theme
      route: "/(tabs)/settings/theme"
    - name: About
      route: "/(tabs)/settings/about"

  auth_screens:
    - name: Login
      route: "/(auth)/login"
    - name: Register (self)
      route: "/(auth)/register"
    - name: Register (invited)
      route: "/(auth)/register-invited"
    - name: Forgot Password
      route: "/(auth)/forgot-password"
    - name: Reset Password
      route: "/(auth)/reset-password"

  modal_screens:
    - name: Presentation Mode
      route: "/presentation"
      notes: "Usa botao 'fechar' (excecao da convencao de back button)"

# =============================================================================
# SCOPE BOUNDARIES
# =============================================================================

in_scope:
  - "CRUD de membros (manual + CSV import/export)"
  - "CRUD de temas (ala + colecoes gerais via script admin)"
  - "Tipo de domingo via dropdown (7 opcoes + texto livre para 'Outro')"
  - "Auto-atribuicao em lote de tipo de domingo"
  - "Designacao de discursantes e temas (3 discursos por domingo)"
  - "Ciclo de status com LEDs 3D animados"
  - "Aba Home personalizada por role"
  - "WhatsApp integration (links wa.me com template)"
  - "Real-time sync (Supabase Realtime + polling fallback)"
  - "Scroll infinito (12 meses passado/futuro, +6 ao scroll)"
  - "i18n: pt-BR, en, es"
  - "Multi-tenancy com RLS"
  - "3 roles: bishopric, secretary, observer"
  - "CRUD de usuarios (Edge Functions)"
  - "Offline support (fila de mutacoes, OfflineBanner)"
  - "Dark/light mode"
  - "Agenda completa da reuniao sacramental"
  - "Gestao inline de atores da reuniao"
  - "Catalogo de hinos com i18n"
  - "Modo Apresentacao (full-screen read-only)"
  - "Push notifications (Expo + Edge Function)"
  - "Self-registration e convite por link"
  - "Historico de acoes (audit log, 2 anos)"
  - "Esqueci a senha (email traduzido em 3 idiomas via Edge Function)"
  - "Logout"

out_of_scope:
  - "Envio direto de SMS (apenas push notifications e links wa.me; email via Edge Function para reset)"
  - "Gestao de outros aspectos da ala (frequencia, chamados, financas)"
  - "Colaboracao multi-usuario simultanea"
  - "Integracao com sistemas oficiais da Igreja SUD"
  - "Gestao de Estacas"
  - "Fotos de membros"
  - "Autenticacao federada / SSO"
  - "Relatorios e analytics"
  - "Lista de convites pendentes na UI (apenas botao convidar)"

# =============================================================================
# CR HISTORY REFERENCE (para lookup rapido de todas as 90 CRs)
# =============================================================================

cr_history:
  batch_1:
    range: "CR-01 a CR-10"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch1.md"
    summary: "UI fixes, bugs criticos (sunday types, topics scroll), theme/about buttons"

  batch_2:
    range: "CR-11 a CR-30"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch2.md"
    summary: "i18n fix, WhatsApp template improvements, activity log, secretary permissions, sunday type dropdown fix, actors redesign, agenda enhancements"

  batch_3:
    range: "CR-31 a CR-43"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch3.md"
    summary: "Spec corrections, back button convention, debounce rules, CSV fixes, logout, timezone spec, topics search"

  batch_4:
    range: "CR-44 a CR-75"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CR_batch4.md"
    summary: "Docs update, speeches persistence, dead code wiring, error handling overhaul, CSV/members fixes, UI/UX improvements, auth fixes, agenda/actors enhancements, import-hymns CLI"

  batch_5:
    range: "CR-76 a CR-82"
    status: "todas implementadas"
    file: "docs/specs/history/SPEC_CONSOLIDATED_old.yaml (CR-77, 78, 82)"
    summary: "Users screen regression, back button, members explanatory text, user name field, expo-file-system v19 migration, GestureHandlerRootView"

  batch_6:
    range: "CR-83 a CR-90"
    status: "todas implementadas"
    files:
      - "docs/specs/SPEC_F027_F031.yaml (CR-83, 84, 85, 86, 90 - Fase 1)"
      - "docs/specs/SPEC_F032_F034.yaml (CR-87, 88, 89 - Fase 2)"
    summary: "Save/Cancel explicito, search clear button, country codes completo, import confirmation dialog, swipe icons, topics explanatory text, collection detail view, delete button fix"

  batch_7:
    range: "CR-91 a CR-100"
    status: "5 implementadas (91, 92, 93, 95, 98), 5 pendentes (94, 96, 97, 99, 100)"
    files:
      - "docs/specs/SPEC_F035_F039.yaml (CR-91, 92, 93, 95, 98 - Fase 1: Bug Fixes)"
      - "docs/specs/SPEC_F040_F044.yaml (CR-94, 96, 97, 99, 100 - Fase 2: UX & Features)"
    summary: "Fase 1 (implementada): RLS policy fix, duplicate key fix, deep link protocol, speech fields visibility, prayer fields clickable. Fase 2 (pendente): WhatsApp template i18n, search fields layout, multi-select recognizing, agenda speech labels, last-minute speaker swap."

  batch_8:
    range: "CR-101 a CR-111"
    status: "11 pendentes (101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111)"
    files:
      - "docs/specs/SPEC_F045_F049.yaml (CR-101, 102, 103, 104, 108, 109 - Fase 1: Display Fixes & WhatsApp Template)"
      - "docs/specs/SPEC_F050_F054.yaml (CR-105, 106, 107, 110, 111 - Fase 2: Invite Management UX)"
    summary: "Fase 1 (pendente): Hide LEDs on non-speech Sundays, hide speech exception label in Agenda, fix WhatsApp template in Settings, fix WhatsApp message variables (collection, link, quotes, date format), fix speech slots in Home NextSundaysSection. Fase 2 (pendente): WhatsApp icon button, custom status dropdown, status line in invite row, bishopric access to invite section, LED-X spacing."

  batch_9:
    range: "CR-112 a CR-125"
    status: "14 pendentes"
    files:
      - "docs/specs/SPEC_F055_F059.yaml (CR-112, 113, 117, 122, 125 - Fase 1: Bug Fixes & Quick UI)"
      - "docs/specs/SPEC_F060_F064.yaml (CR-114, 115, 116, 119, 121 - Fase 2: Speech Cards & Agenda)"
      - "docs/specs/SPEC_F065_F068.yaml (CR-118, 120, 123, 124 - Fase 3: UX Polish)"
    summary: "Fase 1: WhatsApp view conversation fix, dropdown title fix, country code display fix, last speech label, prayer selector duplicate fix. Fase 2: Topic clear button, confirmation on type change, LED status filter, speech slot reorder, last-minute label. Fase 3: Search field width, auto-scroll on expand, recognizing per-line, custom prayer names."

  batch_10:
    range: "CR-126 a CR-133"
    status: "4 pendentes fase 1 (126, 127, 129, 130), 4 pendentes fase 2 (128, 131, 132, 133)"
    files:
      - "docs/specs/SPEC_F069_F072.yaml (CR-126, 127, 129, 130 - Fase 1: LED Redesign, Data Cleanup, Status Options, Country Code Fix)"
      - "docs/specs/SPEC_F073.yaml (CR-128 - Fase 2: Topic X Button)"
      - "docs/specs/SPEC_F074.yaml (CR-131 - Fase 2: Hymn Search Width)"
      - "docs/specs/SPEC_F075.yaml (CR-132 - Fase 2: Auto-Scroll Fix)"
      - "docs/specs/SPEC_F076.yaml (CR-133 - Fase 2: Custom Prayer UX)"
    summary: "Fase 1 (pendente): LED flat redesign, delete speeches on type change, LED click all status options, country code display fix. Fase 2 (pendente): Topic X button outside field, hymn search field width consistency, auto-scroll fix (remove getItemLayout), custom prayer name UX (discoverability + re-editing)."

  batch_11:
    range: "CR-134 a CR-138"
    status: "5 pendentes (134, 135, 136, 137, 138)"
    files:
      - "docs/specs/SPEC_F077.yaml (CR-134: Status options fix - regression of CR-129)"
      - "docs/specs/SPEC_F078.yaml (CR-135: Custom name hint text change)"
      - "docs/specs/SPEC_F079.yaml (CR-136: Agenda initial scroll fix)"
      - "docs/specs/SPEC_F080.yaml (CR-137: Checkbox UX for recognizing presence)"
      - "docs/specs/SPEC_F081.yaml (CR-138: Actor delete confirmation text)"
    summary: "Status options regression fix (show all except current and not_assigned in both InviteActionDropdown and StatusChangeModal), custom name hint text improvement, Agenda tab initial scroll to center next sunday, checkbox-style UX for multi-select recognizing presence, actor delete confirmation text context-specific."

  batch_12:
    range: "CR-139"
    status: "1 pendente (139)"
    files:
      - "docs/specs/SPEC_F082.yaml (CR-139: Integration tests)"
    summary: "Integration tests covering hooks+Supabase+ReactQuery, SyncProvider orchestration, AuthContext flow, and component-hook data flow. 30 acceptance criteria, 5 new files, 0 existing files modified."

  batch_13:
    range: "CR-140 a CR-144"
    status: "5 pendentes (140, 141, 142, 143, 144)"
    files:
      - "docs/specs/SPEC_F083.yaml (CR-140 to CR-144 - Settings Rename, Agenda Sunday Type, Activity Log i18n, Query Perf, Security)"
    summary: "Settings tab options renamed with i18n, Sunday type selector in Agenda tab, Activity log entries overhaul with structured format and i18n, Replace pg_timezone_names with static list (analysis), Fix mutable search_path in 7 PostgreSQL functions."

  batch_14:
    range: "CR-145 a CR-153"
    status: "5 pendentes fase 1 (145, 146, 147, 148, 149), 4 pendentes fase 2 (150, 151, 152, 153)"
    files:
      - "docs/specs/SPEC_F088.yaml (CR-145 - Email Reset Customization)"
      - "docs/specs/SPEC_F089.yaml (CR-146 - Offline Graceful Degradation)"
      - "docs/specs/SPEC_F090.yaml (CR-147 - Offline Banner Readability)"
      - "docs/specs/SPEC_F091.yaml (CR-148 - Sunday Type Change Confirmation)"
      - "docs/specs/SPEC_F092.yaml (CR-149 - Presentation Mode Button Always Visible)"
      - "docs/specs/SPEC_F093_F096.yaml (CR-150 to CR-153 - Card Layouts, Pianist/Conductor, Hymn Toggle, Status Lines)"
    summary: "Phase 1: Password reset email customization (branding + redirect URL), graceful offline degradation (suppress errors, show cache, reconnect), offline banner readability on iPhone (safe area insets), sunday type change confirmation message with specific text (i18n), presentation mode button always visible (remove Sunday-only condition). Phase 2: Collapsed card layouts with speaker names and vertical LEDs, pianist/conductor fields in agenda welcome section, toggle for intermediate hymn, collapsed agenda card status lines with completion info."

  batch_15:
    range: "CR-155 a CR-164"
    status: "8 pendentes fase 1 (156, 157, 158, 159, 160, 161, 162, 163), 2 pendentes fase 2 (155, 164)"
    files:
      - "docs/specs/SPEC_F097_F100.yaml (CR-156 to CR-163 - Presentation mode, Speech labels, Card redesign)"
      - "docs/specs/SPEC_F101_F102.yaml (CR-155, CR-164 - Multilingual reset email, Test suite fix)"
    summary: "Phase 1: Presentation mode improvements (arrows, recognized names, font size, section titles), speech label context-aware display, collapsed speech card redesign, expanded speech status circle repositioning. Phase 2: Multilingual password reset email via Edge Function (3 languages), test suite 100% passing."

  batch_16:
    range: "CR-165 a CR-171"
    status: "7 pendentes (165, 166, 167, 168, 169, 170, 171)"
    files:
      - "docs/specs/SPEC_F103_F109.yaml (CR-165 to CR-171 - UI polish, accent fixes, UX improvements)"
    summary: "Align status circle with X button in speech cards, presentation title rename + font lock, Portuguese accent/cedilla fixes in section headers, increase back button tap area in Settings, equalize status LED sizes in collapsed cards, fix last speech label redundancy, collapsed agenda cards status lines for special meetings."

  batch_17:
    range: "CR-172 a CR-174"
    status: "3 pendentes (172, 173, 174)"
    files:
      - "docs/specs/SPEC_F110_F112.yaml (CR-172 to CR-174 - Stake announcements in presentation, AgendaForm label fix, SpeechSlot alignment)"
    summary: "Add stake announcements card to presentation mode when toggle is on (3 languages), fix redundant last speech label in AgendaForm, restructure SpeechSlot layout for center-to-center alignment of StatusLED and X button (supersedes CR-165 approach)."

  batch_18:
    range: "CR-175 a CR-177"
    status: "3 pendentes (175, 176, 177)"
    files:
      - "docs/specs/SPEC_F113_F115.yaml (CR-175 to CR-177 - Deep link scheme fix, Email reset HTTPS redirect, Status circle right-alignment)"
    summary: "Change deep link scheme from sacrmeetman:// to sacrmeetplan:// in 3 files, create HTTPS redirect Edge Function (reset-redirect) so email reset button is clickable in email clients, align right edge of StatusLED circle with right edge of speaker name field (supersedes F112 center-to-center approach)."

  batch_19:
    range: "CR-178, CR-179, CR-180, CR-181, CR-182, CR-183, CR-187, CR-189, CR-191, CR-192"
    status: "4 pendentes fase 1 (178, 180, 181, 191), 6 pendentes fase 2 (179, 182, 183, 187, 189, 192)"
    files:
      - "docs/specs/SPEC_F116_F119.yaml (CR-178, CR-180, CR-181, CR-191 - Language control, Pianist/Conductor split, Optional 2nd speech, Password reset bug)"
      - "docs/specs/SPEC_F120_F125.yaml (CR-179, CR-182, CR-183, CR-187, CR-189, CR-192 - Card UI/UX, Label renames, Push notifications bug)"
    summary: "Phase 1 (pending): Separate app/ward language control, split can_music into can_pianist/can_conductor, optional 2nd speech toggle, password reset HTML rendering fix. Phase 2 (pending): X clear buttons on agenda selector fields, remove speech editing from agenda card (pencil nav to Speeches tab), rename 'Proximas Designacoes' to 'Proximos Discursos', rename tab 'Agenda' to 'Agendas', fix X alignment in SpeechSlot, fix push notifications (projectId undefined)."

  batch_20:
    range: "CR-184, CR-185, CR-186, CR-188"
    status: "4 pendentes (184, 185, 186, 188)"
    files:
      - "docs/specs/SPEC_F126_F129.yaml (CR-184, CR-185, CR-186, CR-188 - Navigation & Home redesign)"
    summary: "X clear button for Speeches tab selectors, remove speech editing from agenda card (pencil nav to Speeches), rename 'Proximos Discursos' section, simplify NextSundaysSection to non-expandable cards with pencil navigation."

  batch_21:
    range: "CR-193, CR-194, CR-195, CR-196, CR-197, CR-198, CR-199, CR-200"
    status: "5 pendentes fase 1 (194, 195, 196, 197, 198), 3 pendentes fase 2 (193, 199, 200)"
    files:
      - "docs/specs/SPEC_F130_F134.yaml (CR-194-CR-198 - Bug fixes: TS errors, ward language, 2nd speech toggle, email language, reset redirect)"
      - "docs/specs/SPEC_F135_F137.yaml (CR-193, CR-199, CR-200 - Settings reorganization, StatusLED alignment, play icon size)"
    summary: "Phase 1: Fix TS errors and actor role naming after Pianist/Conductor split (F130), fix ward language switch not updating AuthContext (F131), fix 2nd speech toggle bugs: topic clearing, disabled fields with placeholder, dynamic X/2 vs X/3 (F132), fix password reset email to use user app language (F133), remove script tag from reset-redirect (F134). Phase 2: Reorganize Settings tab into 2 labeled groups Ward Settings and App Settings (F135), align StatusLED right edge with speaker field right edge (F136), enlarge play icon in Home button and Agenda card (F137)."

  batch_22:
    range: "CR-202, CR-203"
    status: "2 pendentes fase 1 (202, 203)"
    files:
      - "docs/specs/SPEC_F138_F139.yaml (CR-202, CR-203 - Password reset web page, invitation acceptance web page)"
    summary: "Phase 1: Rewrite reset-redirect Edge Function to serve complete password reset web page with form using Supabase JS via CDN (F138), create invite-redirect Edge Function with invitation acceptance web page and update create-invitation to return HTTPS URL instead of deep link (F139)."

  batch_23:
    range: "CR-205, CR-206, CR-207"
    status: "3 pendentes fase 1 (205, 206, 207)"
    files:
      - "docs/specs/SPEC_F140_F141_F142.yaml (CR-205, CR-206, CR-207 - Invite error handling, language switch collections/template, WhatsApp template disconnect)"
    summary: "Phase 1: Improve invite user error handling to show server error message instead of generic text, suppress duplicate MutationCache alert (F140). Fix language switch breaking collections by seeding general_collections for en/es, reset whatsapp_template to NULL on language change, reset initialized flag in whatsapp.tsx (F141). Fix WhatsApp send to use ward template from DB instead of hardcoded empty string, use wardLanguage instead of app language (F142)."
